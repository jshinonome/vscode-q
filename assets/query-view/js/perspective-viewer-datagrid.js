(function (root, factory) {
        if (typeof define === 'function' && define.amd) {
            define(['exports'], factory);
        } else if (typeof exports === 'object' && typeof exports.nodeName !== 'string') {
            factory(exports);
        } else {
            factory((root.perspective_datagrid = {}));
        }
    }(typeof self !== 'undefined' ? self : this, function (exports) {
    
var vo=Object.create;var Gt=Object.defineProperty;var yo=Object.getOwnPropertyDescriptor;var wo=Object.getOwnPropertyNames;var xo=Object.getPrototypeOf,ko=Object.prototype.hasOwnProperty;var Lo=t=>Gt(t,"__esModule",{value:!0});var qt=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports);var Mo=(t,r,l)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of wo(r))!ko.call(t,i)&&i!=="default"&&Gt(t,i,{get:()=>r[i],enumerable:!(l=yo(r,i))||l.enumerable});return t},dt=t=>Mo(Lo(Gt(t!=null?vo(xo(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var gt=qt((ht,pt)=>{(function(){var t,r,l,i,n,_,h,g,b,k,v,E,I,C,P,z,j,T,K,p,Z,me,V,W,oe,re,fe,le,Se,qe,je,Be,Ve,se,Fe,Ne,Re,ue,ve,Oe,he,We,ye,we,Ee,Ue,Ce,pe,$e,vt,rr,q,or,sr,lr,ir,_e,nr,ar,cr,fr,_r,ur,dr,It,Tt,Dt,hr,pr,gr,yt,wt,br,xe,mr,Ke,Le,Ht,ee,te,Ie,xt,kt,Me=[].slice;ee=function(){var e,o,s,a,c;for(e={},c="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),a=0,o=c.length;a<o;a++)s=c[a],e["[object "+s+"]"]=s.toLowerCase();return function(f){var u;return u=Object.prototype.toString.call(f),e[u]||"object"}}(),pe=function(e,o,s){return o==null&&(o=0),s==null&&(s=1),e<o&&(e=o),e>s&&(e=s),e},te=function(e){return e.length>=3?Array.prototype.slice.call(e):e[0]},Z=function(e){var o,s;for(e._clipped=!1,e._unclipped=e.slice(0),o=s=0;s<3;o=++s)o<3?((e[o]<0||e[o]>255)&&(e._clipped=!0),e[o]<0&&(e[o]=0),e[o]>255&&(e[o]=255)):o===3&&(e[o]<0&&(e[o]=0),e[o]>1&&(e[o]=1));return e._clipped||delete e._unclipped,e},i=Math.PI,xe=Math.round,W=Math.cos,Se=Math.floor,_e=Math.pow,$e=Math.log,Ke=Math.sin,Le=Math.sqrt,C=Math.atan2,q=Math.max,I=Math.abs,h=i*2,n=i/3,r=i/180,_=180/i,p=function(){return arguments[0]instanceof t?arguments[0]:function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,arguments,function(){})},p.default=p,E=[],typeof pt!="undefined"&&pt!==null&&pt.exports!=null&&(pt.exports=p),typeof define=="function"&&define.amd?define([],function(){return p}):(br=typeof ht!="undefined"&&ht!==null?ht:this,br.chroma=p),p.version="1.4.1",v={},b=[],k=!1,t=function(){function e(){var o,s,a,c,f,u,d,m,w;for(u=this,s=[],m=0,c=arguments.length;m<c;m++)o=arguments[m],o!=null&&s.push(o);if(s.length>1&&(d=s[s.length-1]),v[d]!=null)u._rgb=Z(v[d](te(s.slice(0,-1))));else{for(k||(b=b.sort(function(L,O){return O.p-L.p}),k=!0),w=0,f=b.length;w<f&&(a=b[w],d=a.test.apply(a,s),!d);w++);d&&(u._rgb=Z(v[d].apply(v,s)))}u._rgb==null&&console.warn("unknown format: "+s),u._rgb==null&&(u._rgb=[0,0,0]),u._rgb.length===3&&u._rgb.push(1)}return e.prototype.toString=function(){return this.hex()},e}(),p._input=v;p.brewer=T={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var e,o;o=[];for(e in T)o.push(T[e.toLowerCase()]=T[e]);return o}(),Ie={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},p.colors=V=Ie,ye=function(){var e,o,s,a,c,f,u,d,m;return o=te(arguments),c=o[0],e=o[1],s=o[2],d=(c+16)/116,u=isNaN(e)?d:d+e/500,m=isNaN(s)?d:d-s/200,d=l.Yn*we(d),u=l.Xn*we(u),m=l.Zn*we(m),f=kt(3.2404542*u-1.5371385*d-.4985314*m),a=kt(-.969266*u+1.8760108*d+.041556*m),s=kt(.0556434*u-.2040259*d+1.0572252*m),[f,a,s,o.length>3?o[3]:1]},kt=function(e){return 255*(e<=.00304?12.92*e:1.055*_e(e,1/2.4)-.055)},we=function(e){return e>l.t1?e*e*e:l.t2*(e-l.t0)},l={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},It=function(){var e,o,s,a,c,f,u,d;return a=te(arguments),s=a[0],o=a[1],e=a[2],c=gr(s,o,e),f=c[0],u=c[1],d=c[2],[116*u-16,500*(f-u),200*(u-d)]},yt=function(e){return(e/=255)<=.04045?e/12.92:_e((e+.055)/1.055,2.4)},xt=function(e){return e>l.t3?_e(e,1/3):e/l.t2+l.t0},gr=function(){var e,o,s,a,c,f,u;return a=te(arguments),s=a[0],o=a[1],e=a[2],s=yt(s),o=yt(o),e=yt(e),c=xt((.4124564*s+.3575761*o+.1804375*e)/l.Xn),f=xt((.2126729*s+.7151522*o+.072175*e)/l.Yn),u=xt((.0193339*s+.119192*o+.9503041*e)/l.Zn),[c,f,u]},p.lab=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["lab"]),function(){})},v.lab=ye,t.prototype.lab=function(){return It(this._rgb)},P=function(e){var o,s,a,c,f,u,d,m,w,L,O;return e=function(){var M,x,A;for(A=[],x=0,M=e.length;x<M;x++)c=e[x],A.push(p(c));return A}(),e.length===2?(w=function(){var M,x,A;for(A=[],x=0,M=e.length;x<M;x++)c=e[x],A.push(c.lab());return A}(),f=w[0],u=w[1],o=function(M){var x,A;return A=function(){var N,R;for(R=[],x=N=0;N<=2;x=++N)R.push(f[x]+M*(u[x]-f[x]));return R}(),p.lab.apply(p,A)}):e.length===3?(L=function(){var M,x,A;for(A=[],x=0,M=e.length;x<M;x++)c=e[x],A.push(c.lab());return A}(),f=L[0],u=L[1],d=L[2],o=function(M){var x,A;return A=function(){var N,R;for(R=[],x=N=0;N<=2;x=++N)R.push((1-M)*(1-M)*f[x]+2*(1-M)*M*u[x]+M*M*d[x]);return R}(),p.lab.apply(p,A)}):e.length===4?(O=function(){var M,x,A;for(A=[],x=0,M=e.length;x<M;x++)c=e[x],A.push(c.lab());return A}(),f=O[0],u=O[1],d=O[2],m=O[3],o=function(M){var x,A;return A=function(){var N,R;for(R=[],x=N=0;N<=2;x=++N)R.push((1-M)*(1-M)*(1-M)*f[x]+3*(1-M)*(1-M)*M*u[x]+3*(1-M)*M*M*d[x]+M*M*M*m[x]);return R}(),p.lab.apply(p,A)}):e.length===5&&(s=P(e.slice(0,3)),a=P(e.slice(2,5)),o=function(M){return M<.5?s(M*2):a((M-.5)*2)}),o},p.bezier=function(e){var o;return o=P(e),o.scale=function(){return p.scale(o)},o},p.cubehelix=function(e,o,s,a,c){var f,u,d;return e==null&&(e=300),o==null&&(o=-1.5),s==null&&(s=1),a==null&&(a=1),c==null&&(c=[0,1]),f=0,ee(c)==="array"?u=c[1]-c[0]:(u=0,c=[c,c]),d=function(m){var w,L,O,M,x,A,N,R,X;return w=h*((e+120)/360+o*m),N=_e(c[0]+u*m,a),A=f!==0?s[0]+m*f:s,L=A*N*(1-N)/2,M=W(w),X=Ke(w),R=N+L*(-.14861*M+1.78277*X),x=N+L*(-.29227*M-.90649*X),O=N+L*(1.97294*M),p(Z([R*255,x*255,O*255,1]))},d.start=function(m){return m==null?e:(e=m,d)},d.rotations=function(m){return m==null?o:(o=m,d)},d.gamma=function(m){return m==null?a:(a=m,d)},d.hue=function(m){return m==null?s:(s=m,ee(s)==="array"?(f=s[1]-s[0],f===0&&(s=s[1])):f=0,d)},d.lightness=function(m){return m==null?c:(ee(m)==="array"?(c=m,u=m[1]-m[0]):(c=[m,m],u=0),d)},d.scale=function(){return p.scale(d)},d.hue(s),d},p.random=function(){var e,o,s,a;for(o="0123456789abcdef",e="#",s=a=0;a<6;s=++a)e+=o.charAt(Se(Math.random()*16));return new t(e)},E=[],Ne=function(e,o,s,a){var c,f,u,d;for(s==null&&(s=.5),a==null&&(a="rgb"),ee(e)!=="object"&&(e=p(e)),ee(o)!=="object"&&(o=p(o)),u=0,f=E.length;u<f;u++)if(c=E[u],a===c[0]){d=c[1](e,o,s,a);break}if(d==null)throw"color mode "+a+" is not supported";return d.alpha(e.alpha()+s*(o.alpha()-e.alpha()))},p.interpolate=Ne,t.prototype.interpolate=function(e,o,s){return Ne(this,e,o,s)},p.mix=Ne,t.prototype.mix=t.prototype.interpolate,v.rgb=function(){var e,o,s,a;o=te(arguments),s=[];for(e in o)a=o[e],s.push(a);return s},p.rgb=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["rgb"]),function(){})},t.prototype.rgb=function(e){return e==null&&(e=!0),e?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},t.prototype.rgba=function(e){return e==null&&(e=!0),e?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},b.push({p:3,test:function(e){var o;if(o=te(arguments),ee(o)==="array"&&o.length===3||o.length===4&&ee(o[3])==="number"&&o[3]>=0&&o[3]<=1)return"rgb"}}),v.lrgb=v.rgb,ve=function(e,o,s,a){var c,f;return c=e._rgb,f=o._rgb,new t(Le(_e(c[0],2)*(1-s)+_e(f[0],2)*s),Le(_e(c[1],2)*(1-s)+_e(f[1],2)*s),Le(_e(c[2],2)*(1-s)+_e(f[2],2)*s),a)},g=function(e){var o,s,a,c,f,u;for(s=1/e.length,u=[0,0,0,0],c=0,a=e.length;c<a;c++)o=e[c],f=o._rgb,u[0]+=_e(f[0],2)*s,u[1]+=_e(f[1],2)*s,u[2]+=_e(f[2],2)*s,u[3]+=f[3]*s;return u[0]=Le(u[0]),u[1]=Le(u[1]),u[2]=Le(u[2]),u[3]>1&&(u[3]=1),new t(Z(u))},E.push(["lrgb",ve]),p.average=function(e,o){var s,a,c,f,u,d,m,w,L,O,M,x,A;if(o==null&&(o="rgb"),L=e.length,e=e.map(function(N){return p(N)}),m=e.splice(0,1)[0],o==="lrgb")return g(e);x=m.get(o),f=[],u=0,d=0;for(w in x)x[w]=x[w]||0,f.push(isNaN(x[w])?0:1),o.charAt(w)==="h"&&!isNaN(x[w])&&(s=x[w]/180*i,u+=W(s),d+=Ke(s));for(a=m.alpha(),M=0,O=e.length;M<O;M++){c=e[M],A=c.get(o),a+=c.alpha();for(w in x)isNaN(A[w])||(f[w]+=1,o.charAt(w)==="h"?(s=A[w]/180*i,u+=W(s),d+=Ke(s)):x[w]+=A[w])}for(w in x)if(o.charAt(w)==="h"){for(s=C(d/f[w],u/f[w])/i*180;s<0;)s+=360;for(;s>=360;)s-=360;x[w]=s}else x[w]=x[w]/f[w];return p(x,o).alpha(a/L)},je=function(e){var o,s,a,c,f,u;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(e.length===4||e.length===7)&&(e=e.substr(1)),e.length===3&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),u=parseInt(e,16),c=u>>16,a=u>>8&255,s=u&255,[c,a,s,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return e.length===9&&(e=e.substr(1)),u=parseInt(e,16),c=u>>24&255,a=u>>16&255,s=u>>8&255,o=xe((u&255)/255*100)/100,[c,a,s,o];if(v.css!=null&&(f=v.css(e)))return f;throw"unknown color: "+e},fr=function(e,o){var s,a,c,f,u,d,m;return o==null&&(o="auto"),u=e[0],c=e[1],a=e[2],s=e[3],o==="auto"&&(o=s<1?"rgba":"rgb"),u=Math.round(u),c=Math.round(c),a=Math.round(a),m=u<<16|c<<8|a,d="000000"+m.toString(16),d=d.substr(d.length-6),f="0"+xe(s*255).toString(16),f=f.substr(f.length-2),"#"+function(){switch(o.toLowerCase()){case"rgba":return d+f;case"argb":return f+d;default:return d}}()},v.hex=function(e){return je(e)},p.hex=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["hex"]),function(){})},t.prototype.hex=function(e){return e==null&&(e="auto"),fr(this._rgb,e)},b.push({p:4,test:function(e){if(arguments.length===1&&ee(e)==="string")return"hex"}}),se=function(){var e,o,s,a,c,f,u,d,m,w,L,O,M,x;if(e=te(arguments),c=e[0],L=e[1],u=e[2],L===0)m=a=o=u*255;else{for(x=[0,0,0],s=[0,0,0],M=u<.5?u*(1+L):u+L-u*L,O=2*u-M,c/=360,x[0]=c+1/3,x[1]=c,x[2]=c-1/3,f=d=0;d<=2;f=++d)x[f]<0&&(x[f]+=1),x[f]>1&&(x[f]-=1),6*x[f]<1?s[f]=O+(M-O)*6*x[f]:2*x[f]<1?s[f]=M:3*x[f]<2?s[f]=O+(M-O)*(2/3-x[f])*6:s[f]=O;w=[xe(s[0]*255),xe(s[1]*255),xe(s[2]*255)],m=w[0],a=w[1],o=w[2]}return e.length>3?[m,a,o,e[3]]:[m,a,o]},ur=function(e,o,s){var a,c,f,u,d;return e!==void 0&&e.length>=3&&(u=e,e=u[0],o=u[1],s=u[2]),e/=255,o/=255,s/=255,f=Math.min(e,o,s),q=Math.max(e,o,s),c=(q+f)/2,q===f?(d=0,a=Number.NaN):d=c<.5?(q-f)/(q+f):(q-f)/(2-q-f),e===q?a=(o-s)/(q-f):o===q?a=2+(s-e)/(q-f):s===q&&(a=4+(e-o)/(q-f)),a*=60,a<0&&(a+=360),[a,d,c]},p.hsl=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["hsl"]),function(){})},v.hsl=se,t.prototype.hsl=function(){return ur(this._rgb)},Fe=function(){var e,o,s,a,c,f,u,d,m,w,L,O,M,x,A,N,R,X;if(e=te(arguments),c=e[0],N=e[1],X=e[2],X*=255,N===0)m=a=o=X;else switch(c===360&&(c=0),c>360&&(c-=360),c<0&&(c+=360),c/=60,f=Se(c),s=c-f,u=X*(1-N),d=X*(1-N*s),R=X*(1-N*(1-s)),f){case 0:w=[X,R,u],m=w[0],a=w[1],o=w[2];break;case 1:L=[d,X,u],m=L[0],a=L[1],o=L[2];break;case 2:O=[u,X,R],m=O[0],a=O[1],o=O[2];break;case 3:M=[u,d,X],m=M[0],a=M[1],o=M[2];break;case 4:x=[R,u,X],m=x[0],a=x[1],o=x[2];break;case 5:A=[X,u,d],m=A[0],a=A[1],o=A[2]}return[m,a,o,e.length>3?e[3]:1]},dr=function(){var e,o,s,a,c,f,u,d,m;return u=te(arguments),f=u[0],s=u[1],e=u[2],c=Math.min(f,s,e),q=Math.max(f,s,e),o=q-c,m=q/255,q===0?(a=Number.NaN,d=0):(d=o/q,f===q&&(a=(s-e)/o),s===q&&(a=2+(e-f)/o),e===q&&(a=4+(f-s)/o),a*=60,a<0&&(a+=360)),[a,d,m]},p.hsv=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["hsv"]),function(){})},v.hsv=Fe,t.prototype.hsv=function(){return dr(this._rgb)},lr=function(e){var o,s,a;return ee(e)==="number"&&e>=0&&e<=16777215?(a=e>>16,s=e>>8&255,o=e&255,[a,s,o,1]):(console.warn("unknown num color: "+e),[0,0,0,1])},hr=function(){var e,o,s,a;return a=te(arguments),s=a[0],o=a[1],e=a[2],(s<<16)+(o<<8)+e},p.num=function(e){return new t(e,"num")},t.prototype.num=function(e){return e==null&&(e="rgb"),hr(this._rgb,e)},v.num=lr,b.push({p:1,test:function(e){if(arguments.length===1&&ee(e)==="number"&&e>=0&&e<=16777215)return"num"}}),qe=function(){var e,o,s,a,c,f,u,d,m,w,L,O,M,x,A,N,R,X,ie,F;if(s=te(arguments),d=s[0],c=s[1],o=s[2],c=c/100,u=u/100*255,e=c*255,c===0)O=u=a=o;else switch(d===360&&(d=0),d>360&&(d-=360),d<0&&(d+=360),d/=60,m=Se(d),f=d-m,w=o*(1-c),L=w+e*(1-f),ie=w+e*f,F=w+e,m){case 0:M=[F,ie,w],O=M[0],u=M[1],a=M[2];break;case 1:x=[L,F,w],O=x[0],u=x[1],a=x[2];break;case 2:A=[w,F,ie],O=A[0],u=A[1],a=A[2];break;case 3:N=[w,L,F],O=N[0],u=N[1],a=N[2];break;case 4:R=[ie,w,F],O=R[0],u=R[1],a=R[2];break;case 5:X=[F,w,L],O=X[0],u=X[1],a=X[2]}return[O,u,a,s.length>3?s[3]:1]},cr=function(){var e,o,s,a,c,f,u,d,m;return m=te(arguments),d=m[0],c=m[1],o=m[2],u=Math.min(d,c,o),q=Math.max(d,c,o),a=q-u,s=a*100/255,e=u/(255-a)*100,a===0?f=Number.NaN:(d===q&&(f=(c-o)/a),c===q&&(f=2+(o-d)/a),o===q&&(f=4+(d-c)/a),f*=60,f<0&&(f+=360)),[f,s,e]},p.hcg=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["hcg"]),function(){})},v.hcg=qe,t.prototype.hcg=function(){return cr(this._rgb)},oe=function(e){var o,s,a,c,f,u,d,m;if(e=e.toLowerCase(),p.colors!=null&&p.colors[e])return je(p.colors[e]);if(f=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(d=f.slice(1,4),c=u=0;u<=2;c=++u)d[c]=+d[c];d[3]=1}else if(f=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(d=f.slice(1,5),c=m=0;m<=3;c=++m)d[c]=+d[c];else if(f=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(d=f.slice(1,4),c=o=0;o<=2;c=++o)d[c]=xe(d[c]*2.55);d[3]=1}else if(f=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(d=f.slice(1,5),c=s=0;s<=2;c=++s)d[c]=xe(d[c]*2.55);d[3]=+d[3]}else(f=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(a=f.slice(1,4),a[1]*=.01,a[2]*=.01,d=se(a),d[3]=1):(f=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(a=f.slice(1,4),a[1]*=.01,a[2]*=.01,d=se(a),d[3]=+f[4]);return d},ar=function(e){var o;if(o=e[3]<1?"rgba":"rgb",o==="rgb")return o+"("+e.slice(0,3).map(xe).join(",")+")";if(o==="rgba")return o+"("+e.slice(0,3).map(xe).join(",")+","+e[3]+")"},wt=function(e){return xe(e*100)/100},Ve=function(e,o){var s;return s=o<1?"hsla":"hsl",e[0]=wt(e[0]||0),e[1]=wt(e[1]*100)+"%",e[2]=wt(e[2]*100)+"%",s==="hsla"&&(e[3]=o),s+"("+e.join(",")+")"},v.css=function(e){return oe(e)},p.css=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["css"]),function(){})},t.prototype.css=function(e){if(e==null&&(e="rgb"),e.slice(0,3)==="rgb")return ar(this._rgb);if(e.slice(0,3)==="hsl")return Ve(this.hsl(),this.alpha())},v.named=function(e){return je(Ie[e])},b.push({p:5,test:function(e){if(arguments.length===1&&Ie[e]!=null)return"named"}}),t.prototype.name=function(e){var o,s;arguments.length&&(Ie[e]&&(this._rgb=je(Ie[e])),this._rgb[3]=1),o=this.hex("rgb");for(s in Ie)if(o===Ie[s])return s;return o},Ee=function(){var e,o,s,a;return a=te(arguments),s=a[0],e=a[1],o=a[2],o=o*r,[s,W(o)*e,Ke(o)*e]},Ue=function(){var e,o,s,a,c,f,u,d,m,w,L;return s=te(arguments),d=s[0],c=s[1],u=s[2],w=Ee(d,c,u),e=w[0],o=w[1],a=w[2],L=ye(e,o,a),m=L[0],f=L[1],a=L[2],[m,f,a,s.length>3?s[3]:1]},We=function(){var e,o,s,a,c,f;return f=te(arguments),c=f[0],e=f[1],o=f[2],s=Le(e*e+o*o),a=(C(o,e)*_+360)%360,xe(s*1e4)===0&&(a=Number.NaN),[c,s,a]},Tt=function(){var e,o,s,a,c,f,u;return f=te(arguments),c=f[0],s=f[1],o=f[2],u=It(c,s,o),a=u[0],e=u[1],o=u[2],We(a,e,o)},p.lch=function(){var e;return e=te(arguments),new t(e,"lch")},p.hcl=function(){var e;return e=te(arguments),new t(e,"hcl")},v.lch=Ue,v.hcl=function(){var e,o,s,a;return a=te(arguments),o=a[0],e=a[1],s=a[2],Ue([s,e,o])},t.prototype.lch=function(){return Tt(this._rgb)},t.prototype.hcl=function(){return Tt(this._rgb).reverse()},nr=function(e){var o,s,a,c,f,u,d,m,w;return e==null&&(e="rgb"),m=te(arguments),d=m[0],c=m[1],o=m[2],d=d/255,c=c/255,o=o/255,f=1-Math.max(d,Math.max(c,o)),a=f<1?1/(1-f):0,s=(1-d-f)*a,u=(1-c-f)*a,w=(1-o-f)*a,[s,u,w,f]},me=function(){var e,o,s,a,c,f,u,d,m;return o=te(arguments),a=o[0],u=o[1],m=o[2],f=o[3],e=o.length>4?o[4]:1,f===1?[0,0,0,e]:(d=a>=1?0:255*(1-a)*(1-f),c=u>=1?0:255*(1-u)*(1-f),s=m>=1?0:255*(1-m)*(1-f),[d,c,s,e])},v.cmyk=function(){return me(te(arguments))},p.cmyk=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["cmyk"]),function(){})},t.prototype.cmyk=function(){return nr(this._rgb)},v.gl=function(){var e,o,s,a,c;for(a=function(){var f,u;f=te(arguments),u=[];for(o in f)c=f[o],u.push(c);return u}.apply(this,arguments),e=s=0;s<=2;e=++s)a[e]*=255;return a},p.gl=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["gl"]),function(){})},t.prototype.gl=function(){var e;return e=this._rgb,[e[0]/255,e[1]/255,e[2]/255,e[3]]},Dt=function(e,o,s){var a;return a=te(arguments),e=a[0],o=a[1],s=a[2],e=vt(e),o=vt(o),s=vt(s),.2126*e+.7152*o+.0722*s},vt=function(e){return e/=255,e<=.03928?e/12.92:_e((e+.055)/1.055,2.4)},he=function(e,o,s,a){var c,f;return c=e._rgb,f=o._rgb,new t(c[0]+s*(f[0]-c[0]),c[1]+s*(f[1]-c[1]),c[2]+s*(f[2]-c[2]),a)},E.push(["rgb",he]),t.prototype.luminance=function(e,o){var s,a,c,f,u;return o==null&&(o="rgb"),arguments.length?(f=this._rgb,e===0?f=[0,0,0,this._rgb[3]]:e===1?f=[255,255,255,this[3]]:(s=Dt(this._rgb),a=1e-7,c=20,u=function(d,m){var w,L;return L=d.interpolate(m,.5,o),w=L.luminance(),Math.abs(e-w)<a||!c--?L:w>e?u(d,L):u(L,m)},s>e?f=u(p("black"),this).rgba():f=u(this,p("white")).rgba()),p(f).alpha(this.alpha())):Dt(this._rgb)},Ht=function(e){var o,s,a,c;return c=e/100,c<66?(a=255,s=-155.25485562709179-.44596950469579133*(s=c-2)+104.49216199393888*$e(s),o=c<20?0:-254.76935184120902+.8274096064007395*(o=c-10)+115.67994401066147*$e(o)):(a=351.97690566805693+.114206453784165*(a=c-55)-40.25366309332127*$e(a),s=325.4494125711974+.07943456536662342*(s=c-50)-28.0852963507957*$e(s),o=255),[a,s,o]},pr=function(){var e,o,s,a,c,f,u,d,m;for(u=te(arguments),f=u[0],s=u[1],e=u[2],c=1e3,a=4e4,o=.4;a-c>o;)m=(a+c)*.5,d=Ht(m),d[2]/d[0]>=e/f?a=m:c=m;return xe(m)},p.temperature=p.kelvin=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["temperature"]),function(){})},v.temperature=v.kelvin=v.K=Ht,t.prototype.temperature=function(){return pr(this._rgb)},t.prototype.kelvin=t.prototype.temperature,p.contrast=function(e,o){var s,a,c,f;return((c=ee(e))==="string"||c==="number")&&(e=new t(e)),((f=ee(o))==="string"||f==="number")&&(o=new t(o)),s=e.luminance(),a=o.luminance(),s>a?(s+.05)/(a+.05):(a+.05)/(s+.05)},p.distance=function(e,o,s){var a,c,f,u,d,m,w;s==null&&(s="lab"),((d=ee(e))==="string"||d==="number")&&(e=new t(e)),((m=ee(o))==="string"||m==="number")&&(o=new t(o)),f=e.get(s),u=o.get(s),w=0;for(c in f)a=(f[c]||0)-(u[c]||0),w+=a*a;return Math.sqrt(w)},p.deltaE=function(e,o,s,a){var c,f,u,d,m,w,L,O,M,x,A,N,R,X,ie,F,ze,ke,$,U,ge,y,S,H,G,D,B;for(s==null&&(s=1),a==null&&(a=1),((ze=ee(e))==="string"||ze==="number")&&(e=new t(e)),((ke=ee(o))==="string"||ke==="number")&&(o=new t(o)),$=e.lab(),c=$[0],u=$[1],m=$[2],U=o.lab(),f=U[0],d=U[1],w=U[2],L=Le(u*u+m*m),O=Le(d*d+w*w),S=c<16?.511:.040975*c/(1+.01765*c),ge=.0638*L/(1+.0131*L)+.638,F=L<1e-6?0:C(m,u)*180/i;F<0;)F+=360;for(;F>=360;)F-=360;return H=F>=164&&F<=345?.56+I(.2*W(i*(F+168)/180)):.36+I(.4*W(i*(F+35)/180)),M=L*L*L*L,ie=Le(M/(M+1900)),y=ge*(ie*H+1-ie),X=c-f,R=L-O,A=u-d,N=m-w,x=A*A+N*N-R*R,G=X/(s*S),D=R/(a*ge),B=y,Le(G*G+D*D+x/(B*B))},t.prototype.get=function(e){var o,s,a,c,f,u;return a=this,f=e.split("."),c=f[0],o=f[1],u=a[c](),o?(s=c.indexOf(o),s>-1?u[s]:console.warn("unknown channel "+o+" in mode "+c)):u},t.prototype.set=function(e,o){var s,a,c,f,u,d;if(c=this,u=e.split("."),f=u[0],s=u[1],s)if(d=c[f](),a=f.indexOf(s),a>-1)if(ee(o)==="string")switch(o.charAt(0)){case"+":d[a]+=+o;break;case"-":d[a]+=+o;break;case"*":d[a]*=+o.substr(1);break;case"/":d[a]/=+o.substr(1);break;default:d[a]=+o}else d[a]=o;else console.warn("unknown channel "+s+" in mode "+f);else d=o;return p(d,f).alpha(c.alpha())},t.prototype.clipped=function(){return this._rgb._clipped||!1},t.prototype.alpha=function(e){return arguments.length?p.rgb([this._rgb[0],this._rgb[1],this._rgb[2],e]):this._rgb[3]},t.prototype.darken=function(e){var o,s;return e==null&&(e=1),s=this,o=s.lab(),o[0]-=l.Kn*e,p.lab(o).alpha(s.alpha())},t.prototype.brighten=function(e){return e==null&&(e=1),this.darken(-e)},t.prototype.darker=t.prototype.darken,t.prototype.brighter=t.prototype.brighten,t.prototype.saturate=function(e){var o,s;return e==null&&(e=1),s=this,o=s.lch(),o[1]+=e*l.Kn,o[1]<0&&(o[1]=0),p.lch(o).alpha(s.alpha())},t.prototype.desaturate=function(e){return e==null&&(e=1),this.saturate(-e)},t.prototype.premultiply=function(){var e,o;return o=this.rgb(),e=this.alpha(),p(o[0]*e,o[1]*e,o[2]*e,e)},z=function(e,o,s){if(!z[s])throw"unknown blend mode "+s;return z[s](e,o)},j=function(e){return function(o,s){var a,c;return a=p(s).rgb(),c=p(o).rgb(),p(e(a,c),"rgb")}},le=function(e){return function(o,s){var a,c,f;for(f=[],a=c=0;c<=3;a=++c)f[a]=e(o[a],s[a]);return f}},sr=function(e,o){return e},or=function(e,o){return e*o/255},re=function(e,o){return e>o?o:e},Ce=function(e,o){return e>o?e:o},mr=function(e,o){return 255*(1-(1-e/255)*(1-o/255))},ir=function(e,o){return o<128?2*e*o/255:255*(1-2*(1-e/255)*(1-o/255))},K=function(e,o){return 255*(1-(1-o/255)/(e/255))},fe=function(e,o){return e===255||(e=255*(o/255)/(1-e/255),e>255)?255:e},z.normal=j(le(sr)),z.multiply=j(le(or)),z.screen=j(le(mr)),z.overlay=j(le(ir)),z.darken=j(le(re)),z.lighten=j(le(Ce)),z.dodge=j(le(fe)),z.burn=j(le(K)),p.blend=z,p.analyze=function(e){var o,s,a,c;for(a={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},s=0,o=e.length;s<o;s++)c=e[s],c!=null&&!isNaN(c)&&(a.values.push(c),a.sum+=c,c<a.min&&(a.min=c),c>a.max&&(a.max=c),a.count+=1);return a.domain=[a.min,a.max],a.limits=function(f,u){return p.limits(a,f,u)},a},p.scale=function(e,o){var s,a,c,f,u,d,m,w,L,O,M,x,A,N,R,X,ie,F,ze,ke,$,U,ge;return O="rgb",M=p("#ccc"),R=0,d=!1,u=[0,1],N=[],A=[0,0],s=!1,c=[],x=!1,L=0,w=1,f=!1,a={},X=!0,m=1,U=function(y){var S,H,G,D,B,Q;if(y==null&&(y=["#fff","#000"]),y!=null&&ee(y)==="string"&&p.brewer!=null&&(y=p.brewer[y]||p.brewer[y.toLowerCase()]||y),ee(y)==="array"){for(y.length===1&&(y=[y[0],y[0]]),y=y.slice(0),S=G=0,D=y.length-1;0<=D?G<=D:G>=D;S=0<=D?++G:--G)H=y[S],ee(H)==="string"&&(y[S]=p(H));for(N.length=0,S=Q=0,B=y.length-1;0<=B?Q<=B:Q>=B;S=0<=B?++Q:--Q)N.push(S/(y.length-1))}return $(),c=y},ze=function(y){var S,H;if(s!=null){for(H=s.length-1,S=0;S<H&&y>=s[S];)S++;return S-1}return 0},ge=function(y){return y},ie=function(y){var S,H,G,D,B;return B=y,s.length>2&&(D=s.length-1,S=ze(y),G=s[0]+(s[1]-s[0])*(0+R*.5),H=s[D-1]+(s[D]-s[D-1])*(1-R*.5),B=L+(s[S]+(s[S+1]-s[S])*.5-G)/(H-G)*(w-L)),B},ke=function(y,S){var H,G,D,B,Q,J,ae,Y;if(S==null&&(S=!1),isNaN(y)||y===null)return M;if(S?Y=y:s&&s.length>2?(H=ze(y),Y=H/(s.length-2)):w!==L?Y=(y-L)/(w-L):Y=1,S||(Y=ge(Y)),m!==1&&(Y=_e(Y,m)),Y=A[0]+Y*(1-A[0]-A[1]),Y=Math.min(1,Math.max(0,Y)),B=Math.floor(Y*1e4),X&&a[B])G=a[B];else{if(ee(c)==="array")for(D=Q=0,ae=N.length-1;0<=ae?Q<=ae:Q>=ae;D=0<=ae?++Q:--Q){if(J=N[D],Y<=J){G=c[D];break}if(Y>=J&&D===N.length-1){G=c[D];break}if(Y>J&&Y<N[D+1]){Y=(Y-J)/(N[D+1]-J),G=p.interpolate(c[D],c[D+1],Y,O);break}}else ee(c)==="function"&&(G=c(Y));X&&(a[B]=G)}return G},$=function(){return a={}},U(e),F=function(y){var S;return S=p(ke(y)),x&&S[x]?S[x]():S},F.classes=function(y){var S;return y!=null?(ee(y)==="array"?(s=y,u=[y[0],y[y.length-1]]):(S=p.analyze(u),y===0?s=[S.min,S.max]:s=p.limits(S,"e",y)),F):s},F.domain=function(y){var S,H,G,D,B,Q,J;if(!arguments.length)return u;if(L=y[0],w=y[y.length-1],N=[],G=c.length,y.length===G&&L!==w)for(B=0,D=y.length;B<D;B++)H=y[B],N.push((H-L)/(w-L));else for(S=J=0,Q=G-1;0<=Q?J<=Q:J>=Q;S=0<=Q?++J:--J)N.push(S/(G-1));return u=[L,w],F},F.mode=function(y){return arguments.length?(O=y,$(),F):O},F.range=function(y,S){return U(y,S),F},F.out=function(y){return x=y,F},F.spread=function(y){return arguments.length?(R=y,F):R},F.correctLightness=function(y){return y==null&&(y=!0),f=y,$(),f?ge=function(S){var H,G,D,B,Q,J,ae,Y,de;for(H=ke(0,!0).lab()[0],G=ke(1,!0).lab()[0],ae=H>G,D=ke(S,!0).lab()[0],Q=H+(G-H)*S,B=D-Q,Y=0,de=1,J=20;Math.abs(B)>.01&&J-- >0;)(function(){return ae&&(B*=-1),B<0?(Y=S,S+=(de-S)*.5):(de=S,S+=(Y-S)*.5),D=ke(S,!0).lab()[0],B=D-Q})();return S}:ge=function(S){return S},F},F.padding=function(y){return y!=null?(ee(y)==="number"&&(y=[y,y]),A=y,F):A},F.colors=function(y,S){var H,G,D,B,Q,J,ae,Y,de;if(arguments.length<2&&(S="hex"),J=[],arguments.length===0)J=c.slice(0);else if(y===1)J=[F(.5)];else if(y>1)G=u[0],H=u[1]-G,J=function(){ae=[];for(var be=0;0<=y?be<y:be>y;0<=y?be++:be--)ae.push(be);return ae}.apply(this).map(function(be){return F(G+be/(y-1)*H)});else{if(e=[],Y=[],s&&s.length>2)for(D=de=1,Q=s.length;1<=Q?de<Q:de>Q;D=1<=Q?++de:--de)Y.push((s[D-1]+s[D])*.5);else Y=u;J=Y.map(function(be){return F(be)})}return p[S]&&(J=J.map(function(be){return be[S]()})),J},F.cache=function(y){return y!=null?(X=y,F):X},F.gamma=function(y){return y!=null?(m=y,F):m},F.nodata=function(y){return y!=null?(M=p(y),F):M},F},p.scales==null&&(p.scales={}),p.scales.cool=function(){return p.scale([p.hsl(180,1,.9),p.hsl(250,.7,.4)])},p.scales.hot=function(){return p.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},p.analyze=function(e,o,s){var a,c,f,u,d,m,w;if(d={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},s==null&&(s=function(){return!0}),a=function(L){L!=null&&!isNaN(L)&&(d.values.push(L),d.sum+=L,L<d.min&&(d.min=L),L>d.max&&(d.max=L),d.count+=1)},w=function(L,O){if(s(L,O))return o!=null&&ee(o)==="function"?a(o(L)):o!=null&&ee(o)==="string"||ee(o)==="number"?a(L[o]):a(L)},ee(e)==="array")for(u=0,f=e.length;u<f;u++)m=e[u],w(m);else for(c in e)m=e[c],w(m,c);return d.domain=[d.min,d.max],d.limits=function(L,O){return p.limits(d,L,O)},d},p.limits=function(e,o,s){var a,c,f,u,d,m,w,L,O,M,x,A,N,R,X,ie,F,ze,ke,$,U,ge,y,S,H,G,D,B,Q,J,ae,Y,de,be,Ze,Je,Qe,et,tt,rt,vr,ot,st,lt,it,nt,at,ct,ft,_t,mo,Te,Lt,yr,Ae,ut;if(o==null&&(o="equal"),s==null&&(s=7),ee(e)==="array"&&(e=p.analyze(e)),H=e.min,q=e.max,mo=e.sum,Ae=e.values.sort(function(Wt,$t){return Wt-$t}),s===1)return[H,q];if(y=[],o.substr(0,1)==="c"&&(y.push(H),y.push(q)),o.substr(0,1)==="e"){for(y.push(H),$=ae=1,Ze=s-1;1<=Ze?ae<=Ze:ae>=Ze;$=1<=Ze?++ae:--ae)y.push(H+$/s*(q-H));y.push(q)}else if(o.substr(0,1)==="l"){if(H<=0)throw"Logarithmic scales are only possible for values > 0";for(G=Math.LOG10E*$e(H),S=Math.LOG10E*$e(q),y.push(H),$=ut=1,Je=s-1;1<=Je?ut<=Je:ut>=Je;$=1<=Je?++ut:--ut)y.push(_e(10,G+$/s*(S-G)));y.push(q)}else if(o.substr(0,1)==="q"){for(y.push(H),$=a=1,ot=s-1;1<=ot?a<=ot:a>=ot;$=1<=ot?++a:--a)Y=(Ae.length-1)*$/s,de=Se(Y),de===Y?y.push(Ae[de]):(be=Y-de,y.push(Ae[de]*(1-be)+Ae[de+1]*be));y.push(q)}else if(o.substr(0,1)==="k"){for(B=Ae.length,R=new Array(B),ze=new Array(s),_t=!0,Q=0,ie=null,ie=[],ie.push(H),$=c=1,st=s-1;1<=st?c<=st:c>=st;$=1<=st?++c:--c)ie.push(H+$/s*(q-H));for(ie.push(q);_t;){for(U=f=0,lt=s-1;0<=lt?f<=lt:f>=lt;U=0<=lt?++f:--f)ze[U]=0;for($=u=0,it=B-1;0<=it?u<=it:u>=it;$=0<=it?++u:--u){for(yr=Ae[$],D=Number.MAX_VALUE,U=d=0,nt=s-1;0<=nt?d<=nt:d>=nt;U=0<=nt?++d:--d)ke=I(ie[U]-yr),ke<D&&(D=ke,X=U);ze[X]++,R[$]=X}for(J=new Array(s),U=m=0,at=s-1;0<=at?m<=at:m>=at;U=0<=at?++m:--m)J[U]=null;for($=w=0,ct=B-1;0<=ct?w<=ct:w>=ct;$=0<=ct?++w:--w)F=R[$],J[F]===null?J[F]=Ae[$]:J[F]+=Ae[$];for(U=L=0,ft=s-1;0<=ft?L<=ft:L>=ft;U=0<=ft?++L:--L)J[U]*=1/ze[U];for(_t=!1,U=O=0,Qe=s-1;0<=Qe?O<=Qe:O>=Qe;U=0<=Qe?++O:--O)if(J[U]!==ie[$]){_t=!0;break}ie=J,Q++,Q>200&&(_t=!1)}for(ge={},U=M=0,et=s-1;0<=et?M<=et:M>=et;U=0<=et?++M:--M)ge[U]=[];for($=x=0,tt=B-1;0<=tt?x<=tt:x>=tt;$=0<=tt?++x:--x)F=R[$],ge[F].push(Ae[$]);for(Te=[],U=A=0,rt=s-1;0<=rt?A<=rt:A>=rt;U=0<=rt?++A:--A)Te.push(ge[U][0]),Te.push(ge[U][ge[U].length-1]);for(Te=Te.sort(function(Wt,$t){return Wt-$t}),y.push(Te[0]),$=N=1,vr=Te.length-1;N<=vr;$=N+=2)Lt=Te[$],!isNaN(Lt)&&y.indexOf(Lt)===-1&&y.push(Lt)}return y},Be=function(e,o,s){var a,c,f,u;return a=te(arguments),e=a[0],o=a[1],s=a[2],isNaN(e)&&(e=0),e/=360,e<1/3?(c=(1-o)/3,u=(1+o*W(h*e)/W(n-h*e))/3,f=1-(c+u)):e<2/3?(e-=1/3,u=(1-o)/3,f=(1+o*W(h*e)/W(n-h*e))/3,c=1-(u+f)):(e-=2/3,f=(1-o)/3,c=(1+o*W(h*e)/W(n-h*e))/3,u=1-(f+c)),u=pe(s*u*3),f=pe(s*f*3),c=pe(s*c*3),[u*255,f*255,c*255,a.length>3?a[3]:1]},_r=function(){var e,o,s,a,c,f,u,d;return u=te(arguments),f=u[0],o=u[1],e=u[2],h=Math.PI*2,f/=255,o/=255,e/=255,c=Math.min(f,o,e),a=(f+o+e)/3,d=1-c/a,d===0?s=0:(s=(f-o+(f-e))/2,s/=Math.sqrt((f-o)*(f-o)+(f-e)*(o-e)),s=Math.acos(s),e>o&&(s=h-s),s/=h),[s*360,d,a]},p.hsi=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(t,Me.call(arguments).concat(["hsi"]),function(){})},v.hsi=Be,t.prototype.hsi=function(){return _r(this._rgb)},Re=function(e,o,s,a){var c,f,u,d,m,w,L,O,M,x,A,N,R;return a==="hsl"?(N=e.hsl(),R=o.hsl()):a==="hsv"?(N=e.hsv(),R=o.hsv()):a==="hcg"?(N=e.hcg(),R=o.hcg()):a==="hsi"?(N=e.hsi(),R=o.hsi()):(a==="lch"||a==="hcl")&&(a="hcl",N=e.hcl(),R=o.hcl()),a.substr(0,1)==="h"&&(u=N[0],x=N[1],w=N[2],d=R[0],A=R[1],L=R[2]),!isNaN(u)&&!isNaN(d)?(d>u&&d-u>180?c=d-(u+360):d<u&&u-d>180?c=d+360-u:c=d-u,f=u+s*c):isNaN(u)?isNaN(d)?f=Number.NaN:(f=d,(w===1||w===0)&&a!=="hsv"&&(M=A)):(f=u,(L===1||L===0)&&a!=="hsv"&&(M=x)),M==null&&(M=x+s*(A-x)),m=w+s*(L-w),O=p[a](f,M,m)},E=E.concat(function(){var e,o,s,a;for(s=["hsv","hsl","hsi","hcl","lch","hcg"],a=[],o=0,e=s.length;o<e;o++)rr=s[o],a.push([rr,Re]);return a}()),Oe=function(e,o,s,a){var c,f;return c=e.num(),f=o.num(),p.num(c+(f-c)*s,"num")},E.push(["num",Oe]),ue=function(e,o,s,a){var c,f,u;return f=e.lab(),u=o.lab(),c=new t(f[0]+s*(u[0]-f[0]),f[1]+s*(u[1]-f[1]),f[2]+s*(u[2]-f[2]),a)},E.push(["lab",ue])}).call(ht)});var ro=qt((Is,to)=>{to.exports.default={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}}});var so=qt((Ts,Pe)=>{var oo=ro().default;Pe.exports.get_types=function(){return Object.keys(Pe.exports.get_config().types)};Pe.exports.get_type_config=function(t){let r={};if(Pe.exports.get_config().types[t]&&Object.assign(r,Pe.exports.get_config().types[t]),r.type){let l=Pe.exports.get_type_config(r.type);return Object.assign(l,r),l}else return r};function Zt(t){return t&&typeof t=="object"&&!Array.isArray(t)}function St(t,...r){if(!r.length)return t;let l=r.shift();if(Zt(t)&&Zt(l))for(let i in l)Zt(l[i])?(t[i]||Object.assign(t,{[i]:{}}),St(t[i],l[i])):Object.assign(t,{[i]:l[i]});return St(t,...r)}globalThis.__PERSPECTIVE_CONFIG__=void 0;Pe.exports.override_config=function(t){globalThis.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),globalThis.__PERSPECTIVE_CONFIG__=St(oo,t)};Pe.exports.get_config=function(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=St(oo,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}});var Ge=new WeakMap,zo=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?5e6:1e7;function wr(t,r,l,i,n){var _={};return Object.keys(i).forEach(function(h){_[h]=i[h]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=l.slice().reverse().reduce(function(h,g){return g(t,r,h)||h},_),n&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(n):void 0,_.initializer=void 0),_.initializer===void 0&&(Object.defineProperty(t,r,_),_=null),_}var Mt=0,Ye=0,xr=performance.now(),kr=(t,...r)=>t.map((l,i)=>[l,r[i]]).flat().filter(l=>!!l).join("");function Lr(t,r,l){let i=l.value,n=Symbol("regular-table throttle lock");return l.value=async function(..._){if(this[n]!==void 0&&(await this[n],this[n]!==void 0))return void await this[n];let h;this[n]=(()=>{let g,b=new Promise(k=>{g=k});return b.resolve=g,b})();try{h=await i.call(this,..._)}finally{let g=this[n];this[n]=void 0,g.resolve()}return h},l.value.flush=async function(){return await new Promise(requestAnimationFrame),await this[n]},l}var zt,Eo=(wr((zt=class extends HTMLElement{create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=kr` <style> ${":host{bottom:0;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch}:host,div.rt-virtual-panel{position:absolute;top:0;left:0;right:0}div.rt-virtual-panel{pointer-events:none}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%}div.rt-tree-container{display:flex;align-items:center;height:100%}slot{position:absolute;overflow:hidden;overflow-anchor:none}"} </style> <style> ${":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px}"} </style> <div class="rt-virtual-panel"></div> <div class="rt-scroll-table-clip"> ${"<slot></slot>"} </div> `;let[,t,r,l]=this.shadowRoot.children;this._sub_cell_style=t,this._table_clip=l,this._virtual_panel=r,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode==="both"||this._virtual_mode==="vertical"?this._table_clip.style.top="0px":this._table_clip.style.removeProperty("top"),this._virtual_mode==="both"||this._virtual_mode==="horizontal"?this._table_clip.style.left="0px":this._table_clip.style.removeProperty("left"),this._virtual_mode!=="both"?this._table_clip.style.contain="none":this._table_clip.style.removeProperty("contain"))}_calculate_viewport(t,r){let{start_row:l,end_row:i}=this._calculate_row_range(t),{start_col:n,end_col:_}=this._calculate_column_range(r);return this._nrows=t,{start_col:n,end_col:_,start_row:l,end_row:i}}_calculate_row_range(t){let{height:r}=this._container_size,l=this._column_sizes.row_height||19,i=this._view_cache.config.column_pivots.length,n=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),_=Math.max(Math.ceil(this.scrollTop),0)/n,h=r/l-i,g=t||0,b=Math.max(0,Math.ceil(g-h))*_;return{start_row:b,end_row:Math.max(0,Math.min(b+h,t))}}_calc_start_column(){let t=this._view_cache.config.row_pivots.length,r=0,l=0,i=0;for(;l<this.scrollLeft;){let n=this._column_sizes.indices[r+t];i=this.scrollLeft-l,r+=1,l+=n!==void 0?n:60}return r+=i/(this._column_sizes.indices[r+t-1]||60),Math.max(0,r-1)}_calculate_column_range(t){if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let r=this._calc_start_column();return{start_col:r,end_col:r+(this.table_model.num_columns()||Math.min(t,Math.ceil(this._container_size.width/60)))+1}}}_max_scroll_column(t){let r=0;if(this._view_cache.config.row_pivots.length>0)for(let n of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))r+=n;let l=this._view_cache.config.row_pivots.length,i=t;for(;r<this._container_size.width&&i>=0;)i--,r+=this._column_sizes.indices[i+l]||60;return Math.min(t-1,i+1)}_validate_viewport({start_col:t,end_col:r,start_row:l,end_row:i}){l=Math.floor(l),i=Math.ceil(i),t=Math.floor(t),r=Math.ceil(r);let n=this._start_col!==t,_=this._start_row!==l||this._end_row!==i||this._end_col!==r;return this._start_col=t,this._end_col=r,this._start_row=l,this._end_row=i,{invalid_column:n,invalid_row:_}}_calc_scrollable_column_width(t){let r=this._view_cache.config.row_pivots.length,l=this._max_scroll_column(t),i=r,n=0;for(;i<l+r;)n+=this._column_sizes.indices[i]||60,i++;return n}_update_virtual_panel_width(t,r){if(t)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((l,i)=>l+i,0)+"px";else{let l=this._calc_scrollable_column_width(r);if(l!==0){let i=this._container_size.width+l+2;this._virtual_panel.style.width=i+"px"}else this._virtual_panel.style.width="1px"}}_update_virtual_panel_height(t){let{row_height:r=19}=this._column_sizes,l=this._view_cache.config.column_pivots.length*r,i;if(this._virtual_mode==="horizontal"||this._virtual_mode==="none")i=t*r+l;else{let n=this.clientHeight/(this._table_clip.offsetHeight-l);i=Math.min(zo,t*r*n)}this._virtual_panel.style.height=i+"px"}async draw(t={}){let r=performance.now(),{invalid_viewport:l=!0,preserve_width:i=!1}=t,{num_columns:n,num_rows:_}=await this._view_cache.view(0,0,0,0);this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight},this._update_virtual_panel_height(_),i||this._update_virtual_panel_width(l,n);let h=this._calculate_viewport(_,n),{invalid_row:g,invalid_column:b}=this._validate_viewport(h);if(this._invalid_schema||g||b||l){let v=[],E=!0;for await(let I of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,i,h,n)){I!==void 0&&(v=v.concat(I)),E&&(this.update_sub_cell_offset(h),E=!1),this._is_styling=!0;let C=this._style_callbacks;for(let P of C)await P({detail:this});if(this._is_styling=!1,!this._invalidated&&I!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(v),this.table_model.header.reset_header_cache(),i||this._update_virtual_panel_width(this._invalid_schema||b,n),this._invalid_schema=!1}else this.update_sub_cell_offset(h);var k;k=performance.now()-r,Mt=(Mt*Ye+k)/(Ye+1),Ye+=1}update_sub_cell_offset(t){var r;let l=this._column_sizes.row_height*(t.start_row%1)||0,i=this._column_sizes.indices[(this.table_model._row_headers_length||0)+Math.floor(t.start_col)]*(t.start_col%1)||0,n=(r=this._sub_cell_style.sheet)===null||r===void 0?void 0:r.cssRules[0].style;n&&(n.setProperty("--regular-table--clip-x",i+"px"),n.setProperty("--regular-table--clip-y",l+"px"),n.setProperty("--regular-table--transform-x",`-${i}px`),n.setProperty("--regular-table--transform-y",`-${l}px`))}}).prototype,"draw",[Lr],Object.getOwnPropertyDescriptor(zt.prototype,"draw"),zt.prototype),zt),Et,Co=(wr((Et=class extends Eo{register_listeners(){this.addEventListener("mousedown",this._on_click_or_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!0}),this._register_glitch_scroll_listeners()}_on_scroll(t){t.stopPropagation(),this.draw({invalid_viewport:!1})}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this))}_on_mousewheel(t){if(!window.safari)return;let{clientWidth:r,clientHeight:l,scrollTop:i,scrollLeft:n}=this;t.preventDefault(),t.returnValue=!1;let _=Math.max(1,this._virtual_panel.offsetHeight-l),h=Math.max(1,this._virtual_panel.offsetWidth-r);this.scrollTop=Math.max(0,Math.min(_,i+t.deltaY)),this.scrollLeft=Math.max(0,Math.min(h,n+t.deltaX)),this._on_scroll(t)}_on_touchmove(t){t.stopPropagation(),t.preventDefault(),t.returnValue=!1;let{clientWidth:r,clientHeight:l}=this,i=Math.max(1,this._virtual_panel.offsetHeight-l),n=Math.max(1,this._virtual_panel.offsetWidth-r);this.scrollTop=Math.min(i,this._memo_scroll_top+(this._memo_touch_startY-t.touches[0].pageY)),this.scrollLeft=Math.min(n,this._memo_scroll_left+(this._memo_touch_startX-t.touches[0].pageX)),this._on_scroll(t)}_on_touchstart(t){this._memo_touch_startY=t.touches[0].pageY,this._memo_touch_startX=t.touches[0].pageX,this._memo_scroll_top=this.scrollTop,this._memo_scroll_left=this.scrollLeft}async _on_dblclick(t){let r=t.target;for(;r.tagName!=="TD"&&r.tagName!=="TH";)if(r=r.parentElement,!this.contains(r))return;let l=t.target.classList.contains("rt-column-resize"),i=Ge.get(r);if(l){t.stopImmediatePropagation(),r.style.minWidth="",r.style.maxWidth="",t.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(this._column_sizes.override[i.size_key]=void 0,this._column_sizes.auto[i.size_key]=void 0,this._column_sizes.indices[i.size_key]=void 0);for(let n of t.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let _ of t.shiftKey?n:[n[i._virtual_x]])_&&(_.style.minWidth="",_.style.maxWidth="",_.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(t){if(t.button!==0)return;let r=t.target;for(;r.tagName!=="TD"&&r.tagName!=="TH";)if(r=r.parentElement,!this.contains(r))return;let l=t.target.classList.contains("rt-column-resize"),i=Ge.get(r);l&&(this._on_resize_column(t,r,i),t.stopImmediatePropagation())}async _on_click_or_dblclick(t){let r=performance.now();this._last_clicked_time&&r-this._last_clicked_time<500?(this._last_clicked_time=r,await this._on_dblclick(t)):(this._last_clicked_time=r,await this._on_click(t))}_on_resize_column(t,r,l){let{_virtual_x:i,size_key:n}=l,_=t.pageX,h=i+r.colSpan-1,g=this.table_model.header.get_column_header(h),b=this._column_sizes.indices[n],k=E=>this._on_resize_column_move(E,g,_,b,n,h),v=()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",v);let E=this._column_sizes.override[n],I=this._column_sizes.indices[n]!==E;this._column_sizes.indices[n]=E,I&&this.draw()};document.addEventListener("mousemove",k),document.addEventListener("mouseup",v)}async _on_resize_column_move(t,r,l,i,n,_){await new Promise(setTimeout);let h=t.pageX-l,g=Math.max(1,i+h);if(this._column_sizes.override[n]=g,h<0)await this.draw({preserve_width:!0});else{r.style.minWidth=g+"px",r.style.maxWidth=g+"px";let b=this._column_sizes.auto[n];for(let k of this.table_model.body.cells){let v=k[_];v&&(v.style.maxWidth=v.style.minWidth=g+"px",v.classList.toggle("rt-cell-clip",b>g))}}}}).prototype,"_on_resize_column_move",[Lr],Object.getOwnPropertyDescriptor(Et.prototype,"_on_resize_column_move"),Et.prototype),Et),Mr=class{constructor(r){this._name=r,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let r=this._elements[this._index];return this._index+=1,r}},Bt=class{constructor(r,l,i){this._column_sizes=r,this._container=l,this._span_factory=new Mr("span"),this.table=i,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(r,l){Ge.set(r,l)}_get_or_create_metadata(r){if(r===void 0)return{};if(Ge.has(r))return Ge.get(r);{let l={};return Ge.set(r,l),l}}_replace_cell(r,l){let{tr:i,row_container:n}=this._get_row(r),_=n[l];return _&&(i.removeChild(_),n.splice(l,1,void 0)),_}_fetch_cell(r,l){if(r<0||l<0)return;let{row_container:i}=this._get_row(r);return i[l]}_get_cell(r="TD",l,i){let{tr:n,row_container:_}=this._get_row(l),h=_[i];if(h||(i<_.length?(h=_[i]=document.createElement(r),n.insertBefore(h,_.slice(i+1).find(g=>g))):(h=_[i]=document.createElement(r),n.appendChild(h))),h.tagName!==r){let g=document.createElement(r);n.replaceChild(g,h),this.cells[l].splice(i,1,g),h=g}return h}_get_row(r){let l=this.rows[r];l||(l=this.rows[r]=document.createElement("tr"),this.table.appendChild(l));let i=this.cells[r];return i||(i=this.cells[r]=[]),{tr:l,row_container:i}}_clean_columns(r){for(let l=0;l<this.rows.length;l++){let i=this.rows[l],n=this.cells[l];this.cells[l]=n.slice(0,r[l]||r);let _=this.cells[l].filter(h=>h!==void 0).length;for(;i.children[_];)i.removeChild(i.children[_])}}_clean_rows(r){for(;this.table.children[r];)this.table.removeChild(this.table.children[r]);this.rows=this.rows.slice(0,r),this.cells=this.cells.slice(0,r)}},zr=class extends Bt{constructor(...r){super(...r),this._group_header_cache=[],this._offset_cache=[]}_draw_group_th(r,l,i){let n=this._get_cell("TH",l,r[l]||0);if(r[l]+=1,n.removeAttribute("colspan"),n.style.minWidth="0",n.textContent="",i instanceof HTMLElement)n.appendChild(i);else{let h=this._span_factory.get("span");h.textContent=i,n.appendChild(h)}let _=this._span_factory.get("span");return _.className="rt-column-resize",n.appendChild(_),n}_draw_group(r,l,i){let n=this._get_or_create_metadata(i);return n.column_header=r,n.value=l,n.value=l,n}_draw_th(r,l,i,n,_){let h=this._get_or_create_metadata(i);if(h.column_header=r,h.value=l,h.size_key=_.length?_[0]:_,!(_.length>1)){let g=this._column_sizes.override[h.size_key],b=this._column_sizes.auto[h.size_key];g?(i.classList.toggle("rt-cell-clip",b>g),i.style.minWidth=g+"px",i.style.maxWidth=g+"px"):b?(i.classList.remove("rt-cell-clip"),i.style.maxWidth="",i.style.minWidth=b+"px"):(i.style.maxWidth="",i.style.maxWidth="")}return h}get_column_header(r){return this._get_cell("TH",this.num_rows()-1,r)}draw(r,l,i,n,_,h,g){let b=l==null?void 0:l.length;if(b===0)return;let k,v,E;for(let z=0;z<b;z++){if(E=l[z]?l[z]:"",this._offset_cache[z]=this._offset_cache[z]||0,z<b-1){var I,C,P;((I=this._group_header_cache)===null||I===void 0||(C=I[z])===null||C===void 0||(P=C[0])===null||P===void 0?void 0:P.value)===E?(k=this._group_header_cache[z][1],this._group_header_cache[z][2]+=1,i===1&&(this._group_header_cache[z][0].row_header_x=_),k.setAttribute("colspan",this._group_header_cache[z][2])):(k=this._draw_group_th(this._offset_cache,z,E),v=this._draw_group(l,E,k),this._group_header_cache[z]=[v,k,1])}else{k=this._draw_group_th(this._offset_cache,z,E),v=this._draw_th(r||l,E,k,n,_);for(let[j]of this._group_header_cache)j.size_key=v.size_key;k.removeAttribute("colspan")}k.classList.toggle("rt-group-corner",n===void 0),v&&(v.x=n===void 0?n:Math.floor(n),v.column_header_y=z,v.x0=Math.floor(h),v._virtual_x=g,i===1&&(v.row_header_x=_))}return this._clean_rows(this._offset_cache.length),{th:k,metadata:v}}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}},Er=class extends Bt{_draw_td(r,l,i,n,{column_name:_},{ridx_offset:h},g){let b=this._get_cell(r,l,n),k=this._get_or_create_metadata(b);k.y=l+Math.floor(h),k.size_key=g,r==="TD"&&(k.column_header=_);let v=this._column_sizes.override[k.size_key];if(v){let E=this._column_sizes.auto[k.size_key];b.classList.toggle("rt-cell-clip",E>v),b.style.minWidth=v+"px",b.style.maxWidth=v+"px"}else b.classList.remove("rt-cell-clip"),b.style.minWidth="",b.style.maxWidth="";return k.value!==i&&(i instanceof HTMLElement?(b.textContent="",b.appendChild(i)):b.textContent=i),k.value=i,{td:b,metadata:k}}draw(r,l,i,n=!1,_,h,g){let{cidx:b,column_data:k,row_headers:v,column_data_listener_metadata:E}=l,I,{row_height:C}=i,P=[],z=[],j=0,T=[];for(let p=0;p<(n?i.row_headers_length:1);p++){j=0;for(let Z of k){var K;let me=v==null?void 0:v[j],V;if(n){let W=Z[p],oe=this._fetch_cell(j-(P[p]||1),b+p),re=this._get_or_create_metadata(oe),fe=this._fetch_cell(j,b+p-(T[j]||1)),le=this._get_or_create_metadata(fe);!fe||le.value!==W&&W!==void 0||fe.hasAttribute("rowspan")?oe&&re.value===W&&!oe.hasAttribute("colspan")?(P[p]=P[p]?P[p]+1:2,oe.setAttribute("rowspan",P[p]),this._replace_cell(j,b+p)):(V=this._draw_td("TH",j,W,b+p,l,i,p),V.td.style.display="",V.td.removeAttribute("rowspan"),V.td.removeAttribute("colspan"),V.metadata.row_header=Z,V.metadata.row_header_x=p,V.metadata.y0=Math.floor(i.ridx_offset),V.metadata.y1=Math.ceil(i.y1),V.metadata._virtual_x=p,h!==void 0&&(V.metadata.x0=Math.floor(h)),P[p]=1,T[j]=1,z[p]=V):(T[j]=T[j]?T[j]+1:2,fe.setAttribute("colspan",T[j]),this._replace_cell(j,b+p))}else V=this._draw_td("TD",j,Z,b,l,i,g),E&&(V.metadata.user=E[j]),V.metadata.x=_===void 0?_:Math.floor(_),V.metadata.x1=Math.ceil(i.x1),V.metadata.row_header=me||[],V.metadata.y0=Math.floor(i.ridx_offset),V.metadata.y1=Math.ceil(i.y1),V.metadata.dx=Math.floor(_-h),V.metadata.dy=V.metadata.y-Math.floor(V.metadata.y0),V.metadata._virtual_x=b,h!==void 0&&(V.metadata.x0=Math.floor(h)),z[0]=V;if(j++,I=V?V.metadata:I,C=C||((K=V)===null||K===void 0?void 0:K.td.offsetHeight),j*C>r)break}}return this._clean_rows(j),{tds:z,ridx:j,metadata:I,row_height:C}}clean({ridx:r,cidx:l}){this._clean_rows(r),this._clean_columns(l)}},Vt=class{constructor(r,l,i){this.clear(i);let[n]=i.children,[_,h]=n.children;this.table=n,this._column_sizes=l,this.header=new zr(l,r,_),this.body=new Er(l,r,h),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(r){r.innerHTML=kr` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `}autosize_cells(r){for(;r.length>0;){let[l,i,n]=r.pop(),_,h=getComputedStyle(l);h.boxSizing!=="border-box"?(_=l.clientWidth,_-=h.paddingLeft?parseFloat(h.paddingLeft):0,_-=h.paddingRight?parseFloat(h.paddingRight):0):_=parseFloat(h.width),this._column_sizes.row_height=this._column_sizes.row_height||n.offsetHeight,this._column_sizes.indices[i.size_key]=_;let g=this._column_sizes.override[i.size_key]!==void 0;_&&!g&&(this._column_sizes.auto[i.size_key]=_),l.style.minWidth==="0px"&&(l.style.minWidth=_+"px")}}async*draw(r,l,i,n,_,h){var g,b,k,v;let{width:E,height:I}=r,{view:C,config:P}=l,{data:z,row_headers:j,column_headers:T,metadata:K}=await C(Math.floor(_.start_col),Math.floor(_.start_row),Math.ceil(_.end_col),Math.ceil(_.end_row)),{start_row:p=0,start_col:Z=0,end_col:me=0,end_row:V=0}=_;j&&(this._row_headers_length=j.reduce((se,Fe)=>Math.max(se,Fe.length),0),j=j.map(se=>(se.length=this._row_headers_length,se))),l.config.column_pivots=Array.from(Array((T==null||(g=T[0])===null||g===void 0?void 0:g.length)||0).keys()),l.config.row_pivots=Array.from(Array(((b=j)===null||b===void 0||(k=b[0])===null||k===void 0?void 0:k.length)||0).keys());let W={viewport_width:0,selected_id:i,ridx_offset:p,sub_cell_offset:this._column_sizes.indices[(this._row_headers_length||0)+Math.floor(_.start_col)]||0,x0:Z,x1:me,y1:V,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},oe,re=0,fe=[],le=!0;if(((v=j)===null||v===void 0?void 0:v.length)>0){let se=P.row_pivots.join(","),Fe={column_name:se,cidx:0,column_data:j,row_headers:j,first_col:le},Ne=re+Math.floor(Z);oe=this.body.draw(I,Fe,{...W,x0:0},!0,void 0,void 0,Ne);let Re=[];for(let ue=0;ue<l.config.row_pivots.length;ue++){let ve=this.header.draw(se,Array(l.config.column_pivots.length).fill(""),1,void 0,ue,Z,ue);ve&&Re.push(ve)}if(le=!1,W.viewport_width+=Re.reduce((ue,{th:ve},Oe)=>ue+(this._column_sizes.indices[Oe]||ve.offsetWidth),0),W.row_height=W.row_height||oe.row_height,re=j[0].length,!n)for(let ue=0;ue<l.config.row_pivots.length;ue++){let{td:ve,metadata:Oe}=oe.tds[ue]||{},{th:he,metadata:We}=Re[ue]||{};(ve||he)&&fe.push([he||ve,We||Oe,ve||he])}}try{var Se;let se=0,Fe=h-_.start_col;for(;se<Fe;){if(!z[se]){let ye=Math.max(_.end_col,0);_.start_col=ye;let we=0,Ee=0;for(;this._column_sizes.indices.length>re+Z+we+1&&Ee+W.viewport_width<E;)we++,Ee+=this._column_sizes.indices[re+Z+we];if(Ee+W.viewport_width<E){let pe=Math.min(h,ye+5);_.end_col=Math.max(1,Math.min(h,pe))}else _.end_col=Math.max(1,Math.min(h,ye+we));let Ue=C(Math.floor(_.start_col),Math.floor(_.start_row),Math.ceil(_.end_col),Math.ceil(_.end_row));yield;let Ce=await Ue;if(Ce.data.length===0)return void(yield fe);_.end_col=_.start_col+Ce.data.length;for(let pe=0;pe<Ce.data.length;pe++){var qe;z[se+pe]=Ce.data[pe],Ce.metadata&&(K[se+pe]=Ce.metadata[pe]),T&&(T[se+pe]=(qe=Ce.column_headers)===null||qe===void 0?void 0:qe[pe])}}let Ne=(T==null?void 0:T[se])||"",Re=z[se],ue={column_name:Ne,cidx:re,column_data:Re,column_data_listener_metadata:K==null?void 0:K[se],row_headers:j,first_col:le},ve=se+Z,Oe=re+Math.floor(Z),he=this.header.draw(void 0,Ne,void 0,ve,Oe,Z,re);if(oe=this.body.draw(I,ue,W,!1,ve,Z,Oe),le=!1,!n)for(let{td:ye,metadata:we}of oe.tds)fe.push([(he==null?void 0:he.th)||ye,(he==null?void 0:he.metadata)||we,ye||(he==null?void 0:he.th)]);let We=this._column_sizes.indices[re+Math.floor(Z)];var je;if(We?W.viewport_width+=We:W.viewport_width+=(he==null||(je=he.th)===null||je===void 0?void 0:je.offsetWidth)||oe.tds.reduce((ye,we)=>{var Ee;return ye+((Ee=we.td)===null||Ee===void 0?void 0:Ee.offsetWidth)},0),W.row_height=W.row_height||oe.row_height,re++,se++,W.viewport_width-W.sub_cell_offset>E){var Be;this.body.clean({ridx:((Be=oe)===null||Be===void 0?void 0:Be.ridx)||0,cidx:re}),this.header.clean(),yield fe,W.viewport_width=0;for(let[ye]of fe)W.viewport_width+=ye.offsetWidth;if(W.viewport_width-W.sub_cell_offset>E)return}}this.body.clean({ridx:((Se=oe)===null||Se===void 0?void 0:Se.ridx)||0,cidx:re}),this.header.clean(),yield fe}finally{var Ve;this.body.clean({ridx:((Ve=oe)===null||Ve===void 0?void 0:Ve.ridx)||0,cidx:re}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}},Ao=["both","horizontal","vertical","none"],Cr=class extends Co{constructor(){super(),this._column_sizes={auto:[],override:[],indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new Vt(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto=[],this._column_sizes.override=[],this._column_sizes.indices=[];for(let r=0;r<this.table_model.header.num_columns();r++){let l=this.table_model.header.get_column_header(r);l.style.minWidth="",l.style.maxWidth=""}}clear(){this.table_model=new Vt(this._table_clip,this._column_sizes,this)}addStyleListener(r){this._style_callbacks=this._style_callbacks.concat(r);let l=!0;return()=>{if(!l)return;l=!1;let i=this._style_callbacks=this._style_callbacks.slice(),n=i.indexOf(r);i.splice(n,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(r){if(r!==void 0){if(r instanceof HTMLElement)return Ge.get(r);if(r.row_header_x>=0){if(r.row_header_x<this._view_cache.config.row_pivots.length){let l=this.table_model.body._fetch_cell(r.y,r.row_header_x);return this.getMeta(l)}}else{if(!(r.column_header_y>=0))return this.getMeta(this.table_model.body._fetch_cell(r.dy,r.dx+this.table_model._row_headers_length));if(r.column_header_y<this._view_cache.config.column_pivots.length){let l=this.table_model.body._fetch_cell(r.column_header_y,r.y);return this.getMeta(l)}}}}getDrawFPS(){return function(){let r=performance.now(),l=r-xr,i=Mt,n=1e3*Ye/l,_=Ye;return Mt=0,Ye=0,xr=r,{avg:i,real_fps:n,virtual_fps:1e3/i,num_frames:_,elapsed:l}}()}async scrollToCell(r,l){if(!this._view_cache)return void console.warn("data listener not configured");let i=this._column_sizes.row_height||19,n=this._view_cache.config.column_pivots.length*i,_=(this._table_clip.offsetHeight-n)%i,h=(this._virtual_panel.offsetHeight-_)/this._nrows;this.scrollTop=Math.ceil(h*l);let g=0;for(;r>0;)r--,g+=this._column_sizes.indices[r+this._view_cache.config.row_pivots.length]||60;this.scrollLeft=Math.ceil(g),await new Promise(requestAnimationFrame),await this.draw.flush()}setDataListener(r,{virtual_mode:l="both"}={}){console.assert(Ao.indexOf(l)>-1,`Unknown virtual_mode ${l};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=l,this._invalid_schema=!0,this._view_cache={view:r,config:{row_pivots:[],column_pivots:[]},schema:{}},this._setup_virtual_scroll()}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",Cr);var Ar=`regular-table{padding:0;margin:12px 0 0 12px;scrollbar-color:transparent transparent;scrollbar-width:thin;outline:none}regular-table:hover{scrollbar-color:rgba(0,0,0,.3) transparent}.sub-cell-scroll-enabled regular-table table tbody td,.sub-cell-scroll-enabled regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x, 0px))}.sub-cell-scroll-enabled regular-table table tbody{transform:translateY(var(--regular-table--transform-y, 0px))}.sub-cell-scroll-enabled regular-table table tbody tr:first-child td,.sub-cell-scroll-enabled regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y, 0),0 200%,200% 200%,200% var(--regular-table--clip-y, 0))}.sub-cell-scroll-enabled regular-table table thead th.rt-group-corner{background:var(--plugin--background, white);z-index:1}.sub-cell-scroll-enabled regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x, 0) 0,var(--regular-table--clip-x, 0) 200%,200% 200%,200% 0)}.sub-cell-scroll-enabled regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x, 0) var(--regular-table--clip-y, 0),var(--regular-table--clip-x, 0) 200%,200% 200%,200% var(--regular-table--clip-y, 0))}regular-table{font-family:inherit}regular-table div[tabindex]{outline:none}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden}regular-table th{text-align:center}regular-table thead tr:not(:last-child) th{overflow:hidden;max-width:0px}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right}regular-table tbody th{text-align:left}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left}regular-table thead tr:last-child th{border-bottom:1px solid #eaedef}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important}regular-table th{position:relative}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid #eee;height:100%}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding:0 5px;height:19px}regular-table tr:hover td{background:#eee;opacity:1}regular-table tr:hover{color:#333}regular-table table *{box-sizing:border-box}regular-table table{position:absolute;overflow:hidden;color:#666;outline:none}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family, "Material Icons")}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family, "Material Icons")}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px #1a7da1}regular-table .rt-selected td{background-color:#eee}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%}regular-table th span.rt-group-name{text-align:left}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize}regular-table a{color:var(--rt-pos-cell--color)}regular-table a:visited{color:var(--active--color)}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#0000;border-radius:5px}regular-table::-webkit-scrollbar-thumb:horizontal{border-bottom:2px solid transparent;border-top:2px solid transparent}regular-table::-webkit-scrollbar-thumb:vertical{border-left:2px solid transparent;border-right:2px solid transparent}regular-table:hover::-webkit-scrollbar-thumb{background-color:#00000026}regular-table::-webkit-scrollbar-thumb:hover{background-color:#0000004d}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0 var(--inactive--color, #eaedef)}.psp-header-group{box-shadow:0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-is-top{box-shadow:5px 4px 0 -4px var(--inactive--color, #eaedef)}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0 -4px var(--inactive--color, #eaedef),0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0 var(--inactive--color, #eaedef),0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0 -4px var(--inactive--color, #eaedef)}tr:only-child th{box-shadow:none!important}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--rt-hover--border-color, #c5c9d080)!important;background-color:transparent;box-shadow:0 1px 0 var(--rt-hover--border-color, #c5c9d080),0 3px #0000000d,0 5px #00000003}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:1px;border-right-color:transparent}regular-table tbody tr:hover{color:#161616}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color, #c5c9d080)!important}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color, #c5c9d080)!important}perspective-viewer[settings] regular-table .psp-header-leaf{height:36px;vertical-align:top;padding-top:2px}perspective-viewer[settings] regular-table .psp-header-leaf:not(.psp-header-corner):before{font-family:var(--button--font-family, inherit);content:var(--column-style-open-button--content, var(--config-button-icon--content, "\\1f527"));position:absolute;width:calc(100% - 8px);left:5px;bottom:0px;color:var(--inactive--color, #b4b7be)}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:not(.psp-header-corner):before{color:inherit;cursor:pointer}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner){pointer-events:none}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner):before{content:var(--column-style-close-button--content, "X")}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:hover:before{color:#338dcd}perspective-viewer[settings] regular-table .psp-header-leaf .rt-column-resize{height:18px}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:#fff!important;background-color:#ea7319!important;border-color:#ea7319!important}.psp-row-selected.psp-tree-label:not(:hover):before{color:#fff}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,.2)!important}.psp-error{color:red}td:focus{outline:#666;outline-style:dotted;outline-width:1px}perspective-viewer.dragging regular-table{pointer-events:none}.psp-header-border:last-child{border-right-width:0px}.psp-header-sort-desc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-desc--content, "\\2193")}.psp-header-sort-asc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-asc--content, "\\2191")}.psp-header-sort-col-desc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-col-desc--content, "\\2190")}.psp-header-sort-col-asc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-col-asc--content, "\\2192")}tbody th:last-of-type{border-right:1px solid #eaedef;overflow:hidden;text-overflow:ellipsis}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,#eee 10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none}.psp-tree-label{max-width:0px;min-width:0px}.psp-tree-label:before{color:#ccc;font-family:var(--button--font-family, inherit);padding-right:11px;vertical-align:-1px}.psp-tree-label-expand:before{content:var(--tree-label-expand--content, "+")}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content, "-")}.psp-tree-label:hover:before{color:#338dcd;text-shadow:0px 0px 5px #338dcd}regular-table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--color, #eaedef)}.psp-tree-leaf{padding-left:24px}.psp-align-right{text-align:right}.psp-align-left{text-align:left}.psp-positive:not(:focus){color:var(--rt-pos-cell--color, #338dcd)}.psp-negative:not(:focus){color:var(--rt-neg-cell--color, #ff5942)}regular-table table tbody td{min-width:52px!important}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed #999;border-bottom-width:0px;border-left-width:0px}.psp-bool-type{font-family:var(--button--font-family, "Material Icons")}.boolean-editable{cursor:pointer}regular-table table{user-select:none;color:#161616;border-collapse:separate}regular-table table th{font-weight:400}regular-table table td,regular-table table th{border-color:#eaedef;height:23px}regular-table table .psp-header-group{text-overflow:ellipsis}regular-table table .psp-header-leaf{border-bottom-width:0px}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px}regular-table table tbody th:empty{background-position:0px -10px}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start, rgba(0, 128, 255, .5))}to{background-color:var(--pulse--background-color-end, rgba(0, 128, 255, 0))}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start, rgba(0, 128, 255, .5))}to{background-color:var(--pulse--background-color-end, rgba(0, 128, 255, 0))}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start, rgba(255, 25, 0, .5))}to{background-color:var(--pulse--background-color-end, rgba(255, 25, 0, 0))}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start, rgba(255, 25, 0, .5))}to{background-color:var(--pulse--background-color-end, rgba(255, 25, 0, 0))}}
`;function jo(t){return t.x>=0?this._column_types[t.x]:this._row_header_types[t.row_header_x-1]}function Sr(t){let r=t._view_cache.config.row_pivots.length-1,l=Array.from(t.children[0].children[0].children);if(l.length>0){let[i]=l.splice(l.length-1,1);for(let n of i?.children){let _=t.getMeta(n),h=_.column_header?.[_.column_header?.length-1],g=this._config.sort.find(z=>z[0]===h),b=_.row_header_x===r,k=typeof _.x=="undefined";b=b||(_.x+1)%this._config.columns.length==0,n.classList.toggle("psp-header-border",b),n.classList.toggle("psp-header-group",!1),n.classList.toggle("psp-header-leaf",!0),n.classList.toggle("psp-is-top",!1),n.classList.toggle("psp-header-corner",k),n.classList.toggle("psp-header-sort-asc",!!g&&g[1]==="asc"),n.classList.toggle("psp-header-sort-desc",!!g&&g[1]==="desc"),n.classList.toggle("psp-header-sort-col-asc",!!g&&g[1]==="col asc"),n.classList.toggle("psp-header-sort-col-desc",!!g&&g[1]==="col desc");let v=jo.call(this,_),E=v==="integer"||v==="float",I=v==="string",C=v==="date",P=v==="datetime";n.classList.toggle("psp-align-right",E),n.classList.toggle("psp-align-left",!E),n.classList.toggle("psp-menu-open",this._open_column_styles_menu[0]===_._virtual_x),n.classList.toggle("psp-menu-enabled",(I||E||C||P)&&!k),n.classList.toggle("psp-is-width-override",t._column_sizes?.override[_.size_key]!==void 0)}}}function jr(t){let r=t._view_cache.config.row_pivots.length-1,l=Array.from(t.children[0].children[0].children),i=[],n=new Set,_=t.children[0];for(let h=0;h<l.length;h++){let g=_.rows[h],b=new Set;for(let k=0;k<g.cells.length;k++){let v=g.cells[k];v.style.backgroundColor="";let E=t.getMeta(v),I=E.row_header_x===r||E.x>=0;v.classList.toggle("psp-align-right",!1),v.classList.toggle("psp-align-left",!1),v.classList.toggle("psp-header-group",!0),v.classList.toggle("psp-header-leaf",!1),v.classList.toggle("psp-header-border",I),v.classList.toggle("psp-header-group-corner",typeof E.x=="undefined"),v.classList.toggle("psp-color-mode-bar",!1),v.classList.toggle("psp-header-sort-asc",!1),v.classList.toggle("psp-header-sort-desc",!1),v.classList.toggle("psp-header-sort-col-asc",!1),v.classList.toggle("psp-header-sort-col-desc",!1);let C=g.cells[k],P=k,z,j;for(;i[h]&&i[h][P];++P);for(b.add(P),z=P;z<P+C.colSpan;++z)for(j=h;j<h+C.rowSpan;++j)i[j]||(i[j]=[]),i[j][z]=!0;C.classList.toggle("psp-is-top",h===0||!n.has(z))}n=b}}var ce=Symbol("Plugin Symbol");function Nr(t,r,[,,,,,l,i],[,,,,,n,_]){let h=this._ids?.[t.dy]?.join("|"),g=t.column_header.join("|");if(this.last_reverse_columns?.has(g)&&this.last_reverse_ids?.has(h)){let b=this.last_reverse_ids?.get(h),k=this.last_reverse_columns.get(g);this._is_old_viewport?this.last_meta?.[k]?.[b]>t.user?(r.style.setProperty("--pulse--background-color-start",n),r.style.setProperty("--pulse--background-color-end",_),r.style.animationName==="pulse_neg"?r.style.animation="pulse_neg2 0.5s linear":r.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[k]?.[b]<t.user?(r.style.setProperty("--pulse--background-color-start",l),r.style.setProperty("--pulse--background-color-end",i),r.style.animationName==="pulse_pos"?r.style.animation="pulse_pos2 0.5s linear":r.style.animation="pulse_pos 0.5s linear"):b!==t.dy&&(r.style.animation=""):r.style.animation=""}else r.style.animation=""}var Yt=dt(gt());function Xt(t,r){return Yt.default.mix(t,`rgb(${r[0]},${r[1]},${r[2]})`,.5).hex()}function De([t,r,l,i],n=[255,255,255]){function _(h,g){return((1-i)*(n[h]/255)+i*(g/255))*255}return[_(0,t),_(1,r),_(2,l)]}function He([t,r,l]){return Math.sqrt(t*t*.299+r*r*.587+l*l*.114)>130?"#161616":"#ffffff"}function No(t){let[r,l,i]=t.rgb(),[n,_,h]=t.set("hsl.h",(t.get("hsl.h")-15)%360).rgb(),[g,b,k]=t.set("hsl.h",(t.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${n},${_},${h}),rgb(${r},${l},${i}) 50%,rgb(${g},${b},${k}))`}function ne(t){let r=(0,Yt.default)(t),l=No(r),i=r.rgb();return[t,...i,l,`rgba(${i[0]},${i[1]},${i[2]},1)`,`rgba(${i[0]},${i[1]},${i[2]},0)`]}function Or(t,r,l){let i=l.user>0,n=l.user<0,_;t?.pos_bg_color!==void 0?_=t.pos_bg_color:_=this._pos_bg_color;let h;t?.neg_bg_color!==void 0?h=t.neg_bg_color:h=this._neg_bg_color;let g=i?_:n?h:["",...this._plugin_background,""];{let[C,P,z,j,T]=g;if(r.style.position="",t?.number_bg_mode==="color")r.style.animation="",r.style.backgroundColor=C;else if(t?.number_bg_mode==="gradient"){let K=Math.max(0,Math.min(1,Math.abs(l.user/t.bg_gradient))),p=this._plugin_background,Z=He(De([P,z,j,K],p));r.style.animation="",r.style.color=Z,r.style.backgroundColor=`rgba(${P},${z},${j},${K})`}else t?.number_bg_mode==="pulse"?(Nr.call(this,l,r,_,h),r.style.backgroundColor=""):(t?.number_bg_mode==="disabled"||!t?.number_bg_mode,r.style.animation="",r.style.backgroundColor="")}let[b,k,v,E,I]=(()=>t?.pos_fg_color!==void 0?i?t.pos_fg_color:n?t.neg_fg_color:["",...this._plugin_background,""]:i?this._pos_fg_color:n?this._neg_fg_color:["",...this._plugin_background,""])();if(t?.number_fg_mode==="disabled")if(t?.number_bg_mode==="color"){let C=this._plugin_background,P=He(De([g[1],g[2],g[3],1],C));r.style.color=P}else t?.number_bg_mode==="gradient"||(r.style.color="");else t?.number_fg_mode==="bar"?(r.style.color="",r.style.position="relative",I!==""&&r.children.length>0&&r.children[0].nodeType===Node.ELEMENT_NODE&&(r.children[0].style.background=I)):(t?.number_fg_mode==="color"||!t?.number_fg_mode)&&(r.style.color=b)}var Ut=dt(gt());function Pr(t,r,l){let i=l.column_header?.[l.column_header?.length-1],[n,_,h,g,b]=(()=>t?.color!==void 0?t.color:this._color)();if(t?.string_color_mode==="foreground"&&l.user!==null)r.style.color=n,r.style.backgroundColor="",t?.format==="link"&&(r.children[0].style.color=n);else if(t?.string_color_mode==="background"&&l.user!==null){let k=this._plugin_background,v=He(De([_,h,g,1],k));r.style.color=v,r.style.backgroundColor=n}else if(t?.string_color_mode==="series"&&l.user!==null){this._series_color_map.has(i)||(this._series_color_map.set(i,new Map),this._series_color_seed.set(i,0));let k=this._series_color_map.get(i);if(!k.has(l.user)){let me=this._series_color_seed.get(i);k.set(l.user,me),this._series_color_seed.set(i,me+1)}let v=k.get(l.user),[E,I,C]=(0,Ut.default)(n).hsl();E=E+v*150%360;let P=(0,Ut.default)(E,I,C,"hsl"),[z,j,T]=P.rgb(),K=P.hex(),p=this._plugin_background,Z=He(De([z,j,T,1],p));r.style.color=Z,r.style.backgroundColor=K}else r.style.backgroundColor="",r.style.color=""}var os=dt(gt());function Fr(t,r,l){let i=l.column_header?.[l.column_header?.length-1],[n,_,h,g,b]=(()=>t?.color!==void 0?t.color:this._color)();if(t?.datetime_color_mode==="foreground"&&l.user!==null)r.style.color=n,r.style.backgroundColor="";else if(t?.datetime_color_mode==="background"&&l.user!==null){let k=this._plugin_background,v=He(De([_,h,g,1],k));r.style.color=v,r.style.backgroundColor=n}else r.style.backgroundColor="",r.style.color=""}function Rr(t,r,l){let[i]=l.user===!0?this._pos_fg_color:l.user===!1?this._neg_fg_color:["",0,0,0,""];r.style.backgroundColor="",r.style.color=i}function Ir(t,r,l){let i=typeof l.value!=null&&typeof l.value!=null&&l.value?.toString()?.trim().length>0,n=l.row_header_x>=this._config.group_by.length,_=t.getMeta({dx:0,dy:l.y-l.y0+1}),h=_&&_.row_header&&typeof _.row_header[l.row_header_x+1]!="undefined";r.classList.toggle("psp-tree-label",i&&!n),r.classList.toggle("psp-tree-label-expand",i&&!n&&!h),r.classList.toggle("psp-tree-label-collapse",i&&!n&&h),r.classList.toggle("psp-tree-leaf",i&&n)}function Oo(t){return t.x>=0?this._column_types[t.x]:this._row_header_types[t.row_header_x-1]}function Tr(t){let r=t[ce]||{};for(let l of t.children[0].children[1].children)for(let i of l.children){let n=t.getMeta(i),_=n.column_header?.[n.column_header?.length-1],h=Oo.call(this,n),g=r[_],b=h==="integer"||h==="float";b?Or.call(this,g,i,n):h==="boolean"?Rr.call(this,g,i,n):h==="string"?Pr.call(this,g,i,n):h==="date"||h==="datetime"?Fr.call(this,g,i,n):(i.style.backgroundColor="",i.style.color=""),i.classList.toggle("psp-bool-type",h==="boolean"&&n.user!==null);let k=i.tagName==="TH";k&&Ir.call(this,t,i,n),i.classList.toggle("psp-align-right",!k&&b),i.classList.toggle("psp-align-left",k||!b),i.classList.toggle("psp-color-mode-bar",g?.number_fg_mode==="bar"&&b)}}async function Dr(t,r,l){let i=t.getMeta(l),n=i.column_header[i.column_header.length-1],h=(r.shiftKey?Po:Fo).call(this,n);this._preserve_focus_state=!0,await t.parentElement.parentElement.restore({sort:h})}function Po(t){let r=[],l=!1;for(let i of this._config.sort){let[n,_]=i;if(n===t){l=!0;let h=Hr.call(this,t,_);h&&r.push(h)}else r.push(i)}return l||r.push([t,"desc"]),r}function Fo(t){for(let[r,l]of this._config.sort)if(r===t){let i=Hr.call(this,t,l);return i?[i]:[]}return[[t,"desc"]]}function Hr(t,r){let i=this._config.split_by.length>0?Io:Ro,n=r?i[r]:"desc";if(n)return[t,n]}var Ro={desc:"asc",asc:void 0},Io={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};function Kt(t,r,l){let i=t.getMeta(r),n=i.column_header[i.column_header.length-1],_=this._schema[n],h=_==="integer"||_==="float",g=document.createElement(`perspective-${{float:"number",integer:"number",string:"string",date:"date",datetime:"datetime"}[_]}-column-style`),b;if(h?b={fg_gradient:l,pos_fg_color:this._pos_fg_color[0],neg_fg_color:this._neg_fg_color[0],number_fg_mode:"color",bg_gradient:l,pos_bg_color:this._pos_bg_color[0],neg_bg_color:this._neg_bg_color[0],number_bg_mode:"disabled"}:b={color:this._color[0],bg_color:this._color[0]},!(_==="string"||_==="date"||_==="datetime"))if(_==="float")b.fixed=2;else if(_==="integer")b.fixed=0;else{this._open_column_styles_menu.pop(),t.draw({preserve_width:!0});return}let k=()=>g.blur(),v=P=>{let z=P.detail;z.pos_fg_color&&(z.pos_fg_color=ne(z.pos_fg_color),z.neg_fg_color=ne(z.neg_fg_color)),z.pos_bg_color&&(z.pos_bg_color=ne(z.pos_bg_color),z.neg_bg_color=ne(z.neg_bg_color)),z.color&&(z.color=ne(z.color)),z.bg_color&&(z.bg_color=ne(z.bg_color)),t[ce]=t[ce]||{},t[ce][n]=z,t.draw({preserve_width:!0}),t.parentElement.parentElement.dispatchEvent(new Event("perspective-config-update"))},E=async()=>{t.removeEventListener("regular-table-scroll",k),g.removeEventListener("perspective-column-style-change",v),g.removeEventListener("blur",E),this._open_column_styles_menu.pop(),t.parentElement.parentElement.dispatchEvent(new Event("perspective-config-update")),await t.draw({preserve_width:!0}),g.destroy()};g.addEventListener("perspective-column-style-change",v),g.addEventListener("blur",E),t.addEventListener("regular-table-scroll",k);let I=t[ce]||{},C=Object.assign({},I[n]=I[n]||{});(C.pos_fg_color||C.pos_bg_color)&&(C.pos_fg_color=C.pos_fg_color?.[0],C.neg_fg_color=C.neg_fg_color?.[0],C.pos_bg_color=C.pos_bg_color?.[0],C.neg_bg_color=C.neg_bg_color?.[0]),C.color&&(C.color=C.color[0]),C.bg_color&&(C.bg_color=C.bg_color[0]),g.open(r,C,b)}async function Wr(t,r){let l=t.getMeta(r.target),i=r.target.classList.contains("psp-tree-label-collapse");r.shiftKey&&i?this._view.set_depth(l.row_header.filter(n=>n!==void 0).length-2):r.shiftKey?this._view.set_depth(l.row_header.filter(n=>n!==void 0).length-1):i?this._view.collapse(l.y):this._view.expand(l.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),t.draw()}async function $r(t,r){if(r.which!==1)return;let l=r.target;if(l.tagName==="A")return;for(;l.tagName!=="TD"&&l.tagName!=="TH";)if(l=l.parentElement,!t.contains(l))return;if(l.classList.contains("psp-tree-label")){Wr.call(this,t,r),r.stopImmediatePropagation();return}let i=l.getBoundingClientRect();if(l.classList.contains("psp-menu-enabled")&&r.clientY-i.top>16){let n=t.getMeta(l),_=n.column_header?.[n.column_header?.length-1],h=this._schema[_];if(this._open_column_styles_menu.unshift(n._virtual_x),h==="string"||h==="date"||h==="datetime")await t.draw({preserve_width:!0}),Kt.call(this,t,l);else{let[g,b]=await this._view.get_min_max(_);await t.draw({preserve_width:!0});let k=Math.max(Math.abs(g),Math.abs(b));k>1&&(k=Math.round(k*100)/100),Kt.call(this,t,l,k)}r.preventDefault(),r.stopImmediatePropagation()}else l.classList.contains("psp-header-leaf")&&!l.classList.contains("psp-header-corner")&&(Dr.call(this,t,r,l),r.stopImmediatePropagation())}function Gr(t,r){if(r.which!==1)return;let l=r.target;for(;l.tagName!=="TD"&&l.tagName!=="TH";)if(l=l.parentElement,!t.contains(l))return;(l.classList.contains("psp-tree-label")&&r.offsetX<26||l.classList.contains("psp-header-leaf")&&!l.classList.contains("psp-header-corner"))&&r.stopImmediatePropagation()}function qr(t,r=!1){let l=this._config.group_by.length===0&&this._config.split_by.length===0,i=t.hasAttribute("selectable"),n=r||!!t.children[0]._is_edit_mode;return l&&!i&&n}function Br(t,r){let l=t[ce]||{},i=qr.call(this,r);t.parentElement.classList.toggle("edit-mode-allowed",qr.call(this,r,!0));for(let n of t.querySelectorAll("td")){let _=t.getMeta(n),h=this.get_psp_type(_);if(i&&this._is_editable[_.x]){let g=_.column_header[_.column_header.length-1];h==="string"&&l[g]?.format==="link"?(n.toggleAttribute("contenteditable",!1),n.classList.toggle("boolean-editable",!1)):h==="boolean"?(n.toggleAttribute("contenteditable",!1),n.classList.toggle("boolean-editable",_.user!==null)):(i!==n.hasAttribute("contenteditable")&&n.toggleAttribute("contenteditable",i),n.classList.toggle("boolean-editable",!1))}else n.toggleAttribute("contenteditable",!1),n.classList.toggle("boolean-editable",!1)}}var Ct=(t,r,l)=>{let i=t.querySelectorAll("td"),n=l.get(t);if(n){for(let _ of i){let h=t.getMeta(_);if(h.x===n.x&&h.y===n.y)return document.activeElement!==_&&_.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&t.contains(document.activeElement)&&document.activeElement.blur()}};function To(t){let r;return async function(...l){if(!!r&&await r&&!!r)return;let i;r=new Promise(n=>i=n),await t.apply(this,l),r=void 0,i()}}function Vr(){if(this.isContentEditable){let t=document.getSelection().getRangeAt(0),r=t.cloneRange();return r.selectNodeContents(this),r.setEnd(t.endContainer,t.endOffset),r.toString().length}else return this.target.selectionStart}function Yr(t,r,l){let i=t.getMeta(l),n=r._schema[r._column_paths[i.x]];if(i){let _=l.textContent,h=r._ids[i.y-i.y0];if(n==="float"||n==="integer"){if(_=parseFloat(_.replace(/,/g,"")),isNaN(_))return!1}else if(n==="date"||n==="datetime"){if(_=Date.parse(_),isNaN(_))return!1}else n==="boolean"&&(_=_==="check"?!1:_==="close"?!0:null);let g={__INDEX__:h,[r._column_paths[i.x]]:_};return r._table.update([g],{port_id:r._edit_port}),!0}}function At(t,r=!1){let l=this._config.group_by.length===0&&this._config.split_by.length===0,i=t.hasAttribute("selectable"),n=r||!!t.children[0]._is_edit_mode;return l&&!i&&n}var Xe=To(async function(t,r,l,i,n){let _=t.getMeta(l),h=this._column_paths.length,g=this._num_rows,b=r.get(t);if(!b)return;_.x+i<h&&0<=_.x+i&&(b.x=_.x+i),_.y+n<g&&0<=_.y+n&&(b.y=_.y+n);let k=Math.max(_.x0-10,0),v=Math.min(_.x0+10,h),E=Math.max(_.y0-5,0),I=Math.min(_.y0+10,g),C=_.x0+i,P=_.y0+n;for(;!Ct(t,void 0,r)&&C>=k&&C<v&&P>=E&&P<I;)await t.scrollToCell(C,P,h,g),r.set(t,b),C+=i,P+=n});function Xr(t,r,l,i){if(!At.call(this,r))return;let n=document.activeElement;switch(i.target.classList.remove("psp-error"),i.keyCode){case 13:i.preventDefault(),i.shiftKey?Xe.call(this,t,l,n,0,-1):Xe.call(this,t,l,n,0,1);break;case 37:Vr.call(n)==0&&(i.preventDefault(),Xe.call(this,t,l,n,-1,0));break;case 38:i.preventDefault(),Xe.call(this,t,l,n,0,-1);break;case 39:Vr.call(n)==n.textContent.length&&(i.preventDefault(),Xe.call(this,t,l,n,1,0));break;case 40:i.preventDefault(),Xe.call(this,t,l,n,0,1);break;default:}}function Ur(t,r,l){let i=t.getMeta(l.target);if(typeof i?.x!="undefined"){let n=At.call(this,r),_=this._is_editable[i.x],h=this.get_psp_type(i)==="boolean",g=l.target.textContent==="-";n&&_&&h&&!g&&write(t,this,l.target)}}function Kr(t,r,l,i){if(At.call(this,r)&&l.has(t)){i.target.classList.remove("psp-error");let n=l.get(t);l.delete(t),n.content!==i.target.textContent&&(Yr(t,this,i.target)||(i.target.textContent=n.content,i.target.classList.add("psp-error"),i.target.focus()))}}function Zr(t,r,l,i){let n=t.getMeta(i.target);if(n){let _={x:n.x,y:n.y,content:i.target.textContent};l.set(t,_)}}async function bt({_view:t,_config:r},l,i){let n=r.group_by,_=r.split_by,h=l>=0?l:0,g=h+1,b=await t.to_json({start_row:h,end_row:g}),v=b.map(T=>T.__ROW_PATH__)[0]||[],E=n.map((T,K)=>{let p=v[K];return p?[T,"==",p]:void 0}).filter(T=>T),I=n.length>0?i+1:i,C=Object.keys(b[0])[I],P={row:b[0]},z=[];if(C){let T=C.split("|");P.column_names=[T[T.length-1]],z=_.map((K,p)=>{let Z=T[p];return Z?[K,"==",Z]:void 0}).filter(K=>K).filter(([,,K])=>K!=="__ROW_PATH__")}let j=r.filter.concat(E).concat(z);return P.config={filter:j},P}async function Jr(t,r,l,i){let n=t.getMeta(i.target);if(!r.hasAttribute("selectable")||i.handled||i.which!==1||!n)return;let _=this._ids[n.y-n.y0];if(n&&n.y>=0){let h=l.get(t),g=!!h&&h.reduce((v,E,I)=>v&&E===_[I],!0),b=!!h&&_.length===h.length&&g,k=[];b?l.delete(t):(l.set(t,_),k=await bt(this,n.y,n.x),k=k.config.filter),await t.draw({preserve_width:!0}),i.handled=!0,r.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:{selected:!b,config:{filter:k}}}))}}function Qr(t,r,l){if(!r.hasAttribute("selectable"))return;let i=l.has(t),n=l.get(t);for(let _ of t.querySelectorAll("td"))if(!i)_.classList.toggle("psp-row-selected",!1),_.classList.toggle("psp-row-subselected",!1);else{let h=t.getMeta(_),g=this._ids[h.y-h.y0],b=n.reduce((k,v,E)=>k&&v===g[E],!0);_.classList.toggle("psp-row-selected",g.length===n.length&&b),_.classList.toggle("psp-row-subselected",g.length!==n.length&&b)}for(let _ of t.querySelectorAll("tbody th")){let h=t.getMeta(_),g=this._ids[h.y-h.y0];if(!i||!!g[h.row_header_x])_.classList.toggle("psp-row-selected",!1),_.classList.toggle("psp-row-subselected",!1);else{let b=n.reduce((k,v,E)=>k&&v===g[E],!0);_.classList.toggle("psp-row-selected",g.length===n.length&&b),_.classList.toggle("psp-row-subselected",g.length!==n.length&&b)}}}async function eo(t,r,l){l.delete(t);for(let i of t.querySelectorAll("td,th"))i.classList.toggle("psp-row-selected",!1),i.classList.toggle("psp-row-subselected",!1)}var ao=dt(gt());var mt=dt(so()),lo={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(t){return t?"check":"close"}}},Jt=class{constructor(){this._formatters=new Map}create_datetime_formatter(r,l){let i=(0,mt.get_type_config)(r),n={...i.format,timeZone:l.timeZone,dateStyle:l.dateStyle,timeStyle:l.timeStyle};return n.dateStyle==="disabled"?n.dateStyle=void 0:n.dateStyle===void 0&&(n.dateStyle=i.format.dateStyle),n.timeStyle==="disabled"?n.timeStyle=void 0:n.timeStyle===void 0&&(n.timeStyle=i.format.timeStyle),new Intl.DateTimeFormat([],n)}create_number_formatter(r,l){let{format:i}=(0,mt.get_type_config)(r);return l.fixed!==void 0&&(i.minimumFractionDigits=l.fixed,i.maximumFractionDigits=l.fixed),new lo[r]([],i)}create_boolean_formatter(r,l){let i=(0,mt.get_type_config)(r);return new lo[r]([],i.format)}get(r,l){let i=[r,l.fixed,l.timeZone,l.dateStyle,l.timeStyle].join("-");if(!this._formatters.has(i)){let n=(0,mt.get_type_config)(r);r==="date"||r==="datetime"?this._formatters.set(i,this.create_datetime_formatter(r,l)):r==="integer"||r==="float"?this._formatters.set(i,this.create_number_formatter(r,l)):r==="boolean"?this._formatters.set(i,this.create_boolean_formatter(r,l)):this._formatters.set(i,!1)}return this._formatters.get(i)}};var Do=new Jt;function jt(t,r,l={},i=!1){if(r===null)return"-";let n=t[t.length-1],_=i&&this._table_schema[n]||this._schema[n]||"string",h=l[n]||{};if((_==="integer"||_==="float")&&h?.number_fg_mode==="bar"){let b=Math.max(0,Math.min(.95,Math.abs(r/h.fg_gradient)*.95)),k=this._div_factory.get(),v=r>=0?"left":"right";return k.setAttribute("style",`width:${(b*100).toFixed(2)}%;position:absolute;${v}:0;height:80%;top:10%;pointer-events:none;`),k}else if(h?.format==="link"&&_==="string"){let b=document.createElement("a");return b.setAttribute("href",r),b.setAttribute("target","_blank"),b.textContent=r,b}else if(h?.format==="bold"&&_==="string"){let b=document.createElement("b");return b.textContent=r,b}else if(h?.format==="italics"&&_==="string"){let b=document.createElement("i");return b.textContent=r,b}else{let b=Do.get(_,h);return b?b.format(r):r}}function*io(t=[],r,l){let i=l[ce];for(let n of t){n=["TOTAL",...n];let _=n[n.length-1];n=n.slice(0,n.length-1).fill("");let h=jt.call(this,[r[n.length-1]],_,i,!0);h instanceof HTMLElement?n=n.concat(h):n=n.concat({toString:()=>h}),n.length=r.length+1,yield n}}function no(){let t,r,l,i,n;return async function(h,g,b,k,v){let E={},I;k-g>0&&v-b>0?(this._is_old_viewport=this._last_window?.start_row===b&&this._last_window?.end_row===v&&this._last_window?.start_col===g&&this._last_window?.end_col===k,I={start_row:b,start_col:g,end_row:v,end_col:k,id:!0},E=await this._view.to_columns(I),this._last_window=I,this._ids=E.__ID__,this._reverse_columns=this._column_paths.slice(g,k).reduce((T,K,p)=>(T.set(K,p),T),new Map),this._reverse_ids=this._ids.reduce((T,K,p)=>(T.set(K?.join("|"),p),T),new Map)):this._div_factory.clear();let C=[],P=[],z=[],j=[];for(let T=g;T<Math.min(k,this._column_paths.length);++T){let K=this._column_paths[T],p=K.split("|"),Z=E[K]||new Array(v-b).fill(null);C.push(Z.map(me=>jt.call(this,p,me,h[ce]))),P.push(Z),z.push(p),j.push(K)}return k-g>0&&v-b>0&&(this.last_column_paths=r,this.last_meta=t,this.last_ids=l,this.last_reverse_ids=i,this.last_reverse_columns=n,r=j,t=P,l=this._ids,i=this._reverse_ids,n=this._reverse_columns),{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(io.call(this,E.__ROW_PATH__,this._config.group_by,h)),column_headers:z,data:C,metadata:P}}}function Nt(t,r,l){let i=window.getComputedStyle(t).getPropertyValue(r).trim();return i.length>0?i:l}var co=class{constructor(r){this._name=r,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let r=this._elements[this._index];return this._index+=1,r}};function Ho(t){return t.x>=0?this._column_types[t.x]:this._row_header_types[t.row_header_x-1]}async function Qt(t,r,l,i={}){let n=await l.get_config(),_=n.expressions.map(re=>re[1]),[h,g,b,k,v,E,I]=await Promise.all([r.schema(),r.validate_expressions(_),l.num_rows(),l.schema(),l.expression_schema(),l.column_paths(),this.parentElement.getEditPort()]),C=(0,ao.default)(Nt(t,"--plugin--background","#FFFFFF")).rgb(),P=ne(Nt(t,"--rt-pos-cell--color","#338DCD")),z=ne(Nt(t,"--rt-neg-cell--color","#FF5942")),j=ne(Xt(P[0],C)),T=ne(Xt(z[0],C)),K=ne(Nt(t,"--active--color","#ff0000")),p={...k,...v},Z={...h,...g.expression_schema},me=E.filter(re=>re!=="__ROW_PATH__"&&re!=="__ID__"),V=[],W=[];for(let re of me){let fe=re.split("|"),le=fe[fe.length-1];W.push(p[le]),V.push(!!h[le])}let oe=Object.assign(i,{_edit_port:I,_view:l,_table:r,_table_schema:Z,_config:n,_num_rows:b,_schema:p,_ids:[],_open_column_styles_menu:[],_plugin_background:C,_color:K,_pos_fg_color:P,_neg_fg_color:z,_pos_bg_color:j,_neg_bg_color:T,_column_paths:me,_column_types:W,_is_editable:V,_row_header_types:n.group_by.map(re=>Z[re]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:Ho});return oe._div_factory=oe._div_factory||new co("div"),t.setDataListener(no().bind(oe,t),{virtual_mode:window.getComputedStyle(t).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),oe}async function fo(t,r,l){let i=t.getMeta(l.target);if(!i)return;let{x:n,y:_}=i,{row:h,column_names:g,config:b}=await bt(this,_,n);r.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:h,column_names:g,config:b}}))}async function _o(t){let r=this.parentElement,l=await r.getTable(!0);if(this._initialized)await Qt.call(this,this.regular_table,l,t,this.model);else{this.innerHTML="",this.appendChild(this.regular_table),this.model=await Qt.call(this,this.regular_table,l,t),this.regular_table.addStyleListener(Tr.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(jr.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(Sr.bind(this.model,this.regular_table)),this.regular_table.addEventListener("click",Gr.bind(this.model,this.regular_table)),this.regular_table.addEventListener("mousedown",$r.bind(this.model,this.regular_table));let i=new WeakMap;this.regular_table.addStyleListener(Qr.bind(this.model,this.regular_table,r,i)),this.regular_table.addEventListener("mousedown",Jr.bind(this.model,this.regular_table,r,i)),this.regular_table.addEventListener("psp-deselect-all",eo.bind(this.model,this.regular_table,r,i)),this.regular_table.addEventListener("click",fo.bind(this.model,this.regular_table,r));let n=new WeakMap;this.regular_table.addStyleListener(Br.bind(this.model,this.regular_table,r)),this.regular_table.addStyleListener(Ct.bind(this.model,this.regular_table,r,n)),this.regular_table.addEventListener("click",Ur.bind(this.model,this.regular_table,r)),this.regular_table.addEventListener("focusin",Zr.bind(this.model,this.regular_table,r,n)),this.regular_table.addEventListener("focusout",Kr.bind(this.model,this.regular_table,r,n)),this.regular_table.addEventListener("keydown",Xr.bind(this.model,this.regular_table,r,n)),this._initialized=!0}}function Ot(t,r=!1){if(!this._initialized)return;r&&(this._cached_column_sizes=t);let l={},{group_by:i,columns:n}=this.model._config,_=i?.length>0?i.length+1:0;for(let h of Object.keys(t))if(h==="__ROW_PATH__")l[_-1]=t[h];else{let g=this.model._column_paths.indexOf(h);l[g+_]=t[h]}this.regular_table._column_sizes.override=l}function Pt(){if(!this._initialized)return[];if(this._cached_column_sizes){let _=this._cached_column_sizes;return this._cached_column_sizes=void 0,_}let t=this.regular_table._column_sizes.override,{group_by:r,columns:l}=this.model._config,i=r?.length>0?r.length+1:0,n={};for(let _ of Object.keys(t))if(t[_]!==void 0){let h=_-i;h>-1?n[this.model._column_paths[h]]=t[_]:h===-1&&(n.__ROW_PATH__=t[_])}return n}function Ft(t=void 0){typeof t=="undefined"&&(t=!this._is_edit_mode),this._is_edit_mode=t,this.classList.toggle("editable",t),this._edit_mode!==void 0&&(this._edit_mode.classList.toggle("editable",t),t?this._edit_mode.children[0].textContent="Editable":this._edit_mode.children[0].textContent="Read Only")}function Rt(t=void 0){typeof t=="undefined"&&(t=!this._is_scroll_lock),this._is_scroll_lock=t,this.classList.toggle("sub-cell-scroll-enabled",!t),this._scroll_lock!==void 0&&(this._scroll_lock.classList.toggle("lock-scroll",t),t?this._scroll_lock.children[0].textContent="Align Scroll":this._scroll_lock.children[0].textContent="Free Scroll")}function uo(t){t=JSON.parse(JSON.stringify(t));let r={};if(t.columns)for(let i of Object.keys(t.columns)){let n=t.columns[i];n.column_size_override!==void 0&&(r[i]=n.column_size_override,delete n.column_size_override),n?.pos_fg_color&&(n.pos_fg_color=ne(n.pos_fg_color),n.neg_fg_color=ne(n.neg_fg_color)),n?.pos_bg_color&&(n.pos_bg_color=ne(n.pos_bg_color),n.neg_bg_color=ne(n.neg_bg_color)),n?.color&&(n.color=ne(n.color)),Object.keys(n).length===0&&delete t.columns[i]}"editable"in t&&Ft.call(this,t.editable),"scroll_lock"in t&&Rt.call(this,t.scroll_lock);let l=this.regular_table;try{l._resetAutoSize()}catch{}Ot.call(this,r,!0),l[ce]=t.columns}function ho(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar")),this.parentElement.appendChild(this._toolbar)}function po(){if(this.regular_table){let t=this.regular_table,r={columns:{},scroll_lock:!!this._is_scroll_lock,editable:!!this._is_edit_mode};for(let i of Object.keys(t[ce]||{})){let n=Object.assign({},t[ce][i]);(n?.pos_fg_color||n?.pos_bg_color)&&(n.pos_fg_color=n.pos_fg_color?.[0],n.neg_fg_color=n.neg_fg_color?.[0],n.pos_bg_color=n.pos_bg_color?.[0],n.neg_bg_color=n.neg_bg_color?.[0]),n?.color&&(n.color=n.color[0]),r.columns[i]=n}let l=Pt.call(this);for(let i of Object.keys(l||{}))r.columns[i]||(r.columns[i]={}),r.columns[i].column_size_override=l[i];return JSON.parse(JSON.stringify(r))}return{}}async function go(t){if(this.parentElement&&await this.activate(t),!this.isConnected||this.offsetParent==null)return;let r=Pt.call(this),l=this.regular_table.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.regular_table.scrollTop=0,this.regular_table.scrollLeft=0,this.regular_table.dispatchEvent(new CustomEvent("psp-deselect-all",{bubbles:!1})),this.regular_table._resetAutoSize()),Ot.call(this,r),await l,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}var er=class extends HTMLElement{constructor(){super();this.regular_table=document.createElement("regular-table"),this._is_scroll_lock=!0}connectedCallback(){return ho.call(this)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}async activate(r){return await _o.call(this,r)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){}async draw(r){return await go.call(this,r)}async update(r){this.model._num_rows=await r.num_rows(),await this.regular_table.draw()}async resize(){!this.isConnected||this.offsetParent==null||this._initialized&&await this.regular_table.draw()}async clear(){this.regular_table._resetAutoSize(),this.regular_table.clear()}save(){return po.call(this)}restore(r){return uo.call(this,r)}async restyle(r){await this.draw(r)}delete(){this.regular_table.table_model&&this.regular_table._resetAutoSize(),this.regular_table.clear()}};var bo=`:host{position:relative;display:block}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0}:host #toolbar{display:flex;align-items:center;height:36px}:host #slot-container{flex:1;position:relative}#scroll_lock.lock-scroll:before{content:var(--toolbar-scroll-lock-active--content)}#scroll_lock:before{content:var(--toolbar-scroll-lock--content)}#select_mode:before{content:"highlight_alt"}#edit_mode:before{content:var(--toolbar-edit-mode--content)}#edit_mode.editable:before{content:var(--toolbar-edit-mode-active--content)}:host(.aggregated) #toolbar #edit_mode{display:none}.button:before{color:var(--inactive--color, #ccc);line-height:36px;font-size:14px;font-family:var(--button--font-family, "Material Icons Outlined");vertical-align:bottom;margin:0 11px}.button.editable:before,.button.lock-scroll:before{color:inherit}.button{user-select:none;width:36px;box-sizing:border-box}.button>span{display:none;margin:0;padding:0}.button:hover{opacity:1;display:flex;align-items:center;color:inherit;cursor:pointer;min-width:105px;background-color:#0000000d}.button:hover:before{margin:0 6px 0 11px}.button:hover>span{display:contents;font-size:12px;font-weight:300;line-height:36px}
`;var tr=class extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0,this.setAttribute("slot","plugin-settings"),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
            <style>
                ${bo}
            </style>
            <div id="toolbar">
                <span id="scroll_lock" class="lock-scroll button">
                    <span>Align Scroll</span>
                </span>
                <span id="edit_mode" class="button"><span>Read Only</span></span>
            </div>
        `;let r=this.parentElement,l=r.querySelector("perspective-viewer-datagrid");l._scroll_lock=this.shadowRoot.querySelector("#scroll_lock"),l._scroll_lock.addEventListener("click",()=>Rt.call(l)),l._edit_mode=this.shadowRoot.querySelector("#edit_mode"),l._edit_mode.addEventListener("click",()=>{Ft.call(l),l.regular_table.draw(),r.dispatchEvent(new Event("perspective-config-update"))})}};function $o(){let t=document.createElement("style");t.textContent=Ar,document.head.insertBefore(t,document.head.firstChild)}async function Go(){customElements.define("perspective-viewer-datagrid-toolbar",tr),customElements.define("perspective-viewer-datagrid",er),await customElements.whenDefined("perspective-viewer"),customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}Go();$o();
/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */
/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
}));

//# sourceMappingURL=perspective-viewer-datagrid.js.map
