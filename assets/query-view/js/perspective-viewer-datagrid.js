(function (root, factory) {
        if (typeof define === 'function' && define.amd) {
            define(['exports'], factory);
        } else if (typeof exports === 'object' && typeof exports.nodeName !== 'string') {
            factory(exports, module);
        } else {
            const exports = (root.perspective_datagrid = {});
            const module = {exports}
            factory(exports, module);
            root.perspective_datagrid = module.exports;
        }
    }(typeof self !== 'undefined' ? self : this, function (exports, module) {
    
var po=Object.create;var kr=Object.defineProperty;var go=Object.getOwnPropertyDescriptor;var bo=Object.getOwnPropertyNames;var mo=Object.getPrototypeOf,yo=Object.prototype.hasOwnProperty;var vo=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var wo=(r,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of bo(t))!yo.call(r,l)&&l!==i&&kr(r,l,{get:()=>t[l],enumerable:!(n=go(t,l))||n.enumerable});return r};var kt=(r,t,i)=>(i=r!=null?po(mo(r)):{},wo(t||!r||!r.__esModule?kr(i,"default",{value:r,enumerable:!0}):i,r));var pt=vo((dt,ht)=>{(function(){var r,t,i,n,l,_,h,g,b,k,y,E,T,C,P,z,N,j,K,p,Z,me,Y,W,oe,re,fe,ie,Se,Ge,Ne,qe,Be,se,Fe,Oe,Re,ue,ye,Pe,he,He,ve,we,Ee,Ue,Ce,pe,We,bt,sr,q,ir,nr,lr,ar,_e,cr,fr,_r,ur,dr,hr,pr,Ht,Wt,$t,gr,br,mr,mt,yt,yr,xe,vr,Ke,Le,Gt,ee,te,Ie,vt,wt,Me=[].slice;ee=function(){var e,o,s,a,c;for(e={},c="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),a=0,o=c.length;a<o;a++)s=c[a],e["[object "+s+"]"]=s.toLowerCase();return function(f){var u;return u=Object.prototype.toString.call(f),e[u]||"object"}}(),pe=function(e,o,s){return o==null&&(o=0),s==null&&(s=1),e<o&&(e=o),e>s&&(e=s),e},te=function(e){return e.length>=3?Array.prototype.slice.call(e):e[0]},Z=function(e){var o,s;for(e._clipped=!1,e._unclipped=e.slice(0),o=s=0;s<3;o=++s)o<3?((e[o]<0||e[o]>255)&&(e._clipped=!0),e[o]<0&&(e[o]=0),e[o]>255&&(e[o]=255)):o===3&&(e[o]<0&&(e[o]=0),e[o]>1&&(e[o]=1));return e._clipped||delete e._unclipped,e},n=Math.PI,xe=Math.round,W=Math.cos,Se=Math.floor,_e=Math.pow,We=Math.log,Ke=Math.sin,Le=Math.sqrt,C=Math.atan2,q=Math.max,T=Math.abs,h=n*2,l=n/3,t=n/180,_=180/n,p=function(){return arguments[0]instanceof r?arguments[0]:function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,arguments,function(){})},p.default=p,E=[],typeof ht<"u"&&ht!==null&&ht.exports!=null&&(ht.exports=p),typeof define=="function"&&define.amd?define([],function(){return p}):(yr=typeof dt<"u"&&dt!==null?dt:this,yr.chroma=p),p.version="1.4.1",y={},b=[],k=!1,r=function(){function e(){var o,s,a,c,f,u,d,m,w;for(u=this,s=[],m=0,c=arguments.length;m<c;m++)o=arguments[m],o!=null&&s.push(o);if(s.length>1&&(d=s[s.length-1]),y[d]!=null)u._rgb=Z(y[d](te(s.slice(0,-1))));else{for(k||(b=b.sort(function(L,F){return F.p-L.p}),k=!0),w=0,f=b.length;w<f&&(a=b[w],d=a.test.apply(a,s),!d);w++);d&&(u._rgb=Z(y[d].apply(y,s)))}u._rgb==null&&console.warn("unknown format: "+s),u._rgb==null&&(u._rgb=[0,0,0]),u._rgb.length===3&&u._rgb.push(1)}return e.prototype.toString=function(){return this.hex()},e}(),p._input=y;p.brewer=j={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var e,o;o=[];for(e in j)o.push(j[e.toLowerCase()]=j[e]);return o}(),Ie={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},p.colors=Y=Ie,ve=function(){var e,o,s,a,c,f,u,d,m;return o=te(arguments),c=o[0],e=o[1],s=o[2],d=(c+16)/116,u=isNaN(e)?d:d+e/500,m=isNaN(s)?d:d-s/200,d=i.Yn*we(d),u=i.Xn*we(u),m=i.Zn*we(m),f=wt(3.2404542*u-1.5371385*d-.4985314*m),a=wt(-.969266*u+1.8760108*d+.041556*m),s=wt(.0556434*u-.2040259*d+1.0572252*m),[f,a,s,o.length>3?o[3]:1]},wt=function(e){return 255*(e<=.00304?12.92*e:1.055*_e(e,1/2.4)-.055)},we=function(e){return e>i.t1?e*e*e:i.t2*(e-i.t0)},i={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Ht=function(){var e,o,s,a,c,f,u,d;return a=te(arguments),s=a[0],o=a[1],e=a[2],c=mr(s,o,e),f=c[0],u=c[1],d=c[2],[116*u-16,500*(f-u),200*(u-d)]},mt=function(e){return(e/=255)<=.04045?e/12.92:_e((e+.055)/1.055,2.4)},vt=function(e){return e>i.t3?_e(e,1/3):e/i.t2+i.t0},mr=function(){var e,o,s,a,c,f,u;return a=te(arguments),s=a[0],o=a[1],e=a[2],s=mt(s),o=mt(o),e=mt(e),c=vt((.4124564*s+.3575761*o+.1804375*e)/i.Xn),f=vt((.2126729*s+.7151522*o+.072175*e)/i.Yn),u=vt((.0193339*s+.119192*o+.9503041*e)/i.Zn),[c,f,u]},p.lab=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["lab"]),function(){})},y.lab=ve,r.prototype.lab=function(){return Ht(this._rgb)},P=function(e){var o,s,a,c,f,u,d,m,w,L,F;return e=function(){var M,x,A;for(A=[],x=0,M=e.length;x<M;x++)c=e[x],A.push(p(c));return A}(),e.length===2?(w=function(){var M,x,A;for(A=[],x=0,M=e.length;x<M;x++)c=e[x],A.push(c.lab());return A}(),f=w[0],u=w[1],o=function(M){var x,A;return A=function(){var O,I;for(I=[],x=O=0;O<=2;x=++O)I.push(f[x]+M*(u[x]-f[x]));return I}(),p.lab.apply(p,A)}):e.length===3?(L=function(){var M,x,A;for(A=[],x=0,M=e.length;x<M;x++)c=e[x],A.push(c.lab());return A}(),f=L[0],u=L[1],d=L[2],o=function(M){var x,A;return A=function(){var O,I;for(I=[],x=O=0;O<=2;x=++O)I.push((1-M)*(1-M)*f[x]+2*(1-M)*M*u[x]+M*M*d[x]);return I}(),p.lab.apply(p,A)}):e.length===4?(F=function(){var M,x,A;for(A=[],x=0,M=e.length;x<M;x++)c=e[x],A.push(c.lab());return A}(),f=F[0],u=F[1],d=F[2],m=F[3],o=function(M){var x,A;return A=function(){var O,I;for(I=[],x=O=0;O<=2;x=++O)I.push((1-M)*(1-M)*(1-M)*f[x]+3*(1-M)*(1-M)*M*u[x]+3*(1-M)*M*M*d[x]+M*M*M*m[x]);return I}(),p.lab.apply(p,A)}):e.length===5&&(s=P(e.slice(0,3)),a=P(e.slice(2,5)),o=function(M){return M<.5?s(M*2):a((M-.5)*2)}),o},p.bezier=function(e){var o;return o=P(e),o.scale=function(){return p.scale(o)},o},p.cubehelix=function(e,o,s,a,c){var f,u,d;return e==null&&(e=300),o==null&&(o=-1.5),s==null&&(s=1),a==null&&(a=1),c==null&&(c=[0,1]),f=0,ee(c)==="array"?u=c[1]-c[0]:(u=0,c=[c,c]),d=function(m){var w,L,F,M,x,A,O,I,X;return w=h*((e+120)/360+o*m),O=_e(c[0]+u*m,a),A=f!==0?s[0]+m*f:s,L=A*O*(1-O)/2,M=W(w),X=Ke(w),I=O+L*(-.14861*M+1.78277*X),x=O+L*(-.29227*M-.90649*X),F=O+L*(1.97294*M),p(Z([I*255,x*255,F*255,1]))},d.start=function(m){return m==null?e:(e=m,d)},d.rotations=function(m){return m==null?o:(o=m,d)},d.gamma=function(m){return m==null?a:(a=m,d)},d.hue=function(m){return m==null?s:(s=m,ee(s)==="array"?(f=s[1]-s[0],f===0&&(s=s[1])):f=0,d)},d.lightness=function(m){return m==null?c:(ee(m)==="array"?(c=m,u=m[1]-m[0]):(c=[m,m],u=0),d)},d.scale=function(){return p.scale(d)},d.hue(s),d},p.random=function(){var e,o,s,a;for(o="0123456789abcdef",e="#",s=a=0;a<6;s=++a)e+=o.charAt(Se(Math.random()*16));return new r(e)},E=[],Oe=function(e,o,s,a){var c,f,u,d;for(s==null&&(s=.5),a==null&&(a="rgb"),ee(e)!=="object"&&(e=p(e)),ee(o)!=="object"&&(o=p(o)),u=0,f=E.length;u<f;u++)if(c=E[u],a===c[0]){d=c[1](e,o,s,a);break}if(d==null)throw"color mode "+a+" is not supported";return d.alpha(e.alpha()+s*(o.alpha()-e.alpha()))},p.interpolate=Oe,r.prototype.interpolate=function(e,o,s){return Oe(this,e,o,s)},p.mix=Oe,r.prototype.mix=r.prototype.interpolate,y.rgb=function(){var e,o,s,a;o=te(arguments),s=[];for(e in o)a=o[e],s.push(a);return s},p.rgb=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["rgb"]),function(){})},r.prototype.rgb=function(e){return e==null&&(e=!0),e?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},r.prototype.rgba=function(e){return e==null&&(e=!0),e?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},b.push({p:3,test:function(e){var o;if(o=te(arguments),ee(o)==="array"&&o.length===3||o.length===4&&ee(o[3])==="number"&&o[3]>=0&&o[3]<=1)return"rgb"}}),y.lrgb=y.rgb,ye=function(e,o,s,a){var c,f;return c=e._rgb,f=o._rgb,new r(Le(_e(c[0],2)*(1-s)+_e(f[0],2)*s),Le(_e(c[1],2)*(1-s)+_e(f[1],2)*s),Le(_e(c[2],2)*(1-s)+_e(f[2],2)*s),a)},g=function(e){var o,s,a,c,f,u;for(s=1/e.length,u=[0,0,0,0],c=0,a=e.length;c<a;c++)o=e[c],f=o._rgb,u[0]+=_e(f[0],2)*s,u[1]+=_e(f[1],2)*s,u[2]+=_e(f[2],2)*s,u[3]+=f[3]*s;return u[0]=Le(u[0]),u[1]=Le(u[1]),u[2]=Le(u[2]),u[3]>1&&(u[3]=1),new r(Z(u))},E.push(["lrgb",ye]),p.average=function(e,o){var s,a,c,f,u,d,m,w,L,F,M,x,A;if(o==null&&(o="rgb"),L=e.length,e=e.map(function(O){return p(O)}),m=e.splice(0,1)[0],o==="lrgb")return g(e);x=m.get(o),f=[],u=0,d=0;for(w in x)x[w]=x[w]||0,f.push(isNaN(x[w])?0:1),o.charAt(w)==="h"&&!isNaN(x[w])&&(s=x[w]/180*n,u+=W(s),d+=Ke(s));for(a=m.alpha(),M=0,F=e.length;M<F;M++){c=e[M],A=c.get(o),a+=c.alpha();for(w in x)isNaN(A[w])||(f[w]+=1,o.charAt(w)==="h"?(s=A[w]/180*n,u+=W(s),d+=Ke(s)):x[w]+=A[w])}for(w in x)if(o.charAt(w)==="h"){for(s=C(d/f[w],u/f[w])/n*180;s<0;)s+=360;for(;s>=360;)s-=360;x[w]=s}else x[w]=x[w]/f[w];return p(x,o).alpha(a/L)},Ne=function(e){var o,s,a,c,f,u;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(e.length===4||e.length===7)&&(e=e.substr(1)),e.length===3&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),u=parseInt(e,16),c=u>>16,a=u>>8&255,s=u&255,[c,a,s,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return e.length===9&&(e=e.substr(1)),u=parseInt(e,16),c=u>>24&255,a=u>>16&255,s=u>>8&255,o=xe((u&255)/255*100)/100,[c,a,s,o];if(y.css!=null&&(f=y.css(e)))return f;throw"unknown color: "+e},ur=function(e,o){var s,a,c,f,u,d,m;return o==null&&(o="auto"),u=e[0],c=e[1],a=e[2],s=e[3],o==="auto"&&(o=s<1?"rgba":"rgb"),u=Math.round(u),c=Math.round(c),a=Math.round(a),m=u<<16|c<<8|a,d="000000"+m.toString(16),d=d.substr(d.length-6),f="0"+xe(s*255).toString(16),f=f.substr(f.length-2),"#"+function(){switch(o.toLowerCase()){case"rgba":return d+f;case"argb":return f+d;default:return d}}()},y.hex=function(e){return Ne(e)},p.hex=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["hex"]),function(){})},r.prototype.hex=function(e){return e==null&&(e="auto"),ur(this._rgb,e)},b.push({p:4,test:function(e){if(arguments.length===1&&ee(e)==="string")return"hex"}}),se=function(){var e,o,s,a,c,f,u,d,m,w,L,F,M,x;if(e=te(arguments),c=e[0],L=e[1],u=e[2],L===0)m=a=o=u*255;else{for(x=[0,0,0],s=[0,0,0],M=u<.5?u*(1+L):u+L-u*L,F=2*u-M,c/=360,x[0]=c+1/3,x[1]=c,x[2]=c-1/3,f=d=0;d<=2;f=++d)x[f]<0&&(x[f]+=1),x[f]>1&&(x[f]-=1),6*x[f]<1?s[f]=F+(M-F)*6*x[f]:2*x[f]<1?s[f]=M:3*x[f]<2?s[f]=F+(M-F)*(2/3-x[f])*6:s[f]=F;w=[xe(s[0]*255),xe(s[1]*255),xe(s[2]*255)],m=w[0],a=w[1],o=w[2]}return e.length>3?[m,a,o,e[3]]:[m,a,o]},hr=function(e,o,s){var a,c,f,u,d;return e!==void 0&&e.length>=3&&(u=e,e=u[0],o=u[1],s=u[2]),e/=255,o/=255,s/=255,f=Math.min(e,o,s),q=Math.max(e,o,s),c=(q+f)/2,q===f?(d=0,a=Number.NaN):d=c<.5?(q-f)/(q+f):(q-f)/(2-q-f),e===q?a=(o-s)/(q-f):o===q?a=2+(s-e)/(q-f):s===q&&(a=4+(e-o)/(q-f)),a*=60,a<0&&(a+=360),[a,d,c]},p.hsl=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["hsl"]),function(){})},y.hsl=se,r.prototype.hsl=function(){return hr(this._rgb)},Fe=function(){var e,o,s,a,c,f,u,d,m,w,L,F,M,x,A,O,I,X;if(e=te(arguments),c=e[0],O=e[1],X=e[2],X*=255,O===0)m=a=o=X;else switch(c===360&&(c=0),c>360&&(c-=360),c<0&&(c+=360),c/=60,f=Se(c),s=c-f,u=X*(1-O),d=X*(1-O*s),I=X*(1-O*(1-s)),f){case 0:w=[X,I,u],m=w[0],a=w[1],o=w[2];break;case 1:L=[d,X,u],m=L[0],a=L[1],o=L[2];break;case 2:F=[u,X,I],m=F[0],a=F[1],o=F[2];break;case 3:M=[u,d,X],m=M[0],a=M[1],o=M[2];break;case 4:x=[I,u,X],m=x[0],a=x[1],o=x[2];break;case 5:A=[X,u,d],m=A[0],a=A[1],o=A[2]}return[m,a,o,e.length>3?e[3]:1]},pr=function(){var e,o,s,a,c,f,u,d,m;return u=te(arguments),f=u[0],s=u[1],e=u[2],c=Math.min(f,s,e),q=Math.max(f,s,e),o=q-c,m=q/255,q===0?(a=Number.NaN,d=0):(d=o/q,f===q&&(a=(s-e)/o),s===q&&(a=2+(e-f)/o),e===q&&(a=4+(f-s)/o),a*=60,a<0&&(a+=360)),[a,d,m]},p.hsv=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["hsv"]),function(){})},y.hsv=Fe,r.prototype.hsv=function(){return pr(this._rgb)},lr=function(e){var o,s,a;return ee(e)==="number"&&e>=0&&e<=16777215?(a=e>>16,s=e>>8&255,o=e&255,[a,s,o,1]):(console.warn("unknown num color: "+e),[0,0,0,1])},gr=function(){var e,o,s,a;return a=te(arguments),s=a[0],o=a[1],e=a[2],(s<<16)+(o<<8)+e},p.num=function(e){return new r(e,"num")},r.prototype.num=function(e){return e==null&&(e="rgb"),gr(this._rgb,e)},y.num=lr,b.push({p:1,test:function(e){if(arguments.length===1&&ee(e)==="number"&&e>=0&&e<=16777215)return"num"}}),Ge=function(){var e,o,s,a,c,f,u,d,m,w,L,F,M,x,A,O,I,X,ne,R;if(s=te(arguments),d=s[0],c=s[1],o=s[2],c=c/100,u=u/100*255,e=c*255,c===0)F=u=a=o;else switch(d===360&&(d=0),d>360&&(d-=360),d<0&&(d+=360),d/=60,m=Se(d),f=d-m,w=o*(1-c),L=w+e*(1-f),ne=w+e*f,R=w+e,m){case 0:M=[R,ne,w],F=M[0],u=M[1],a=M[2];break;case 1:x=[L,R,w],F=x[0],u=x[1],a=x[2];break;case 2:A=[w,R,ne],F=A[0],u=A[1],a=A[2];break;case 3:O=[w,L,R],F=O[0],u=O[1],a=O[2];break;case 4:I=[ne,w,R],F=I[0],u=I[1],a=I[2];break;case 5:X=[R,w,L],F=X[0],u=X[1],a=X[2]}return[F,u,a,s.length>3?s[3]:1]},_r=function(){var e,o,s,a,c,f,u,d,m;return m=te(arguments),d=m[0],c=m[1],o=m[2],u=Math.min(d,c,o),q=Math.max(d,c,o),a=q-u,s=a*100/255,e=u/(255-a)*100,a===0?f=Number.NaN:(d===q&&(f=(c-o)/a),c===q&&(f=2+(o-d)/a),o===q&&(f=4+(d-c)/a),f*=60,f<0&&(f+=360)),[f,s,e]},p.hcg=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["hcg"]),function(){})},y.hcg=Ge,r.prototype.hcg=function(){return _r(this._rgb)},oe=function(e){var o,s,a,c,f,u,d,m;if(e=e.toLowerCase(),p.colors!=null&&p.colors[e])return Ne(p.colors[e]);if(f=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(d=f.slice(1,4),c=u=0;u<=2;c=++u)d[c]=+d[c];d[3]=1}else if(f=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(d=f.slice(1,5),c=m=0;m<=3;c=++m)d[c]=+d[c];else if(f=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(d=f.slice(1,4),c=o=0;o<=2;c=++o)d[c]=xe(d[c]*2.55);d[3]=1}else if(f=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(d=f.slice(1,5),c=s=0;s<=2;c=++s)d[c]=xe(d[c]*2.55);d[3]=+d[3]}else(f=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(a=f.slice(1,4),a[1]*=.01,a[2]*=.01,d=se(a),d[3]=1):(f=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(a=f.slice(1,4),a[1]*=.01,a[2]*=.01,d=se(a),d[3]=+f[4]);return d},fr=function(e){var o;if(o=e[3]<1?"rgba":"rgb",o==="rgb")return o+"("+e.slice(0,3).map(xe).join(",")+")";if(o==="rgba")return o+"("+e.slice(0,3).map(xe).join(",")+","+e[3]+")"},yt=function(e){return xe(e*100)/100},Be=function(e,o){var s;return s=o<1?"hsla":"hsl",e[0]=yt(e[0]||0),e[1]=yt(e[1]*100)+"%",e[2]=yt(e[2]*100)+"%",s==="hsla"&&(e[3]=o),s+"("+e.join(",")+")"},y.css=function(e){return oe(e)},p.css=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["css"]),function(){})},r.prototype.css=function(e){if(e==null&&(e="rgb"),e.slice(0,3)==="rgb")return fr(this._rgb);if(e.slice(0,3)==="hsl")return Be(this.hsl(),this.alpha())},y.named=function(e){return Ne(Ie[e])},b.push({p:5,test:function(e){if(arguments.length===1&&Ie[e]!=null)return"named"}}),r.prototype.name=function(e){var o,s;arguments.length&&(Ie[e]&&(this._rgb=Ne(Ie[e])),this._rgb[3]=1),o=this.hex("rgb");for(s in Ie)if(o===Ie[s])return s;return o},Ee=function(){var e,o,s,a;return a=te(arguments),s=a[0],e=a[1],o=a[2],o=o*t,[s,W(o)*e,Ke(o)*e]},Ue=function(){var e,o,s,a,c,f,u,d,m,w,L;return s=te(arguments),d=s[0],c=s[1],u=s[2],w=Ee(d,c,u),e=w[0],o=w[1],a=w[2],L=ve(e,o,a),m=L[0],f=L[1],a=L[2],[m,f,a,s.length>3?s[3]:1]},He=function(){var e,o,s,a,c,f;return f=te(arguments),c=f[0],e=f[1],o=f[2],s=Le(e*e+o*o),a=(C(o,e)*_+360)%360,xe(s*1e4)===0&&(a=Number.NaN),[c,s,a]},Wt=function(){var e,o,s,a,c,f,u;return f=te(arguments),c=f[0],s=f[1],o=f[2],u=Ht(c,s,o),a=u[0],e=u[1],o=u[2],He(a,e,o)},p.lch=function(){var e;return e=te(arguments),new r(e,"lch")},p.hcl=function(){var e;return e=te(arguments),new r(e,"hcl")},y.lch=Ue,y.hcl=function(){var e,o,s,a;return a=te(arguments),o=a[0],e=a[1],s=a[2],Ue([s,e,o])},r.prototype.lch=function(){return Wt(this._rgb)},r.prototype.hcl=function(){return Wt(this._rgb).reverse()},cr=function(e){var o,s,a,c,f,u,d,m,w;return e==null&&(e="rgb"),m=te(arguments),d=m[0],c=m[1],o=m[2],d=d/255,c=c/255,o=o/255,f=1-Math.max(d,Math.max(c,o)),a=f<1?1/(1-f):0,s=(1-d-f)*a,u=(1-c-f)*a,w=(1-o-f)*a,[s,u,w,f]},me=function(){var e,o,s,a,c,f,u,d,m;return o=te(arguments),a=o[0],u=o[1],m=o[2],f=o[3],e=o.length>4?o[4]:1,f===1?[0,0,0,e]:(d=a>=1?0:255*(1-a)*(1-f),c=u>=1?0:255*(1-u)*(1-f),s=m>=1?0:255*(1-m)*(1-f),[d,c,s,e])},y.cmyk=function(){return me(te(arguments))},p.cmyk=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["cmyk"]),function(){})},r.prototype.cmyk=function(){return cr(this._rgb)},y.gl=function(){var e,o,s,a,c;for(a=function(){var f,u;f=te(arguments),u=[];for(o in f)c=f[o],u.push(c);return u}.apply(this,arguments),e=s=0;s<=2;e=++s)a[e]*=255;return a},p.gl=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["gl"]),function(){})},r.prototype.gl=function(){var e;return e=this._rgb,[e[0]/255,e[1]/255,e[2]/255,e[3]]},$t=function(e,o,s){var a;return a=te(arguments),e=a[0],o=a[1],s=a[2],e=bt(e),o=bt(o),s=bt(s),.2126*e+.7152*o+.0722*s},bt=function(e){return e/=255,e<=.03928?e/12.92:_e((e+.055)/1.055,2.4)},he=function(e,o,s,a){var c,f;return c=e._rgb,f=o._rgb,new r(c[0]+s*(f[0]-c[0]),c[1]+s*(f[1]-c[1]),c[2]+s*(f[2]-c[2]),a)},E.push(["rgb",he]),r.prototype.luminance=function(e,o){var s,a,c,f,u;return o==null&&(o="rgb"),arguments.length?(f=this._rgb,e===0?f=[0,0,0,this._rgb[3]]:e===1?f=[255,255,255,this[3]]:(s=$t(this._rgb),a=1e-7,c=20,u=function(d,m){var w,L;return L=d.interpolate(m,.5,o),w=L.luminance(),Math.abs(e-w)<a||!c--?L:w>e?u(d,L):u(L,m)},s>e?f=u(p("black"),this).rgba():f=u(this,p("white")).rgba()),p(f).alpha(this.alpha())):$t(this._rgb)},Gt=function(e){var o,s,a,c;return c=e/100,c<66?(a=255,s=-155.25485562709179-.44596950469579133*(s=c-2)+104.49216199393888*We(s),o=c<20?0:-254.76935184120902+.8274096064007395*(o=c-10)+115.67994401066147*We(o)):(a=351.97690566805693+.114206453784165*(a=c-55)-40.25366309332127*We(a),s=325.4494125711974+.07943456536662342*(s=c-50)-28.0852963507957*We(s),o=255),[a,s,o]},br=function(){var e,o,s,a,c,f,u,d,m;for(u=te(arguments),f=u[0],s=u[1],e=u[2],c=1e3,a=4e4,o=.4;a-c>o;)m=(a+c)*.5,d=Gt(m),d[2]/d[0]>=e/f?a=m:c=m;return xe(m)},p.temperature=p.kelvin=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["temperature"]),function(){})},y.temperature=y.kelvin=y.K=Gt,r.prototype.temperature=function(){return br(this._rgb)},r.prototype.kelvin=r.prototype.temperature,p.contrast=function(e,o){var s,a,c,f;return((c=ee(e))==="string"||c==="number")&&(e=new r(e)),((f=ee(o))==="string"||f==="number")&&(o=new r(o)),s=e.luminance(),a=o.luminance(),s>a?(s+.05)/(a+.05):(a+.05)/(s+.05)},p.distance=function(e,o,s){var a,c,f,u,d,m,w;s==null&&(s="lab"),((d=ee(e))==="string"||d==="number")&&(e=new r(e)),((m=ee(o))==="string"||m==="number")&&(o=new r(o)),f=e.get(s),u=o.get(s),w=0;for(c in f)a=(f[c]||0)-(u[c]||0),w+=a*a;return Math.sqrt(w)},p.deltaE=function(e,o,s,a){var c,f,u,d,m,w,L,F,M,x,A,O,I,X,ne,R,ze,ke,$,U,ge,v,S,H,G,D,B;for(s==null&&(s=1),a==null&&(a=1),((ze=ee(e))==="string"||ze==="number")&&(e=new r(e)),((ke=ee(o))==="string"||ke==="number")&&(o=new r(o)),$=e.lab(),c=$[0],u=$[1],m=$[2],U=o.lab(),f=U[0],d=U[1],w=U[2],L=Le(u*u+m*m),F=Le(d*d+w*w),S=c<16?.511:.040975*c/(1+.01765*c),ge=.0638*L/(1+.0131*L)+.638,R=L<1e-6?0:C(m,u)*180/n;R<0;)R+=360;for(;R>=360;)R-=360;return H=R>=164&&R<=345?.56+T(.2*W(n*(R+168)/180)):.36+T(.4*W(n*(R+35)/180)),M=L*L*L*L,ne=Le(M/(M+1900)),v=ge*(ne*H+1-ne),X=c-f,I=L-F,A=u-d,O=m-w,x=A*A+O*O-I*I,G=X/(s*S),D=I/(a*ge),B=v,Le(G*G+D*D+x/(B*B))},r.prototype.get=function(e){var o,s,a,c,f,u;return a=this,f=e.split("."),c=f[0],o=f[1],u=a[c](),o?(s=c.indexOf(o),s>-1?u[s]:console.warn("unknown channel "+o+" in mode "+c)):u},r.prototype.set=function(e,o){var s,a,c,f,u,d;if(c=this,u=e.split("."),f=u[0],s=u[1],s)if(d=c[f](),a=f.indexOf(s),a>-1)if(ee(o)==="string")switch(o.charAt(0)){case"+":d[a]+=+o;break;case"-":d[a]+=+o;break;case"*":d[a]*=+o.substr(1);break;case"/":d[a]/=+o.substr(1);break;default:d[a]=+o}else d[a]=o;else console.warn("unknown channel "+s+" in mode "+f);else d=o;return p(d,f).alpha(c.alpha())},r.prototype.clipped=function(){return this._rgb._clipped||!1},r.prototype.alpha=function(e){return arguments.length?p.rgb([this._rgb[0],this._rgb[1],this._rgb[2],e]):this._rgb[3]},r.prototype.darken=function(e){var o,s;return e==null&&(e=1),s=this,o=s.lab(),o[0]-=i.Kn*e,p.lab(o).alpha(s.alpha())},r.prototype.brighten=function(e){return e==null&&(e=1),this.darken(-e)},r.prototype.darker=r.prototype.darken,r.prototype.brighter=r.prototype.brighten,r.prototype.saturate=function(e){var o,s;return e==null&&(e=1),s=this,o=s.lch(),o[1]+=e*i.Kn,o[1]<0&&(o[1]=0),p.lch(o).alpha(s.alpha())},r.prototype.desaturate=function(e){return e==null&&(e=1),this.saturate(-e)},r.prototype.premultiply=function(){var e,o;return o=this.rgb(),e=this.alpha(),p(o[0]*e,o[1]*e,o[2]*e,e)},z=function(e,o,s){if(!z[s])throw"unknown blend mode "+s;return z[s](e,o)},N=function(e){return function(o,s){var a,c;return a=p(s).rgb(),c=p(o).rgb(),p(e(a,c),"rgb")}},ie=function(e){return function(o,s){var a,c,f;for(f=[],a=c=0;c<=3;a=++c)f[a]=e(o[a],s[a]);return f}},nr=function(e,o){return e},ir=function(e,o){return e*o/255},re=function(e,o){return e>o?o:e},Ce=function(e,o){return e>o?e:o},vr=function(e,o){return 255*(1-(1-e/255)*(1-o/255))},ar=function(e,o){return o<128?2*e*o/255:255*(1-2*(1-e/255)*(1-o/255))},K=function(e,o){return 255*(1-(1-o/255)/(e/255))},fe=function(e,o){return e===255||(e=255*(o/255)/(1-e/255),e>255)?255:e},z.normal=N(ie(nr)),z.multiply=N(ie(ir)),z.screen=N(ie(vr)),z.overlay=N(ie(ar)),z.darken=N(ie(re)),z.lighten=N(ie(Ce)),z.dodge=N(ie(fe)),z.burn=N(ie(K)),p.blend=z,p.analyze=function(e){var o,s,a,c;for(a={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},s=0,o=e.length;s<o;s++)c=e[s],c!=null&&!isNaN(c)&&(a.values.push(c),a.sum+=c,c<a.min&&(a.min=c),c>a.max&&(a.max=c),a.count+=1);return a.domain=[a.min,a.max],a.limits=function(f,u){return p.limits(a,f,u)},a},p.scale=function(e,o){var s,a,c,f,u,d,m,w,L,F,M,x,A,O,I,X,ne,R,ze,ke,$,U,ge;return F="rgb",M=p("#ccc"),I=0,d=!1,u=[0,1],O=[],A=[0,0],s=!1,c=[],x=!1,L=0,w=1,f=!1,a={},X=!0,m=1,U=function(v){var S,H,G,D,B,Q;if(v==null&&(v=["#fff","#000"]),v!=null&&ee(v)==="string"&&p.brewer!=null&&(v=p.brewer[v]||p.brewer[v.toLowerCase()]||v),ee(v)==="array"){for(v.length===1&&(v=[v[0],v[0]]),v=v.slice(0),S=G=0,D=v.length-1;0<=D?G<=D:G>=D;S=0<=D?++G:--G)H=v[S],ee(H)==="string"&&(v[S]=p(H));for(O.length=0,S=Q=0,B=v.length-1;0<=B?Q<=B:Q>=B;S=0<=B?++Q:--Q)O.push(S/(v.length-1))}return $(),c=v},ze=function(v){var S,H;if(s!=null){for(H=s.length-1,S=0;S<H&&v>=s[S];)S++;return S-1}return 0},ge=function(v){return v},ne=function(v){var S,H,G,D,B;return B=v,s.length>2&&(D=s.length-1,S=ze(v),G=s[0]+(s[1]-s[0])*(0+I*.5),H=s[D-1]+(s[D]-s[D-1])*(1-I*.5),B=L+(s[S]+(s[S+1]-s[S])*.5-G)/(H-G)*(w-L)),B},ke=function(v,S){var H,G,D,B,Q,J,ae,V;if(S==null&&(S=!1),isNaN(v)||v===null)return M;if(S?V=v:s&&s.length>2?(H=ze(v),V=H/(s.length-2)):w!==L?V=(v-L)/(w-L):V=1,S||(V=ge(V)),m!==1&&(V=_e(V,m)),V=A[0]+V*(1-A[0]-A[1]),V=Math.min(1,Math.max(0,V)),B=Math.floor(V*1e4),X&&a[B])G=a[B];else{if(ee(c)==="array")for(D=Q=0,ae=O.length-1;0<=ae?Q<=ae:Q>=ae;D=0<=ae?++Q:--Q){if(J=O[D],V<=J){G=c[D];break}if(V>=J&&D===O.length-1){G=c[D];break}if(V>J&&V<O[D+1]){V=(V-J)/(O[D+1]-J),G=p.interpolate(c[D],c[D+1],V,F);break}}else ee(c)==="function"&&(G=c(V));X&&(a[B]=G)}return G},$=function(){return a={}},U(e),R=function(v){var S;return S=p(ke(v)),x&&S[x]?S[x]():S},R.classes=function(v){var S;return v!=null?(ee(v)==="array"?(s=v,u=[v[0],v[v.length-1]]):(S=p.analyze(u),v===0?s=[S.min,S.max]:s=p.limits(S,"e",v)),R):s},R.domain=function(v){var S,H,G,D,B,Q,J;if(!arguments.length)return u;if(L=v[0],w=v[v.length-1],O=[],G=c.length,v.length===G&&L!==w)for(B=0,D=v.length;B<D;B++)H=v[B],O.push((H-L)/(w-L));else for(S=J=0,Q=G-1;0<=Q?J<=Q:J>=Q;S=0<=Q?++J:--J)O.push(S/(G-1));return u=[L,w],R},R.mode=function(v){return arguments.length?(F=v,$(),R):F},R.range=function(v,S){return U(v,S),R},R.out=function(v){return x=v,R},R.spread=function(v){return arguments.length?(I=v,R):I},R.correctLightness=function(v){return v==null&&(v=!0),f=v,$(),f?ge=function(S){var H,G,D,B,Q,J,ae,V,de;for(H=ke(0,!0).lab()[0],G=ke(1,!0).lab()[0],ae=H>G,D=ke(S,!0).lab()[0],Q=H+(G-H)*S,B=D-Q,V=0,de=1,J=20;Math.abs(B)>.01&&J-- >0;)(function(){return ae&&(B*=-1),B<0?(V=S,S+=(de-S)*.5):(de=S,S+=(V-S)*.5),D=ke(S,!0).lab()[0],B=D-Q})();return S}:ge=function(S){return S},R},R.padding=function(v){return v!=null?(ee(v)==="number"&&(v=[v,v]),A=v,R):A},R.colors=function(v,S){var H,G,D,B,Q,J,ae,V,de;if(arguments.length<2&&(S="hex"),J=[],arguments.length===0)J=c.slice(0);else if(v===1)J=[R(.5)];else if(v>1)G=u[0],H=u[1]-G,J=function(){ae=[];for(var be=0;0<=v?be<v:be>v;0<=v?be++:be--)ae.push(be);return ae}.apply(this).map(function(be){return R(G+be/(v-1)*H)});else{if(e=[],V=[],s&&s.length>2)for(D=de=1,Q=s.length;1<=Q?de<Q:de>Q;D=1<=Q?++de:--de)V.push((s[D-1]+s[D])*.5);else V=u;J=V.map(function(be){return R(be)})}return p[S]&&(J=J.map(function(be){return be[S]()})),J},R.cache=function(v){return v!=null?(X=v,R):X},R.gamma=function(v){return v!=null?(m=v,R):m},R.nodata=function(v){return v!=null?(M=p(v),R):M},R},p.scales==null&&(p.scales={}),p.scales.cool=function(){return p.scale([p.hsl(180,1,.9),p.hsl(250,.7,.4)])},p.scales.hot=function(){return p.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},p.analyze=function(e,o,s){var a,c,f,u,d,m,w;if(d={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},s==null&&(s=function(){return!0}),a=function(L){L!=null&&!isNaN(L)&&(d.values.push(L),d.sum+=L,L<d.min&&(d.min=L),L>d.max&&(d.max=L),d.count+=1)},w=function(L,F){if(s(L,F))return o!=null&&ee(o)==="function"?a(o(L)):o!=null&&ee(o)==="string"||ee(o)==="number"?a(L[o]):a(L)},ee(e)==="array")for(u=0,f=e.length;u<f;u++)m=e[u],w(m);else for(c in e)m=e[c],w(m,c);return d.domain=[d.min,d.max],d.limits=function(L,F){return p.limits(d,L,F)},d},p.limits=function(e,o,s){var a,c,f,u,d,m,w,L,F,M,x,A,O,I,X,ne,R,ze,ke,$,U,ge,v,S,H,G,D,B,Q,J,ae,V,de,be,Ze,Je,Qe,et,tt,rt,wr,ot,st,it,nt,lt,at,ct,ft,_t,ho,Te,xt,xr,Ae,ut;if(o==null&&(o="equal"),s==null&&(s=7),ee(e)==="array"&&(e=p.analyze(e)),H=e.min,q=e.max,ho=e.sum,Ae=e.values.sort(function(qt,Bt){return qt-Bt}),s===1)return[H,q];if(v=[],o.substr(0,1)==="c"&&(v.push(H),v.push(q)),o.substr(0,1)==="e"){for(v.push(H),$=ae=1,Ze=s-1;1<=Ze?ae<=Ze:ae>=Ze;$=1<=Ze?++ae:--ae)v.push(H+$/s*(q-H));v.push(q)}else if(o.substr(0,1)==="l"){if(H<=0)throw"Logarithmic scales are only possible for values > 0";for(G=Math.LOG10E*We(H),S=Math.LOG10E*We(q),v.push(H),$=ut=1,Je=s-1;1<=Je?ut<=Je:ut>=Je;$=1<=Je?++ut:--ut)v.push(_e(10,G+$/s*(S-G)));v.push(q)}else if(o.substr(0,1)==="q"){for(v.push(H),$=a=1,ot=s-1;1<=ot?a<=ot:a>=ot;$=1<=ot?++a:--a)V=(Ae.length-1)*$/s,de=Se(V),de===V?v.push(Ae[de]):(be=V-de,v.push(Ae[de]*(1-be)+Ae[de+1]*be));v.push(q)}else if(o.substr(0,1)==="k"){for(B=Ae.length,I=new Array(B),ze=new Array(s),_t=!0,Q=0,ne=null,ne=[],ne.push(H),$=c=1,st=s-1;1<=st?c<=st:c>=st;$=1<=st?++c:--c)ne.push(H+$/s*(q-H));for(ne.push(q);_t;){for(U=f=0,it=s-1;0<=it?f<=it:f>=it;U=0<=it?++f:--f)ze[U]=0;for($=u=0,nt=B-1;0<=nt?u<=nt:u>=nt;$=0<=nt?++u:--u){for(xr=Ae[$],D=Number.MAX_VALUE,U=d=0,lt=s-1;0<=lt?d<=lt:d>=lt;U=0<=lt?++d:--d)ke=T(ne[U]-xr),ke<D&&(D=ke,X=U);ze[X]++,I[$]=X}for(J=new Array(s),U=m=0,at=s-1;0<=at?m<=at:m>=at;U=0<=at?++m:--m)J[U]=null;for($=w=0,ct=B-1;0<=ct?w<=ct:w>=ct;$=0<=ct?++w:--w)R=I[$],J[R]===null?J[R]=Ae[$]:J[R]+=Ae[$];for(U=L=0,ft=s-1;0<=ft?L<=ft:L>=ft;U=0<=ft?++L:--L)J[U]*=1/ze[U];for(_t=!1,U=F=0,Qe=s-1;0<=Qe?F<=Qe:F>=Qe;U=0<=Qe?++F:--F)if(J[U]!==ne[$]){_t=!0;break}ne=J,Q++,Q>200&&(_t=!1)}for(ge={},U=M=0,et=s-1;0<=et?M<=et:M>=et;U=0<=et?++M:--M)ge[U]=[];for($=x=0,tt=B-1;0<=tt?x<=tt:x>=tt;$=0<=tt?++x:--x)R=I[$],ge[R].push(Ae[$]);for(Te=[],U=A=0,rt=s-1;0<=rt?A<=rt:A>=rt;U=0<=rt?++A:--A)Te.push(ge[U][0]),Te.push(ge[U][ge[U].length-1]);for(Te=Te.sort(function(qt,Bt){return qt-Bt}),v.push(Te[0]),$=O=1,wr=Te.length-1;O<=wr;$=O+=2)xt=Te[$],!isNaN(xt)&&v.indexOf(xt)===-1&&v.push(xt)}return v},qe=function(e,o,s){var a,c,f,u;return a=te(arguments),e=a[0],o=a[1],s=a[2],isNaN(e)&&(e=0),e/=360,e<1/3?(c=(1-o)/3,u=(1+o*W(h*e)/W(l-h*e))/3,f=1-(c+u)):e<2/3?(e-=1/3,u=(1-o)/3,f=(1+o*W(h*e)/W(l-h*e))/3,c=1-(u+f)):(e-=2/3,f=(1-o)/3,c=(1+o*W(h*e)/W(l-h*e))/3,u=1-(f+c)),u=pe(s*u*3),f=pe(s*f*3),c=pe(s*c*3),[u*255,f*255,c*255,a.length>3?a[3]:1]},dr=function(){var e,o,s,a,c,f,u,d;return u=te(arguments),f=u[0],o=u[1],e=u[2],h=Math.PI*2,f/=255,o/=255,e/=255,c=Math.min(f,o,e),a=(f+o+e)/3,d=1-c/a,d===0?s=0:(s=(f-o+(f-e))/2,s/=Math.sqrt((f-o)*(f-o)+(f-e)*(o-e)),s=Math.acos(s),e>o&&(s=h-s),s/=h),[s*360,d,a]},p.hsi=function(){return function(e,o,s){s.prototype=e.prototype;var a=new s,c=e.apply(a,o);return Object(c)===c?c:a}(r,Me.call(arguments).concat(["hsi"]),function(){})},y.hsi=qe,r.prototype.hsi=function(){return dr(this._rgb)},Re=function(e,o,s,a){var c,f,u,d,m,w,L,F,M,x,A,O,I;return a==="hsl"?(O=e.hsl(),I=o.hsl()):a==="hsv"?(O=e.hsv(),I=o.hsv()):a==="hcg"?(O=e.hcg(),I=o.hcg()):a==="hsi"?(O=e.hsi(),I=o.hsi()):(a==="lch"||a==="hcl")&&(a="hcl",O=e.hcl(),I=o.hcl()),a.substr(0,1)==="h"&&(u=O[0],x=O[1],w=O[2],d=I[0],A=I[1],L=I[2]),!isNaN(u)&&!isNaN(d)?(d>u&&d-u>180?c=d-(u+360):d<u&&u-d>180?c=d+360-u:c=d-u,f=u+s*c):isNaN(u)?isNaN(d)?f=Number.NaN:(f=d,(w===1||w===0)&&a!=="hsv"&&(M=A)):(f=u,(L===1||L===0)&&a!=="hsv"&&(M=x)),M==null&&(M=x+s*(A-x)),m=w+s*(L-w),F=p[a](f,M,m)},E=E.concat(function(){var e,o,s,a;for(s=["hsv","hsl","hsi","hcl","lch","hcg"],a=[],o=0,e=s.length;o<e;o++)sr=s[o],a.push([sr,Re]);return a}()),Pe=function(e,o,s,a){var c,f;return c=e.num(),f=o.num(),p.num(c+(f-c)*s,"num")},E.push(["num",Pe]),ue=function(e,o,s,a){var c,f,u;return f=e.lab(),u=o.lab(),c=new r(f[0]+s*(u[0]-f[0]),f[1]+s*(u[1]-f[1]),f[2]+s*(u[2]-f[2]),a)},E.push(["lab",ue])}).call(dt)});var $e=new WeakMap,xo=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?5e6:1e7;function Mr(r,t,i,n,l){var _={};return Object.keys(n).forEach(function(h){_[h]=n[h]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=i.slice().reverse().reduce(function(h,g){return g(r,t,h)||h},_),l&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(l):void 0,_.initializer=void 0),_.initializer===void 0&&(Object.defineProperty(r,t,_),_=null),_}var zt=0,Ye=0,Lr=performance.now(),zr=(r,...t)=>r.map((i,n)=>[i,t[n]]).flat().filter(i=>!!i).join("");function Er(r,t,i){let n=i.value,l=Symbol("regular-table throttle lock");return i.value=async function(..._){if(this[l]!==void 0&&(await this[l],this[l]!==void 0))return void await this[l];let h;this[l]=(()=>{let g,b=new Promise(k=>{g=k});return b.resolve=g,b})();try{h=await n.call(this,..._)}finally{let g=this[l];this[l]=void 0,g.resolve()}return h},i.value.flush=async function(){return await new Promise(requestAnimationFrame),await this[l]},i}var Lt,ko=(Mr((Lt=class extends HTMLElement{create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=zr` <style> ${":host{bottom:0;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch}:host,div.rt-virtual-panel{position:absolute;top:0;left:0;right:0}div.rt-virtual-panel{pointer-events:none}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%}div.rt-tree-container{display:flex;align-items:center;height:100%}slot{position:absolute;overflow:hidden;overflow-anchor:none}"} </style> <style> ${":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px}"} </style> <div class="rt-virtual-panel"></div> <div class="rt-scroll-table-clip"> ${"<slot></slot>"} </div> `;let[,r,t,i]=this.shadowRoot.children;this._sub_cell_style=r,this._table_clip=i,this._virtual_panel=t,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode==="both"||this._virtual_mode==="vertical"?this._table_clip.style.top="0px":this._table_clip.style.removeProperty("top"),this._virtual_mode==="both"||this._virtual_mode==="horizontal"?this._table_clip.style.left="0px":this._table_clip.style.removeProperty("left"),this._virtual_mode!=="both"?this._table_clip.style.contain="none":this._table_clip.style.removeProperty("contain"))}_calculate_viewport(r,t){let{start_row:i,end_row:n}=this._calculate_row_range(r),{start_col:l,end_col:_}=this._calculate_column_range(t);return this._nrows=r,{start_col:l,end_col:_,start_row:i,end_row:n}}_calculate_row_range(r){let{height:t}=this._container_size,i=this._column_sizes.row_height||19,n=this._view_cache.config.column_pivots.length,l=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),_=Math.max(Math.ceil(this.scrollTop),0)/l,h=t/i-n,g=r||0,b=Math.max(0,Math.ceil(g-h))*_;return{start_row:b,end_row:Math.max(0,Math.min(b+h,r))}}_calc_start_column(){let r=this._view_cache.config.row_pivots.length,t=0,i=0,n=0;for(;i<this.scrollLeft;){let l=this._column_sizes.indices[t+r];n=this.scrollLeft-i,t+=1,i+=l!==void 0?l:60}return t+=n/(this._column_sizes.indices[t+r-1]||60),Math.max(0,t-1)}_calculate_column_range(r){if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let t=this._calc_start_column();return{start_col:t,end_col:t+(this.table_model.num_columns()||Math.min(r,Math.ceil(this._container_size.width/60)))+1}}}_max_scroll_column(r){let t=0;if(this._view_cache.config.row_pivots.length>0)for(let l of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))t+=l;let i=this._view_cache.config.row_pivots.length,n=r;for(;t<this._container_size.width&&n>=0;)n--,t+=this._column_sizes.indices[n+i]||60;return Math.min(r-1,n+1)}_validate_viewport({start_col:r,end_col:t,start_row:i,end_row:n}){i=Math.floor(i),n=Math.ceil(n),r=Math.floor(r),t=Math.ceil(t);let l=this._start_col!==r,_=this._start_row!==i||this._end_row!==n||this._end_col!==t;return this._start_col=r,this._end_col=t,this._start_row=i,this._end_row=n,{invalid_column:l,invalid_row:_}}_calc_scrollable_column_width(r){let t=this._view_cache.config.row_pivots.length,i=this._max_scroll_column(r),n=t,l=0;for(;n<i+t;)l+=this._column_sizes.indices[n]||60,n++;return l}_update_virtual_panel_width(r,t){if(r)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((i,n)=>i+n,0)+"px";else{let i=this._calc_scrollable_column_width(t);if(i!==0){let n=this._container_size.width+i+2;this._virtual_panel.style.width=n+"px"}else this._virtual_panel.style.width="1px"}}_update_virtual_panel_height(r){let{row_height:t=19}=this._column_sizes,i=this._view_cache.config.column_pivots.length*t,n;if(this._virtual_mode==="horizontal"||this._virtual_mode==="none")n=r*t+i;else{let l=this.clientHeight/(this._table_clip.offsetHeight-i);n=Math.min(xo,r*t*l)}this._virtual_panel.style.height=n+"px"}async draw(r={}){let t=performance.now(),{invalid_viewport:i=!0,preserve_width:n=!1}=r,{num_columns:l,num_rows:_}=await this._view_cache.view(0,0,0,0);this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight},this._update_virtual_panel_height(_),n||this._update_virtual_panel_width(i,l);let h=this._calculate_viewport(_,l),{invalid_row:g,invalid_column:b}=this._validate_viewport(h);if(this._invalid_schema||g||b||i){let y=[],E=!0;for await(let T of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,n,h,l)){T!==void 0&&(y=y.concat(T)),E&&(this.update_sub_cell_offset(h),E=!1),this._is_styling=!0;let C=this._style_callbacks;for(let P of C)await P({detail:this});if(this._is_styling=!1,!this._invalidated&&T!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(y),this.table_model.header.reset_header_cache(),n||this._update_virtual_panel_width(this._invalid_schema||b,l),this._invalid_schema=!1}else this.update_sub_cell_offset(h);var k;k=performance.now()-t,zt=(zt*Ye+k)/(Ye+1),Ye+=1}update_sub_cell_offset(r){var t;let i=this._column_sizes.row_height*(r.start_row%1)||0,n=this._column_sizes.indices[(this.table_model._row_headers_length||0)+Math.floor(r.start_col)]*(r.start_col%1)||0,l=(t=this._sub_cell_style.sheet)===null||t===void 0?void 0:t.cssRules[0].style;l&&(l.setProperty("--regular-table--clip-x",n+"px"),l.setProperty("--regular-table--clip-y",i+"px"),l.setProperty("--regular-table--transform-x",`-${n}px`),l.setProperty("--regular-table--transform-y",`-${i}px`))}}).prototype,"draw",[Er],Object.getOwnPropertyDescriptor(Lt.prototype,"draw"),Lt.prototype),Lt),Mt,Lo=(Mr((Mt=class extends ko{register_listeners(){this.addEventListener("mousedown",this._on_click_or_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!0}),this._register_glitch_scroll_listeners()}_on_scroll(r){r.stopPropagation(),this.draw({invalid_viewport:!1})}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this))}_on_mousewheel(r){if(!window.safari)return;let{clientWidth:t,clientHeight:i,scrollTop:n,scrollLeft:l}=this;r.preventDefault(),r.returnValue=!1;let _=Math.max(1,this._virtual_panel.offsetHeight-i),h=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.max(0,Math.min(_,n+r.deltaY)),this.scrollLeft=Math.max(0,Math.min(h,l+r.deltaX)),this._on_scroll(r)}_on_touchmove(r){r.stopPropagation(),r.preventDefault(),r.returnValue=!1;let{clientWidth:t,clientHeight:i}=this,n=Math.max(1,this._virtual_panel.offsetHeight-i),l=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.min(n,this._memo_scroll_top+(this._memo_touch_startY-r.touches[0].pageY)),this.scrollLeft=Math.min(l,this._memo_scroll_left+(this._memo_touch_startX-r.touches[0].pageX)),this._on_scroll(r)}_on_touchstart(r){this._memo_touch_startY=r.touches[0].pageY,this._memo_touch_startX=r.touches[0].pageX,this._memo_scroll_top=this.scrollTop,this._memo_scroll_left=this.scrollLeft}async _on_dblclick(r){let t=r.target;for(;t.tagName!=="TD"&&t.tagName!=="TH";)if(t=t.parentElement,!this.contains(t))return;let i=r.target.classList.contains("rt-column-resize"),n=$e.get(t);if(i){r.stopImmediatePropagation(),t.style.minWidth="",t.style.maxWidth="",r.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(this._column_sizes.override[n.size_key]=void 0,this._column_sizes.auto[n.size_key]=void 0,this._column_sizes.indices[n.size_key]=void 0);for(let l of r.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let _ of r.shiftKey?l:[l[n._virtual_x]])_&&(_.style.minWidth="",_.style.maxWidth="",_.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(r){if(r.button!==0)return;let t=r.target;for(;t.tagName!=="TD"&&t.tagName!=="TH";)if(t=t.parentElement,!this.contains(t))return;let i=r.target.classList.contains("rt-column-resize"),n=$e.get(t);i&&(this._on_resize_column(r,t,n),r.stopImmediatePropagation())}async _on_click_or_dblclick(r){let t=performance.now();this._last_clicked_time&&t-this._last_clicked_time<500?(this._last_clicked_time=t,await this._on_dblclick(r)):(this._last_clicked_time=t,await this._on_click(r))}_on_resize_column(r,t,i){let{_virtual_x:n,size_key:l}=i,_=r.pageX,h=n+t.colSpan-1,g=this.table_model.header.get_column_header(h),b=this._column_sizes.indices[l],k=E=>this._on_resize_column_move(E,g,_,b,l,h),y=()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",y);let E=this._column_sizes.override[l],T=this._column_sizes.indices[l]!==E;this._column_sizes.indices[l]=E,T&&this.draw()};document.addEventListener("mousemove",k),document.addEventListener("mouseup",y)}async _on_resize_column_move(r,t,i,n,l,_){await new Promise(setTimeout);let h=r.pageX-i,g=Math.max(1,n+h);if(this._column_sizes.override[l]=g,h<0)await this.draw({preserve_width:!0});else{t.style.minWidth=g+"px",t.style.maxWidth=g+"px";let b=this._column_sizes.auto[l];for(let k of this.table_model.body.cells){let y=k[_];y&&(y.style.maxWidth=y.style.minWidth=g+"px",y.classList.toggle("rt-cell-clip",b>g))}}}}).prototype,"_on_resize_column_move",[Er],Object.getOwnPropertyDescriptor(Mt.prototype,"_on_resize_column_move"),Mt.prototype),Mt),Yt=class{constructor(t){this._name=t,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let t=this._elements[this._index];return this._index+=1,t}},Et=class{constructor(t,i,n){this._column_sizes=t,this._container=i,this._span_factory=new Yt("span"),this.table=n,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(t,i){$e.set(t,i)}_get_or_create_metadata(t){if(t===void 0)return{};if($e.has(t))return $e.get(t);{let i={};return $e.set(t,i),i}}_replace_cell(t,i){let{tr:n,row_container:l}=this._get_row(t),_=l[i];return _&&(n.removeChild(_),l.splice(i,1,void 0)),_}_fetch_cell(t,i){if(t<0||i<0)return;let{row_container:n}=this._get_row(t);return n[i]}_get_cell(t="TD",i,n){let{tr:l,row_container:_}=this._get_row(i),h=_[n];if(h||(n<_.length?(h=_[n]=document.createElement(t),l.insertBefore(h,_.slice(n+1).find(g=>g))):(h=_[n]=document.createElement(t),l.appendChild(h))),h.tagName!==t){let g=document.createElement(t);l.replaceChild(g,h),this.cells[i].splice(n,1,g),h=g}return h}_get_row(t){let i=this.rows[t];i||(i=this.rows[t]=document.createElement("tr"),this.table.appendChild(i));let n=this.cells[t];return n||(n=this.cells[t]=[]),{tr:i,row_container:n}}_clean_columns(t){for(let i=0;i<this.rows.length;i++){let n=this.rows[i],l=this.cells[i];this.cells[i]=l.slice(0,t[i]||t);let _=this.cells[i].filter(h=>h!==void 0).length;for(;n.children[_];)n.removeChild(n.children[_])}}_clean_rows(t){for(;this.table.children[t];)this.table.removeChild(this.table.children[t]);this.rows=this.rows.slice(0,t),this.cells=this.cells.slice(0,t)}},Vt=class extends Et{constructor(...t){super(...t),this._group_header_cache=[],this._offset_cache=[]}_draw_group_th(t,i,n){let l=this._get_cell("TH",i,t[i]||0);if(t[i]+=1,l.removeAttribute("colspan"),l.style.minWidth="0",l.textContent="",n instanceof HTMLElement)l.appendChild(n);else{let h=this._span_factory.get("span");h.textContent=n,l.appendChild(h)}let _=this._span_factory.get("span");return _.className="rt-column-resize",l.appendChild(_),l}_draw_group(t,i,n){let l=this._get_or_create_metadata(n);return l.column_header=t,l.value=i,l.value=i,l}_draw_th(t,i,n,l,_){let h=this._get_or_create_metadata(n);if(h.column_header=t,h.value=i,h.size_key=_.length?_[0]:_,!(_.length>1)){let g=this._column_sizes.override[h.size_key],b=this._column_sizes.auto[h.size_key];g?(n.classList.toggle("rt-cell-clip",b>g),n.style.minWidth=g+"px",n.style.maxWidth=g+"px"):b?(n.classList.remove("rt-cell-clip"),n.style.maxWidth="",n.style.minWidth=b+"px"):(n.style.maxWidth="",n.style.maxWidth="")}return h}get_column_header(t){return this._get_cell("TH",this.num_rows()-1,t)}draw(t,i,n,l,_,h,g){let b=i?.length;if(b===0)return;let k,y,E;for(let z=0;z<b;z++){if(E=i[z]?i[z]:"",this._offset_cache[z]=this._offset_cache[z]||0,z<b-1){var T,C,P;((T=this._group_header_cache)===null||T===void 0||(C=T[z])===null||C===void 0||(P=C[0])===null||P===void 0?void 0:P.value)===E?(k=this._group_header_cache[z][1],this._group_header_cache[z][2]+=1,n===1&&(this._group_header_cache[z][0].row_header_x=_),k.setAttribute("colspan",this._group_header_cache[z][2])):(k=this._draw_group_th(this._offset_cache,z,E),y=this._draw_group(i,E,k),this._group_header_cache[z]=[y,k,1])}else{k=this._draw_group_th(this._offset_cache,z,E),y=this._draw_th(t||i,E,k,l,_);for(let[N]of this._group_header_cache)N.size_key=y.size_key;k.removeAttribute("colspan")}k.classList.toggle("rt-group-corner",l===void 0),y&&(y.x=l===void 0?l:Math.floor(l),y.column_header_y=z,y.x0=Math.floor(h),y._virtual_x=g,n===1&&(y.row_header_x=_))}return this._clean_rows(this._offset_cache.length),{th:k,metadata:y}}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}},Xt=class extends Et{_draw_td(t,i,n,l,{column_name:_},{ridx_offset:h},g){let b=this._get_cell(t,i,l),k=this._get_or_create_metadata(b);k.y=i+Math.floor(h),k.size_key=g,t==="TD"&&(k.column_header=_);let y=this._column_sizes.override[k.size_key];if(y){let E=this._column_sizes.auto[k.size_key];b.classList.toggle("rt-cell-clip",E>y),b.style.minWidth=y+"px",b.style.maxWidth=y+"px"}else b.classList.remove("rt-cell-clip"),b.style.minWidth="",b.style.maxWidth="";return k.value!==n&&(n instanceof HTMLElement?(b.textContent="",b.appendChild(n)):b.textContent=n),k.value=n,{td:b,metadata:k}}draw(t,i,n,l=!1,_,h,g){let{cidx:b,column_data:k,row_headers:y,column_data_listener_metadata:E}=i,T,{row_height:C}=n,P=[],z=[],N=0,j=[];for(let p=0;p<(l?n.row_headers_length:1);p++){N=0;for(let Z of k){var K;let me=y?.[N],Y;if(l){let W=Z[p],oe=this._fetch_cell(N-(P[p]||1),b+p),re=this._get_or_create_metadata(oe),fe=this._fetch_cell(N,b+p-(j[N]||1)),ie=this._get_or_create_metadata(fe);!fe||ie.value!==W&&W!==void 0||fe.hasAttribute("rowspan")?oe&&re.value===W&&!oe.hasAttribute("colspan")?(P[p]=P[p]?P[p]+1:2,oe.setAttribute("rowspan",P[p]),this._replace_cell(N,b+p)):(Y=this._draw_td("TH",N,W,b+p,i,n,p),Y.td.style.display="",Y.td.removeAttribute("rowspan"),Y.td.removeAttribute("colspan"),Y.metadata.row_header=Z,Y.metadata.row_header_x=p,Y.metadata.y0=Math.floor(n.ridx_offset),Y.metadata.y1=Math.ceil(n.y1),Y.metadata._virtual_x=p,h!==void 0&&(Y.metadata.x0=Math.floor(h)),P[p]=1,j[N]=1,z[p]=Y):(j[N]=j[N]?j[N]+1:2,fe.setAttribute("colspan",j[N]),this._replace_cell(N,b+p))}else Y=this._draw_td("TD",N,Z,b,i,n,g),E&&(Y.metadata.user=E[N]),Y.metadata.x=_===void 0?_:Math.floor(_),Y.metadata.x1=Math.ceil(n.x1),Y.metadata.row_header=me||[],Y.metadata.y0=Math.floor(n.ridx_offset),Y.metadata.y1=Math.ceil(n.y1),Y.metadata.dx=Math.floor(_-h),Y.metadata.dy=Y.metadata.y-Math.floor(Y.metadata.y0),Y.metadata._virtual_x=b,h!==void 0&&(Y.metadata.x0=Math.floor(h)),z[0]=Y;if(N++,T=Y?Y.metadata:T,C=C||((K=Y)===null||K===void 0?void 0:K.td.offsetHeight),N*C>t)break}}return this._clean_rows(N),{tds:z,ridx:N,metadata:T,row_height:C}}clean({ridx:t,cidx:i}){this._clean_rows(t),this._clean_columns(i)}},Ct=class{constructor(t,i,n){this.clear(n);let[l]=n.children,[_,h]=l.children;this.table=l,this._column_sizes=i,this.header=new Vt(i,t,_),this.body=new Xt(i,t,h),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(t){t.innerHTML=zr` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `}autosize_cells(t){for(;t.length>0;){let[i,n,l]=t.pop(),_,h=getComputedStyle(i);h.boxSizing!=="border-box"?(_=i.clientWidth,_-=h.paddingLeft?parseFloat(h.paddingLeft):0,_-=h.paddingRight?parseFloat(h.paddingRight):0):_=parseFloat(h.width),this._column_sizes.row_height=this._column_sizes.row_height||l.offsetHeight,this._column_sizes.indices[n.size_key]=_;let g=this._column_sizes.override[n.size_key]!==void 0;_&&!g&&(this._column_sizes.auto[n.size_key]=_),i.style.minWidth==="0px"&&(i.style.minWidth=_+"px")}}async*draw(t,i,n,l,_,h){var g,b,k,y;let{width:E,height:T}=t,{view:C,config:P}=i,{data:z,row_headers:N,column_headers:j,metadata:K}=await C(Math.floor(_.start_col),Math.floor(_.start_row),Math.ceil(_.end_col),Math.ceil(_.end_row)),{start_row:p=0,start_col:Z=0,end_col:me=0,end_row:Y=0}=_;N&&(this._row_headers_length=N.reduce((se,Fe)=>Math.max(se,Fe.length),0),N=N.map(se=>(se.length=this._row_headers_length,se))),i.config.column_pivots=Array.from(Array((j==null||(g=j[0])===null||g===void 0?void 0:g.length)||0).keys()),i.config.row_pivots=Array.from(Array(((b=N)===null||b===void 0||(k=b[0])===null||k===void 0?void 0:k.length)||0).keys());let W={viewport_width:0,selected_id:n,ridx_offset:p,sub_cell_offset:this._column_sizes.indices[(this._row_headers_length||0)+Math.floor(_.start_col)]||0,x0:Z,x1:me,y1:Y,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},oe,re=0,fe=[],ie=!0;if(((y=N)===null||y===void 0?void 0:y.length)>0){let se=P.row_pivots.join(","),Fe={column_name:se,cidx:0,column_data:N,row_headers:N,first_col:ie},Oe=re+Math.floor(Z);oe=this.body.draw(T,Fe,{...W,x0:0},!0,void 0,void 0,Oe);let Re=[];for(let ue=0;ue<i.config.row_pivots.length;ue++){let ye=this.header.draw(se,Array(i.config.column_pivots.length).fill(""),1,void 0,ue,Z,ue);ye&&Re.push(ye)}if(ie=!1,W.viewport_width+=Re.reduce((ue,{th:ye},Pe)=>ue+(this._column_sizes.indices[Pe]||ye.offsetWidth),0),W.row_height=W.row_height||oe.row_height,re=N[0].length,!l)for(let ue=0;ue<i.config.row_pivots.length;ue++){let{td:ye,metadata:Pe}=oe.tds[ue]||{},{th:he,metadata:He}=Re[ue]||{};(ye||he)&&fe.push([he||ye,He||Pe,ye||he])}}try{var Se;let se=0,Fe=h-_.start_col;for(;se<Fe;){if(!z[se]){let ve=Math.max(_.end_col,0);_.start_col=ve;let we=0,Ee=0;for(;this._column_sizes.indices.length>re+Z+we+1&&Ee+W.viewport_width<E;)we++,Ee+=this._column_sizes.indices[re+Z+we];if(Ee+W.viewport_width<E){let pe=Math.min(h,ve+5);_.end_col=Math.max(1,Math.min(h,pe))}else _.end_col=Math.max(1,Math.min(h,ve+we));let Ue=C(Math.floor(_.start_col),Math.floor(_.start_row),Math.ceil(_.end_col),Math.ceil(_.end_row));yield;let Ce=await Ue;if(Ce.data.length===0)return void(yield fe);_.end_col=_.start_col+Ce.data.length;for(let pe=0;pe<Ce.data.length;pe++){var Ge;z[se+pe]=Ce.data[pe],Ce.metadata&&(K[se+pe]=Ce.metadata[pe]),j&&(j[se+pe]=(Ge=Ce.column_headers)===null||Ge===void 0?void 0:Ge[pe])}}let Oe=j?.[se]||"",Re=z[se],ue={column_name:Oe,cidx:re,column_data:Re,column_data_listener_metadata:K?.[se],row_headers:N,first_col:ie},ye=se+Z,Pe=re+Math.floor(Z),he=this.header.draw(void 0,Oe,void 0,ye,Pe,Z,re);if(oe=this.body.draw(T,ue,W,!1,ye,Z,Pe),ie=!1,!l)for(let{td:ve,metadata:we}of oe.tds)fe.push([he?.th||ve,he?.metadata||we,ve||he?.th]);let He=this._column_sizes.indices[re+Math.floor(Z)];var Ne;if(He?W.viewport_width+=He:W.viewport_width+=(he==null||(Ne=he.th)===null||Ne===void 0?void 0:Ne.offsetWidth)||oe.tds.reduce((ve,we)=>{var Ee;return ve+((Ee=we.td)===null||Ee===void 0?void 0:Ee.offsetWidth)},0),W.row_height=W.row_height||oe.row_height,re++,se++,W.viewport_width-W.sub_cell_offset>E){var qe;this.body.clean({ridx:((qe=oe)===null||qe===void 0?void 0:qe.ridx)||0,cidx:re}),this.header.clean(),yield fe,W.viewport_width=0;for(let[ve]of fe)W.viewport_width+=ve.offsetWidth;if(W.viewport_width-W.sub_cell_offset>E)return}}this.body.clean({ridx:((Se=oe)===null||Se===void 0?void 0:Se.ridx)||0,cidx:re}),this.header.clean(),yield fe}finally{var Be;this.body.clean({ridx:((Be=oe)===null||Be===void 0?void 0:Be.ridx)||0,cidx:re}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}},Mo=["both","horizontal","vertical","none"],Ut=class extends Lo{constructor(){super(),this._column_sizes={auto:[],override:[],indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new Ct(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto=[],this._column_sizes.override=[],this._column_sizes.indices=[];for(let t=0;t<this.table_model.header.num_columns();t++){let i=this.table_model.header.get_column_header(t);i.style.minWidth="",i.style.maxWidth=""}}clear(){this.table_model=new Ct(this._table_clip,this._column_sizes,this)}addStyleListener(t){this._style_callbacks=this._style_callbacks.concat(t);let i=!0;return()=>{if(!i)return;i=!1;let n=this._style_callbacks=this._style_callbacks.slice(),l=n.indexOf(t);n.splice(l,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(t){if(t!==void 0){if(t instanceof HTMLElement)return $e.get(t);if(t.row_header_x>=0){if(t.row_header_x<this._view_cache.config.row_pivots.length){let i=this.table_model.body._fetch_cell(t.y,t.row_header_x);return this.getMeta(i)}}else{if(!(t.column_header_y>=0))return this.getMeta(this.table_model.body._fetch_cell(t.dy,t.dx+this.table_model._row_headers_length));if(t.column_header_y<this._view_cache.config.column_pivots.length){let i=this.table_model.body._fetch_cell(t.column_header_y,t.y);return this.getMeta(i)}}}}getDrawFPS(){return function(){let t=performance.now(),i=t-Lr,n=zt,l=1e3*Ye/i,_=Ye;return zt=0,Ye=0,Lr=t,{avg:n,real_fps:l,virtual_fps:1e3/n,num_frames:_,elapsed:i}}()}async scrollToCell(t,i){if(!this._view_cache)return void console.warn("data listener not configured");let n=this._column_sizes.row_height||19,l=this._view_cache.config.column_pivots.length*n,_=(this._table_clip.offsetHeight-l)%n,h=(this._virtual_panel.offsetHeight-_)/this._nrows;this.scrollTop=Math.ceil(h*i);let g=0;for(;t>0;)t--,g+=this._column_sizes.indices[t+this._view_cache.config.row_pivots.length]||60;this.scrollLeft=Math.ceil(g),await new Promise(requestAnimationFrame),await this.draw.flush()}setDataListener(t,{virtual_mode:i="both"}={}){console.assert(Mo.indexOf(i)>-1,`Unknown virtual_mode ${i};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=i,this._invalid_schema=!0,this._view_cache={view:t,config:{row_pivots:[],column_pivots:[]},schema:{}},this._setup_virtual_scroll()}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",Ut);var Cr=`regular-table{padding:0;margin:12px 0 0 12px;scrollbar-color:transparent transparent;scrollbar-width:thin;outline:none}regular-table:hover{scrollbar-color:rgba(0,0,0,.3) transparent}.sub-cell-scroll-enabled regular-table table tbody td,.sub-cell-scroll-enabled regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x, 0px))}.sub-cell-scroll-enabled regular-table table tbody{transform:translateY(var(--regular-table--transform-y, 0px))}.sub-cell-scroll-enabled regular-table table tbody tr:first-child td,.sub-cell-scroll-enabled regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y, 0),0 200%,200% 200%,200% var(--regular-table--clip-y, 0))}.sub-cell-scroll-enabled regular-table table thead th.rt-group-corner{background:var(--plugin--background, white);z-index:1}.sub-cell-scroll-enabled regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x, 0) 0,var(--regular-table--clip-x, 0) 200%,200% 200%,200% 0)}.sub-cell-scroll-enabled regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x, 0) var(--regular-table--clip-y, 0),var(--regular-table--clip-x, 0) 200%,200% 200%,200% var(--regular-table--clip-y, 0))}regular-table{font-family:inherit}regular-table div[tabindex]{outline:none}regular-table>div{position:absolute;inset:0;overflow:hidden}regular-table th{text-align:center}regular-table thead tr:not(:last-child) th{overflow:hidden;max-width:0px}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right}regular-table tbody th{text-align:left}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left}regular-table thead tr:last-child th{border-bottom:1px solid #eaedef}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important}regular-table th{position:relative}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid #eee;height:100%}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding:0 5px;height:19px}regular-table tr:hover td{background:#eee;opacity:1}regular-table tr:hover{color:#333}regular-table table *{box-sizing:border-box}regular-table table{position:absolute;overflow:hidden;color:#666;outline:none}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family, "Material Icons")}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family, "Material Icons")}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px #1a7da1}regular-table .rt-selected td{background-color:#eee}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%}regular-table th span.rt-group-name{text-align:left}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize}regular-table a{color:var(--rt-pos-cell--color)}regular-table a:visited{color:var(--active--color)}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#0000;border-radius:5px}regular-table::-webkit-scrollbar-thumb:horizontal{border-bottom:2px solid transparent;border-top:2px solid transparent}regular-table::-webkit-scrollbar-thumb:vertical{border-left:2px solid transparent;border-right:2px solid transparent}regular-table:hover::-webkit-scrollbar-thumb{background-color:#00000026}regular-table::-webkit-scrollbar-thumb:hover{background-color:#0000004d}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0 var(--inactive--color, #eaedef)}.psp-header-group{box-shadow:0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-is-top{box-shadow:5px 4px 0 -4px var(--inactive--color, #eaedef)}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0 -4px var(--inactive--color, #eaedef),0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0 var(--inactive--color, #eaedef),0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0 -4px var(--inactive--color, #eaedef)}tr:only-child th{box-shadow:none!important}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--rt-hover--border-color, #c5c9d080)!important;background-color:transparent;box-shadow:0 1px 0 var(--rt-hover--border-color, #c5c9d080),0 3px #0000000d,0 5px #00000003}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:1px;border-right-color:transparent}regular-table tbody tr:hover{color:#161616}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color, #c5c9d080)!important}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color, #c5c9d080)!important}perspective-viewer[settings] regular-table .psp-header-leaf{height:36px;vertical-align:top;padding-top:2px}perspective-viewer[settings] regular-table .psp-header-leaf:not(.psp-header-corner):before{font-family:var(--button--font-family, inherit);content:var(--column-style-open-button--content, var(--config-button-icon--content, "\\1f527"));position:absolute;width:calc(100% - 8px);left:5px;bottom:0;color:var(--inactive--color, #b4b7be)}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:not(.psp-header-corner):before{color:inherit;cursor:pointer}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner){pointer-events:none}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner):before{content:var(--column-style-close-button--content, "X")}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:hover:before{color:#338dcd}perspective-viewer[settings] regular-table .psp-header-leaf .rt-column-resize{height:18px}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:#fff!important;background-color:#ea7319!important;border-color:#ea7319!important}.psp-row-selected.psp-tree-label:not(:hover):before{color:#fff}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,.2)!important}.psp-error{color:red}td:focus{outline:#666;outline-style:dotted;outline-width:1px}perspective-viewer.dragging regular-table{pointer-events:none}.psp-header-border:last-child{border-right-width:0px}.psp-header-sort-desc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-desc--content, "\\2193")}.psp-header-sort-asc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-asc--content, "\\2191")}.psp-header-sort-col-desc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-col-desc--content, "\\2190")}.psp-header-sort-col-asc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-col-asc--content, "\\2192")}tbody th:last-of-type{border-right:1px solid #eaedef;overflow:hidden;text-overflow:ellipsis}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,#eee 10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none}.psp-tree-label{max-width:0px;min-width:0px}.psp-tree-label:before{color:#ccc;font-family:var(--button--font-family, inherit);padding-right:11px;vertical-align:-1px}.psp-tree-label-expand:before{content:var(--tree-label-expand--content, "+")}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content, "-")}.psp-tree-label:hover:before{color:#338dcd;text-shadow:0px 0px 5px #338dcd}regular-table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--color, #eaedef)}.psp-tree-leaf{padding-left:24px}.psp-align-right{text-align:right}.psp-align-left{text-align:left}.psp-positive:not(:focus){color:var(--rt-pos-cell--color, #338dcd)}.psp-negative:not(:focus){color:var(--rt-neg-cell--color, #ff5942)}regular-table table tbody td{min-width:52px!important}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed #999;border-bottom-width:0px;border-left-width:0px}.psp-bool-type{font-family:var(--button--font-family, "Material Icons")}.boolean-editable{cursor:pointer}regular-table table{user-select:none;color:#161616;border-collapse:separate}regular-table table th{font-weight:400}regular-table table td,regular-table table th{border-color:#eaedef;height:23px}regular-table table .psp-header-group{text-overflow:ellipsis}regular-table table .psp-header-leaf{border-bottom-width:0px}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px}regular-table table tbody th:empty{background-position:0px -10px}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start, rgba(0, 128, 255, .5))}to{background-color:var(--pulse--background-color-end, rgba(0, 128, 255, 0))}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start, rgba(0, 128, 255, .5))}to{background-color:var(--pulse--background-color-end, rgba(0, 128, 255, 0))}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start, rgba(255, 25, 0, .5))}to{background-color:var(--pulse--background-color-end, rgba(255, 25, 0, 0))}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start, rgba(255, 25, 0, .5))}to{background-color:var(--pulse--background-color-end, rgba(255, 25, 0, 0))}}
`;function Eo(r){return r.x>=0?this._column_types[r.x]:this._row_header_types[r.row_header_x-1]}function Ar(r){let t=r._view_cache.config.row_pivots.length-1,i=Array.from(r.children[0].children[0].children);if(i.length>0){let[n]=i.splice(i.length-1,1);for(let l of n?.children){let _=r.getMeta(l),h=_.column_header?.[_.column_header?.length-1],g=this._config.sort.find(z=>z[0]===h),b=_.row_header_x===t,k=typeof _.x>"u";b=b||(_.x+1)%this._config.columns.length===0,l.classList.toggle("psp-header-border",b),l.classList.toggle("psp-header-group",!1),l.classList.toggle("psp-header-leaf",!0),l.classList.toggle("psp-is-top",!1),l.classList.toggle("psp-header-corner",k),l.classList.toggle("psp-header-sort-asc",!!g&&g[1]==="asc"),l.classList.toggle("psp-header-sort-desc",!!g&&g[1]==="desc"),l.classList.toggle("psp-header-sort-col-asc",!!g&&g[1]==="col asc"),l.classList.toggle("psp-header-sort-col-desc",!!g&&g[1]==="col desc");let y=Eo.call(this,_),E=y==="integer"||y==="float",T=y==="string",C=y==="date",P=y==="datetime";l.classList.toggle("psp-align-right",E),l.classList.toggle("psp-align-left",!E),l.classList.toggle("psp-menu-open",this._open_column_styles_menu[0]===_._virtual_x),l.classList.toggle("psp-menu-enabled",(T||E||C||P)&&!k),l.classList.toggle("psp-is-width-override",r._column_sizes?.override[_.size_key]!==void 0)}}}function Sr(r){let t=r._view_cache.config.row_pivots.length-1,i=Array.from(r.children[0].children[0].children),n=[],l=new Set,_=r.children[0];for(let h=0;h<i.length;h++){let g=_.rows[h],b=new Set;for(let k=0;k<g.cells.length;k++){let y=g.cells[k];y.style.backgroundColor="";let E=r.getMeta(y),T=E.row_header_x===t||E.x>=0;y.classList.toggle("psp-align-right",!1),y.classList.toggle("psp-align-left",!1),y.classList.toggle("psp-header-group",!0),y.classList.toggle("psp-header-leaf",!1),y.classList.toggle("psp-header-border",T),y.classList.toggle("psp-header-group-corner",typeof E.x>"u"),y.classList.toggle("psp-color-mode-bar",!1),y.classList.toggle("psp-header-sort-asc",!1),y.classList.toggle("psp-header-sort-desc",!1),y.classList.toggle("psp-header-sort-col-asc",!1),y.classList.toggle("psp-header-sort-col-desc",!1);let C=g.cells[k],P=k,z,N;for(;n[h]&&n[h][P];++P);for(b.add(P),z=P;z<P+C.colSpan;++z)for(N=h;N<h+C.rowSpan;++N)n[N]||(n[N]=[]),n[N][z]=!0;C.classList.toggle("psp-is-top",h===0||!l.has(z))}l=b}}var ce=Symbol("Plugin Symbol");function Nr(r,t,[,,,,,i,n],[,,,,,l,_]){let h=this._ids?.[r.dy]?.join("|"),g=r.column_header.join("|");if(this.last_reverse_columns?.has(g)&&this.last_reverse_ids?.has(h)){let b=this.last_reverse_ids?.get(h),k=this.last_reverse_columns.get(g);this._is_old_viewport?this.last_meta?.[k]?.[b]>r.user?(t.style.setProperty("--pulse--background-color-start",l),t.style.setProperty("--pulse--background-color-end",_),t.style.animationName==="pulse_neg"?t.style.animation="pulse_neg2 0.5s linear":t.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[k]?.[b]<r.user?(t.style.setProperty("--pulse--background-color-start",i),t.style.setProperty("--pulse--background-color-end",n),t.style.animationName==="pulse_pos"?t.style.animation="pulse_pos2 0.5s linear":t.style.animation="pulse_pos 0.5s linear"):b!==r.dy&&(t.style.animation=""):t.style.animation=""}else t.style.animation=""}var Kt=kt(pt());function Zt(r,t){return Kt.default.mix(r,`rgb(${t[0]},${t[1]},${t[2]})`,.5).hex()}function je([r,t,i,n],l=[255,255,255]){function _(h,g){return((1-n)*(l[h]/255)+n*(g/255))*255}return[_(0,r),_(1,t),_(2,i)]}function De([r,t,i]){return Math.sqrt(r*r*.299+t*t*.587+i*i*.114)>130?"#161616":"#ffffff"}function Co(r){let[t,i,n]=r.rgb(),[l,_,h]=r.set("hsl.h",(r.get("hsl.h")-15)%360).rgb(),[g,b,k]=r.set("hsl.h",(r.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${l},${_},${h}),rgb(${t},${i},${n}) 50%,rgb(${g},${b},${k}))`}function le(r){let t=(0,Kt.default)(r),i=Co(t),n=t.rgb();return[r,...n,i,`rgba(${n[0]},${n[1]},${n[2]},1)`,`rgba(${n[0]},${n[1]},${n[2]},0)`]}function Or(r,t,i){let n=i.user>0,l=i.user<0,_;r?.pos_bg_color!==void 0?_=r.pos_bg_color:_=this._pos_bg_color;let h;r?.neg_bg_color!==void 0?h=r.neg_bg_color:h=this._neg_bg_color;let g=n?_:l?h:["",...this._plugin_background,""];{let[C,P,z,N,j]=g;if(t.style.position="",r?.number_bg_mode==="color")t.style.animation="",t.style.backgroundColor=C;else if(r?.number_bg_mode==="gradient"){let K=Math.max(0,Math.min(1,Math.abs(i.user/r.bg_gradient))),p=this._plugin_background,Z=De(je([P,z,N,K],p));t.style.animation="",t.style.color=Z,t.style.backgroundColor=`rgba(${P},${z},${N},${K})`}else r?.number_bg_mode==="pulse"?(Nr.call(this,i,t,_,h),t.style.backgroundColor=""):(r?.number_bg_mode==="disabled"||r?.number_bg_mode,t.style.animation="",t.style.backgroundColor="")}let[b,k,y,E,T]=(()=>r?.pos_fg_color!==void 0?n?r.pos_fg_color:l?r.neg_fg_color:["",...this._plugin_background,""]:n?this._pos_fg_color:l?this._neg_fg_color:["",...this._plugin_background,""])();if(r?.number_fg_mode==="disabled")if(r?.number_bg_mode==="color"){let C=this._plugin_background,P=De(je([g[1],g[2],g[3],1],C));t.style.color=P}else r?.number_bg_mode==="gradient"||(t.style.color="");else r?.number_fg_mode==="bar"?(t.style.color="",t.style.position="relative",T!==""&&t.children.length>0&&t.children[0].nodeType===Node.ELEMENT_NODE&&(t.children[0].style.background=T)):(r?.number_fg_mode==="color"||!r?.number_fg_mode)&&(t.style.color=b)}var Jt=kt(pt());function Pr(r,t,i){let n=i.column_header?.[i.column_header?.length-1],[l,_,h,g,b]=(()=>r?.color!==void 0?r.color:this._color)();if(r?.string_color_mode==="foreground"&&i.user!==null)t.style.color=l,t.style.backgroundColor="",r?.format==="link"&&(t.children[0].style.color=l);else if(r?.string_color_mode==="background"&&i.user!==null){let k=this._plugin_background,y=De(je([_,h,g,1],k));t.style.color=y,t.style.backgroundColor=l}else if(r?.string_color_mode==="series"&&i.user!==null){this._series_color_map.has(n)||(this._series_color_map.set(n,new Map),this._series_color_seed.set(n,0));let k=this._series_color_map.get(n);if(!k.has(i.user)){let me=this._series_color_seed.get(n);k.set(i.user,me),this._series_color_seed.set(n,me+1)}let y=k.get(i.user),[E,T,C]=(0,Jt.default)(l).hsl();E=E+y*150%360;let P=(0,Jt.default)(E,T,C,"hsl"),[z,N,j]=P.rgb(),K=P.hex(),p=this._plugin_background,Z=De(je([z,N,j,1],p));t.style.color=Z,t.style.backgroundColor=K}else t.style.backgroundColor="",t.style.color=""}var es=kt(pt());function Fr(r,t,i){let n=i.column_header?.[i.column_header?.length-1],[l,_,h,g,b]=(()=>r?.color!==void 0?r.color:this._color)();if(r?.datetime_color_mode==="foreground"&&i.user!==null)t.style.color=l,t.style.backgroundColor="";else if(r?.datetime_color_mode==="background"&&i.user!==null){let k=this._plugin_background,y=De(je([_,h,g,1],k));t.style.color=y,t.style.backgroundColor=l}else t.style.backgroundColor="",t.style.color=""}function Rr(r,t,i){let[n]=i.user===!0?this._pos_fg_color:i.user===!1?this._neg_fg_color:["",0,0,0,""];t.style.backgroundColor="",t.style.color=n}function Ir(r,t,i){let n=typeof i.value!=null&&typeof i.value!=null&&i.value?.toString()?.trim().length>0,l=i.row_header_x>=this._config.group_by.length,_=r.getMeta({dx:0,dy:i.y-i.y0+1}),h=_&&_.row_header&&typeof _.row_header[i.row_header_x+1]<"u";t.classList.toggle("psp-tree-label",n&&!l),t.classList.toggle("psp-tree-label-expand",n&&!l&&!h),t.classList.toggle("psp-tree-label-collapse",n&&!l&&h),t.classList.toggle("psp-tree-leaf",n&&l)}function Ao(r){return r.x>=0?this._column_types[r.x]:this._row_header_types[r.row_header_x-1]}function Tr(r){let t=r[ce]||{};for(let i of r.children[0].children[1].children)for(let n of i.children){let l=r.getMeta(n),_=l.column_header?.[l.column_header?.length-1],h=Ao.call(this,l),g=t[_],b=h==="integer"||h==="float";b?Or.call(this,g,n,l):h==="boolean"?Rr.call(this,g,n,l):h==="string"?Pr.call(this,g,n,l):h==="date"||h==="datetime"?Fr.call(this,g,n,l):(n.style.backgroundColor="",n.style.color=""),n.classList.toggle("psp-bool-type",h==="boolean"&&l.user!==null);let k=n.tagName==="TH";k&&Ir.call(this,r,n,l),n.classList.toggle("psp-align-right",!k&&b),n.classList.toggle("psp-align-left",k||!b),n.classList.toggle("psp-color-mode-bar",g?.number_fg_mode==="bar"&&b)}}async function jr(r,t,i){let n=r.getMeta(i),l=n.column_header[n.column_header.length-1],h=(t.shiftKey?So:No).call(this,l);this._preserve_focus_state=!0,await r.parentElement.parentElement.restore({sort:h})}function So(r){let t=[],i=!1;for(let n of this._config.sort){let[l,_]=n;if(l===r){i=!0;let h=Dr.call(this,r,_);h&&t.push(h)}else t.push(n)}return i||t.push([r,"desc"]),t}function No(r){for(let[t,i]of this._config.sort)if(t===r){let n=Dr.call(this,r,i);return n?[n]:[]}return[[r,"desc"]]}function Dr(r,t){let n=this._config.split_by.length>0?Po:Oo,l=t?n[t]:"desc";if(l)return[r,l]}var Oo={desc:"asc",asc:void 0},Po={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};function Qt(r,t,i){let n=r.getMeta(t),l=n.column_header[n.column_header.length-1],_=this._schema[l],h=_==="integer"||_==="float",g=document.createElement(`perspective-${{float:"number",integer:"number",string:"string",date:"date",datetime:"datetime"}[_]}-column-style`),b;if(h?b={fg_gradient:i,pos_fg_color:this._pos_fg_color[0],neg_fg_color:this._neg_fg_color[0],number_fg_mode:"color",bg_gradient:i,pos_bg_color:this._pos_bg_color[0],neg_bg_color:this._neg_bg_color[0],number_bg_mode:"disabled"}:b={color:this._color[0],bg_color:this._color[0]},!(_==="string"||_==="date"||_==="datetime"))if(_==="float")b.fixed=2;else if(_==="integer")b.fixed=0;else{this._open_column_styles_menu.pop(),r.draw({preserve_width:!0});return}let k=()=>g.blur(),y=P=>{let z=P.detail;z.pos_fg_color&&(z.pos_fg_color=le(z.pos_fg_color),z.neg_fg_color=le(z.neg_fg_color)),z.pos_bg_color&&(z.pos_bg_color=le(z.pos_bg_color),z.neg_bg_color=le(z.neg_bg_color)),z.color&&(z.color=le(z.color)),z.bg_color&&(z.bg_color=le(z.bg_color)),r[ce]=r[ce]||{},r[ce][l]=z,r.draw({preserve_width:!0}),r.parentElement.parentElement.dispatchEvent(new Event("perspective-config-update"))},E=async()=>{r.removeEventListener("regular-table-scroll",k),g.removeEventListener("perspective-column-style-change",y),g.removeEventListener("blur",E),this._open_column_styles_menu.pop(),r.parentElement.parentElement.dispatchEvent(new Event("perspective-config-update")),await r.draw({preserve_width:!0}),g.destroy()};g.addEventListener("perspective-column-style-change",y),g.addEventListener("blur",E),r.addEventListener("regular-table-scroll",k);let T=r[ce]||{},C=Object.assign({},T[l]=T[l]||{});(C.pos_fg_color||C.pos_bg_color)&&(C.pos_fg_color=C.pos_fg_color?.[0],C.neg_fg_color=C.neg_fg_color?.[0],C.pos_bg_color=C.pos_bg_color?.[0],C.neg_bg_color=C.neg_bg_color?.[0]),C.color&&(C.color=C.color[0]),C.bg_color&&(C.bg_color=C.bg_color[0]),g.open(t,C,b)}async function Hr(r,t){let i=r.getMeta(t.target),n=t.target.classList.contains("psp-tree-label-collapse");t.shiftKey&&n?this._view.set_depth(i.row_header.filter(l=>l!==void 0).length-2):t.shiftKey?this._view.set_depth(i.row_header.filter(l=>l!==void 0).length-1):n?this._view.collapse(i.y):this._view.expand(i.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),r.draw()}async function Wr(r,t){if(t.which!==1)return;let i=t.target;if(i.tagName==="A")return;for(;i.tagName!=="TD"&&i.tagName!=="TH";)if(i=i.parentElement,!r.contains(i))return;if(i.classList.contains("psp-tree-label")){Hr.call(this,r,t),t.stopImmediatePropagation();return}let n=i.getBoundingClientRect();if(i.classList.contains("psp-menu-enabled")&&t.clientY-n.top>16){let l=r.getMeta(i),_=l.column_header?.[l.column_header?.length-1],h=this._schema[_];if(this._open_column_styles_menu.unshift(l._virtual_x),h==="string"||h==="date"||h==="datetime")await r.draw({preserve_width:!0}),Qt.call(this,r,i);else{let[g,b]=await this._view.get_min_max(_);await r.draw({preserve_width:!0});let k=Math.max(Math.abs(g),Math.abs(b));k>1&&(k=Math.round(k*100)/100),Qt.call(this,r,i,k)}t.preventDefault(),t.stopImmediatePropagation()}else i.classList.contains("psp-header-leaf")&&!i.classList.contains("psp-header-corner")&&(jr.call(this,r,t,i),t.stopImmediatePropagation())}function $r(r,t){if(t.which!==1)return;let i=t.target;for(;i.tagName!=="TD"&&i.tagName!=="TH";)if(i=i.parentElement,!r.contains(i))return;(i.classList.contains("psp-tree-label")&&t.offsetX<26||i.classList.contains("psp-header-leaf")&&!i.classList.contains("psp-header-corner"))&&t.stopImmediatePropagation()}function Gr(r,t=!1){let i=this._config.group_by.length===0&&this._config.split_by.length===0,n=r.hasAttribute("selectable"),l=t||!!r.children[0]._is_edit_mode;return i&&!n&&l}function qr(r,t){let i=r[ce]||{},n=Gr.call(this,t);r.parentElement.classList.toggle("edit-mode-allowed",Gr.call(this,t,!0));for(let l of r.querySelectorAll("td")){let _=r.getMeta(l),h=this.get_psp_type(_);if(n&&this._is_editable[_.x]){let g=_.column_header[_.column_header.length-1];h==="string"&&i[g]?.format==="link"?(l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",!1)):h==="boolean"?(l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",_.user!==null)):(n!==l.hasAttribute("contenteditable")&&l.toggleAttribute("contenteditable",n),l.classList.toggle("boolean-editable",!1))}else l.toggleAttribute("contenteditable",!1),l.classList.toggle("boolean-editable",!1)}}var At=(r,t,i)=>{let n=r.querySelectorAll("td"),l=i.get(r);if(l){for(let _ of n){let h=r.getMeta(_);if(h.x===l.x&&h.y===l.y)return document.activeElement!==_&&_.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&r.contains(document.activeElement)&&document.activeElement.blur()}};function Fo(r){let t;return async function(...i){if(!!t&&await t&&!!t)return;let n;t=new Promise(l=>n=l),await r.apply(this,i),t=void 0,n()}}function Br(){if(this.isContentEditable){let r=document.getSelection().getRangeAt(0),t=r.cloneRange();return t.selectNodeContents(this),t.setEnd(r.endContainer,r.endOffset),t.toString().length}else return this.target.selectionStart}function Yr(r,t,i){let n=r.getMeta(i),l=t._schema[t._column_paths[n.x]];if(n){let _=i.textContent,h=t._ids[n.y-n.y0];if(l==="float"||l==="integer"){if(_=parseFloat(_.replace(/,/g,"")),isNaN(_))return!1}else if(l==="date"||l==="datetime"){if(_=Date.parse(_),isNaN(_))return!1}else l==="boolean"&&(_=_==="check"?!1:_==="close"?!0:null);let g={__INDEX__:h,[t._column_paths[n.x]]:_};return t._table.update([g],{port_id:t._edit_port}),!0}}function St(r,t=!1){let i=this._config.group_by.length===0&&this._config.split_by.length===0,n=r.hasAttribute("selectable"),l=t||!!r.children[0]._is_edit_mode;return i&&!n&&l}var Ve=Fo(async function(r,t,i,n,l){let _=r.getMeta(i),h=this._column_paths.length,g=this._num_rows,b=t.get(r);if(!b)return;_.x+n<h&&0<=_.x+n&&(b.x=_.x+n),_.y+l<g&&0<=_.y+l&&(b.y=_.y+l);let k=Math.max(_.x0-10,0),y=Math.min(_.x0+10,h),E=Math.max(_.y0-5,0),T=Math.min(_.y0+10,g),C=_.x0+n,P=_.y0+l;for(;!At(r,void 0,t)&&C>=k&&C<y&&P>=E&&P<T;)await r.scrollToCell(C,P,h,g),t.set(r,b),C+=n,P+=l});function Vr(r,t,i,n){if(!St.call(this,t))return;let l=document.activeElement;switch(n.target.classList.remove("psp-error"),n.keyCode){case 13:n.preventDefault(),n.shiftKey?Ve.call(this,r,i,l,0,-1):Ve.call(this,r,i,l,0,1);break;case 37:Br.call(l)==0&&(n.preventDefault(),Ve.call(this,r,i,l,-1,0));break;case 38:n.preventDefault(),Ve.call(this,r,i,l,0,-1);break;case 39:Br.call(l)==l.textContent.length&&(n.preventDefault(),Ve.call(this,r,i,l,1,0));break;case 40:n.preventDefault(),Ve.call(this,r,i,l,0,1);break;default:}}function Xr(r,t,i){let n=r.getMeta(i.target);if(typeof n?.x<"u"){let l=St.call(this,t),_=this._is_editable[n.x],h=this.get_psp_type(n)==="boolean",g=i.target.textContent==="-";l&&_&&h&&!g&&write(r,this,i.target)}}function Ur(r,t,i,n){if(St.call(this,t)&&i.has(r)){n.target.classList.remove("psp-error");let l=i.get(r);i.delete(r),l.content!==n.target.textContent&&(Yr(r,this,n.target)||(n.target.textContent=l.content,n.target.classList.add("psp-error"),n.target.focus()))}}function Kr(r,t,i,n){let l=r.getMeta(n.target);if(l){let _={x:l.x,y:l.y,content:n.target.textContent};i.set(r,_)}}async function gt({_view:r,_config:t},i,n){let l=t.group_by,_=t.split_by,h=i>=0?i:0,g=h+1,b=await r.to_json({start_row:h,end_row:g}),y=b.map(j=>j.__ROW_PATH__)[0]||[],E=l.map((j,K)=>{let p=y[K];return p?[j,"==",p]:void 0}).filter(j=>j),T=l.length>0?n+1:n,C=Object.keys(b[0])[T],P={row:b[0]},z=[];if(C){let j=C.split("|");P.column_names=[j[j.length-1]],z=_.map((K,p)=>{let Z=j[p];return Z?[K,"==",Z]:void 0}).filter(K=>K).filter(([,,K])=>K!=="__ROW_PATH__")}let N=t.filter.concat(E).concat(z);return P.config={filter:N},P}async function Zr(r,t,i,n){let l=r.getMeta(n.target);if(!t.hasAttribute("selectable")||n.handled||n.which!==1||!l)return;let _=this._ids[l.y-l.y0];if(l&&l.y>=0){let h=i.get(r),g=!!h&&h.reduce((C,P,z)=>C&&P===_[z],!0),b=!!h&&_.length===h.length&&g,k={selected:!b},{row:y,column_names:E,config:T}=await gt(this,l.y,l.x);b?(i.delete(r),k={...k,row:y,config:{filter:structuredClone(this._config.filter)}}):(i.set(r,_),k={...k,row:y,column_names:E,config:T}),await r.draw({preserve_width:!0}),n.handled=!0,t.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:k}))}}function Jr(r,t,i){if(!t.hasAttribute("selectable"))return;let n=i.has(r),l=i.get(r);for(let _ of r.querySelectorAll("td"))if(!n)_.classList.toggle("psp-row-selected",!1),_.classList.toggle("psp-row-subselected",!1);else{let h=r.getMeta(_),g=this._ids[h.y-h.y0],b=l.reduce((k,y,E)=>k&&y===g[E],!0);_.classList.toggle("psp-row-selected",g.length===l.length&&b),_.classList.toggle("psp-row-subselected",g.length!==l.length&&b)}for(let _ of r.querySelectorAll("tbody th")){let h=r.getMeta(_),g=this._ids[h.y-h.y0];if(!n||!!g[h.row_header_x])_.classList.toggle("psp-row-selected",!1),_.classList.toggle("psp-row-subselected",!1);else{let b=l.reduce((k,y,E)=>k&&y===g[E],!0);_.classList.toggle("psp-row-selected",g.length===l.length&&b),_.classList.toggle("psp-row-subselected",g.length!==l.length&&b)}}}async function Qr(r,t,i){i.delete(r);for(let n of r.querySelectorAll("td,th"))n.classList.toggle("psp-row-selected",!1),n.classList.toggle("psp-row-subselected",!1)}var io=kt(pt());var eo={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}};function Xe(r){let t={};if(to().types[r]&&Object.assign(t,to().types[r]),t.type){let i=Xe(t.type);return Object.assign(i,t),i}else return t}function er(r){return r&&typeof r=="object"&&!Array.isArray(r)}function tr(r,...t){if(!t.length)return r;let i=t.shift();if(er(r)&&er(i))for(let n in i)er(i[n])?(r[n]||Object.assign(r,{[n]:{}}),tr(r[n],i[n])):Object.assign(r,{[n]:i[n]});return tr(r,...t)}function to(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=tr(eo,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}var ro={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(r){return r?"check":"close"}}},Nt=class{constructor(){this._formatters=new Map}create_datetime_formatter(t,i){let n=Xe(t),l={...n.format,timeZone:i.timeZone,dateStyle:i.dateStyle,timeStyle:i.timeStyle};return l.dateStyle==="disabled"?l.dateStyle=void 0:l.dateStyle===void 0&&(l.dateStyle=n.format.dateStyle),l.timeStyle==="disabled"?l.timeStyle=void 0:l.timeStyle===void 0&&(l.timeStyle=n.format.timeStyle),new Intl.DateTimeFormat([],l)}create_number_formatter(t,i){let{format:n}=Xe(t);return i.fixed!==void 0&&(n.minimumFractionDigits=i.fixed,n.maximumFractionDigits=i.fixed),new ro[t]([],n)}create_boolean_formatter(t,i){let n=Xe(t);return new ro[t]([],n.format)}get(t,i){let n=[t,i.fixed,i.timeZone,i.dateStyle,i.timeStyle].join("-");if(!this._formatters.has(n)){let l=Xe(t);t==="date"||t==="datetime"?this._formatters.set(n,this.create_datetime_formatter(t,i)):t==="integer"||t==="float"?this._formatters.set(n,this.create_number_formatter(t,i)):t==="boolean"?this._formatters.set(n,this.create_boolean_formatter(t,i)):this._formatters.set(n,!1)}return this._formatters.get(n)}};var Ro=new Nt;function Ot(r,t,i={},n=!1){if(t===null)return"-";let l=r[r.length-1],_=n&&this._table_schema[l]||this._schema[l]||"string",h=i[l]||{};if((_==="integer"||_==="float")&&h?.number_fg_mode==="bar"){let b=Math.max(0,Math.min(.95,Math.abs(t/h.fg_gradient)*.95)),k=this._div_factory.get(),y=t>=0?"left":"right";return k.setAttribute("style",`width:${(b*100).toFixed(2)}%;position:absolute;${y}:0;height:80%;top:10%;pointer-events:none;`),k}else if(h?.format==="link"&&_==="string"){let b=document.createElement("a");return b.setAttribute("href",t),b.setAttribute("target","_blank"),b.textContent=t,b}else if(h?.format==="bold"&&_==="string"){let b=document.createElement("b");return b.textContent=t,b}else if(h?.format==="italics"&&_==="string"){let b=document.createElement("i");return b.textContent=t,b}else{let b=Ro.get(_,h);return b?b.format(t):t}}function*oo(r=[],t,i){let n=i[ce];for(let l of r){l=["TOTAL",...l];let _=l[l.length-1];l=l.slice(0,l.length-1).fill("");let h=Ot.call(this,[t[l.length-1]],_,n,!0);h instanceof HTMLElement?l=l.concat(h):l=l.concat({toString:()=>h}),l.length=t.length+1,yield l}}function so(){let r,t,i,n,l;return async function(h,g,b,k,y){let E={},T;k-g>0&&y-b>0?(this._is_old_viewport=this._last_window?.start_row===b&&this._last_window?.end_row===y&&this._last_window?.start_col===g&&this._last_window?.end_col===k,T={start_row:b,start_col:g,end_row:y,end_col:k,id:!0},E=await this._view.to_columns(T),this._last_window=T,this._ids=E.__ID__,this._reverse_columns=this._column_paths.slice(g,k).reduce((j,K,p)=>(j.set(K,p),j),new Map),this._reverse_ids=this._ids.reduce((j,K,p)=>(j.set(K?.join("|"),p),j),new Map)):this._div_factory.clear();let C=[],P=[],z=[],N=[];for(let j=g;j<Math.min(k,this._column_paths.length);++j){let K=this._column_paths[j],p=K.split("|"),Z=E[K]||new Array(y-b).fill(null);C.push(Z.map(me=>Ot.call(this,p,me,h[ce]))),P.push(Z),z.push(p),N.push(K)}return k-g>0&&y-b>0&&(this.last_column_paths=t,this.last_meta=r,this.last_ids=i,this.last_reverse_ids=n,this.last_reverse_columns=l,t=N,r=P,i=this._ids,n=this._reverse_ids,l=this._reverse_columns),{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(oo.call(this,E.__ROW_PATH__,this._config.group_by,h)),column_headers:z,data:C,metadata:P}}}function Pt(r,t,i){let n=window.getComputedStyle(r).getPropertyValue(t).trim();return n.length>0?n:i}var rr=class{constructor(t){this._name=t,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let t=this._elements[this._index];return this._index+=1,t}};function Io(r){return r.x>=0?this._column_types[r.x]:this._row_header_types[r.row_header_x-1]}async function or(r,t,i,n={}){let l=await i.get_config(),_=l.expressions.map(re=>re[1]),[h,g,b,k,y,E,T]=await Promise.all([t.schema(),t.validate_expressions(_),i.num_rows(),i.schema(),i.expression_schema(),i.column_paths(),this.parentElement.getEditPort()]),C=(0,io.default)(Pt(r,"--plugin--background","#FFFFFF")).rgb(),P=le(Pt(r,"--rt-pos-cell--color","#338DCD")),z=le(Pt(r,"--rt-neg-cell--color","#FF5942")),N=le(Zt(P[0],C)),j=le(Zt(z[0],C)),K=le(Pt(r,"--active--color","#ff0000")),p={...k,...y},Z={...h,...g.expression_schema},me=E.filter(re=>re!=="__ROW_PATH__"&&re!=="__ID__"),Y=[],W=[];for(let re of me){let fe=re.split("|"),ie=fe[fe.length-1];W.push(p[ie]),Y.push(!!h[ie])}let oe=Object.assign(n,{_edit_port:T,_view:i,_table:t,_table_schema:Z,_config:l,_num_rows:b,_schema:p,_ids:[],_open_column_styles_menu:[],_plugin_background:C,_color:K,_pos_fg_color:P,_neg_fg_color:z,_pos_bg_color:N,_neg_bg_color:j,_column_paths:me,_column_types:W,_is_editable:Y,_row_header_types:l.group_by.map(re=>Z[re]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:Io});return oe._div_factory=oe._div_factory||new rr("div"),r.setDataListener(so().bind(oe,r),{virtual_mode:window.getComputedStyle(r).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),oe}async function no(r,t,i){let n=r.getMeta(i.target);if(!n)return;let{x:l,y:_}=n,{row:h,column_names:g,config:b}=await gt(this,_,l);t.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:h,column_names:g,config:b}}))}async function lo(r){let t=this.parentElement,i=await t.getTable(!0);if(this._initialized)await or.call(this,this.regular_table,i,r,this.model);else{this.innerHTML="",this.appendChild(this.regular_table),this.model=await or.call(this,this.regular_table,i,r),this.regular_table.addStyleListener(Tr.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(Sr.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(Ar.bind(this.model,this.regular_table)),this.regular_table.addEventListener("click",$r.bind(this.model,this.regular_table)),this.regular_table.addEventListener("mousedown",Wr.bind(this.model,this.regular_table));let n=new WeakMap;this.regular_table.addStyleListener(Jr.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("mousedown",Zr.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("psp-deselect-all",Qr.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("click",no.bind(this.model,this.regular_table,t));let l=new WeakMap;this.regular_table.addStyleListener(qr.bind(this.model,this.regular_table,t)),this.regular_table.addStyleListener(At.bind(this.model,this.regular_table,t,l)),this.regular_table.addEventListener("click",Xr.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("focusin",Kr.bind(this.model,this.regular_table,t,l)),this.regular_table.addEventListener("focusout",Ur.bind(this.model,this.regular_table,t,l)),this.regular_table.addEventListener("keydown",Vr.bind(this.model,this.regular_table,t,l)),this._initialized=!0}}function Ft(r,t=!1){if(!this._initialized)return;t&&(this._cached_column_sizes=r);let i={},{group_by:n,columns:l}=this.model._config,_=n?.length>0?n.length+1:0;for(let h of Object.keys(r))if(h==="__ROW_PATH__")i[_-1]=r[h];else{let g=this.model._column_paths.indexOf(h);i[g+_]=r[h]}this.regular_table._column_sizes.override=i}function Rt(){if(!this._initialized)return[];if(this._cached_column_sizes){let _=this._cached_column_sizes;return this._cached_column_sizes=void 0,_}let r=this.regular_table._column_sizes.override,{group_by:t,columns:i}=this.model._config,n=t?.length>0?t.length+1:0,l={};for(let _ of Object.keys(r))if(r[_]!==void 0){let h=_-n;h>-1?l[this.model._column_paths[h]]=r[_]:h===-1&&(l.__ROW_PATH__=r[_])}return l}function It(r=void 0){typeof r>"u"&&(r=!this._is_edit_mode),this._is_edit_mode=r,this.classList.toggle("editable",r),this._edit_mode!==void 0&&(this._edit_mode.classList.toggle("editable",r),r?this._edit_mode.children[0].textContent="Editable":this._edit_mode.children[0].textContent="Read Only")}function Tt(r=void 0){typeof r>"u"&&(r=!this._is_scroll_lock),this._is_scroll_lock=r,this.classList.toggle("sub-cell-scroll-enabled",!r),this._scroll_lock!==void 0&&(this._scroll_lock.classList.toggle("lock-scroll",r),r?this._scroll_lock.children[0].textContent="Align Scroll":this._scroll_lock.children[0].textContent="Free Scroll")}function ao(r){r=JSON.parse(JSON.stringify(r));let t={};if(r.columns)for(let n of Object.keys(r.columns)){let l=r.columns[n];l.column_size_override!==void 0&&(t[n]=l.column_size_override,delete l.column_size_override),l?.pos_fg_color&&(l.pos_fg_color=le(l.pos_fg_color),l.neg_fg_color=le(l.neg_fg_color)),l?.pos_bg_color&&(l.pos_bg_color=le(l.pos_bg_color),l.neg_bg_color=le(l.neg_bg_color)),l?.color&&(l.color=le(l.color)),Object.keys(l).length===0&&delete r.columns[n]}"editable"in r&&It.call(this,r.editable),"scroll_lock"in r&&Tt.call(this,r.scroll_lock);let i=this.regular_table;try{i._resetAutoSize()}catch{}Ft.call(this,t,!0),i[ce]=r.columns}function co(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar")),this.parentElement.appendChild(this._toolbar)}function fo(){if(this.regular_table){let r=this.regular_table,t={columns:{},scroll_lock:!!this._is_scroll_lock,editable:!!this._is_edit_mode};for(let n of Object.keys(r[ce]||{})){let l=Object.assign({},r[ce][n]);(l?.pos_fg_color||l?.pos_bg_color)&&(l.pos_fg_color=l.pos_fg_color?.[0],l.neg_fg_color=l.neg_fg_color?.[0],l.pos_bg_color=l.pos_bg_color?.[0],l.neg_bg_color=l.neg_bg_color?.[0]),l?.color&&(l.color=l.color[0]),t.columns[n]=l}let i=Rt.call(this);for(let n of Object.keys(i||{}))t.columns[n]||(t.columns[n]={}),t.columns[n].column_size_override=i[n];return JSON.parse(JSON.stringify(t))}return{}}async function _o(r){if(this.parentElement&&await this.activate(r),!this.isConnected||this.offsetParent==null)return;let t=Rt.call(this),i=this.regular_table.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.regular_table.scrollTop=0,this.regular_table.scrollLeft=0,this.regular_table.dispatchEvent(new CustomEvent("psp-deselect-all",{bubbles:!1})),this.regular_table._resetAutoSize()),Ft.call(this,t),await i,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}var jt=class extends HTMLElement{constructor(){super(),this.regular_table=document.createElement("regular-table"),this._is_scroll_lock=!0}connectedCallback(){return co.call(this)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}async activate(t){return await lo.call(this,t)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){}get priority(){return 1}async draw(t){return await _o.call(this,t)}async update(t){this.model._num_rows=await t.num_rows(),await this.regular_table.draw()}async resize(){!this.isConnected||this.offsetParent==null||this._initialized&&await this.regular_table.draw()}async clear(){this.regular_table._resetAutoSize(),this.regular_table.clear()}save(){return fo.call(this)}restore(t){return ao.call(this,t)}async restyle(t){await this.draw(t)}delete(){this.regular_table.table_model&&this.regular_table._resetAutoSize(),this.regular_table.clear()}};var uo=`:host{position:relative;display:block}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;inset:0}:host #toolbar{display:flex;align-items:center;height:36px}:host #slot-container{flex:1;position:relative}#scroll_lock.lock-scroll:before{content:var(--toolbar-scroll-lock-active--content)}#scroll_lock:before{content:var(--toolbar-scroll-lock--content)}#select_mode:before{content:"highlight_alt"}#edit_mode:before{content:var(--toolbar-edit-mode--content)}#edit_mode.editable:before{content:var(--toolbar-edit-mode-active--content)}:host(.aggregated) #toolbar #edit_mode{display:none}.button:before{color:var(--inactive--color, #ccc);line-height:36px;font-size:14px;font-family:var(--button--font-family, "Material Icons Outlined");vertical-align:bottom;margin:0 11px}.button.editable:before,.button.lock-scroll:before{color:inherit}.button{user-select:none;width:36px;box-sizing:border-box;white-space:nowrap}.button>span{display:none;margin:0;padding:0}.button:hover{opacity:1;display:flex;align-items:center;color:inherit;cursor:pointer;min-width:var(--button--min-width, 105px);background-color:#0000000d}.button:hover:before{margin:0 6px 0 11px}.button:hover>span{display:contents;font-size:12px;font-weight:300;line-height:36px}
`;var Dt=class extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0,this.setAttribute("slot","plugin-settings"),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
            <style>
                ${uo}
            </style>
            <div id="toolbar">
                <span id="scroll_lock" class="lock-scroll button">
                    <span>Align Scroll</span>
                </span>
                <span id="edit_mode" class="button"><span>Read Only</span></span>
            </div>
        `;let t=this.parentElement,i=t.querySelector("perspective-viewer-datagrid");i._scroll_lock=this.shadowRoot.querySelector("#scroll_lock"),i._scroll_lock.addEventListener("click",()=>Tt.call(i)),i._edit_mode=this.shadowRoot.querySelector("#edit_mode"),i._edit_mode.addEventListener("click",()=>{It.call(i),i.regular_table.draw(),t.dispatchEvent(new Event("perspective-config-update"))})}};function jo(){let r=document.createElement("style");r.textContent=Cr,document.head.insertBefore(r,document.head.firstChild)}async function Do(){customElements.define("perspective-viewer-datagrid-toolbar",Dt),customElements.define("perspective-viewer-datagrid",jt),await customElements.whenDefined("perspective-viewer"),customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}Do();jo();
/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */
/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
}));

//# sourceMappingURL=perspective-viewer-datagrid.js.map
