(function (root, factory) {
        if (typeof define === 'function' && define.amd) {
            define(['exports'], factory);
        } else if (typeof exports === 'object' && typeof exports.nodeName !== 'string') {
            factory(exports);
        } else {
            factory((root.perspective_datagrid = {}));
        }
    }(typeof self !== 'undefined' ? self : this, function (exports) {
    
var Ur=Object.create;var Et=Object.defineProperty;var Kr=Object.getOwnPropertyDescriptor;var Jr=Object.getOwnPropertyNames;var Zr=Object.getPrototypeOf,Qr=Object.prototype.hasOwnProperty;var pr=r=>Et(r,"__esModule",{value:!0});var Tt=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),eo=(r,t)=>{pr(r);for(var i in t)Et(r,i,{get:t[i],enumerable:!0})},to=(r,t,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Jr(t))!Qr.call(r,a)&&a!=="default"&&Et(r,a,{get:()=>t[a],enumerable:!(i=Kr(t,a))||i.enumerable});return r},Wt=r=>to(pr(Et(r!=null?Ur(Zr(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var Mr=Tt((Po,Lr)=>{Lr.exports.default={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric"},null_value:-1}}}});var Er=Tt((Fo,De)=>{var zr=Mr().default;De.exports.get_types=function(){return Object.keys(De.exports.get_config().types)};De.exports.get_type_config=function(r){let t={};if(De.exports.get_config().types[r]&&Object.assign(t,De.exports.get_config().types[r]),t.type){let i=De.exports.get_type_config(t.type);return Object.assign(i,t),i}else return t};function qt(r){return r&&typeof r=="object"&&!Array.isArray(r)}function Ot(r,...t){if(!t.length)return r;let i=t.shift();if(qt(r)&&qt(i))for(let a in i)qt(i[a])?(r[a]||Object.assign(r,{[a]:{}}),Ot(r[a],i[a])):Object.assign(r,{[a]:i[a]});return Ot(r,...t)}globalThis.__PERSPECTIVE_CONFIG__=void 0;De.exports.override_config=function(r){globalThis.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),globalThis.__PERSPECTIVE_CONFIG__=Ot(zr,r)};De.exports.get_config=function(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=Ot(zr,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}});var Gt=Tt((_t,pt)=>{(function(){var r,t,i,a,c,u,p,m,_,v,w,E,C,F,I,M,N,S,q,g,Y,de,H,T,Q,oe,se,ne,me,Fe,ve,Ae,Ee,ie,Ie,je,Te,ue,ye,Re,_e,$e,we,ke,Oe,Ke,Se,pe,qe,wt,Kt,X,Jt,Zt,Qt,er,ce,tr,rr,or,sr,ir,nr,lr,Pt,Ft,jt,ar,cr,fr,xt,kt,dr,Le,ur,Je,ze,Rt,te,re,We,Lt,Mt,Ce=[].slice;te=function(){var e,o,s,n,l;for(e={},l="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),n=0,o=l.length;n<o;n++)s=l[n],e["[object "+s+"]"]=s.toLowerCase();return function(f){var d;return d=Object.prototype.toString.call(f),e[d]||"object"}}(),pe=function(e,o,s){return o==null&&(o=0),s==null&&(s=1),e<o&&(e=o),e>s&&(e=s),e},re=function(e){return e.length>=3?Array.prototype.slice.call(e):e[0]},Y=function(e){var o,s;for(e._clipped=!1,e._unclipped=e.slice(0),o=s=0;s<3;o=++s)o<3?((e[o]<0||e[o]>255)&&(e._clipped=!0),e[o]<0&&(e[o]=0),e[o]>255&&(e[o]=255)):o===3&&(e[o]<0&&(e[o]=0),e[o]>1&&(e[o]=1));return e._clipped||delete e._unclipped,e},a=Math.PI,Le=Math.round,T=Math.cos,me=Math.floor,ce=Math.pow,qe=Math.log,Je=Math.sin,ze=Math.sqrt,F=Math.atan2,X=Math.max,C=Math.abs,p=a*2,c=a/3,t=a/180,u=180/a,g=function(){return arguments[0]instanceof r?arguments[0]:function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,arguments,function(){})},g.default=g,E=[],typeof pt!="undefined"&&pt!==null&&pt.exports!=null&&(pt.exports=g),typeof define=="function"&&define.amd?define([],function(){return g}):(dr=typeof _t!="undefined"&&_t!==null?_t:this,dr.chroma=g),g.version="1.4.1",w={},_=[],v=!1,r=function(){function e(){var o,s,n,l,f,d,h,b,x;for(d=this,s=[],b=0,l=arguments.length;b<l;b++)o=arguments[b],o!=null&&s.push(o);if(s.length>1&&(h=s[s.length-1]),w[h]!=null)d._rgb=Y(w[h](re(s.slice(0,-1))));else{for(v||(_=_.sort(function(L,j){return j.p-L.p}),v=!0),x=0,f=_.length;x<f&&(n=_[x],h=n.test.apply(n,s),!h);x++);h&&(d._rgb=Y(w[h].apply(w,s)))}d._rgb==null&&console.warn("unknown format: "+s),d._rgb==null&&(d._rgb=[0,0,0]),d._rgb.length===3&&d._rgb.push(1)}return e.prototype.toString=function(){return this.hex()},e}(),g._input=w;g.brewer=S={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var e,o;o=[];for(e in S)o.push(S[e.toLowerCase()]=S[e]);return o}(),We={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},g.colors=H=We,we=function(){var e,o,s,n,l,f,d,h,b;return o=re(arguments),l=o[0],e=o[1],s=o[2],h=(l+16)/116,d=isNaN(e)?h:h+e/500,b=isNaN(s)?h:h-s/200,h=i.Yn*ke(h),d=i.Xn*ke(d),b=i.Zn*ke(b),f=Mt(3.2404542*d-1.5371385*h-.4985314*b),n=Mt(-.969266*d+1.8760108*h+.041556*b),s=Mt(.0556434*d-.2040259*h+1.0572252*b),[f,n,s,o.length>3?o[3]:1]},Mt=function(e){return 255*(e<=.00304?12.92*e:1.055*ce(e,1/2.4)-.055)},ke=function(e){return e>i.t1?e*e*e:i.t2*(e-i.t0)},i={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Pt=function(){var e,o,s,n,l,f,d,h;return n=re(arguments),s=n[0],o=n[1],e=n[2],l=fr(s,o,e),f=l[0],d=l[1],h=l[2],[116*d-16,500*(f-d),200*(d-h)]},xt=function(e){return(e/=255)<=.04045?e/12.92:ce((e+.055)/1.055,2.4)},Lt=function(e){return e>i.t3?ce(e,1/3):e/i.t2+i.t0},fr=function(){var e,o,s,n,l,f,d;return n=re(arguments),s=n[0],o=n[1],e=n[2],s=xt(s),o=xt(o),e=xt(e),l=Lt((.4124564*s+.3575761*o+.1804375*e)/i.Xn),f=Lt((.2126729*s+.7151522*o+.072175*e)/i.Yn),d=Lt((.0193339*s+.119192*o+.9503041*e)/i.Zn),[l,f,d]},g.lab=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["lab"]),function(){})},w.lab=we,r.prototype.lab=function(){return Pt(this._rgb)},I=function(e){var o,s,n,l,f,d,h,b,x,L,j;return e=function(){var z,k,A;for(A=[],k=0,z=e.length;k<z;k++)l=e[k],A.push(g(l));return A}(),e.length===2?(x=function(){var z,k,A;for(A=[],k=0,z=e.length;k<z;k++)l=e[k],A.push(l.lab());return A}(),f=x[0],d=x[1],o=function(z){var k,A;return A=function(){var P,D;for(D=[],k=P=0;P<=2;k=++P)D.push(f[k]+z*(d[k]-f[k]));return D}(),g.lab.apply(g,A)}):e.length===3?(L=function(){var z,k,A;for(A=[],k=0,z=e.length;k<z;k++)l=e[k],A.push(l.lab());return A}(),f=L[0],d=L[1],h=L[2],o=function(z){var k,A;return A=function(){var P,D;for(D=[],k=P=0;P<=2;k=++P)D.push((1-z)*(1-z)*f[k]+2*(1-z)*z*d[k]+z*z*h[k]);return D}(),g.lab.apply(g,A)}):e.length===4?(j=function(){var z,k,A;for(A=[],k=0,z=e.length;k<z;k++)l=e[k],A.push(l.lab());return A}(),f=j[0],d=j[1],h=j[2],b=j[3],o=function(z){var k,A;return A=function(){var P,D;for(D=[],k=P=0;P<=2;k=++P)D.push((1-z)*(1-z)*(1-z)*f[k]+3*(1-z)*(1-z)*z*d[k]+3*(1-z)*z*z*h[k]+z*z*z*b[k]);return D}(),g.lab.apply(g,A)}):e.length===5&&(s=I(e.slice(0,3)),n=I(e.slice(2,5)),o=function(z){return z<.5?s(z*2):n((z-.5)*2)}),o},g.bezier=function(e){var o;return o=I(e),o.scale=function(){return g.scale(o)},o},g.cubehelix=function(e,o,s,n,l){var f,d,h;return e==null&&(e=300),o==null&&(o=-1.5),s==null&&(s=1),n==null&&(n=1),l==null&&(l=[0,1]),f=0,te(l)==="array"?d=l[1]-l[0]:(d=0,l=[l,l]),h=function(b){var x,L,j,z,k,A,P,D,K;return x=p*((e+120)/360+o*b),P=ce(l[0]+d*b,n),A=f!==0?s[0]+b*f:s,L=A*P*(1-P)/2,z=T(x),K=Je(x),D=P+L*(-.14861*z+1.78277*K),k=P+L*(-.29227*z-.90649*K),j=P+L*(1.97294*z),g(Y([D*255,k*255,j*255,1]))},h.start=function(b){return b==null?e:(e=b,h)},h.rotations=function(b){return b==null?o:(o=b,h)},h.gamma=function(b){return b==null?n:(n=b,h)},h.hue=function(b){return b==null?s:(s=b,te(s)==="array"?(f=s[1]-s[0],f===0&&(s=s[1])):f=0,h)},h.lightness=function(b){return b==null?l:(te(b)==="array"?(l=b,d=b[1]-b[0]):(l=[b,b],d=0),h)},h.scale=function(){return g.scale(h)},h.hue(s),h},g.random=function(){var e,o,s,n;for(o="0123456789abcdef",e="#",s=n=0;n<6;s=++n)e+=o.charAt(me(Math.random()*16));return new r(e)},E=[],je=function(e,o,s,n){var l,f,d,h;for(s==null&&(s=.5),n==null&&(n="rgb"),te(e)!=="object"&&(e=g(e)),te(o)!=="object"&&(o=g(o)),d=0,f=E.length;d<f;d++)if(l=E[d],n===l[0]){h=l[1](e,o,s,n);break}if(h==null)throw"color mode "+n+" is not supported";return h.alpha(e.alpha()+s*(o.alpha()-e.alpha()))},g.interpolate=je,r.prototype.interpolate=function(e,o,s){return je(this,e,o,s)},g.mix=je,r.prototype.mix=r.prototype.interpolate,w.rgb=function(){var e,o,s,n;o=re(arguments),s=[];for(e in o)n=o[e],s.push(n);return s},g.rgb=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["rgb"]),function(){})},r.prototype.rgb=function(e){return e==null&&(e=!0),e?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},r.prototype.rgba=function(e){return e==null&&(e=!0),e?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},_.push({p:3,test:function(e){var o;if(o=re(arguments),te(o)==="array"&&o.length===3||o.length===4&&te(o[3])==="number"&&o[3]>=0&&o[3]<=1)return"rgb"}}),w.lrgb=w.rgb,ye=function(e,o,s,n){var l,f;return l=e._rgb,f=o._rgb,new r(ze(ce(l[0],2)*(1-s)+ce(f[0],2)*s),ze(ce(l[1],2)*(1-s)+ce(f[1],2)*s),ze(ce(l[2],2)*(1-s)+ce(f[2],2)*s),n)},m=function(e){var o,s,n,l,f,d;for(s=1/e.length,d=[0,0,0,0],l=0,n=e.length;l<n;l++)o=e[l],f=o._rgb,d[0]+=ce(f[0],2)*s,d[1]+=ce(f[1],2)*s,d[2]+=ce(f[2],2)*s,d[3]+=f[3]*s;return d[0]=ze(d[0]),d[1]=ze(d[1]),d[2]=ze(d[2]),d[3]>1&&(d[3]=1),new r(Y(d))},E.push(["lrgb",ye]),g.average=function(e,o){var s,n,l,f,d,h,b,x,L,j,z,k,A;if(o==null&&(o="rgb"),L=e.length,e=e.map(function(P){return g(P)}),b=e.splice(0,1)[0],o==="lrgb")return m(e);k=b.get(o),f=[],d=0,h=0;for(x in k)k[x]=k[x]||0,f.push(isNaN(k[x])?0:1),o.charAt(x)==="h"&&!isNaN(k[x])&&(s=k[x]/180*a,d+=T(s),h+=Je(s));for(n=b.alpha(),z=0,j=e.length;z<j;z++){l=e[z],A=l.get(o),n+=l.alpha();for(x in k)isNaN(A[x])||(f[x]+=1,o.charAt(x)==="h"?(s=A[x]/180*a,d+=T(s),h+=Je(s)):k[x]+=A[x])}for(x in k)if(o.charAt(x)==="h"){for(s=F(h/f[x],d/f[x])/a*180;s<0;)s+=360;for(;s>=360;)s-=360;k[x]=s}else k[x]=k[x]/f[x];return g(k,o).alpha(n/L)},ve=function(e){var o,s,n,l,f,d;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(e.length===4||e.length===7)&&(e=e.substr(1)),e.length===3&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),d=parseInt(e,16),l=d>>16,n=d>>8&255,s=d&255,[l,n,s,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return e.length===9&&(e=e.substr(1)),d=parseInt(e,16),l=d>>24&255,n=d>>16&255,s=d>>8&255,o=Le((d&255)/255*100)/100,[l,n,s,o];if(w.css!=null&&(f=w.css(e)))return f;throw"unknown color: "+e},sr=function(e,o){var s,n,l,f,d,h,b;return o==null&&(o="auto"),d=e[0],l=e[1],n=e[2],s=e[3],o==="auto"&&(o=s<1?"rgba":"rgb"),d=Math.round(d),l=Math.round(l),n=Math.round(n),b=d<<16|l<<8|n,h="000000"+b.toString(16),h=h.substr(h.length-6),f="0"+Le(s*255).toString(16),f=f.substr(f.length-2),"#"+function(){switch(o.toLowerCase()){case"rgba":return h+f;case"argb":return f+h;default:return h}}()},w.hex=function(e){return ve(e)},g.hex=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["hex"]),function(){})},r.prototype.hex=function(e){return e==null&&(e="auto"),sr(this._rgb,e)},_.push({p:4,test:function(e){if(arguments.length===1&&te(e)==="string")return"hex"}}),ie=function(){var e,o,s,n,l,f,d,h,b,x,L,j,z,k;if(e=re(arguments),l=e[0],L=e[1],d=e[2],L===0)b=n=o=d*255;else{for(k=[0,0,0],s=[0,0,0],z=d<.5?d*(1+L):d+L-d*L,j=2*d-z,l/=360,k[0]=l+1/3,k[1]=l,k[2]=l-1/3,f=h=0;h<=2;f=++h)k[f]<0&&(k[f]+=1),k[f]>1&&(k[f]-=1),6*k[f]<1?s[f]=j+(z-j)*6*k[f]:2*k[f]<1?s[f]=z:3*k[f]<2?s[f]=j+(z-j)*(2/3-k[f])*6:s[f]=j;x=[Le(s[0]*255),Le(s[1]*255),Le(s[2]*255)],b=x[0],n=x[1],o=x[2]}return e.length>3?[b,n,o,e[3]]:[b,n,o]},nr=function(e,o,s){var n,l,f,d,h;return e!==void 0&&e.length>=3&&(d=e,e=d[0],o=d[1],s=d[2]),e/=255,o/=255,s/=255,f=Math.min(e,o,s),X=Math.max(e,o,s),l=(X+f)/2,X===f?(h=0,n=Number.NaN):h=l<.5?(X-f)/(X+f):(X-f)/(2-X-f),e===X?n=(o-s)/(X-f):o===X?n=2+(s-e)/(X-f):s===X&&(n=4+(e-o)/(X-f)),n*=60,n<0&&(n+=360),[n,h,l]},g.hsl=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["hsl"]),function(){})},w.hsl=ie,r.prototype.hsl=function(){return nr(this._rgb)},Ie=function(){var e,o,s,n,l,f,d,h,b,x,L,j,z,k,A,P,D,K;if(e=re(arguments),l=e[0],P=e[1],K=e[2],K*=255,P===0)b=n=o=K;else switch(l===360&&(l=0),l>360&&(l-=360),l<0&&(l+=360),l/=60,f=me(l),s=l-f,d=K*(1-P),h=K*(1-P*s),D=K*(1-P*(1-s)),f){case 0:x=[K,D,d],b=x[0],n=x[1],o=x[2];break;case 1:L=[h,K,d],b=L[0],n=L[1],o=L[2];break;case 2:j=[d,K,D],b=j[0],n=j[1],o=j[2];break;case 3:z=[d,h,K],b=z[0],n=z[1],o=z[2];break;case 4:k=[D,d,K],b=k[0],n=k[1],o=k[2];break;case 5:A=[K,d,h],b=A[0],n=A[1],o=A[2]}return[b,n,o,e.length>3?e[3]:1]},lr=function(){var e,o,s,n,l,f,d,h,b;return d=re(arguments),f=d[0],s=d[1],e=d[2],l=Math.min(f,s,e),X=Math.max(f,s,e),o=X-l,b=X/255,X===0?(n=Number.NaN,h=0):(h=o/X,f===X&&(n=(s-e)/o),s===X&&(n=2+(e-f)/o),e===X&&(n=4+(f-s)/o),n*=60,n<0&&(n+=360)),[n,h,b]},g.hsv=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["hsv"]),function(){})},w.hsv=Ie,r.prototype.hsv=function(){return lr(this._rgb)},Qt=function(e){var o,s,n;return te(e)==="number"&&e>=0&&e<=16777215?(n=e>>16,s=e>>8&255,o=e&255,[n,s,o,1]):(console.warn("unknown num color: "+e),[0,0,0,1])},ar=function(){var e,o,s,n;return n=re(arguments),s=n[0],o=n[1],e=n[2],(s<<16)+(o<<8)+e},g.num=function(e){return new r(e,"num")},r.prototype.num=function(e){return e==null&&(e="rgb"),ar(this._rgb,e)},w.num=Qt,_.push({p:1,test:function(e){if(arguments.length===1&&te(e)==="number"&&e>=0&&e<=16777215)return"num"}}),Fe=function(){var e,o,s,n,l,f,d,h,b,x,L,j,z,k,A,P,D,K,le,R;if(s=re(arguments),h=s[0],l=s[1],o=s[2],l=l/100,d=d/100*255,e=l*255,l===0)j=d=n=o;else switch(h===360&&(h=0),h>360&&(h-=360),h<0&&(h+=360),h/=60,b=me(h),f=h-b,x=o*(1-l),L=x+e*(1-f),le=x+e*f,R=x+e,b){case 0:z=[R,le,x],j=z[0],d=z[1],n=z[2];break;case 1:k=[L,R,x],j=k[0],d=k[1],n=k[2];break;case 2:A=[x,R,le],j=A[0],d=A[1],n=A[2];break;case 3:P=[x,L,R],j=P[0],d=P[1],n=P[2];break;case 4:D=[le,x,R],j=D[0],d=D[1],n=D[2];break;case 5:K=[R,x,L],j=K[0],d=K[1],n=K[2]}return[j,d,n,s.length>3?s[3]:1]},or=function(){var e,o,s,n,l,f,d,h,b;return b=re(arguments),h=b[0],l=b[1],o=b[2],d=Math.min(h,l,o),X=Math.max(h,l,o),n=X-d,s=n*100/255,e=d/(255-n)*100,n===0?f=Number.NaN:(h===X&&(f=(l-o)/n),l===X&&(f=2+(o-h)/n),o===X&&(f=4+(h-l)/n),f*=60,f<0&&(f+=360)),[f,s,e]},g.hcg=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["hcg"]),function(){})},w.hcg=Fe,r.prototype.hcg=function(){return or(this._rgb)},Q=function(e){var o,s,n,l,f,d,h,b;if(e=e.toLowerCase(),g.colors!=null&&g.colors[e])return ve(g.colors[e]);if(f=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(h=f.slice(1,4),l=d=0;d<=2;l=++d)h[l]=+h[l];h[3]=1}else if(f=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(h=f.slice(1,5),l=b=0;b<=3;l=++b)h[l]=+h[l];else if(f=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(h=f.slice(1,4),l=o=0;o<=2;l=++o)h[l]=Le(h[l]*2.55);h[3]=1}else if(f=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(h=f.slice(1,5),l=s=0;s<=2;l=++s)h[l]=Le(h[l]*2.55);h[3]=+h[3]}else(f=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(n=f.slice(1,4),n[1]*=.01,n[2]*=.01,h=ie(n),h[3]=1):(f=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(n=f.slice(1,4),n[1]*=.01,n[2]*=.01,h=ie(n),h[3]=+f[4]);return h},rr=function(e){var o;if(o=e[3]<1?"rgba":"rgb",o==="rgb")return o+"("+e.slice(0,3).map(Le).join(",")+")";if(o==="rgba")return o+"("+e.slice(0,3).map(Le).join(",")+","+e[3]+")"},kt=function(e){return Le(e*100)/100},Ee=function(e,o){var s;return s=o<1?"hsla":"hsl",e[0]=kt(e[0]||0),e[1]=kt(e[1]*100)+"%",e[2]=kt(e[2]*100)+"%",s==="hsla"&&(e[3]=o),s+"("+e.join(",")+")"},w.css=function(e){return Q(e)},g.css=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["css"]),function(){})},r.prototype.css=function(e){if(e==null&&(e="rgb"),e.slice(0,3)==="rgb")return rr(this._rgb);if(e.slice(0,3)==="hsl")return Ee(this.hsl(),this.alpha())},w.named=function(e){return ve(We[e])},_.push({p:5,test:function(e){if(arguments.length===1&&We[e]!=null)return"named"}}),r.prototype.name=function(e){var o,s;arguments.length&&(We[e]&&(this._rgb=ve(We[e])),this._rgb[3]=1),o=this.hex("rgb");for(s in We)if(o===We[s])return s;return o},Oe=function(){var e,o,s,n;return n=re(arguments),s=n[0],e=n[1],o=n[2],o=o*t,[s,T(o)*e,Je(o)*e]},Ke=function(){var e,o,s,n,l,f,d,h,b,x,L;return s=re(arguments),h=s[0],l=s[1],d=s[2],x=Oe(h,l,d),e=x[0],o=x[1],n=x[2],L=we(e,o,n),b=L[0],f=L[1],n=L[2],[b,f,n,s.length>3?s[3]:1]},$e=function(){var e,o,s,n,l,f;return f=re(arguments),l=f[0],e=f[1],o=f[2],s=ze(e*e+o*o),n=(F(o,e)*u+360)%360,Le(s*1e4)===0&&(n=Number.NaN),[l,s,n]},Ft=function(){var e,o,s,n,l,f,d;return f=re(arguments),l=f[0],s=f[1],o=f[2],d=Pt(l,s,o),n=d[0],e=d[1],o=d[2],$e(n,e,o)},g.lch=function(){var e;return e=re(arguments),new r(e,"lch")},g.hcl=function(){var e;return e=re(arguments),new r(e,"hcl")},w.lch=Ke,w.hcl=function(){var e,o,s,n;return n=re(arguments),o=n[0],e=n[1],s=n[2],Ke([s,e,o])},r.prototype.lch=function(){return Ft(this._rgb)},r.prototype.hcl=function(){return Ft(this._rgb).reverse()},tr=function(e){var o,s,n,l,f,d,h,b,x;return e==null&&(e="rgb"),b=re(arguments),h=b[0],l=b[1],o=b[2],h=h/255,l=l/255,o=o/255,f=1-Math.max(h,Math.max(l,o)),n=f<1?1/(1-f):0,s=(1-h-f)*n,d=(1-l-f)*n,x=(1-o-f)*n,[s,d,x,f]},de=function(){var e,o,s,n,l,f,d,h,b;return o=re(arguments),n=o[0],d=o[1],b=o[2],f=o[3],e=o.length>4?o[4]:1,f===1?[0,0,0,e]:(h=n>=1?0:255*(1-n)*(1-f),l=d>=1?0:255*(1-d)*(1-f),s=b>=1?0:255*(1-b)*(1-f),[h,l,s,e])},w.cmyk=function(){return de(re(arguments))},g.cmyk=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["cmyk"]),function(){})},r.prototype.cmyk=function(){return tr(this._rgb)},w.gl=function(){var e,o,s,n,l;for(n=function(){var f,d;f=re(arguments),d=[];for(o in f)l=f[o],d.push(l);return d}.apply(this,arguments),e=s=0;s<=2;e=++s)n[e]*=255;return n},g.gl=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["gl"]),function(){})},r.prototype.gl=function(){var e;return e=this._rgb,[e[0]/255,e[1]/255,e[2]/255,e[3]]},jt=function(e,o,s){var n;return n=re(arguments),e=n[0],o=n[1],s=n[2],e=wt(e),o=wt(o),s=wt(s),.2126*e+.7152*o+.0722*s},wt=function(e){return e/=255,e<=.03928?e/12.92:ce((e+.055)/1.055,2.4)},_e=function(e,o,s,n){var l,f;return l=e._rgb,f=o._rgb,new r(l[0]+s*(f[0]-l[0]),l[1]+s*(f[1]-l[1]),l[2]+s*(f[2]-l[2]),n)},E.push(["rgb",_e]),r.prototype.luminance=function(e,o){var s,n,l,f,d;return o==null&&(o="rgb"),arguments.length?(f=this._rgb,e===0?f=[0,0,0,this._rgb[3]]:e===1?f=[255,255,255,this[3]]:(s=jt(this._rgb),n=1e-7,l=20,d=function(h,b){var x,L;return L=h.interpolate(b,.5,o),x=L.luminance(),Math.abs(e-x)<n||!l--?L:x>e?d(h,L):d(L,b)},s>e?f=d(g("black"),this).rgba():f=d(this,g("white")).rgba()),g(f).alpha(this.alpha())):jt(this._rgb)},Rt=function(e){var o,s,n,l;return l=e/100,l<66?(n=255,s=-155.25485562709179-.44596950469579133*(s=l-2)+104.49216199393888*qe(s),o=l<20?0:-254.76935184120902+.8274096064007395*(o=l-10)+115.67994401066147*qe(o)):(n=351.97690566805693+.114206453784165*(n=l-55)-40.25366309332127*qe(n),s=325.4494125711974+.07943456536662342*(s=l-50)-28.0852963507957*qe(s),o=255),[n,s,o]},cr=function(){var e,o,s,n,l,f,d,h,b;for(d=re(arguments),f=d[0],s=d[1],e=d[2],l=1e3,n=4e4,o=.4;n-l>o;)b=(n+l)*.5,h=Rt(b),h[2]/h[0]>=e/f?n=b:l=b;return Le(b)},g.temperature=g.kelvin=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["temperature"]),function(){})},w.temperature=w.kelvin=w.K=Rt,r.prototype.temperature=function(){return cr(this._rgb)},r.prototype.kelvin=r.prototype.temperature,g.contrast=function(e,o){var s,n,l,f;return((l=te(e))==="string"||l==="number")&&(e=new r(e)),((f=te(o))==="string"||f==="number")&&(o=new r(o)),s=e.luminance(),n=o.luminance(),s>n?(s+.05)/(n+.05):(n+.05)/(s+.05)},g.distance=function(e,o,s){var n,l,f,d,h,b,x;s==null&&(s="lab"),((h=te(e))==="string"||h==="number")&&(e=new r(e)),((b=te(o))==="string"||b==="number")&&(o=new r(o)),f=e.get(s),d=o.get(s),x=0;for(l in f)n=(f[l]||0)-(d[l]||0),x+=n*n;return Math.sqrt(x)},g.deltaE=function(e,o,s,n){var l,f,d,h,b,x,L,j,z,k,A,P,D,K,le,R,Ne,Me,G,J,ge,y,O,$,B,W,V;for(s==null&&(s=1),n==null&&(n=1),((Ne=te(e))==="string"||Ne==="number")&&(e=new r(e)),((Me=te(o))==="string"||Me==="number")&&(o=new r(o)),G=e.lab(),l=G[0],d=G[1],b=G[2],J=o.lab(),f=J[0],h=J[1],x=J[2],L=ze(d*d+b*b),j=ze(h*h+x*x),O=l<16?.511:.040975*l/(1+.01765*l),ge=.0638*L/(1+.0131*L)+.638,R=L<1e-6?0:F(b,d)*180/a;R<0;)R+=360;for(;R>=360;)R-=360;return $=R>=164&&R<=345?.56+C(.2*T(a*(R+168)/180)):.36+C(.4*T(a*(R+35)/180)),z=L*L*L*L,le=ze(z/(z+1900)),y=ge*(le*$+1-le),K=l-f,D=L-j,A=d-h,P=b-x,k=A*A+P*P-D*D,B=K/(s*O),W=D/(n*ge),V=y,ze(B*B+W*W+k/(V*V))},r.prototype.get=function(e){var o,s,n,l,f,d;return n=this,f=e.split("."),l=f[0],o=f[1],d=n[l](),o?(s=l.indexOf(o),s>-1?d[s]:console.warn("unknown channel "+o+" in mode "+l)):d},r.prototype.set=function(e,o){var s,n,l,f,d,h;if(l=this,d=e.split("."),f=d[0],s=d[1],s)if(h=l[f](),n=f.indexOf(s),n>-1)if(te(o)==="string")switch(o.charAt(0)){case"+":h[n]+=+o;break;case"-":h[n]+=+o;break;case"*":h[n]*=+o.substr(1);break;case"/":h[n]/=+o.substr(1);break;default:h[n]=+o}else h[n]=o;else console.warn("unknown channel "+s+" in mode "+f);else h=o;return g(h,f).alpha(l.alpha())},r.prototype.clipped=function(){return this._rgb._clipped||!1},r.prototype.alpha=function(e){return arguments.length?g.rgb([this._rgb[0],this._rgb[1],this._rgb[2],e]):this._rgb[3]},r.prototype.darken=function(e){var o,s;return e==null&&(e=1),s=this,o=s.lab(),o[0]-=i.Kn*e,g.lab(o).alpha(s.alpha())},r.prototype.brighten=function(e){return e==null&&(e=1),this.darken(-e)},r.prototype.darker=r.prototype.darken,r.prototype.brighter=r.prototype.brighten,r.prototype.saturate=function(e){var o,s;return e==null&&(e=1),s=this,o=s.lch(),o[1]+=e*i.Kn,o[1]<0&&(o[1]=0),g.lch(o).alpha(s.alpha())},r.prototype.desaturate=function(e){return e==null&&(e=1),this.saturate(-e)},r.prototype.premultiply=function(){var e,o;return o=this.rgb(),e=this.alpha(),g(o[0]*e,o[1]*e,o[2]*e,e)},M=function(e,o,s){if(!M[s])throw"unknown blend mode "+s;return M[s](e,o)},N=function(e){return function(o,s){var n,l;return n=g(s).rgb(),l=g(o).rgb(),g(e(n,l),"rgb")}},ne=function(e){return function(o,s){var n,l,f;for(f=[],n=l=0;l<=3;n=++l)f[n]=e(o[n],s[n]);return f}},Zt=function(e,o){return e},Jt=function(e,o){return e*o/255},oe=function(e,o){return e>o?o:e},Se=function(e,o){return e>o?e:o},ur=function(e,o){return 255*(1-(1-e/255)*(1-o/255))},er=function(e,o){return o<128?2*e*o/255:255*(1-2*(1-e/255)*(1-o/255))},q=function(e,o){return 255*(1-(1-o/255)/(e/255))},se=function(e,o){return e===255||(e=255*(o/255)/(1-e/255),e>255)?255:e},M.normal=N(ne(Zt)),M.multiply=N(ne(Jt)),M.screen=N(ne(ur)),M.overlay=N(ne(er)),M.darken=N(ne(oe)),M.lighten=N(ne(Se)),M.dodge=N(ne(se)),M.burn=N(ne(q)),g.blend=M,g.analyze=function(e){var o,s,n,l;for(n={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},s=0,o=e.length;s<o;s++)l=e[s],l!=null&&!isNaN(l)&&(n.values.push(l),n.sum+=l,l<n.min&&(n.min=l),l>n.max&&(n.max=l),n.count+=1);return n.domain=[n.min,n.max],n.limits=function(f,d){return g.limits(n,f,d)},n},g.scale=function(e,o){var s,n,l,f,d,h,b,x,L,j,z,k,A,P,D,K,le,R,Ne,Me,G,J,ge;return j="rgb",z=g("#ccc"),D=0,h=!1,d=[0,1],P=[],A=[0,0],s=!1,l=[],k=!1,L=0,x=1,f=!1,n={},K=!0,b=1,J=function(y){var O,$,B,W,V,ee;if(y==null&&(y=["#fff","#000"]),y!=null&&te(y)==="string"&&g.brewer!=null&&(y=g.brewer[y]||g.brewer[y.toLowerCase()]||y),te(y)==="array"){for(y.length===1&&(y=[y[0],y[0]]),y=y.slice(0),O=B=0,W=y.length-1;0<=W?B<=W:B>=W;O=0<=W?++B:--B)$=y[O],te($)==="string"&&(y[O]=g($));for(P.length=0,O=ee=0,V=y.length-1;0<=V?ee<=V:ee>=V;O=0<=V?++ee:--ee)P.push(O/(y.length-1))}return G(),l=y},Ne=function(y){var O,$;if(s!=null){for($=s.length-1,O=0;O<$&&y>=s[O];)O++;return O-1}return 0},ge=function(y){return y},le=function(y){var O,$,B,W,V;return V=y,s.length>2&&(W=s.length-1,O=Ne(y),B=s[0]+(s[1]-s[0])*(0+D*.5),$=s[W-1]+(s[W]-s[W-1])*(1-D*.5),V=L+(s[O]+(s[O+1]-s[O])*.5-B)/($-B)*(x-L)),V},Me=function(y,O){var $,B,W,V,ee,Z,ae,U;if(O==null&&(O=!1),isNaN(y)||y===null)return z;if(O?U=y:s&&s.length>2?($=Ne(y),U=$/(s.length-2)):x!==L?U=(y-L)/(x-L):U=1,O||(U=ge(U)),b!==1&&(U=ce(U,b)),U=A[0]+U*(1-A[0]-A[1]),U=Math.min(1,Math.max(0,U)),V=Math.floor(U*1e4),K&&n[V])B=n[V];else{if(te(l)==="array")for(W=ee=0,ae=P.length-1;0<=ae?ee<=ae:ee>=ae;W=0<=ae?++ee:--ee){if(Z=P[W],U<=Z){B=l[W];break}if(U>=Z&&W===P.length-1){B=l[W];break}if(U>Z&&U<P[W+1]){U=(U-Z)/(P[W+1]-Z),B=g.interpolate(l[W],l[W+1],U,j);break}}else te(l)==="function"&&(B=l(U));K&&(n[V]=B)}return B},G=function(){return n={}},J(e),R=function(y){var O;return O=g(Me(y)),k&&O[k]?O[k]():O},R.classes=function(y){var O;return y!=null?(te(y)==="array"?(s=y,d=[y[0],y[y.length-1]]):(O=g.analyze(d),y===0?s=[O.min,O.max]:s=g.limits(O,"e",y)),R):s},R.domain=function(y){var O,$,B,W,V,ee,Z;if(!arguments.length)return d;if(L=y[0],x=y[y.length-1],P=[],B=l.length,y.length===B&&L!==x)for(V=0,W=y.length;V<W;V++)$=y[V],P.push(($-L)/(x-L));else for(O=Z=0,ee=B-1;0<=ee?Z<=ee:Z>=ee;O=0<=ee?++Z:--Z)P.push(O/(B-1));return d=[L,x],R},R.mode=function(y){return arguments.length?(j=y,G(),R):j},R.range=function(y,O){return J(y,O),R},R.out=function(y){return k=y,R},R.spread=function(y){return arguments.length?(D=y,R):D},R.correctLightness=function(y){return y==null&&(y=!0),f=y,G(),f?ge=function(O){var $,B,W,V,ee,Z,ae,U,he;for($=Me(0,!0).lab()[0],B=Me(1,!0).lab()[0],ae=$>B,W=Me(O,!0).lab()[0],ee=$+(B-$)*O,V=W-ee,U=0,he=1,Z=20;Math.abs(V)>.01&&Z-- >0;)(function(){return ae&&(V*=-1),V<0?(U=O,O+=(he-O)*.5):(he=O,O+=(U-O)*.5),W=Me(O,!0).lab()[0],V=W-ee})();return O}:ge=function(O){return O},R},R.padding=function(y){return y!=null?(te(y)==="number"&&(y=[y,y]),A=y,R):A},R.colors=function(y,O){var $,B,W,V,ee,Z,ae,U,he;if(arguments.length<2&&(O="hex"),Z=[],arguments.length===0)Z=l.slice(0);else if(y===1)Z=[R(.5)];else if(y>1)B=d[0],$=d[1]-B,Z=function(){ae=[];for(var be=0;0<=y?be<y:be>y;0<=y?be++:be--)ae.push(be);return ae}.apply(this).map(function(be){return R(B+be/(y-1)*$)});else{if(e=[],U=[],s&&s.length>2)for(W=he=1,ee=s.length;1<=ee?he<ee:he>ee;W=1<=ee?++he:--he)U.push((s[W-1]+s[W])*.5);else U=d;Z=U.map(function(be){return R(be)})}return g[O]&&(Z=Z.map(function(be){return be[O]()})),Z},R.cache=function(y){return y!=null?(K=y,R):K},R.gamma=function(y){return y!=null?(b=y,R):b},R.nodata=function(y){return y!=null?(z=g(y),R):z},R},g.scales==null&&(g.scales={}),g.scales.cool=function(){return g.scale([g.hsl(180,1,.9),g.hsl(250,.7,.4)])},g.scales.hot=function(){return g.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},g.analyze=function(e,o,s){var n,l,f,d,h,b,x;if(h={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},s==null&&(s=function(){return!0}),n=function(L){L!=null&&!isNaN(L)&&(h.values.push(L),h.sum+=L,L<h.min&&(h.min=L),L>h.max&&(h.max=L),h.count+=1)},x=function(L,j){if(s(L,j))return o!=null&&te(o)==="function"?n(o(L)):o!=null&&te(o)==="string"||te(o)==="number"?n(L[o]):n(L)},te(e)==="array")for(d=0,f=e.length;d<f;d++)b=e[d],x(b);else for(l in e)b=e[l],x(b,l);return h.domain=[h.min,h.max],h.limits=function(L,j){return g.limits(h,L,j)},h},g.limits=function(e,o,s){var n,l,f,d,h,b,x,L,j,z,k,A,P,D,K,le,R,Ne,Me,G,J,ge,y,O,$,B,W,V,ee,Z,ae,U,he,be,Ze,Qe,et,tt,rt,ot,hr,st,it,nt,lt,at,ct,ft,dt,ut,Vr,He,zt,_r,Pe,ht;if(o==null&&(o="equal"),s==null&&(s=7),te(e)==="array"&&(e=g.analyze(e)),$=e.min,X=e.max,Vr=e.sum,Pe=e.values.sort(function(Dt,It){return Dt-It}),s===1)return[$,X];if(y=[],o.substr(0,1)==="c"&&(y.push($),y.push(X)),o.substr(0,1)==="e"){for(y.push($),G=ae=1,Ze=s-1;1<=Ze?ae<=Ze:ae>=Ze;G=1<=Ze?++ae:--ae)y.push($+G/s*(X-$));y.push(X)}else if(o.substr(0,1)==="l"){if($<=0)throw"Logarithmic scales are only possible for values > 0";for(B=Math.LOG10E*qe($),O=Math.LOG10E*qe(X),y.push($),G=ht=1,Qe=s-1;1<=Qe?ht<=Qe:ht>=Qe;G=1<=Qe?++ht:--ht)y.push(ce(10,B+G/s*(O-B)));y.push(X)}else if(o.substr(0,1)==="q"){for(y.push($),G=n=1,st=s-1;1<=st?n<=st:n>=st;G=1<=st?++n:--n)U=(Pe.length-1)*G/s,he=me(U),he===U?y.push(Pe[he]):(be=U-he,y.push(Pe[he]*(1-be)+Pe[he+1]*be));y.push(X)}else if(o.substr(0,1)==="k"){for(V=Pe.length,D=new Array(V),Ne=new Array(s),ut=!0,ee=0,le=null,le=[],le.push($),G=l=1,it=s-1;1<=it?l<=it:l>=it;G=1<=it?++l:--l)le.push($+G/s*(X-$));for(le.push(X);ut;){for(J=f=0,nt=s-1;0<=nt?f<=nt:f>=nt;J=0<=nt?++f:--f)Ne[J]=0;for(G=d=0,lt=V-1;0<=lt?d<=lt:d>=lt;G=0<=lt?++d:--d){for(_r=Pe[G],W=Number.MAX_VALUE,J=h=0,at=s-1;0<=at?h<=at:h>=at;J=0<=at?++h:--h)Me=C(le[J]-_r),Me<W&&(W=Me,K=J);Ne[K]++,D[G]=K}for(Z=new Array(s),J=b=0,ct=s-1;0<=ct?b<=ct:b>=ct;J=0<=ct?++b:--b)Z[J]=null;for(G=x=0,ft=V-1;0<=ft?x<=ft:x>=ft;G=0<=ft?++x:--x)R=D[G],Z[R]===null?Z[R]=Pe[G]:Z[R]+=Pe[G];for(J=L=0,dt=s-1;0<=dt?L<=dt:L>=dt;J=0<=dt?++L:--L)Z[J]*=1/Ne[J];for(ut=!1,J=j=0,et=s-1;0<=et?j<=et:j>=et;J=0<=et?++j:--j)if(Z[J]!==le[G]){ut=!0;break}le=Z,ee++,ee>200&&(ut=!1)}for(ge={},J=z=0,tt=s-1;0<=tt?z<=tt:z>=tt;J=0<=tt?++z:--z)ge[J]=[];for(G=k=0,rt=V-1;0<=rt?k<=rt:k>=rt;G=0<=rt?++k:--k)R=D[G],ge[R].push(Pe[G]);for(He=[],J=A=0,ot=s-1;0<=ot?A<=ot:A>=ot;J=0<=ot?++A:--A)He.push(ge[J][0]),He.push(ge[J][ge[J].length-1]);for(He=He.sort(function(Dt,It){return Dt-It}),y.push(He[0]),G=P=1,hr=He.length-1;P<=hr;G=P+=2)zt=He[G],!isNaN(zt)&&y.indexOf(zt)===-1&&y.push(zt)}return y},Ae=function(e,o,s){var n,l,f,d;return n=re(arguments),e=n[0],o=n[1],s=n[2],isNaN(e)&&(e=0),e/=360,e<1/3?(l=(1-o)/3,d=(1+o*T(p*e)/T(c-p*e))/3,f=1-(l+d)):e<2/3?(e-=1/3,d=(1-o)/3,f=(1+o*T(p*e)/T(c-p*e))/3,l=1-(d+f)):(e-=2/3,f=(1-o)/3,l=(1+o*T(p*e)/T(c-p*e))/3,d=1-(f+l)),d=pe(s*d*3),f=pe(s*f*3),l=pe(s*l*3),[d*255,f*255,l*255,n.length>3?n[3]:1]},ir=function(){var e,o,s,n,l,f,d,h;return d=re(arguments),f=d[0],o=d[1],e=d[2],p=Math.PI*2,f/=255,o/=255,e/=255,l=Math.min(f,o,e),n=(f+o+e)/3,h=1-l/n,h===0?s=0:(s=(f-o+(f-e))/2,s/=Math.sqrt((f-o)*(f-o)+(f-e)*(o-e)),s=Math.acos(s),e>o&&(s=p-s),s/=p),[s*360,h,n]},g.hsi=function(){return function(e,o,s){s.prototype=e.prototype;var n=new s,l=e.apply(n,o);return Object(l)===l?l:n}(r,Ce.call(arguments).concat(["hsi"]),function(){})},w.hsi=Ae,r.prototype.hsi=function(){return ir(this._rgb)},Te=function(e,o,s,n){var l,f,d,h,b,x,L,j,z,k,A,P,D;return n==="hsl"?(P=e.hsl(),D=o.hsl()):n==="hsv"?(P=e.hsv(),D=o.hsv()):n==="hcg"?(P=e.hcg(),D=o.hcg()):n==="hsi"?(P=e.hsi(),D=o.hsi()):(n==="lch"||n==="hcl")&&(n="hcl",P=e.hcl(),D=o.hcl()),n.substr(0,1)==="h"&&(d=P[0],k=P[1],x=P[2],h=D[0],A=D[1],L=D[2]),!isNaN(d)&&!isNaN(h)?(h>d&&h-d>180?l=h-(d+360):h<d&&d-h>180?l=h+360-d:l=h-d,f=d+s*l):isNaN(d)?isNaN(h)?f=Number.NaN:(f=h,(x===1||x===0)&&n!=="hsv"&&(z=A)):(f=d,(L===1||L===0)&&n!=="hsv"&&(z=k)),z==null&&(z=k+s*(A-k)),b=x+s*(L-x),j=g[n](f,z,b)},E=E.concat(function(){var e,o,s,n;for(s=["hsv","hsl","hsi","hcl","lch","hcg"],n=[],o=0,e=s.length;o<e;o++)Kt=s[o],n.push([Kt,Te]);return n}()),Re=function(e,o,s,n){var l,f;return l=e.num(),f=o.num(),g.num(l+(f-l)*s,"num")},E.push(["num",Re]),ue=function(e,o,s,n){var l,f,d;return f=e.lab(),d=o.lab(),l=new r(f[0]+s*(d[0]-f[0]),f[1]+s*(d[1]-f[1]),f[2]+s*(d[2]-f[2]),n)},E.push(["lab",ue])}).call(_t)});eo(exports,{PerspectiveViewerDatagridPluginElement:()=>Ut});var Ge=new WeakMap,ro=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?5e6:1e7;function gr(r,t,i,a,c){var u={};return Object.keys(a).forEach(function(p){u[p]=a[p]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=i.slice().reverse().reduce(function(p,m){return m(r,t,p)||p},u),c&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(c):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(r,t,u),u=null),u}var Ct=0,Xe=0,br=performance.now(),mr=(r,...t)=>r.map((i,a)=>[i,t[a]]).flat().filter(i=>!!i).join("");function vr(r,t,i){let a=i.value,c=Symbol("regular-table throttle lock");return i.value=async function(...u){if(this[c]!==void 0&&(await this[c],this[c]!==void 0))return void await this[c];let p;this[c]=(()=>{let m,_=new Promise(v=>{m=v});return _.resolve=m,_})();try{p=await a.call(this,...u)}finally{let m=this[c];this[c]=void 0,m.resolve()}return p},i.value.flush=async function(){return await new Promise(requestAnimationFrame),await this[c]},i}var Nt,oo=(gr((Nt=class extends HTMLElement{create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=mr` <style> ${":host{bottom:0;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch}:host,div.rt-virtual-panel{position:absolute;top:0;left:0;right:0}div.rt-virtual-panel{pointer-events:none}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%}div.rt-tree-container{display:flex;align-items:center;height:100%}slot{position:absolute;overflow:hidden;overflow-anchor:none}"} </style> <style> ${":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px}"} </style> <div class="rt-virtual-panel"></div> <div class="rt-scroll-table-clip"> ${"<slot></slot>"} </div> `;let[,r,t,i]=this.shadowRoot.children;this._sub_cell_style=r,this._table_clip=i,this._virtual_panel=t,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode==="both"||this._virtual_mode==="vertical"?this._table_clip.style.top="0px":this._table_clip.style.removeProperty("top"),this._virtual_mode==="both"||this._virtual_mode==="horizontal"?this._table_clip.style.left="0px":this._table_clip.style.removeProperty("left"),this._virtual_mode!=="both"?this._table_clip.style.contain="none":this._table_clip.style.removeProperty("contain"))}_calculate_viewport(r,t){let{start_row:i,end_row:a}=this._calculate_row_range(r),{start_col:c,end_col:u}=this._calculate_column_range(t);return this._nrows=r,{start_col:c,end_col:u,start_row:i,end_row:a}}_calculate_row_range(r){let{height:t}=this._container_size,i=this._column_sizes.row_height||19,a=this._view_cache.config.column_pivots.length,c=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),u=Math.max(Math.ceil(this.scrollTop),0)/c,p=t/i-a,m=r||0,_=Math.max(0,Math.ceil(m-p))*u;return{start_row:_,end_row:Math.max(0,Math.min(_+p,r))}}_calc_start_column(){let r=this._view_cache.config.row_pivots.length,t=0,i=0,a=0;for(;i<this.scrollLeft;){let c=this._column_sizes.indices[t+r];a=this.scrollLeft-i,t+=1,i+=c!==void 0?c:60}return t+=a/(this._column_sizes.indices[t+r-1]||60),Math.max(0,t-1)}_calculate_column_range(r){if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let t=this._calc_start_column();return{start_col:t,end_col:t+(this.table_model.num_columns()||Math.min(r,Math.ceil(this._container_size.width/60)))+1}}}_max_scroll_column(r){let t=0;if(this._view_cache.config.row_pivots.length>0)for(let c of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))t+=c;let i=this._view_cache.config.row_pivots.length,a=r;for(;t<this._container_size.width&&a>=0;)a--,t+=this._column_sizes.indices[a+i]||60;return Math.min(r-1,a+1)}_validate_viewport({start_col:r,end_col:t,start_row:i,end_row:a}){i=Math.floor(i),a=Math.ceil(a),r=Math.floor(r),t=Math.ceil(t);let c=this._start_col!==r,u=this._start_row!==i||this._end_row!==a||this._end_col!==t;return this._start_col=r,this._end_col=t,this._start_row=i,this._end_row=a,{invalid_column:c,invalid_row:u}}_calc_scrollable_column_width(r){let t=this._view_cache.config.row_pivots.length,i=this._max_scroll_column(r),a=t,c=0;for(;a<i+t;)c+=this._column_sizes.indices[a]||60,a++;return c}_update_virtual_panel_width(r,t){if(r)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((i,a)=>i+a,0)+"px";else{let i=this._calc_scrollable_column_width(t);if(i!==0){let a=this._container_size.width+i+2;this._virtual_panel.style.width=a+"px"}else this._virtual_panel.style.width="1px"}}_update_virtual_panel_height(r){let{row_height:t=19}=this._column_sizes,i=this._view_cache.config.column_pivots.length*t,a;if(this._virtual_mode==="horizontal"||this._virtual_mode==="none")a=r*t+i;else{let c=this.clientHeight/(this._table_clip.offsetHeight-i);a=Math.min(ro,r*t*c)}this._virtual_panel.style.height=a+"px"}async draw(r={}){let t=performance.now(),{invalid_viewport:i=!0,preserve_width:a=!1}=r,{num_columns:c,num_rows:u}=await this._view_cache.view(0,0,0,0);this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight},this._update_virtual_panel_height(u),a||this._update_virtual_panel_width(i,c);let p=this._calculate_viewport(u,c),{invalid_row:m,invalid_column:_}=this._validate_viewport(p);if(this._invalid_schema||m||_||i){let w=[],E=!0;for await(let C of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,a,p,c)){C!==void 0&&(w=w.concat(C)),E&&(this.update_sub_cell_offset(p),E=!1),this._is_styling=!0;let F=this._style_callbacks;for(let I of F)await I({detail:this});if(this._is_styling=!1,!this._invalidated&&C!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(w),this.table_model.header.reset_header_cache(),a||this._update_virtual_panel_width(this._invalid_schema||_,c),this._invalid_schema=!1}else this.update_sub_cell_offset(p);var v;v=performance.now()-t,Ct=(Ct*Xe+v)/(Xe+1),Xe+=1}update_sub_cell_offset(r){var t;let i=this._column_sizes.row_height*(r.start_row%1)||0,a=this._column_sizes.indices[(this.table_model._row_headers_length||0)+Math.floor(r.start_col)]*(r.start_col%1)||0,c=(t=this._sub_cell_style.sheet)===null||t===void 0?void 0:t.cssRules[0].style;c&&(c.setProperty("--regular-table--clip-x",a+"px"),c.setProperty("--regular-table--clip-y",i+"px"),c.setProperty("--regular-table--transform-x",`-${a}px`),c.setProperty("--regular-table--transform-y",`-${i}px`))}}).prototype,"draw",[vr],Object.getOwnPropertyDescriptor(Nt.prototype,"draw"),Nt.prototype),Nt),At,so=(gr((At=class extends oo{register_listeners(){this.addEventListener("mousedown",this._on_click_or_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!0}),this._register_glitch_scroll_listeners()}_on_scroll(r){r.stopPropagation(),this.draw({invalid_viewport:!1})}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this))}_on_mousewheel(r){if(!window.safari)return;let{clientWidth:t,clientHeight:i,scrollTop:a,scrollLeft:c}=this;r.preventDefault(),r.returnValue=!1;let u=Math.max(1,this._virtual_panel.offsetHeight-i),p=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.max(0,Math.min(u,a+r.deltaY)),this.scrollLeft=Math.max(0,Math.min(p,c+r.deltaX)),this._on_scroll(r)}_on_touchmove(r){r.stopPropagation(),r.preventDefault(),r.returnValue=!1;let{clientWidth:t,clientHeight:i}=this,a=Math.max(1,this._virtual_panel.offsetHeight-i),c=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.min(a,this._memo_scroll_top+(this._memo_touch_startY-r.touches[0].pageY)),this.scrollLeft=Math.min(c,this._memo_scroll_left+(this._memo_touch_startX-r.touches[0].pageX)),this._on_scroll(r)}_on_touchstart(r){this._memo_touch_startY=r.touches[0].pageY,this._memo_touch_startX=r.touches[0].pageX,this._memo_scroll_top=this.scrollTop,this._memo_scroll_left=this.scrollLeft}async _on_dblclick(r){let t=r.target;for(;t.tagName!=="TD"&&t.tagName!=="TH";)if(t=t.parentElement,!this.contains(t))return;let i=r.target.classList.contains("rt-column-resize"),a=Ge.get(t);if(i){r.stopImmediatePropagation(),t.style.minWidth="",t.style.maxWidth="",r.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(this._column_sizes.override[a.size_key]=void 0,this._column_sizes.auto[a.size_key]=void 0,this._column_sizes.indices[a.size_key]=void 0);for(let c of r.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let u of r.shiftKey?c:[c[a._virtual_x]])u&&(u.style.minWidth="",u.style.maxWidth="",u.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(r){if(r.button!==0)return;let t=r.target;for(;t.tagName!=="TD"&&t.tagName!=="TH";)if(t=t.parentElement,!this.contains(t))return;let i=r.target.classList.contains("rt-column-resize"),a=Ge.get(t);i&&(this._on_resize_column(r,t,a),r.stopImmediatePropagation())}async _on_click_or_dblclick(r){let t=performance.now();this._last_clicked_time&&t-this._last_clicked_time<500?(this._last_clicked_time=t,await this._on_dblclick(r)):(this._last_clicked_time=t,await this._on_click(r))}_on_resize_column(r,t,i){let{_virtual_x:a,size_key:c}=i,u=r.pageX,p=a+t.colSpan-1,m=this.table_model.header.get_column_header(p),_=this._column_sizes.indices[c],v=E=>this._on_resize_column_move(E,m,u,_,c,p),w=()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",w);let E=this._column_sizes.override[c],C=this._column_sizes.indices[c]!==E;this._column_sizes.indices[c]=E,C&&this.draw()};document.addEventListener("mousemove",v),document.addEventListener("mouseup",w)}async _on_resize_column_move(r,t,i,a,c,u){await new Promise(setTimeout);let p=r.pageX-i,m=Math.max(1,a+p);if(this._column_sizes.override[c]=m,p<0)await this.draw({preserve_width:!0});else{t.style.minWidth=m+"px",t.style.maxWidth=m+"px";let _=this._column_sizes.auto[c];for(let v of this.table_model.body.cells){let w=v[u];w&&(w.style.maxWidth=w.style.minWidth=m+"px",w.classList.toggle("rt-cell-clip",_>m))}}}}).prototype,"_on_resize_column_move",[vr],Object.getOwnPropertyDescriptor(At.prototype,"_on_resize_column_move"),At.prototype),At),yr=class{constructor(t){this._name=t,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let t=this._elements[this._index];return this._index+=1,t}},Ht=class{constructor(t,i,a){this._column_sizes=t,this._container=i,this._span_factory=new yr("span"),this.table=a,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(t,i){Ge.set(t,i)}_get_or_create_metadata(t){if(t===void 0)return{};if(Ge.has(t))return Ge.get(t);{let i={};return Ge.set(t,i),i}}_replace_cell(t,i){let{tr:a,row_container:c}=this._get_row(t),u=c[i];return u&&(a.removeChild(u),c.splice(i,1,void 0)),u}_fetch_cell(t,i){if(t<0||i<0)return;let{row_container:a}=this._get_row(t);return a[i]}_get_cell(t="TD",i,a){let{tr:c,row_container:u}=this._get_row(i),p=u[a];if(p||(a<u.length?(p=u[a]=document.createElement(t),c.insertBefore(p,u.slice(a+1).find(m=>m))):(p=u[a]=document.createElement(t),c.appendChild(p))),p.tagName!==t){let m=document.createElement(t);c.replaceChild(m,p),this.cells[i].splice(a,1,m),p=m}return p}_get_row(t){let i=this.rows[t];i||(i=this.rows[t]=document.createElement("tr"),this.table.appendChild(i));let a=this.cells[t];return a||(a=this.cells[t]=[]),{tr:i,row_container:a}}_clean_columns(t){for(let i=0;i<this.rows.length;i++){let a=this.rows[i],c=this.cells[i];this.cells[i]=c.slice(0,t[i]||t);let u=this.cells[i].filter(p=>p!==void 0).length;for(;a.children[u];)a.removeChild(a.children[u])}}_clean_rows(t){for(;this.table.children[t];)this.table.removeChild(this.table.children[t]);this.rows=this.rows.slice(0,t),this.cells=this.cells.slice(0,t)}},wr=class extends Ht{constructor(...t){super(...t),this._group_header_cache=[],this._offset_cache=[]}_draw_group_th(t,i,a){let c=this._get_cell("TH",i,t[i]||0);if(t[i]+=1,c.removeAttribute("colspan"),c.style.minWidth="0",c.textContent="",a instanceof HTMLElement)c.appendChild(a);else{let p=this._span_factory.get("span");p.textContent=a,c.appendChild(p)}let u=this._span_factory.get("span");return u.className="rt-column-resize",c.appendChild(u),c}_draw_group(t,i,a){let c=this._get_or_create_metadata(a);return c.column_header=t,c.value=i,c.value=i,c}_draw_th(t,i,a,c,u){let p=this._get_or_create_metadata(a);if(p.column_header=t,p.value=i,p.size_key=u.length?u[0]:u,!(u.length>1)){let m=this._column_sizes.override[p.size_key],_=this._column_sizes.auto[p.size_key];m?(a.classList.toggle("rt-cell-clip",_>m),a.style.minWidth=m+"px",a.style.maxWidth=m+"px"):_?(a.classList.remove("rt-cell-clip"),a.style.maxWidth="",a.style.minWidth=_+"px"):(a.style.maxWidth="",a.style.maxWidth="")}return p}get_column_header(t){return this._get_cell("TH",this.num_rows()-1,t)}draw(t,i,a,c,u,p,m){let _=i==null?void 0:i.length;if(_===0)return;let v,w,E;for(let M=0;M<_;M++){if(E=i[M]?i[M]:"",this._offset_cache[M]=this._offset_cache[M]||0,M<_-1){var C,F,I;((C=this._group_header_cache)===null||C===void 0||(F=C[M])===null||F===void 0||(I=F[0])===null||I===void 0?void 0:I.value)===E?(v=this._group_header_cache[M][1],this._group_header_cache[M][2]+=1,a===1&&(this._group_header_cache[M][0].row_header_x=u),v.setAttribute("colspan",this._group_header_cache[M][2])):(v=this._draw_group_th(this._offset_cache,M,E),w=this._draw_group(i,E,v),this._group_header_cache[M]=[w,v,1])}else{v=this._draw_group_th(this._offset_cache,M,E),w=this._draw_th(t||i,E,v,c,u);for(let[N]of this._group_header_cache)N.size_key=w.size_key;v.removeAttribute("colspan")}v.classList.toggle("rt-group-corner",c===void 0),w&&(w.x=c===void 0?c:Math.floor(c),w.column_header_y=M,w.x0=Math.floor(p),w._virtual_x=m,a===1&&(w.row_header_x=u))}return this._clean_rows(this._offset_cache.length),{th:v,metadata:w}}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}},xr=class extends Ht{_draw_td(t,i,a,c,{column_name:u},{ridx_offset:p},m){let _=this._get_cell(t,i,c),v=this._get_or_create_metadata(_);v.y=i+Math.floor(p),v.size_key=m,t==="TD"&&(v.column_header=u);let w=this._column_sizes.override[v.size_key];if(w){let E=this._column_sizes.auto[v.size_key];_.classList.toggle("rt-cell-clip",E>w),_.style.minWidth=w+"px",_.style.maxWidth=w+"px"}else _.classList.remove("rt-cell-clip"),_.style.minWidth="",_.style.maxWidth="";return v.value!==a&&(a instanceof HTMLElement?(_.textContent="",_.appendChild(a)):_.textContent=a),v.value=a,{td:_,metadata:v}}draw(t,i,a,c=!1,u,p,m){let{cidx:_,column_data:v,row_headers:w,column_data_listener_metadata:E}=i,C,{row_height:F}=a,I=[],M=[],N=0,S=[];for(let g=0;g<(c?a.row_headers_length:1);g++){N=0;for(let Y of v){var q;let de=w==null?void 0:w[N],H;if(c){let T=Y[g],Q=this._fetch_cell(N-(I[g]||1),_+g),oe=this._get_or_create_metadata(Q),se=this._fetch_cell(N,_+g-(S[N]||1)),ne=this._get_or_create_metadata(se);!se||ne.value!==T&&T!==void 0||se.hasAttribute("rowspan")?Q&&oe.value===T&&!Q.hasAttribute("colspan")?(I[g]=I[g]?I[g]+1:2,Q.setAttribute("rowspan",I[g]),this._replace_cell(N,_+g)):(H=this._draw_td("TH",N,T,_+g,i,a,g),H.td.style.display="",H.td.removeAttribute("rowspan"),H.td.removeAttribute("colspan"),H.metadata.row_header=Y,H.metadata.row_header_x=g,H.metadata.y0=Math.floor(a.ridx_offset),H.metadata.y1=Math.ceil(a.y1),H.metadata._virtual_x=g,p!==void 0&&(H.metadata.x0=Math.floor(p)),I[g]=1,S[N]=1,M[g]=H):(S[N]=S[N]?S[N]+1:2,se.setAttribute("colspan",S[N]),this._replace_cell(N,_+g))}else H=this._draw_td("TD",N,Y,_,i,a,m),E&&(H.metadata.user=E[N]),H.metadata.x=u===void 0?u:Math.floor(u),H.metadata.x1=Math.ceil(a.x1),H.metadata.row_header=de||[],H.metadata.y0=Math.floor(a.ridx_offset),H.metadata.y1=Math.ceil(a.y1),H.metadata.dx=Math.floor(u-p),H.metadata.dy=H.metadata.y-Math.floor(H.metadata.y0),H.metadata._virtual_x=_,p!==void 0&&(H.metadata.x0=Math.floor(p)),M[0]=H;if(N++,C=H?H.metadata:C,F=F||((q=H)===null||q===void 0?void 0:q.td.offsetHeight),N*F>t)break}}return this._clean_rows(N),{tds:M,ridx:N,metadata:C,row_height:F}}clean({ridx:t,cidx:i}){this._clean_rows(t),this._clean_columns(i)}},$t=class{constructor(t,i,a){this.clear(a);let[c]=a.children,[u,p]=c.children;this.table=c,this._column_sizes=i,this.header=new wr(i,t,u),this.body=new xr(i,t,p),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(t){t.innerHTML=mr` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `}autosize_cells(t){for(;t.length>0;){let[i,a,c]=t.pop(),u,p=getComputedStyle(i);p.boxSizing!=="border-box"?(u=i.clientWidth,u-=p.paddingLeft?parseFloat(p.paddingLeft):0,u-=p.paddingRight?parseFloat(p.paddingRight):0):u=parseFloat(p.width),this._column_sizes.row_height=this._column_sizes.row_height||c.offsetHeight,this._column_sizes.indices[a.size_key]=u;let m=this._column_sizes.override[a.size_key]!==void 0;u&&!m&&(this._column_sizes.auto[a.size_key]=u),i.style.minWidth==="0px"&&(i.style.minWidth=u+"px")}}async*draw(t,i,a,c,u,p){var m,_,v,w;let{width:E,height:C}=t,{view:F,config:I}=i,{data:M,row_headers:N,column_headers:S,metadata:q}=await F(Math.floor(u.start_col),Math.floor(u.start_row),Math.ceil(u.end_col),Math.ceil(u.end_row)),{start_row:g=0,start_col:Y=0,end_col:de=0,end_row:H=0}=u;N&&(this._row_headers_length=N.reduce((ie,Ie)=>Math.max(ie,Ie.length),0),N=N.map(ie=>(ie.length=this._row_headers_length,ie))),i.config.column_pivots=Array.from(Array((S==null||(m=S[0])===null||m===void 0?void 0:m.length)||0).keys()),i.config.row_pivots=Array.from(Array(((_=N)===null||_===void 0||(v=_[0])===null||v===void 0?void 0:v.length)||0).keys());let T={viewport_width:0,selected_id:a,ridx_offset:g,sub_cell_offset:this._column_sizes.indices[(this._row_headers_length||0)+Math.floor(u.start_col)]||0,x0:Y,x1:de,y1:H,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},Q,oe=0,se=[],ne=!0;if(((w=N)===null||w===void 0?void 0:w.length)>0){let ie=I.row_pivots.join(","),Ie={column_name:ie,cidx:0,column_data:N,row_headers:N,first_col:ne},je=oe+Math.floor(Y);Q=this.body.draw(C,Ie,{...T,x0:0},!0,void 0,void 0,je);let Te=[];for(let ue=0;ue<i.config.row_pivots.length;ue++){let ye=this.header.draw(ie,Array(i.config.column_pivots.length).fill(""),1,void 0,ue,Y,ue);ye&&Te.push(ye)}if(ne=!1,T.viewport_width+=Te.reduce((ue,{th:ye},Re)=>ue+(this._column_sizes.indices[Re]||ye.offsetWidth),0),T.row_height=T.row_height||Q.row_height,oe=N[0].length,!c)for(let ue=0;ue<i.config.row_pivots.length;ue++){let{td:ye,metadata:Re}=Q.tds[ue]||{},{th:_e,metadata:$e}=Te[ue]||{};(ye||_e)&&se.push([_e||ye,$e||Re,ye||_e])}}try{var me;let ie=0,Ie=p-u.start_col;for(;ie<Ie;){if(!M[ie]){let we=Math.max(u.end_col,0);u.start_col=we;let ke=0,Oe=0;for(;this._column_sizes.indices.length>oe+Y+ke+1&&Oe+T.viewport_width<E;)ke++,Oe+=this._column_sizes.indices[oe+Y+ke];if(Oe+T.viewport_width<E){let pe=Math.min(p,we+5);u.end_col=Math.max(1,Math.min(p,pe))}else u.end_col=Math.max(1,Math.min(p,we+ke));let Ke=F(Math.floor(u.start_col),Math.floor(u.start_row),Math.ceil(u.end_col),Math.ceil(u.end_row));yield;let Se=await Ke;if(Se.data.length===0)return void(yield se);u.end_col=u.start_col+Se.data.length;for(let pe=0;pe<Se.data.length;pe++){var Fe;M[ie+pe]=Se.data[pe],Se.metadata&&(q[ie+pe]=Se.metadata[pe]),S&&(S[ie+pe]=(Fe=Se.column_headers)===null||Fe===void 0?void 0:Fe[pe])}}let je=(S==null?void 0:S[ie])||"",Te=M[ie],ue={column_name:je,cidx:oe,column_data:Te,column_data_listener_metadata:q==null?void 0:q[ie],row_headers:N,first_col:ne},ye=ie+Y,Re=oe+Math.floor(Y),_e=this.header.draw(void 0,je,void 0,ye,Re,Y,oe);if(Q=this.body.draw(C,ue,T,!1,ye,Y,Re),ne=!1,!c)for(let{td:we,metadata:ke}of Q.tds)se.push([(_e==null?void 0:_e.th)||we,(_e==null?void 0:_e.metadata)||ke,we||(_e==null?void 0:_e.th)]);let $e=this._column_sizes.indices[oe+Math.floor(Y)];var ve;if($e?T.viewport_width+=$e:T.viewport_width+=(_e==null||(ve=_e.th)===null||ve===void 0?void 0:ve.offsetWidth)||Q.tds.reduce((we,ke)=>{var Oe;return we+((Oe=ke.td)===null||Oe===void 0?void 0:Oe.offsetWidth)},0),T.row_height=T.row_height||Q.row_height,oe++,ie++,T.viewport_width-T.sub_cell_offset>E){var Ae;this.body.clean({ridx:((Ae=Q)===null||Ae===void 0?void 0:Ae.ridx)||0,cidx:oe}),this.header.clean(),yield se,T.viewport_width=0;for(let[we]of se)T.viewport_width+=we.offsetWidth;if(T.viewport_width-T.sub_cell_offset>E)return}}this.body.clean({ridx:((me=Q)===null||me===void 0?void 0:me.ridx)||0,cidx:oe}),this.header.clean(),yield se}finally{var Ee;this.body.clean({ridx:((Ee=Q)===null||Ee===void 0?void 0:Ee.ridx)||0,cidx:oe}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}},io=["both","horizontal","vertical","none"],kr=class extends so{constructor(){super(),this._column_sizes={auto:[],override:[],indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new $t(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto=[],this._column_sizes.override=[],this._column_sizes.indices=[];for(let t=0;t<this.table_model.header.num_columns();t++){let i=this.table_model.header.get_column_header(t);i.style.minWidth="",i.style.maxWidth=""}}clear(){this.table_model=new $t(this._table_clip,this._column_sizes,this)}addStyleListener(t){this._style_callbacks=this._style_callbacks.concat(t);let i=!0;return()=>{if(!i)return;i=!1;let a=this._style_callbacks=this._style_callbacks.slice(),c=a.indexOf(t);a.splice(c,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(t){if(t!==void 0){if(t instanceof HTMLElement)return Ge.get(t);if(t.row_header_x>=0){if(t.row_header_x<this._view_cache.config.row_pivots.length){let i=this.table_model.body._fetch_cell(t.y,t.row_header_x);return this.getMeta(i)}}else{if(!(t.column_header_y>=0))return this.getMeta(this.table_model.body._fetch_cell(t.dy,t.dx+this.table_model._row_headers_length));if(t.column_header_y<this._view_cache.config.column_pivots.length){let i=this.table_model.body._fetch_cell(t.column_header_y,t.y);return this.getMeta(i)}}}}getDrawFPS(){return function(){let t=performance.now(),i=t-br,a=Ct,c=1e3*Xe/i,u=Xe;return Ct=0,Xe=0,br=t,{avg:a,real_fps:c,virtual_fps:1e3/a,num_frames:u,elapsed:i}}()}async scrollToCell(t,i){if(!this._view_cache)return void console.warn("data listener not configured");let a=this._column_sizes.row_height||19,c=this._view_cache.config.column_pivots.length*a,u=(this._table_clip.offsetHeight-c)%a,p=(this._virtual_panel.offsetHeight-u)/this._nrows;this.scrollTop=Math.ceil(p*i);let m=0;for(;t>0;)t--,m+=this._column_sizes.indices[t+this._view_cache.config.row_pivots.length]||60;this.scrollLeft=Math.ceil(m),await new Promise(requestAnimationFrame),await this.draw.flush()}setDataListener(t,{virtual_mode:i="both"}={}){console.assert(io.indexOf(i)>-1,`Unknown virtual_mode ${i};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=i,this._invalid_schema=!0,this._view_cache={view:t,config:{row_pivots:[],column_pivots:[]},schema:{}},this._setup_virtual_scroll()}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",kr);var Pr=Wt(Er());function Cr(r,t,[,,,,,i,a],[,,,,,c,u]){let p=this._ids?.[r.dy]?.join("|"),m=r.column_header.join("|");if(this.last_reverse_columns?.has(m)&&this.last_reverse_ids?.has(p)){let _=this.last_reverse_ids?.get(p),v=this.last_reverse_columns.get(m);this._is_old_viewport?this.last_meta?.[v]?.[_]>r.user?(t.style.setProperty("--pulse--background-color-start",c),t.style.setProperty("--pulse--background-color-end",u),t.style.animationName==="pulse_neg"?t.style.animation="pulse_neg2 0.5s linear":t.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[v]?.[_]<r.user?(t.style.setProperty("--pulse--background-color-start",i),t.style.setProperty("--pulse--background-color-end",a),t.style.animationName==="pulse_pos"?t.style.animation="pulse_pos2 0.5s linear":t.style.animation="pulse_pos 0.5s linear"):_!==r.dy&&(t.style.animation=""):t.style.animation=""}else t.style.animation=""}async function Nr(r,t){r.addEventListener("regular-table-psp-sort",i=>{this._preserve_focus_state=!0,t.restore({sort:i.detail.sort})})}async function Ar(r,t,i){let a=r.getMeta(i),c=a.column_header[a.column_header.length-1],p=(t.shiftKey?no:lo).call(this,c);r.dispatchEvent(new CustomEvent("regular-table-psp-sort",{detail:{sort:p}}))}function no(r){let t=[],i=!1;for(let a of this._config.sort){let[c,u]=a;if(c===r){i=!0;let p=Or.call(this,r,u);p&&t.push(p)}else t.push(a)}return i||t.push([r,"desc"]),t}function lo(r){for(let[t,i]of this._config.sort)if(t===r){let a=Or.call(this,r,i);return a?[a]:[]}return[[r,"desc"]]}function Or(r,t){let a=this._config.split_by.length>0?co:ao,c=t?a[t]:"desc";if(c)return[r,c]}var ao={desc:"asc",asc:void 0},co={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};var Sr=Wt(Gt()),xe=Symbol("Plugin Symbol");function fo(r){let[t,i,a]=r.rgb(),[c,u,p]=r.set("hsl.h",(r.get("hsl.h")-15)%360).rgb(),[m,_,v]=r.set("hsl.h",(r.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${c},${u},${p}),rgb(${t},${i},${a}) 50%,rgb(${m},${_},${v}))`}function fe(r){let t=(0,Sr.default)(r),i=fo(t),a=t.rgb();return[r,...a,i,`rgba(${a[0]},${a[1]},${a[2]},1)`,`rgba(${a[0]},${a[1]},${a[2]},0)`]}function Bt(r,t,i){let a=typeof i!="undefined",c=document.createElement(`perspective-${a?"number":"string"}-column-style`),u=r.getMeta(t),p=u.column_header[u.column_header.length-1],m=this._schema[p],_;if(a?_={fg_gradient:i,pos_fg_color:this._pos_fg_color[0],neg_fg_color:this._neg_fg_color[0],number_fg_mode:"color",bg_gradient:i,pos_bg_color:this._pos_bg_color[0],neg_bg_color:this._neg_bg_color[0],number_bg_mode:"disabled"}:_={color:this._color[0]},m!=="string")if(m==="float")_.fixed=2;else if(m==="integer")_.fixed=0;else{this._open_column_styles_menu.pop(),r.draw({preserve_width:!0});return}let v=()=>c.blur(),w=I=>{let M=I.detail;M.pos_fg_color&&(M.pos_fg_color=fe(M.pos_fg_color),M.neg_fg_color=fe(M.neg_fg_color)),M.pos_bg_color&&(M.pos_bg_color=fe(M.pos_bg_color),M.neg_bg_color=fe(M.neg_bg_color)),M.color&&(M.color=fe(M.color)),r[xe]=r[xe]||{},r[xe][p]=M,r.draw({preserve_width:!0}),r.parentElement.parentElement.dispatchEvent(new Event("perspective-config-update"))},E=async()=>{r.removeEventListener("regular-table-scroll",v),c.removeEventListener("perspective-column-style-change",w),c.removeEventListener("blur",E),c.destroy(),this._open_column_styles_menu.pop(),await r.draw({preserve_width:!0}),r.parentElement.parentElement.dispatchEvent(new Event("perspective-config-update"))};c.addEventListener("perspective-column-style-change",w),c.addEventListener("blur",E),r.addEventListener("regular-table-scroll",v);let C=r[xe]||{},F=Object.assign({},C[p]=C[p]||{});(F.pos_fg_color||F.pos_bg_color)&&(F.pos_fg_color=F.pos_fg_color?.[0],F.neg_fg_color=F.neg_fg_color?.[0],F.pos_bg_color=F.pos_bg_color?.[0],F.neg_bg_color=F.neg_bg_color?.[0]),F.color&&(F.color=F.color[0]),c.open(t,F,_)}function gt([r,t,i,a],c=[255,255,255]){function u(p,m){return((1-a)*(c[p]/255)+a*(m/255))*255}return[u(0,r),u(1,t),u(2,i)]}function bt([r,t,i]){return Math.sqrt(r*r*.299+t*t*.587+i*i*.114)>130?"#161616":"#ffffff"}var mt=Wt(Gt());function uo(r){let t=r._view_cache.config.row_pivots.length-1,i=Array.from(r.children[0].children[0].children),a=r[xe]||{};if(i.length>0){let[m]=i.splice(i.length-1,1);for(let _ of m?.children){let v=r.getMeta(_),w=v.column_header?.[v.column_header?.length-1],E=this._config.sort.find(S=>S[0]===w),C=v.row_header_x===t,F=typeof v.x=="undefined";C=C||(v.x+1)%this._config.columns.length==0,_.classList.toggle("psp-header-border",C),_.classList.toggle("psp-header-group",!1),_.classList.toggle("psp-header-leaf",!0),_.classList.toggle("psp-is-top",!1),_.classList.toggle("psp-header-corner",F),_.classList.toggle("psp-header-sort-asc",!!E&&E[1]==="asc"),_.classList.toggle("psp-header-sort-desc",!!E&&E[1]==="desc"),_.classList.toggle("psp-header-sort-col-asc",!!E&&E[1]==="col asc"),_.classList.toggle("psp-header-sort-col-desc",!!E&&E[1]==="col desc");let I=Vt.call(this,v),M=I==="integer"||I==="float",N=I==="string";_.classList.toggle("psp-align-right",M),_.classList.toggle("psp-align-left",!M),_.classList.toggle("psp-menu-open",this._open_column_styles_menu[0]===v._virtual_x),_.classList.toggle("psp-menu-enabled",(N||M)&&!F),_.classList.toggle("psp-is-width-override",r._column_sizes?.override[v.size_key]!==void 0)}}let c=[],u=new Set,p=r.children[0];for(let m=0;m<i.length;m++){let _=p.rows[m],v=new Set;for(let w=0;w<_.cells.length;w++){let E=_.cells[w];E.style.backgroundColor="";let C=r.getMeta(E),F=C.row_header_x===t||C.x>=0;E.classList.toggle("psp-align-right",!1),E.classList.toggle("psp-align-left",!1),E.classList.toggle("psp-header-group",!0),E.classList.toggle("psp-header-leaf",!1),E.classList.toggle("psp-header-border",F),E.classList.toggle("psp-header-group-corner",typeof C.x=="undefined"),E.classList.toggle("psp-color-mode-bar",!1),E.classList.toggle("psp-header-sort-asc",!1),E.classList.toggle("psp-header-sort-desc",!1),E.classList.toggle("psp-header-sort-col-asc",!1),E.classList.toggle("psp-header-sort-col-desc",!1);let I=_.cells[w],M=w,N,S;for(;c[m]&&c[m][M];++M);for(v.add(M),N=M;N<M+I.colSpan;++N)for(S=m;S<m+I.rowSpan;++S)c[S]||(c[S]=[]),c[S][N]=!0;I.classList.toggle("psp-is-top",m===0||!u.has(N))}u=v}for(let m of r.children[0].children[1].children)for(let _ of m.children){let v=r.getMeta(_),w=v.column_header?.[v.column_header?.length-1],E=Vt.call(this,v),C=a[w],F=E==="integer"||E==="float";if(F){let M=v.user>0,N=v.user<0,S;C?.pos_bg_color!==void 0?S=C.pos_bg_color:S=this._pos_bg_color;let q;C?.neg_bg_color!==void 0?q=C.neg_bg_color:q=this._neg_bg_color;let g=M?S:N?q:["",...this._plugin_background,""];{let[oe,se,ne,me,Fe]=g;if(_.style.position="",C?.number_bg_mode==="color")_.style.animation="",_.style.backgroundColor=oe;else if(C?.number_bg_mode==="gradient"){let ve=Math.max(0,Math.min(1,Math.abs(v.user/C.bg_gradient))),Ae=this._plugin_background,Ee=bt(gt([se,ne,me,ve],Ae));_.style.animation="",_.style.color=Ee,_.style.backgroundColor=`rgba(${se},${ne},${me},${ve})`}else C?.number_bg_mode==="pulse"?(Cr.call(this,v,_,S,q),_.style.backgroundColor=""):(C?.number_bg_mode==="disabled"||!C?.number_bg_mode,_.style.animation="",_.style.backgroundColor="")}let[Y,de,H,T,Q]=(()=>C?.pos_fg_color!==void 0?M?C.pos_fg_color:N?C.neg_fg_color:["",...this._plugin_background,""]:M?this._pos_fg_color:N?this._neg_fg_color:["",...this._plugin_background,""])();if(C?.number_fg_mode==="disabled")if(C?.number_bg_mode==="color"){let oe=this._plugin_background,se=bt(gt([g[1],g[2],g[3],1],oe));_.style.color=se}else C?.number_bg_mode==="gradient"||(_.style.color="");else C?.number_fg_mode==="bar"?(_.style.color="",_.style.position="relative",Q!==""&&_.children.length>0&&_.children[0].nodeType===Node.ELEMENT_NODE&&(_.children[0].style.background=Q)):(C?.number_fg_mode==="color"||!C?.number_fg_mode)&&(_.style.color=Y)}else if(E==="boolean"){let[M]=v.user===!0?this._pos_fg_color:v.user===!1?this._neg_fg_color:["",0,0,0,""];_.style.backgroundColor="",_.style.color=M}else if(E==="string"){let[M,N,S,q,g]=(()=>C?.color!==void 0?C.color:this._color)();if(C?.string_color_mode==="foreground"&&v.user!==null)_.style.color=M,_.style.backgroundColor="",C?.format==="link"&&(_.children[0].style.color=M);else if(C?.string_color_mode==="background"&&v.user!==null){let Y=this._plugin_background,de=bt(gt([N,S,q,1],Y));_.style.color=de,_.style.backgroundColor=M}else if(C?.string_color_mode==="series"&&v.user!==null){this._series_color_map.has(w)||(this._series_color_map.set(w,new Map),this._series_color_seed.set(w,0));let Y=this._series_color_map.get(w);if(!Y.has(v.user)){let Ee=this._series_color_seed.get(w);Y.set(v.user,Ee),this._series_color_seed.set(w,Ee+1)}let de=Y.get(v.user),[H,T,Q]=(0,mt.default)(M).hsl();H=H+de*150%360;let oe=(0,mt.default)(H,T,Q,"hsl"),[se,ne,me]=oe.rgb(),Fe=oe.hex(),ve=this._plugin_background,Ae=bt(gt([se,ne,me,1],ve));_.style.color=Ae,_.style.backgroundColor=Fe}else _.style.backgroundColor="",_.style.color=""}else _.style.backgroundColor="",_.style.color="";_.classList.toggle("psp-bool-type",E==="boolean"&&v.user!==null);let I=_.tagName==="TH";if(I){let M=typeof v.value!=null&&typeof v.value!=null&&v.value?.toString()?.trim().length>0,N=v.row_header_x>=this._config.group_by.length,S=r.getMeta({dx:0,dy:v.y-v.y0+1}),q=S&&S.row_header&&typeof S.row_header[v.row_header_x+1]!="undefined";_.classList.toggle("psp-tree-label",M&&!N),_.classList.toggle("psp-tree-label-expand",M&&!N&&!q),_.classList.toggle("psp-tree-label-collapse",M&&!N&&q),_.classList.toggle("psp-tree-leaf",M&&N)}_.classList.toggle("psp-align-right",!I&&F),_.classList.toggle("psp-align-left",I||!F),_.classList.toggle("psp-color-mode-bar",C?.number_fg_mode==="bar"&&F)}}async function ho(r,t){let i=r.getMeta(t.target),a=t.target.classList.contains("psp-tree-label-collapse");t.shiftKey&&a?this._view.set_depth(i.row_header.filter(c=>c!==void 0).length-2):t.shiftKey?this._view.set_depth(i.row_header.filter(c=>c!==void 0).length-1):a?this._view.collapse(i.y):this._view.expand(i.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),r.draw()}async function _o(r,t){if(t.which!==1)return;let i=t.target;if(i.tagName==="A")return;for(;i.tagName!=="TD"&&i.tagName!=="TH";)if(i=i.parentElement,!r.contains(i))return;if(i.classList.contains("psp-tree-label")){ho.call(this,r,t),t.stopImmediatePropagation();return}let a=i.getBoundingClientRect();if(i.classList.contains("psp-menu-enabled")&&t.clientY-a.top>16){let c=r.getMeta(i),u=c.column_header?.[c.column_header?.length-1],p=this._schema[u];if(this._open_column_styles_menu.unshift(c._virtual_x),p==="string")r.draw({preserve_width:!0}),Bt.call(this,r,i);else{let[m,_]=await this._view.get_min_max(u);r.draw({preserve_width:!0});let v=Math.max(Math.abs(m),Math.abs(_));v>1&&(v=Math.round(v*100)/100),Bt.call(this,r,i,v)}t.preventDefault(),t.stopImmediatePropagation()}else i.classList.contains("psp-header-leaf")&&!i.classList.contains("psp-header-corner")&&(Ar.call(this,r,t,i),t.stopImmediatePropagation())}function po(r,t){if(t.which!==1)return;let i=t.target;for(;i.tagName!=="TD"&&i.tagName!=="TH";)if(i=i.parentElement,!r.contains(i))return;(i.classList.contains("psp-tree-label")&&t.offsetX<26||i.classList.contains("psp-header-leaf")&&!i.classList.contains("psp-header-corner"))&&t.stopImmediatePropagation()}var Be={},Yt={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(r){return r?"check":"close"}}},Fr=Be;function jr(r,t,i={},a=!1){if(t===null)return"-";let c=r[r.length-1],u=a&&this._table_schema[c]||this._schema[c]||"string",p=i[c],m=u==="integer"||u==="float";if(m&&p?.number_fg_mode==="bar"){let _=Math.max(0,Math.min(.95,Math.abs(t/p.fg_gradient)*.95)),v=this._div_factory.get(),w=t>=0?"left":"right";return v.setAttribute("style",`width:${(_*100).toFixed(2)}%;position:absolute;${w}:0;height:80%;top:10%;pointer-events:none;`),v}else if(p?.format==="link"&&u==="string"){let _=document.createElement("a");return _.setAttribute("href",t),_.setAttribute("target","_blank"),_.textContent=t,_}else if(p?.format==="bold"&&u==="string"){let _=document.createElement("b");return _.textContent=t,_}else if(p?.format==="italics"&&u==="string"){let _=document.createElement("i");return _.textContent=t,_}else{let _=m&&p&&p.fixed!==void 0,v=_?`${u}${p.fixed}`:u;if(Be[v]===void 0){let w=(0,Pr.get_type_config)(u);if(_){let E={minimumFractionDigits:p.fixed,maximumFractionDigits:p.fixed};Be[v]=new Yt[u]("en-us",E)}else Yt[u]?Be[v]=new Yt[u]("en-us",w.format):Be[v]=!1}return Be[v]?Be[v].format(t):t}}function*go(r=[],t,i){let a=i[xe];for(let c of r){c=["TOTAL",...c];let u=c[c.length-1];c=c.slice(0,c.length-1).fill("");let p=jr.call(this,[t[c.length-1]],u,a,!0);p instanceof HTMLElement?c=c.concat(p):c=c.concat({toString:()=>p}),c.length=t.length+1,yield c}}function bo(){let r,t,i,a,c;return async function(p,m,_,v,w){let E={},C;v-m>0&&w-_>0?(this._is_old_viewport=this._last_window?.start_row===_&&this._last_window?.end_row===w&&this._last_window?.start_col===m&&this._last_window?.end_col===v,C={start_row:_,start_col:m,end_row:w,end_col:v,id:!0},E=await this._view.to_columns(C),this._last_window=C,this._ids=E.__ID__,this._reverse_columns=this._column_paths.slice(m,v).reduce((S,q,g)=>(S.set(q,g),S),new Map),this._reverse_ids=this._ids.reduce((S,q,g)=>(S.set(q?.join("|"),g),S),new Map)):this._div_factory.clear();let F=[],I=[],M=[],N=[];for(let S=m;S<Math.min(v,this._column_paths.length);++S){let q=this._column_paths[S],g=q.split("|"),Y=E[q]||new Array(w-_).fill(null);F.push(Y.map(de=>jr.call(this,g,de,p[xe]))),I.push(Y),M.push(g),N.push(q)}return v-m>0&&w-_>0&&(this.last_column_paths=t,this.last_meta=r,this.last_ids=i,this.last_reverse_ids=a,this.last_reverse_columns=c,t=N,r=I,i=this._ids,a=this._reverse_ids,c=this._reverse_columns),{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(go.call(this,E.__ROW_PATH__,this._config.group_by,p)),column_headers:M,data:F,metadata:I}}}function St(r,t,i){let a=window.getComputedStyle(r).getPropertyValue(t).trim();return a.length>0?a:i}var Rr=class{constructor(t){this._name=t,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let t=this._elements[this._index];return this._index+=1,t}};function Dr(r,t){return mt.default.mix(r,`rgb(${t[0]},${t[1]},${t[2]})`,.5).hex()}async function Xt(r,t,i,a={}){let c=await i.get_config(),u=c.expressions.map(Q=>Q[1]),[p,m,_,v,w,E]=await Promise.all([t.schema(),t.validate_expressions(u),i.num_rows(),i.schema(),i.expression_schema(),i.column_paths()]),C=(0,mt.default)(St(r,"--plugin--background","#FFFFFF")).rgb(),F=fe(St(r,"--rt-pos-cell--color","#338DCD")),I=fe(St(r,"--rt-neg-cell--color","#FF5942")),M=fe(Dr(F[0],C)),N=fe(Dr(I[0],C)),S=fe(St(r,"--active--color","#ff0000")),q={...v,...w},g={...p,...m.expression_schema},Y=E.filter(Q=>Q!=="__ROW_PATH__"&&Q!=="__ID__"),de=[],H=[];for(let Q of Y){let oe=Q.split("|"),se=oe[oe.length-1];H.push(q[se]),de.push(!!p[se])}let T=Object.assign(a,{_view:i,_table:t,_table_schema:g,_config:c,_num_rows:_,_schema:q,_ids:[],_open_column_styles_menu:[],_plugin_background:C,_color:S,_pos_fg_color:F,_neg_fg_color:I,_pos_bg_color:M,_neg_bg_color:N,_column_paths:Y,_column_types:H,_is_editable:de,_row_header_types:c.group_by.map(Q=>g[Q]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:Vt});return T._div_factory=T._div_factory||new Rr("div"),r.setDataListener(bo().bind(T,r),{virtual_mode:window.getComputedStyle(r).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),T}function Vt(r){return r.x>=0?this._column_types[r.x]:this._row_header_types[r.row_header_x-1]}async function Ir(r,t){r.addStyleListener(uo.bind(t,r)),r.addEventListener("mousedown",_o.bind(t,r)),r.addEventListener("click",po.bind(t,r))}var Tr=`regular-table{padding:0;margin:12px 0 0 12px;scrollbar-color:transparent transparent;scrollbar-width:thin;outline:none}regular-table:hover{scrollbar-color:rgba(0,0,0,.3) transparent}.sub-cell-scroll-enabled regular-table table tbody td,.sub-cell-scroll-enabled regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x, 0px))}.sub-cell-scroll-enabled regular-table table tbody{transform:translateY(var(--regular-table--transform-y, 0px))}.sub-cell-scroll-enabled regular-table table tbody tr:first-child td,.sub-cell-scroll-enabled regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y, 0),0 200%,200% 200%,200% var(--regular-table--clip-y, 0))}.sub-cell-scroll-enabled regular-table table thead th.rt-group-corner{background:var(--plugin--background, white);z-index:1}.sub-cell-scroll-enabled regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x, 0) 0,var(--regular-table--clip-x, 0) 200%,200% 200%,200% 0)}.sub-cell-scroll-enabled regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x, 0) var(--regular-table--clip-y, 0),var(--regular-table--clip-x, 0) 200%,200% 200%,200% var(--regular-table--clip-y, 0))}regular-table{font-family:inherit}regular-table div[tabindex]{outline:none}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden}regular-table th{text-align:center}regular-table thead tr:not(:last-child) th{overflow:hidden;max-width:0px}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right}regular-table tbody th{text-align:left}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left}regular-table thead tr:last-child th{border-bottom:1px solid #eaedef}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important}regular-table th{position:relative}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid #eee;height:100%}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding:0 5px;height:19px}regular-table tr:hover td{background:#eee;opacity:1}regular-table tr:hover{color:#333}regular-table table *{box-sizing:border-box}regular-table table{position:absolute;overflow:hidden;color:#666;outline:none}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family, "Material Icons")}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family, "Material Icons")}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px #1a7da1}regular-table .rt-selected td{background-color:#eee}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%}regular-table th span.rt-group-name{text-align:left}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize}regular-table a{color:var(--rt-pos-cell--color)}regular-table a:visited{color:var(--active--color)}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#0000;border-radius:5px}regular-table::-webkit-scrollbar-thumb:horizontal{border-bottom:2px solid transparent;border-top:2px solid transparent}regular-table::-webkit-scrollbar-thumb:vertical{border-left:2px solid transparent;border-right:2px solid transparent}regular-table:hover::-webkit-scrollbar-thumb{background-color:#00000026}regular-table::-webkit-scrollbar-thumb:hover{background-color:#0000004d}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0 var(--inactive--color, #eaedef)}.psp-header-group{box-shadow:0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-is-top{box-shadow:5px 4px 0 -4px var(--inactive--color, #eaedef)}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0 -4px var(--inactive--color, #eaedef),0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0 var(--inactive--color, #eaedef),0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0 -4px var(--inactive--color, #eaedef)}tr:only-child th{box-shadow:none!important}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--rt-hover--border-color, #c5c9d080)!important;background-color:transparent;box-shadow:0 1px 0 var(--rt-hover--border-color, #c5c9d080),0 3px #0000000d,0 5px #00000003}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:1px;border-right-color:transparent}regular-table tbody tr:hover{color:#161616}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color, #c5c9d080)!important}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color, #c5c9d080)!important}perspective-viewer[settings] regular-table .psp-header-leaf{height:36px;vertical-align:top;padding-top:2px}perspective-viewer[settings] regular-table .psp-header-leaf:not(.psp-header-corner):before{font-family:var(--button--font-family, inherit);content:var(--column-style-open-button--content, var(--config-button-icon--content, "\\1f527"));position:absolute;width:calc(100% - 8px);left:5px;bottom:0px;color:var(--inactive--color, #b4b7be)}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:not(.psp-header-corner):before{color:inherit;cursor:pointer}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner){pointer-events:none}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner):before{content:var(--column-style-close-button--content, "X")}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:hover:before{color:#338dcd}perspective-viewer[settings] regular-table .psp-header-leaf .rt-column-resize{height:18px}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:#fff!important;background-color:#ea7319!important;border-color:#ea7319!important}.psp-row-selected.psp-tree-label:not(:hover):before{color:#fff}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,.2)!important}.psp-error{color:red}td:focus{outline:#666;outline-style:dotted;outline-width:1px}perspective-viewer.dragging regular-table{pointer-events:none}.psp-header-border:last-child{border-right-width:0px}.psp-header-sort-desc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-desc--content, "\\2193")}.psp-header-sort-asc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-asc--content, "\\2191")}.psp-header-sort-col-desc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-col-desc--content, "\\2190")}.psp-header-sort-col-asc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-col-asc--content, "\\2192")}tbody th:last-of-type{border-right:1px solid #eaedef;overflow:hidden;text-overflow:ellipsis}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,#eee 10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none}.psp-tree-label{max-width:0px;min-width:0px}.psp-tree-label:before{color:#ccc;font-family:var(--button--font-family, inherit);padding-right:11px;vertical-align:-1px}.psp-tree-label-expand:before{content:var(--tree-label-expand--content, "+")}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content, "-")}.psp-tree-label:hover:before{color:#338dcd;text-shadow:0px 0px 5px #338dcd}regular-table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--color, #eaedef)}.psp-tree-leaf{padding-left:24px}.psp-align-right{text-align:right}.psp-align-left{text-align:left}.psp-positive:not(:focus){color:var(--rt-pos-cell--color, #338dcd)}.psp-negative:not(:focus){color:var(--rt-neg-cell--color, #ff5942)}regular-table table tbody td{min-width:52px!important}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed #999;border-bottom-width:0px;border-left-width:0px}.psp-bool-type{font-family:var(--button--font-family, "Material Icons")}.boolean-editable{cursor:pointer}regular-table table{user-select:none;color:#161616;border-collapse:separate}regular-table table th{font-weight:400}regular-table table td,regular-table table th{border-color:#eaedef;height:23px}regular-table table .psp-header-group{text-overflow:ellipsis}regular-table table .psp-header-leaf{border-bottom-width:0px}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px}regular-table table tbody th:empty{background-position:0px -10px}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start, rgba(0, 128, 255, .5))}to{background-color:var(--pulse--background-color-end, rgba(0, 128, 255, 0))}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start, rgba(0, 128, 255, .5))}to{background-color:var(--pulse--background-color-end, rgba(0, 128, 255, 0))}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start, rgba(255, 25, 0, .5))}to{background-color:var(--pulse--background-color-end, rgba(255, 25, 0, 0))}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start, rgba(255, 25, 0, .5))}to{background-color:var(--pulse--background-color-end, rgba(255, 25, 0, 0))}}
`;var Wr=`:host{position:relative;display:block}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0}:host #toolbar{display:flex;align-items:center;height:36px}:host #slot-container{flex:1;position:relative}#scroll_lock.lock-scroll:before{content:var(--toolbar-scroll-lock-active--content)}#scroll_lock:before{content:var(--toolbar-scroll-lock--content)}#select_mode:before{content:"highlight_alt"}#edit_mode:before{content:var(--toolbar-edit-mode--content)}#edit_mode.editable:before{content:var(--toolbar-edit-mode-active--content)}:host(.aggregated) #toolbar #edit_mode{display:none}.button:before{color:var(--inactive--color, #ccc);line-height:36px;font-size:14px;font-family:var(--button--font-family, "Material Icons Outlined");vertical-align:bottom;margin:0 11px}.button.editable:before,.button.lock-scroll:before{color:inherit}.button{user-select:none;width:36px;box-sizing:border-box}.button>span{display:none;margin:0;padding:0}.button:hover{opacity:1;display:flex;align-items:center;color:inherit;cursor:pointer;min-width:105px;background-color:#0000000d}.button:hover:before{margin:0 6px 0 11px}.button:hover>span{display:contents;font-size:12px;font-weight:300;line-height:36px}
`;async function vt({_view:r,_config:t},i,a){let c=t.group_by,u=t.split_by,p=i>=0?i:0,m=p+1,_=await r.to_json({start_row:p,end_row:m}),w=_.map(S=>S.__ROW_PATH__)[0]||[],E=c.map((S,q)=>{let g=w[q];return g?[S,"==",g]:void 0}).filter(S=>S),C=c.length>0?a+1:a,F=Object.keys(_[0])[C],I={row:_[0]},M=[];if(F){let S=F.split("|");I.column_names=[S[S.length-1]],M=u.map((q,g)=>{let Y=S[g];return Y?[q,"==",Y]:void 0}).filter(q=>q).filter(([,,q])=>q!=="__ROW_PATH__")}let N=t.filter.concat(E).concat(M);return I.config={filter:N},I}var Ve=new WeakMap;async function yo(r,t,i){let a=r.getMeta(i.target);if(!t.hasAttribute("selectable")||i.handled||i.which!==1||!a)return;let c=this._ids[a.y-a.y0];if(a&&a.y>=0){let u=Ve.get(r),p=!!u&&u.reduce((v,w,E)=>v&&w===c[E],!0),m=!!u&&c.length===u.length&&p,_=[];m?Ve.delete(r):(Ve.set(r,c),_=await vt(this,a.y,a.x),_=_.config.filter),await r.draw({preserve_width:!0}),i.handled=!0,t.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:{selected:!m,config:{filter:_}}}))}}function wo(r,t){if(!t.hasAttribute("selectable"))return;let i=Ve.has(r),a=Ve.get(r);for(let c of r.querySelectorAll("td"))if(!i)c.classList.toggle("psp-row-selected",!1),c.classList.toggle("psp-row-subselected",!1);else{let u=r.getMeta(c),p=this._ids[u.y-u.y0],m=a.reduce((_,v,w)=>_&&v===p[w],!0);c.classList.toggle("psp-row-selected",p.length===a.length&&m),c.classList.toggle("psp-row-subselected",p.length!==a.length&&m)}for(let c of r.querySelectorAll("tbody th")){let u=r.getMeta(c),p=this._ids[u.y-u.y0];if(!i||!!p[u.row_header_x])c.classList.toggle("psp-row-selected",!1),c.classList.toggle("psp-row-subselected",!1);else{let m=a.reduce((_,v,w)=>_&&v===p[w],!0);c.classList.toggle("psp-row-selected",p.length===a.length&&m),c.classList.toggle("psp-row-subselected",p.length!==a.length&&m)}}}function Hr(r,t){r.addStyleListener(wo.bind(this,r,t)),r.addEventListener("mousedown",yo.bind(this,r,t))}async function $r(r){Ve.delete(r);for(let t of r.querySelectorAll("td,th"))t.classList.toggle("psp-row-selected",!1),t.classList.toggle("psp-row-subselected",!1)}async function xo(r,t,i){let a=r.getMeta(i.target);if(!a)return;let{x:c,y:u}=a,{row:p,column_names:m,config:_}=await vt(this,u,c);t.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:p,column_names:m,config:_}}))}function qr(r,t){r.addEventListener("click",xo.bind(this,r,t))}var Ye=new WeakMap;function ko(r){let t;return async function(...i){if(!!t&&await t&&!!t)return;let a;t=new Promise(c=>a=c),await r.apply(this,i),t=void 0,a()}}function Gr(){if(this.isContentEditable){let r=document.getSelection().getRangeAt(0),t=r.cloneRange();return t.selectNodeContents(this),t.setEnd(r.endContainer,r.endOffset),t.toString().length}else return this.target.selectionStart}function Br(r,t,i){let a=r.getMeta(i),c=t._schema[t._column_paths[a.x]];if(a){let u=i.textContent,p=t._ids[a.y-a.y0];if(c==="float"||c==="integer"){if(u=parseFloat(u.replace(/,/g,"")),isNaN(u))return!1}else if(c==="date"||c==="datetime"){if(u=Date.parse(u),isNaN(u))return!1}else c==="boolean"&&(u=u==="check"?!1:u==="close"?!0:null);let m={__INDEX__:p,[t._column_paths[a.x]]:u};return t._table.update([m],{port_id:t._edit_port}),!0}}function yt(r,t=!1){let i=this._config.group_by.length===0&&this._config.split_by.length===0,a=r.hasAttribute("selectable"),c=t||!!r.children[0]._is_edit_mode;return i&&!a&&c}var Ue=ko(async function(r,t,i,a){let c=r.getMeta(t),u=this._column_paths.length,p=this._num_rows,m=Ye.get(r);if(!m)return;c.x+i<u&&0<=c.x+i&&(m.x=c.x+i),c.y+a<p&&0<=c.y+a&&(m.y=c.y+a);let _=Math.max(c.x0-10,0),v=Math.min(c.x0+10,u),w=Math.max(c.y0-5,0),E=Math.min(c.y0+10,p),C=c.x0+i,F=c.y0+a;for(;!Yr(r)&&C>=_&&C<v&&F>=w&&F<E;)await r.scrollToCell(C,F,u,p),Ye.set(r,m),C+=i,F+=a});function Lo(r,t){let i=r[xe]||{},a=yt.call(this,t);r.parentElement.classList.toggle("edit-mode-allowed",yt.call(this,t,!0));for(let c of r.querySelectorAll("td")){let u=r.getMeta(c),p=this.get_psp_type(u);if(a&&this._is_editable[u.x]){let m=u.column_header[u.column_header.length-1];p==="string"&&i[m]?.format==="link"?(c.toggleAttribute("contenteditable",!1),c.classList.toggle("boolean-editable",!1)):p==="boolean"?(c.toggleAttribute("contenteditable",!1),c.classList.toggle("boolean-editable",u.user!==null)):(a!==c.hasAttribute("contenteditable")&&c.toggleAttribute("contenteditable",a),c.classList.toggle("boolean-editable",!1))}else c.toggleAttribute("contenteditable",!1),c.classList.toggle("boolean-editable",!1)}}var Yr=r=>{let t=r.querySelectorAll("td"),i=Ye.get(r);if(i){for(let a of t){let c=r.getMeta(a);if(c.x===i.x&&c.y===i.y)return document.activeElement!==a&&a.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&r.contains(document.activeElement)&&document.activeElement.blur()}};function Mo(r,t,i){if(!yt.call(this,t))return;let a=document.activeElement;switch(i.target.classList.remove("psp-error"),i.keyCode){case 13:i.preventDefault(),i.shiftKey?Ue.call(this,r,a,0,-1):Ue.call(this,r,a,0,1);break;case 37:Gr.call(a)==0&&(i.preventDefault(),Ue.call(this,r,a,-1,0));break;case 38:i.preventDefault(),Ue.call(this,r,a,0,-1);break;case 39:Gr.call(a)==a.textContent.length&&(i.preventDefault(),Ue.call(this,r,a,1,0));break;case 40:i.preventDefault(),Ue.call(this,r,a,0,1);break;default:}}function zo(r,t,i){if(yt.call(this,t)&&Ye.has(r)){i.target.classList.remove("psp-error");let a=Ye.get(r);Ye.delete(r),a.content!==i.target.textContent&&(Br(r,this,i.target)||(i.target.textContent=a.content,i.target.classList.add("psp-error"),i.target.focus()))}}function Eo(r,t,i){let a=r.getMeta(i.target);if(a){let c={x:a.x,y:a.y,content:i.target.textContent};Ye.set(r,c)}}function Co(r,t,i){let a=r.getMeta(i.target);if(typeof a?.x!="undefined"){let c=yt.call(this,t),u=this._is_editable[a.x],p=this.get_psp_type(a)==="boolean",m=i.target.textContent==="-";c&&u&&p&&!m&&Br(r,this,i.target)}}async function Xr(r,t){this._edit_port=await t.getEditPort(),r.addStyleListener(Lo.bind(this,r,t)),r.addStyleListener(Yr.bind(this,r,t)),r.addEventListener("click",Co.bind(this,r,t)),r.addEventListener("focusin",Eo.bind(this,r,t)),r.addEventListener("focusout",zo.bind(this,r,t)),r.addEventListener("keydown",Mo.bind(this,r,t))}var Ut=class extends HTMLElement{constructor(){super();this.datagrid=document.createElement("regular-table"),this.datagrid.formatters=Fr,this._is_scroll_lock=!0}connectedCallback(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar"),this._toolbar.setAttribute("slot","plugin-settings"),this._toolbar.attachShadow({mode:"open"}),this._toolbar.shadowRoot.innerHTML=`
                <style>
                    ${Wr}
                </style>
                <div id="toolbar">
                    <span id="scroll_lock" class="lock-scroll button"><span>Align Scroll</span></span>
                    <span id="edit_mode" class="button"><span>Read Only</span></span>
                </div>
            `,this._scroll_lock=this._toolbar.shadowRoot.querySelector("#scroll_lock"),this._scroll_lock.addEventListener("click",()=>this._toggle_scroll_lock()),this._edit_mode=this._toolbar.shadowRoot.querySelector("#edit_mode"),this._edit_mode.addEventListener("click",()=>{this._toggle_edit_mode(),this.datagrid.draw(),this.parentElement.dispatchEvent(new Event("perspective-config-update"))})),this.parentElement.appendChild(this._toolbar)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}_toggle_edit_mode(t=void 0){typeof t=="undefined"&&(t=!this._is_edit_mode),this._is_edit_mode=t,this.classList.toggle("editable",t),this._edit_mode!==void 0&&(this._edit_mode.classList.toggle("editable",t),t?this._edit_mode.children[0].textContent="Editable":this._edit_mode.children[0].textContent="Read Only")}_toggle_scroll_lock(t=void 0){typeof t=="undefined"&&(t=!this._is_scroll_lock),this._is_scroll_lock=t,this.classList.toggle("sub-cell-scroll-enabled",!t),this._scroll_lock!==void 0&&(this._scroll_lock.classList.toggle("lock-scroll",t),t?this._scroll_lock.children[0].textContent="Align Scroll":this._scroll_lock.children[0].textContent="Free Scroll")}async activate(t){let i=this.parentElement,a=await i.getTable(!0);this._initialized?await Xt(this.datagrid,a,t,this.model):(this.innerHTML="",this.appendChild(this.datagrid),this.model=await Xt(this.datagrid,a,t),Ir(this.datagrid,this.model),await Hr.call(this.model,this.datagrid,i),await qr.call(this.model,this.datagrid,i),await Xr.call(this.model,this.datagrid,i),await Nr.call(this.model,this.datagrid,i),this._initialized=!0)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){}async draw(t){if(this.parentElement&&await this.activate(t),!this.isConnected||this.offsetParent==null)return;let i=this._save_column_size_overrides(),a=this.parentElement,c=this.datagrid.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.datagrid.scrollTop=0,this.datagrid.scrollLeft=0,$r(this.datagrid,a),this.datagrid._resetAutoSize()),this._restore_column_size_overrides(i),await c,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}async update(t){this.model._num_rows=await t.num_rows(),await this.datagrid.draw()}async resize(){!this.isConnected||this.offsetParent==null||this._initialized&&await this.datagrid.draw()}async clear(){this.datagrid._resetAutoSize(),this.datagrid.clear()}save(){if(this.datagrid){let t=this.datagrid,i={columns:{},scroll_lock:!!this._is_scroll_lock,editable:!!this._is_edit_mode};for(let c of Object.keys(t[xe]||{})){let u=Object.assign({},t[xe][c]);(u?.pos_fg_color||u?.pos_bg_color)&&(u.pos_fg_color=u.pos_fg_color?.[0],u.neg_fg_color=u.neg_fg_color?.[0],u.pos_bg_color=u.pos_bg_color?.[0],u.neg_bg_color=u.neg_bg_color?.[0]),u?.color&&(u.color=u.color[0]),i.columns[c]=u}let a=this._save_column_size_overrides();for(let c of Object.keys(a||{}))i.columns[c]||(i.columns[c]={}),i.columns[c].column_size_override=a[c];return JSON.parse(JSON.stringify(i))}return{}}restore(t){t=JSON.parse(JSON.stringify(t));let i={};if(t.columns)for(let c of Object.keys(t.columns)){let u=t.columns[c];u.column_size_override!==void 0&&(i[c]=u.column_size_override,delete u.column_size_override),u?.pos_fg_color&&(u.pos_fg_color=fe(u.pos_fg_color),u.neg_fg_color=fe(u.neg_fg_color)),u?.pos_bg_color&&(u.pos_bg_color=fe(u.pos_bg_color),u.neg_bg_color=fe(u.neg_bg_color)),u?.color&&(u.color=fe(u.color)),Object.keys(u).length===0&&delete t.columns[c]}"editable"in t&&this._toggle_edit_mode(t.editable),"scroll_lock"in t&&this._toggle_scroll_lock(t.scroll_lock);let a=this.datagrid;try{a._resetAutoSize()}catch{}this._restore_column_size_overrides(i,!0),a[xe]=t.columns}async restyle(t){this.draw(t)}delete(){this.datagrid.table_model&&this.datagrid._resetAutoSize(),this.datagrid.clear()}_save_column_size_overrides(){if(!this._initialized)return[];if(this._cached_column_sizes){let p=this._cached_column_sizes;return this._cached_column_sizes=void 0,p}let t=this.datagrid._column_sizes.override,{group_by:i,columns:a}=this.model._config,c=i?.length>0?i.length+1:0,u={};for(let p of Object.keys(t))if(t[p]!==void 0){let m=p-c;m>-1?u[this.model._column_paths[m]]=t[p]:m===-1&&(u.__ROW_PATH__=t[p])}return u}_restore_column_size_overrides(t,i=!1){if(!this._initialized)return;i&&(this._cached_column_sizes=t);let a={},{group_by:c,columns:u}=this.model._config,p=c?.length>0?c.length+1:0;for(let m of Object.keys(t))if(m==="__ROW_PATH__")a[p-1]=t[m];else{let _=this.model._column_paths.indexOf(m);a[_+p]=t[m]}this.datagrid._column_sizes.override=a}};customElements.define("perspective-viewer-datagrid",Ut);function No(){let r=document.createElement("style");r.textContent=Tr,document.head.insertBefore(r,document.head.firstChild)}function Ao(){customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}customElements.whenDefined("perspective-viewer").then(Ao);No();
/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */
/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
}));

//# sourceMappingURL=perspective-viewer-datagrid.js.map
