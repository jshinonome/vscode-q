(()=>{var Br=Object.create;var Ht=Object.defineProperty;var Yr=Object.getOwnPropertyDescriptor;var Xr=Object.getOwnPropertyNames;var Vr=Object.getPrototypeOf,Ur=Object.prototype.hasOwnProperty;var Kr=t=>Ht(t,"__esModule",{value:!0});var Tt=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports);var Jr=(t,o,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let a of Xr(o))!Ur.call(t,a)&&a!=="default"&&Ht(t,a,{get:()=>o[a],enumerable:!(n=Yr(o,a))||n.enumerable});return t},qt=t=>Jr(Kr(Ht(t!=null?Br(Vr(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Mr=Tt((Ci,Lr)=>{Lr.exports.default={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{week:"numeric",year:"numeric",month:"numeric",day:"numeric"},null_value:-1}}}});var Er=Tt((Ni,Pe)=>{var zr=Mr().default;Pe.exports.get_types=function(){return Object.keys(Pe.exports.get_config().types)};Pe.exports.get_type_config=function(t){let o={};if(Pe.exports.get_config().types[t]&&Object.assign(o,Pe.exports.get_config().types[t]),o.type){let n=Pe.exports.get_type_config(o.type);return Object.assign(n,o),n}else return o};function Bt(t){return t&&typeof t=="object"&&!Array.isArray(t)}function Ot(t,...o){if(!o.length)return t;let n=o.shift();if(Bt(t)&&Bt(n))for(let a in n)Bt(n[a])?(t[a]||Object.assign(t,{[a]:{}}),Ot(t[a],n[a])):Object.assign(t,{[a]:n[a]});return Ot(t,...o)}window.__PERSPECTIVE_CONFIG__=void 0;Pe.exports.override_config=function(t){window.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),window.__PERSPECTIVE_CONFIG__=Ot(zr,t)};Pe.exports.get_config=function(){return window.__PERSPECTIVE_CONFIG__||(window.__PERSPECTIVE_CONFIG__=Ot(zr,window.__TEMPLATE_CONFIG__||{})),window.__PERSPECTIVE_CONFIG__}});var Yt=Tt((pt,gt)=>{(function(){var t,o,n,a,c,u,p,y,_,v,x,E,S,D,q,z,C,R,Q,g,Y,se,j,W,re,oe,fe,le,Le,je,Me,Re,Oe,ie,Ie,Se,De,de,be,Fe,he,Te,me,ye,Ce,Je,Ne,_e,qe,xt,Jt,B,Zt,Qt,er,tr,ce,rr,ir,or,nr,sr,lr,ar,Pt,jt,Rt,cr,fr,dr,kt,Lt,ur,we,hr,Ze,ke,It,ee,te,We,Mt,zt,ze=[].slice;ee=function(){var e,r,i,s,l;for(e={},l="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),s=0,r=l.length;s<r;s++)i=l[s],e["[object "+i+"]"]=i.toLowerCase();return function(f){var d;return d=Object.prototype.toString.call(f),e[d]||"object"}}(),_e=function(e,r,i){return r==null&&(r=0),i==null&&(i=1),e<r&&(e=r),e>i&&(e=i),e},te=function(e){return e.length>=3?Array.prototype.slice.call(e):e[0]},Y=function(e){var r,i;for(e._clipped=!1,e._unclipped=e.slice(0),r=i=0;i<3;r=++i)r<3?((e[r]<0||e[r]>255)&&(e._clipped=!0),e[r]<0&&(e[r]=0),e[r]>255&&(e[r]=255)):r===3&&(e[r]<0&&(e[r]=0),e[r]>1&&(e[r]=1));return e._clipped||delete e._unclipped,e},a=Math.PI,we=Math.round,W=Math.cos,Le=Math.floor,ce=Math.pow,qe=Math.log,Ze=Math.sin,ke=Math.sqrt,D=Math.atan2,B=Math.max,S=Math.abs,p=a*2,c=a/3,o=a/180,u=180/a,g=function(){return arguments[0]instanceof t?arguments[0]:function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,arguments,function(){})},g.default=g,E=[],typeof gt!="undefined"&&gt!==null&&gt.exports!=null&&(gt.exports=g),typeof define=="function"&&define.amd?define([],function(){return g}):(ur=typeof pt!="undefined"&&pt!==null?pt:this,ur.chroma=g),g.version="1.4.1",x={},_=[],v=!1,t=function(){function e(){var r,i,s,l,f,d,h,b,w;for(d=this,i=[],b=0,l=arguments.length;b<l;b++)r=arguments[b],r!=null&&i.push(r);if(i.length>1&&(h=i[i.length-1]),x[h]!=null)d._rgb=Y(x[h](te(i.slice(0,-1))));else{for(v||(_=_.sort(function(L,F){return F.p-L.p}),v=!0),w=0,f=_.length;w<f&&(s=_[w],h=s.test.apply(s,i),!h);w++);h&&(d._rgb=Y(x[h].apply(x,i)))}d._rgb==null&&console.warn("unknown format: "+i),d._rgb==null&&(d._rgb=[0,0,0]),d._rgb.length===3&&d._rgb.push(1)}return e.prototype.toString=function(){return this.hex()},e}(),g._input=x;g.brewer=R={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var e,r;r=[];for(e in R)r.push(R[e.toLowerCase()]=R[e]);return r}(),We={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},g.colors=j=We,me=function(){var e,r,i,s,l,f,d,h,b;return r=te(arguments),l=r[0],e=r[1],i=r[2],h=(l+16)/116,d=isNaN(e)?h:h+e/500,b=isNaN(i)?h:h-i/200,h=n.Yn*ye(h),d=n.Xn*ye(d),b=n.Zn*ye(b),f=zt(3.2404542*d-1.5371385*h-.4985314*b),s=zt(-.969266*d+1.8760108*h+.041556*b),i=zt(.0556434*d-.2040259*h+1.0572252*b),[f,s,i,r.length>3?r[3]:1]},zt=function(e){return 255*(e<=.00304?12.92*e:1.055*ce(e,1/2.4)-.055)},ye=function(e){return e>n.t1?e*e*e:n.t2*(e-n.t0)},n={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Pt=function(){var e,r,i,s,l,f,d,h;return s=te(arguments),i=s[0],r=s[1],e=s[2],l=dr(i,r,e),f=l[0],d=l[1],h=l[2],[116*d-16,500*(f-d),200*(d-h)]},kt=function(e){return(e/=255)<=.04045?e/12.92:ce((e+.055)/1.055,2.4)},Mt=function(e){return e>n.t3?ce(e,1/3):e/n.t2+n.t0},dr=function(){var e,r,i,s,l,f,d;return s=te(arguments),i=s[0],r=s[1],e=s[2],i=kt(i),r=kt(r),e=kt(e),l=Mt((.4124564*i+.3575761*r+.1804375*e)/n.Xn),f=Mt((.2126729*i+.7151522*r+.072175*e)/n.Yn),d=Mt((.0193339*i+.119192*r+.9503041*e)/n.Zn),[l,f,d]},g.lab=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["lab"]),function(){})},x.lab=me,t.prototype.lab=function(){return Pt(this._rgb)},q=function(e){var r,i,s,l,f,d,h,b,w,L,F;return e=function(){var M,k,N;for(N=[],k=0,M=e.length;k<M;k++)l=e[k],N.push(g(l));return N}(),e.length===2?(w=function(){var M,k,N;for(N=[],k=0,M=e.length;k<M;k++)l=e[k],N.push(l.lab());return N}(),f=w[0],d=w[1],r=function(M){var k,N;return N=function(){var O,I;for(I=[],k=O=0;O<=2;k=++O)I.push(f[k]+M*(d[k]-f[k]));return I}(),g.lab.apply(g,N)}):e.length===3?(L=function(){var M,k,N;for(N=[],k=0,M=e.length;k<M;k++)l=e[k],N.push(l.lab());return N}(),f=L[0],d=L[1],h=L[2],r=function(M){var k,N;return N=function(){var O,I;for(I=[],k=O=0;O<=2;k=++O)I.push((1-M)*(1-M)*f[k]+2*(1-M)*M*d[k]+M*M*h[k]);return I}(),g.lab.apply(g,N)}):e.length===4?(F=function(){var M,k,N;for(N=[],k=0,M=e.length;k<M;k++)l=e[k],N.push(l.lab());return N}(),f=F[0],d=F[1],h=F[2],b=F[3],r=function(M){var k,N;return N=function(){var O,I;for(I=[],k=O=0;O<=2;k=++O)I.push((1-M)*(1-M)*(1-M)*f[k]+3*(1-M)*(1-M)*M*d[k]+3*(1-M)*M*M*h[k]+M*M*M*b[k]);return I}(),g.lab.apply(g,N)}):e.length===5&&(i=q(e.slice(0,3)),s=q(e.slice(2,5)),r=function(M){return M<.5?i(M*2):s((M-.5)*2)}),r},g.bezier=function(e){var r;return r=q(e),r.scale=function(){return g.scale(r)},r},g.cubehelix=function(e,r,i,s,l){var f,d,h;return e==null&&(e=300),r==null&&(r=-1.5),i==null&&(i=1),s==null&&(s=1),l==null&&(l=[0,1]),f=0,ee(l)==="array"?d=l[1]-l[0]:(d=0,l=[l,l]),h=function(b){var w,L,F,M,k,N,O,I,U;return w=p*((e+120)/360+r*b),O=ce(l[0]+d*b,s),N=f!==0?i[0]+b*f:i,L=N*O*(1-O)/2,M=W(w),U=Ze(w),I=O+L*(-.14861*M+1.78277*U),k=O+L*(-.29227*M-.90649*U),F=O+L*(1.97294*M),g(Y([I*255,k*255,F*255,1]))},h.start=function(b){return b==null?e:(e=b,h)},h.rotations=function(b){return b==null?r:(r=b,h)},h.gamma=function(b){return b==null?s:(s=b,h)},h.hue=function(b){return b==null?i:(i=b,ee(i)==="array"?(f=i[1]-i[0],f===0&&(i=i[1])):f=0,h)},h.lightness=function(b){return b==null?l:(ee(b)==="array"?(l=b,d=b[1]-b[0]):(l=[b,b],d=0),h)},h.scale=function(){return g.scale(h)},h.hue(i),h},g.random=function(){var e,r,i,s;for(r="0123456789abcdef",e="#",i=s=0;s<6;i=++s)e+=r.charAt(Le(Math.random()*16));return new t(e)},E=[],Se=function(e,r,i,s){var l,f,d,h;for(i==null&&(i=.5),s==null&&(s="rgb"),ee(e)!=="object"&&(e=g(e)),ee(r)!=="object"&&(r=g(r)),d=0,f=E.length;d<f;d++)if(l=E[d],s===l[0]){h=l[1](e,r,i,s);break}if(h==null)throw"color mode "+s+" is not supported";return h.alpha(e.alpha()+i*(r.alpha()-e.alpha()))},g.interpolate=Se,t.prototype.interpolate=function(e,r,i){return Se(this,e,r,i)},g.mix=Se,t.prototype.mix=t.prototype.interpolate,x.rgb=function(){var e,r,i,s;r=te(arguments),i=[];for(e in r)s=r[e],i.push(s);return i},g.rgb=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["rgb"]),function(){})},t.prototype.rgb=function(e){return e==null&&(e=!0),e?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},t.prototype.rgba=function(e){return e==null&&(e=!0),e?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},_.push({p:3,test:function(e){var r;if(r=te(arguments),ee(r)==="array"&&r.length===3||r.length===4&&ee(r[3])==="number"&&r[3]>=0&&r[3]<=1)return"rgb"}}),x.lrgb=x.rgb,be=function(e,r,i,s){var l,f;return l=e._rgb,f=r._rgb,new t(ke(ce(l[0],2)*(1-i)+ce(f[0],2)*i),ke(ce(l[1],2)*(1-i)+ce(f[1],2)*i),ke(ce(l[2],2)*(1-i)+ce(f[2],2)*i),s)},y=function(e){var r,i,s,l,f,d;for(i=1/e.length,d=[0,0,0,0],l=0,s=e.length;l<s;l++)r=e[l],f=r._rgb,d[0]+=ce(f[0],2)*i,d[1]+=ce(f[1],2)*i,d[2]+=ce(f[2],2)*i,d[3]+=f[3]*i;return d[0]=ke(d[0]),d[1]=ke(d[1]),d[2]=ke(d[2]),d[3]>1&&(d[3]=1),new t(Y(d))},E.push(["lrgb",be]),g.average=function(e,r){var i,s,l,f,d,h,b,w,L,F,M,k,N;if(r==null&&(r="rgb"),L=e.length,e=e.map(function(O){return g(O)}),b=e.splice(0,1)[0],r==="lrgb")return y(e);k=b.get(r),f=[],d=0,h=0;for(w in k)k[w]=k[w]||0,f.push(isNaN(k[w])?0:1),r.charAt(w)==="h"&&!isNaN(k[w])&&(i=k[w]/180*a,d+=W(i),h+=Ze(i));for(s=b.alpha(),M=0,F=e.length;M<F;M++){l=e[M],N=l.get(r),s+=l.alpha();for(w in k)isNaN(N[w])||(f[w]+=1,r.charAt(w)==="h"?(i=N[w]/180*a,d+=W(i),h+=Ze(i)):k[w]+=N[w])}for(w in k)if(r.charAt(w)==="h"){for(i=D(h/f[w],d/f[w])/a*180;i<0;)i+=360;for(;i>=360;)i-=360;k[w]=i}else k[w]=k[w]/f[w];return g(k,r).alpha(s/L)},Me=function(e){var r,i,s,l,f,d;if(e.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(e.length===4||e.length===7)&&(e=e.substr(1)),e.length===3&&(e=e.split(""),e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),d=parseInt(e,16),l=d>>16,s=d>>8&255,i=d&255,[l,s,i,1];if(e.match(/^#?([A-Fa-f0-9]{8})$/))return e.length===9&&(e=e.substr(1)),d=parseInt(e,16),l=d>>24&255,s=d>>16&255,i=d>>8&255,r=we((d&255)/255*100)/100,[l,s,i,r];if(x.css!=null&&(f=x.css(e)))return f;throw"unknown color: "+e},nr=function(e,r){var i,s,l,f,d,h,b;return r==null&&(r="auto"),d=e[0],l=e[1],s=e[2],i=e[3],r==="auto"&&(r=i<1?"rgba":"rgb"),d=Math.round(d),l=Math.round(l),s=Math.round(s),b=d<<16|l<<8|s,h="000000"+b.toString(16),h=h.substr(h.length-6),f="0"+we(i*255).toString(16),f=f.substr(f.length-2),"#"+function(){switch(r.toLowerCase()){case"rgba":return h+f;case"argb":return f+h;default:return h}}()},x.hex=function(e){return Me(e)},g.hex=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["hex"]),function(){})},t.prototype.hex=function(e){return e==null&&(e="auto"),nr(this._rgb,e)},_.push({p:4,test:function(e){if(arguments.length===1&&ee(e)==="string")return"hex"}}),ie=function(){var e,r,i,s,l,f,d,h,b,w,L,F,M,k;if(e=te(arguments),l=e[0],L=e[1],d=e[2],L===0)b=s=r=d*255;else{for(k=[0,0,0],i=[0,0,0],M=d<.5?d*(1+L):d+L-d*L,F=2*d-M,l/=360,k[0]=l+1/3,k[1]=l,k[2]=l-1/3,f=h=0;h<=2;f=++h)k[f]<0&&(k[f]+=1),k[f]>1&&(k[f]-=1),6*k[f]<1?i[f]=F+(M-F)*6*k[f]:2*k[f]<1?i[f]=M:3*k[f]<2?i[f]=F+(M-F)*(2/3-k[f])*6:i[f]=F;w=[we(i[0]*255),we(i[1]*255),we(i[2]*255)],b=w[0],s=w[1],r=w[2]}return e.length>3?[b,s,r,e[3]]:[b,s,r]},lr=function(e,r,i){var s,l,f,d,h;return e!==void 0&&e.length>=3&&(d=e,e=d[0],r=d[1],i=d[2]),e/=255,r/=255,i/=255,f=Math.min(e,r,i),B=Math.max(e,r,i),l=(B+f)/2,B===f?(h=0,s=Number.NaN):h=l<.5?(B-f)/(B+f):(B-f)/(2-B-f),e===B?s=(r-i)/(B-f):r===B?s=2+(i-e)/(B-f):i===B&&(s=4+(e-r)/(B-f)),s*=60,s<0&&(s+=360),[s,h,l]},g.hsl=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["hsl"]),function(){})},x.hsl=ie,t.prototype.hsl=function(){return lr(this._rgb)},Ie=function(){var e,r,i,s,l,f,d,h,b,w,L,F,M,k,N,O,I,U;if(e=te(arguments),l=e[0],O=e[1],U=e[2],U*=255,O===0)b=s=r=U;else switch(l===360&&(l=0),l>360&&(l-=360),l<0&&(l+=360),l/=60,f=Le(l),i=l-f,d=U*(1-O),h=U*(1-O*i),I=U*(1-O*(1-i)),f){case 0:w=[U,I,d],b=w[0],s=w[1],r=w[2];break;case 1:L=[h,U,d],b=L[0],s=L[1],r=L[2];break;case 2:F=[d,U,I],b=F[0],s=F[1],r=F[2];break;case 3:M=[d,h,U],b=M[0],s=M[1],r=M[2];break;case 4:k=[I,d,U],b=k[0],s=k[1],r=k[2];break;case 5:N=[U,d,h],b=N[0],s=N[1],r=N[2]}return[b,s,r,e.length>3?e[3]:1]},ar=function(){var e,r,i,s,l,f,d,h,b;return d=te(arguments),f=d[0],i=d[1],e=d[2],l=Math.min(f,i,e),B=Math.max(f,i,e),r=B-l,b=B/255,B===0?(s=Number.NaN,h=0):(h=r/B,f===B&&(s=(i-e)/r),i===B&&(s=2+(e-f)/r),e===B&&(s=4+(f-i)/r),s*=60,s<0&&(s+=360)),[s,h,b]},g.hsv=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["hsv"]),function(){})},x.hsv=Ie,t.prototype.hsv=function(){return ar(this._rgb)},er=function(e){var r,i,s;return ee(e)==="number"&&e>=0&&e<=16777215?(s=e>>16,i=e>>8&255,r=e&255,[s,i,r,1]):(console.warn("unknown num color: "+e),[0,0,0,1])},cr=function(){var e,r,i,s;return s=te(arguments),i=s[0],r=s[1],e=s[2],(i<<16)+(r<<8)+e},g.num=function(e){return new t(e,"num")},t.prototype.num=function(e){return e==null&&(e="rgb"),cr(this._rgb,e)},x.num=er,_.push({p:1,test:function(e){if(arguments.length===1&&ee(e)==="number"&&e>=0&&e<=16777215)return"num"}}),je=function(){var e,r,i,s,l,f,d,h,b,w,L,F,M,k,N,O,I,U,ne,P;if(i=te(arguments),h=i[0],l=i[1],r=i[2],l=l/100,d=d/100*255,e=l*255,l===0)F=d=s=r;else switch(h===360&&(h=0),h>360&&(h-=360),h<0&&(h+=360),h/=60,b=Le(h),f=h-b,w=r*(1-l),L=w+e*(1-f),ne=w+e*f,P=w+e,b){case 0:M=[P,ne,w],F=M[0],d=M[1],s=M[2];break;case 1:k=[L,P,w],F=k[0],d=k[1],s=k[2];break;case 2:N=[w,P,ne],F=N[0],d=N[1],s=N[2];break;case 3:O=[w,L,P],F=O[0],d=O[1],s=O[2];break;case 4:I=[ne,w,P],F=I[0],d=I[1],s=I[2];break;case 5:U=[P,w,L],F=U[0],d=U[1],s=U[2]}return[F,d,s,i.length>3?i[3]:1]},or=function(){var e,r,i,s,l,f,d,h,b;return b=te(arguments),h=b[0],l=b[1],r=b[2],d=Math.min(h,l,r),B=Math.max(h,l,r),s=B-d,i=s*100/255,e=d/(255-s)*100,s===0?f=Number.NaN:(h===B&&(f=(l-r)/s),l===B&&(f=2+(r-h)/s),r===B&&(f=4+(h-l)/s),f*=60,f<0&&(f+=360)),[f,i,e]},g.hcg=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["hcg"]),function(){})},x.hcg=je,t.prototype.hcg=function(){return or(this._rgb)},re=function(e){var r,i,s,l,f,d,h,b;if(e=e.toLowerCase(),g.colors!=null&&g.colors[e])return Me(g.colors[e]);if(f=e.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(h=f.slice(1,4),l=d=0;d<=2;l=++d)h[l]=+h[l];h[3]=1}else if(f=e.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(h=f.slice(1,5),l=b=0;b<=3;l=++b)h[l]=+h[l];else if(f=e.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(h=f.slice(1,4),l=r=0;r<=2;l=++r)h[l]=we(h[l]*2.55);h[3]=1}else if(f=e.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(h=f.slice(1,5),l=i=0;i<=2;l=++i)h[l]=we(h[l]*2.55);h[3]=+h[3]}else(f=e.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(s=f.slice(1,4),s[1]*=.01,s[2]*=.01,h=ie(s),h[3]=1):(f=e.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(s=f.slice(1,4),s[1]*=.01,s[2]*=.01,h=ie(s),h[3]=+f[4]);return h},ir=function(e){var r;if(r=e[3]<1?"rgba":"rgb",r==="rgb")return r+"("+e.slice(0,3).map(we).join(",")+")";if(r==="rgba")return r+"("+e.slice(0,3).map(we).join(",")+","+e[3]+")"},Lt=function(e){return we(e*100)/100},Oe=function(e,r){var i;return i=r<1?"hsla":"hsl",e[0]=Lt(e[0]||0),e[1]=Lt(e[1]*100)+"%",e[2]=Lt(e[2]*100)+"%",i==="hsla"&&(e[3]=r),i+"("+e.join(",")+")"},x.css=function(e){return re(e)},g.css=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["css"]),function(){})},t.prototype.css=function(e){if(e==null&&(e="rgb"),e.slice(0,3)==="rgb")return ir(this._rgb);if(e.slice(0,3)==="hsl")return Oe(this.hsl(),this.alpha())},x.named=function(e){return Me(We[e])},_.push({p:5,test:function(e){if(arguments.length===1&&We[e]!=null)return"named"}}),t.prototype.name=function(e){var r,i;arguments.length&&(We[e]&&(this._rgb=Me(We[e])),this._rgb[3]=1),r=this.hex("rgb");for(i in We)if(r===We[i])return i;return r},Ce=function(){var e,r,i,s;return s=te(arguments),i=s[0],e=s[1],r=s[2],r=r*o,[i,W(r)*e,Ze(r)*e]},Je=function(){var e,r,i,s,l,f,d,h,b,w,L;return i=te(arguments),h=i[0],l=i[1],d=i[2],w=Ce(h,l,d),e=w[0],r=w[1],s=w[2],L=me(e,r,s),b=L[0],f=L[1],s=L[2],[b,f,s,i.length>3?i[3]:1]},Te=function(){var e,r,i,s,l,f;return f=te(arguments),l=f[0],e=f[1],r=f[2],i=ke(e*e+r*r),s=(D(r,e)*u+360)%360,we(i*1e4)===0&&(s=Number.NaN),[l,i,s]},jt=function(){var e,r,i,s,l,f,d;return f=te(arguments),l=f[0],i=f[1],r=f[2],d=Pt(l,i,r),s=d[0],e=d[1],r=d[2],Te(s,e,r)},g.lch=function(){var e;return e=te(arguments),new t(e,"lch")},g.hcl=function(){var e;return e=te(arguments),new t(e,"hcl")},x.lch=Je,x.hcl=function(){var e,r,i,s;return s=te(arguments),r=s[0],e=s[1],i=s[2],Je([i,e,r])},t.prototype.lch=function(){return jt(this._rgb)},t.prototype.hcl=function(){return jt(this._rgb).reverse()},rr=function(e){var r,i,s,l,f,d,h,b,w;return e==null&&(e="rgb"),b=te(arguments),h=b[0],l=b[1],r=b[2],h=h/255,l=l/255,r=r/255,f=1-Math.max(h,Math.max(l,r)),s=f<1?1/(1-f):0,i=(1-h-f)*s,d=(1-l-f)*s,w=(1-r-f)*s,[i,d,w,f]},se=function(){var e,r,i,s,l,f,d,h,b;return r=te(arguments),s=r[0],d=r[1],b=r[2],f=r[3],e=r.length>4?r[4]:1,f===1?[0,0,0,e]:(h=s>=1?0:255*(1-s)*(1-f),l=d>=1?0:255*(1-d)*(1-f),i=b>=1?0:255*(1-b)*(1-f),[h,l,i,e])},x.cmyk=function(){return se(te(arguments))},g.cmyk=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["cmyk"]),function(){})},t.prototype.cmyk=function(){return rr(this._rgb)},x.gl=function(){var e,r,i,s,l;for(s=function(){var f,d;f=te(arguments),d=[];for(r in f)l=f[r],d.push(l);return d}.apply(this,arguments),e=i=0;i<=2;e=++i)s[e]*=255;return s},g.gl=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["gl"]),function(){})},t.prototype.gl=function(){var e;return e=this._rgb,[e[0]/255,e[1]/255,e[2]/255,e[3]]},Rt=function(e,r,i){var s;return s=te(arguments),e=s[0],r=s[1],i=s[2],e=xt(e),r=xt(r),i=xt(i),.2126*e+.7152*r+.0722*i},xt=function(e){return e/=255,e<=.03928?e/12.92:ce((e+.055)/1.055,2.4)},he=function(e,r,i,s){var l,f;return l=e._rgb,f=r._rgb,new t(l[0]+i*(f[0]-l[0]),l[1]+i*(f[1]-l[1]),l[2]+i*(f[2]-l[2]),s)},E.push(["rgb",he]),t.prototype.luminance=function(e,r){var i,s,l,f,d;return r==null&&(r="rgb"),arguments.length?(f=this._rgb,e===0?f=[0,0,0,this._rgb[3]]:e===1?f=[255,255,255,this[3]]:(i=Rt(this._rgb),s=1e-7,l=20,d=function(h,b){var w,L;return L=h.interpolate(b,.5,r),w=L.luminance(),Math.abs(e-w)<s||!l--?L:w>e?d(h,L):d(L,b)},i>e?f=d(g("black"),this).rgba():f=d(this,g("white")).rgba()),g(f).alpha(this.alpha())):Rt(this._rgb)},It=function(e){var r,i,s,l;return l=e/100,l<66?(s=255,i=-155.25485562709179-.44596950469579133*(i=l-2)+104.49216199393888*qe(i),r=l<20?0:-254.76935184120902+.8274096064007395*(r=l-10)+115.67994401066147*qe(r)):(s=351.97690566805693+.114206453784165*(s=l-55)-40.25366309332127*qe(s),i=325.4494125711974+.07943456536662342*(i=l-50)-28.0852963507957*qe(i),r=255),[s,i,r]},fr=function(){var e,r,i,s,l,f,d,h,b;for(d=te(arguments),f=d[0],i=d[1],e=d[2],l=1e3,s=4e4,r=.4;s-l>r;)b=(s+l)*.5,h=It(b),h[2]/h[0]>=e/f?s=b:l=b;return we(b)},g.temperature=g.kelvin=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["temperature"]),function(){})},x.temperature=x.kelvin=x.K=It,t.prototype.temperature=function(){return fr(this._rgb)},t.prototype.kelvin=t.prototype.temperature,g.contrast=function(e,r){var i,s,l,f;return((l=ee(e))==="string"||l==="number")&&(e=new t(e)),((f=ee(r))==="string"||f==="number")&&(r=new t(r)),i=e.luminance(),s=r.luminance(),i>s?(i+.05)/(s+.05):(s+.05)/(i+.05)},g.distance=function(e,r,i){var s,l,f,d,h,b,w;i==null&&(i="lab"),((h=ee(e))==="string"||h==="number")&&(e=new t(e)),((b=ee(r))==="string"||b==="number")&&(r=new t(r)),f=e.get(i),d=r.get(i),w=0;for(l in f)s=(f[l]||0)-(d[l]||0),w+=s*s;return Math.sqrt(w)},g.deltaE=function(e,r,i,s){var l,f,d,h,b,w,L,F,M,k,N,O,I,U,ne,P,Ee,xe,G,K,pe,m,A,T,$,H,X;for(i==null&&(i=1),s==null&&(s=1),((Ee=ee(e))==="string"||Ee==="number")&&(e=new t(e)),((xe=ee(r))==="string"||xe==="number")&&(r=new t(r)),G=e.lab(),l=G[0],d=G[1],b=G[2],K=r.lab(),f=K[0],h=K[1],w=K[2],L=ke(d*d+b*b),F=ke(h*h+w*w),A=l<16?.511:.040975*l/(1+.01765*l),pe=.0638*L/(1+.0131*L)+.638,P=L<1e-6?0:D(b,d)*180/a;P<0;)P+=360;for(;P>=360;)P-=360;return T=P>=164&&P<=345?.56+S(.2*W(a*(P+168)/180)):.36+S(.4*W(a*(P+35)/180)),M=L*L*L*L,ne=ke(M/(M+1900)),m=pe*(ne*T+1-ne),U=l-f,I=L-F,N=d-h,O=b-w,k=N*N+O*O-I*I,$=U/(i*A),H=I/(s*pe),X=m,ke($*$+H*H+k/(X*X))},t.prototype.get=function(e){var r,i,s,l,f,d;return s=this,f=e.split("."),l=f[0],r=f[1],d=s[l](),r?(i=l.indexOf(r),i>-1?d[i]:console.warn("unknown channel "+r+" in mode "+l)):d},t.prototype.set=function(e,r){var i,s,l,f,d,h;if(l=this,d=e.split("."),f=d[0],i=d[1],i)if(h=l[f](),s=f.indexOf(i),s>-1)if(ee(r)==="string")switch(r.charAt(0)){case"+":h[s]+=+r;break;case"-":h[s]+=+r;break;case"*":h[s]*=+r.substr(1);break;case"/":h[s]/=+r.substr(1);break;default:h[s]=+r}else h[s]=r;else console.warn("unknown channel "+i+" in mode "+f);else h=r;return g(h,f).alpha(l.alpha())},t.prototype.clipped=function(){return this._rgb._clipped||!1},t.prototype.alpha=function(e){return arguments.length?g.rgb([this._rgb[0],this._rgb[1],this._rgb[2],e]):this._rgb[3]},t.prototype.darken=function(e){var r,i;return e==null&&(e=1),i=this,r=i.lab(),r[0]-=n.Kn*e,g.lab(r).alpha(i.alpha())},t.prototype.brighten=function(e){return e==null&&(e=1),this.darken(-e)},t.prototype.darker=t.prototype.darken,t.prototype.brighter=t.prototype.brighten,t.prototype.saturate=function(e){var r,i;return e==null&&(e=1),i=this,r=i.lch(),r[1]+=e*n.Kn,r[1]<0&&(r[1]=0),g.lch(r).alpha(i.alpha())},t.prototype.desaturate=function(e){return e==null&&(e=1),this.saturate(-e)},t.prototype.premultiply=function(){var e,r;return r=this.rgb(),e=this.alpha(),g(r[0]*e,r[1]*e,r[2]*e,e)},z=function(e,r,i){if(!z[i])throw"unknown blend mode "+i;return z[i](e,r)},C=function(e){return function(r,i){var s,l;return s=g(i).rgb(),l=g(r).rgb(),g(e(s,l),"rgb")}},le=function(e){return function(r,i){var s,l,f;for(f=[],s=l=0;l<=3;s=++l)f[s]=e(r[s],i[s]);return f}},Qt=function(e,r){return e},Zt=function(e,r){return e*r/255},oe=function(e,r){return e>r?r:e},Ne=function(e,r){return e>r?e:r},hr=function(e,r){return 255*(1-(1-e/255)*(1-r/255))},tr=function(e,r){return r<128?2*e*r/255:255*(1-2*(1-e/255)*(1-r/255))},Q=function(e,r){return 255*(1-(1-r/255)/(e/255))},fe=function(e,r){return e===255||(e=255*(r/255)/(1-e/255),e>255)?255:e},z.normal=C(le(Qt)),z.multiply=C(le(Zt)),z.screen=C(le(hr)),z.overlay=C(le(tr)),z.darken=C(le(oe)),z.lighten=C(le(Ne)),z.dodge=C(le(fe)),z.burn=C(le(Q)),g.blend=z,g.analyze=function(e){var r,i,s,l;for(s={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},i=0,r=e.length;i<r;i++)l=e[i],l!=null&&!isNaN(l)&&(s.values.push(l),s.sum+=l,l<s.min&&(s.min=l),l>s.max&&(s.max=l),s.count+=1);return s.domain=[s.min,s.max],s.limits=function(f,d){return g.limits(s,f,d)},s},g.scale=function(e,r){var i,s,l,f,d,h,b,w,L,F,M,k,N,O,I,U,ne,P,Ee,xe,G,K,pe;return F="rgb",M=g("#ccc"),I=0,h=!1,d=[0,1],O=[],N=[0,0],i=!1,l=[],k=!1,L=0,w=1,f=!1,s={},U=!0,b=1,K=function(m){var A,T,$,H,X,Z;if(m==null&&(m=["#fff","#000"]),m!=null&&ee(m)==="string"&&g.brewer!=null&&(m=g.brewer[m]||g.brewer[m.toLowerCase()]||m),ee(m)==="array"){for(m.length===1&&(m=[m[0],m[0]]),m=m.slice(0),A=$=0,H=m.length-1;0<=H?$<=H:$>=H;A=0<=H?++$:--$)T=m[A],ee(T)==="string"&&(m[A]=g(T));for(O.length=0,A=Z=0,X=m.length-1;0<=X?Z<=X:Z>=X;A=0<=X?++Z:--Z)O.push(A/(m.length-1))}return G(),l=m},Ee=function(m){var A,T;if(i!=null){for(T=i.length-1,A=0;A<T&&m>=i[A];)A++;return A-1}return 0},pe=function(m){return m},ne=function(m){var A,T,$,H,X;return X=m,i.length>2&&(H=i.length-1,A=Ee(m),$=i[0]+(i[1]-i[0])*(0+I*.5),T=i[H-1]+(i[H]-i[H-1])*(1-I*.5),X=L+(i[A]+(i[A+1]-i[A])*.5-$)/(T-$)*(w-L)),X},xe=function(m,A){var T,$,H,X,Z,J,ae,V;if(A==null&&(A=!1),isNaN(m)||m===null)return M;if(A?V=m:i&&i.length>2?(T=Ee(m),V=T/(i.length-2)):w!==L?V=(m-L)/(w-L):V=1,A||(V=pe(V)),b!==1&&(V=ce(V,b)),V=N[0]+V*(1-N[0]-N[1]),V=Math.min(1,Math.max(0,V)),X=Math.floor(V*1e4),U&&s[X])$=s[X];else{if(ee(l)==="array")for(H=Z=0,ae=O.length-1;0<=ae?Z<=ae:Z>=ae;H=0<=ae?++Z:--Z){if(J=O[H],V<=J){$=l[H];break}if(V>=J&&H===O.length-1){$=l[H];break}if(V>J&&V<O[H+1]){V=(V-J)/(O[H+1]-J),$=g.interpolate(l[H],l[H+1],V,F);break}}else ee(l)==="function"&&($=l(V));U&&(s[X]=$)}return $},G=function(){return s={}},K(e),P=function(m){var A;return A=g(xe(m)),k&&A[k]?A[k]():A},P.classes=function(m){var A;return m!=null?(ee(m)==="array"?(i=m,d=[m[0],m[m.length-1]]):(A=g.analyze(d),m===0?i=[A.min,A.max]:i=g.limits(A,"e",m)),P):i},P.domain=function(m){var A,T,$,H,X,Z,J;if(!arguments.length)return d;if(L=m[0],w=m[m.length-1],O=[],$=l.length,m.length===$&&L!==w)for(X=0,H=m.length;X<H;X++)T=m[X],O.push((T-L)/(w-L));else for(A=J=0,Z=$-1;0<=Z?J<=Z:J>=Z;A=0<=Z?++J:--J)O.push(A/($-1));return d=[L,w],P},P.mode=function(m){return arguments.length?(F=m,G(),P):F},P.range=function(m,A){return K(m,A),P},P.out=function(m){return k=m,P},P.spread=function(m){return arguments.length?(I=m,P):I},P.correctLightness=function(m){return m==null&&(m=!0),f=m,G(),f?pe=function(A){var T,$,H,X,Z,J,ae,V,ue;for(T=xe(0,!0).lab()[0],$=xe(1,!0).lab()[0],ae=T>$,H=xe(A,!0).lab()[0],Z=T+($-T)*A,X=H-Z,V=0,ue=1,J=20;Math.abs(X)>.01&&J-- >0;)(function(){return ae&&(X*=-1),X<0?(V=A,A+=(ue-A)*.5):(ue=A,A+=(V-A)*.5),H=xe(A,!0).lab()[0],X=H-Z})();return A}:pe=function(A){return A},P},P.padding=function(m){return m!=null?(ee(m)==="number"&&(m=[m,m]),N=m,P):N},P.colors=function(m,A){var T,$,H,X,Z,J,ae,V,ue;if(arguments.length<2&&(A="hex"),J=[],arguments.length===0)J=l.slice(0);else if(m===1)J=[P(.5)];else if(m>1)$=d[0],T=d[1]-$,J=function(){ae=[];for(var ge=0;0<=m?ge<m:ge>m;0<=m?ge++:ge--)ae.push(ge);return ae}.apply(this).map(function(ge){return P($+ge/(m-1)*T)});else{if(e=[],V=[],i&&i.length>2)for(H=ue=1,Z=i.length;1<=Z?ue<Z:ue>Z;H=1<=Z?++ue:--ue)V.push((i[H-1]+i[H])*.5);else V=d;J=V.map(function(ge){return P(ge)})}return g[A]&&(J=J.map(function(ge){return ge[A]()})),J},P.cache=function(m){return m!=null?(U=m,P):U},P.gamma=function(m){return m!=null?(b=m,P):b},P.nodata=function(m){return m!=null?(M=g(m),P):M},P},g.scales==null&&(g.scales={}),g.scales.cool=function(){return g.scale([g.hsl(180,1,.9),g.hsl(250,.7,.4)])},g.scales.hot=function(){return g.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},g.analyze=function(e,r,i){var s,l,f,d,h,b,w;if(h={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},i==null&&(i=function(){return!0}),s=function(L){L!=null&&!isNaN(L)&&(h.values.push(L),h.sum+=L,L<h.min&&(h.min=L),L>h.max&&(h.max=L),h.count+=1)},w=function(L,F){if(i(L,F))return r!=null&&ee(r)==="function"?s(r(L)):r!=null&&ee(r)==="string"||ee(r)==="number"?s(L[r]):s(L)},ee(e)==="array")for(d=0,f=e.length;d<f;d++)b=e[d],w(b);else for(l in e)b=e[l],w(b,l);return h.domain=[h.min,h.max],h.limits=function(L,F){return g.limits(h,L,F)},h},g.limits=function(e,r,i){var s,l,f,d,h,b,w,L,F,M,k,N,O,I,U,ne,P,Ee,xe,G,K,pe,m,A,T,$,H,X,Z,J,ae,V,ue,ge,Qe,et,tt,rt,it,ot,_r,nt,st,lt,at,ct,ft,dt,ut,ht,$r,He,Et,pr,Ae,_t;if(r==null&&(r="equal"),i==null&&(i=7),ee(e)==="array"&&(e=g.analyze(e)),T=e.min,B=e.max,$r=e.sum,Ae=e.values.sort(function(Dt,Wt){return Dt-Wt}),i===1)return[T,B];if(m=[],r.substr(0,1)==="c"&&(m.push(T),m.push(B)),r.substr(0,1)==="e"){for(m.push(T),G=ae=1,Qe=i-1;1<=Qe?ae<=Qe:ae>=Qe;G=1<=Qe?++ae:--ae)m.push(T+G/i*(B-T));m.push(B)}else if(r.substr(0,1)==="l"){if(T<=0)throw"Logarithmic scales are only possible for values > 0";for($=Math.LOG10E*qe(T),A=Math.LOG10E*qe(B),m.push(T),G=_t=1,et=i-1;1<=et?_t<=et:_t>=et;G=1<=et?++_t:--_t)m.push(ce(10,$+G/i*(A-$)));m.push(B)}else if(r.substr(0,1)==="q"){for(m.push(T),G=s=1,nt=i-1;1<=nt?s<=nt:s>=nt;G=1<=nt?++s:--s)V=(Ae.length-1)*G/i,ue=Le(V),ue===V?m.push(Ae[ue]):(ge=V-ue,m.push(Ae[ue]*(1-ge)+Ae[ue+1]*ge));m.push(B)}else if(r.substr(0,1)==="k"){for(X=Ae.length,I=new Array(X),Ee=new Array(i),ht=!0,Z=0,ne=null,ne=[],ne.push(T),G=l=1,st=i-1;1<=st?l<=st:l>=st;G=1<=st?++l:--l)ne.push(T+G/i*(B-T));for(ne.push(B);ht;){for(K=f=0,lt=i-1;0<=lt?f<=lt:f>=lt;K=0<=lt?++f:--f)Ee[K]=0;for(G=d=0,at=X-1;0<=at?d<=at:d>=at;G=0<=at?++d:--d){for(pr=Ae[G],H=Number.MAX_VALUE,K=h=0,ct=i-1;0<=ct?h<=ct:h>=ct;K=0<=ct?++h:--h)xe=S(ne[K]-pr),xe<H&&(H=xe,U=K);Ee[U]++,I[G]=U}for(J=new Array(i),K=b=0,ft=i-1;0<=ft?b<=ft:b>=ft;K=0<=ft?++b:--b)J[K]=null;for(G=w=0,dt=X-1;0<=dt?w<=dt:w>=dt;G=0<=dt?++w:--w)P=I[G],J[P]===null?J[P]=Ae[G]:J[P]+=Ae[G];for(K=L=0,ut=i-1;0<=ut?L<=ut:L>=ut;K=0<=ut?++L:--L)J[K]*=1/Ee[K];for(ht=!1,K=F=0,tt=i-1;0<=tt?F<=tt:F>=tt;K=0<=tt?++F:--F)if(J[K]!==ne[G]){ht=!0;break}ne=J,Z++,Z>200&&(ht=!1)}for(pe={},K=M=0,rt=i-1;0<=rt?M<=rt:M>=rt;K=0<=rt?++M:--M)pe[K]=[];for(G=k=0,it=X-1;0<=it?k<=it:k>=it;G=0<=it?++k:--k)P=I[G],pe[P].push(Ae[G]);for(He=[],K=N=0,ot=i-1;0<=ot?N<=ot:N>=ot;K=0<=ot?++N:--N)He.push(pe[K][0]),He.push(pe[K][pe[K].length-1]);for(He=He.sort(function(Dt,Wt){return Dt-Wt}),m.push(He[0]),G=O=1,_r=He.length-1;O<=_r;G=O+=2)Et=He[G],!isNaN(Et)&&m.indexOf(Et)===-1&&m.push(Et)}return m},Re=function(e,r,i){var s,l,f,d;return s=te(arguments),e=s[0],r=s[1],i=s[2],isNaN(e)&&(e=0),e/=360,e<1/3?(l=(1-r)/3,d=(1+r*W(p*e)/W(c-p*e))/3,f=1-(l+d)):e<2/3?(e-=1/3,d=(1-r)/3,f=(1+r*W(p*e)/W(c-p*e))/3,l=1-(d+f)):(e-=2/3,f=(1-r)/3,l=(1+r*W(p*e)/W(c-p*e))/3,d=1-(f+l)),d=_e(i*d*3),f=_e(i*f*3),l=_e(i*l*3),[d*255,f*255,l*255,s.length>3?s[3]:1]},sr=function(){var e,r,i,s,l,f,d,h;return d=te(arguments),f=d[0],r=d[1],e=d[2],p=Math.PI*2,f/=255,r/=255,e/=255,l=Math.min(f,r,e),s=(f+r+e)/3,h=1-l/s,h===0?i=0:(i=(f-r+(f-e))/2,i/=Math.sqrt((f-r)*(f-r)+(f-e)*(r-e)),i=Math.acos(i),e>r&&(i=p-i),i/=p),[i*360,h,s]},g.hsi=function(){return function(e,r,i){i.prototype=e.prototype;var s=new i,l=e.apply(s,r);return Object(l)===l?l:s}(t,ze.call(arguments).concat(["hsi"]),function(){})},x.hsi=Re,t.prototype.hsi=function(){return sr(this._rgb)},De=function(e,r,i,s){var l,f,d,h,b,w,L,F,M,k,N,O,I;return s==="hsl"?(O=e.hsl(),I=r.hsl()):s==="hsv"?(O=e.hsv(),I=r.hsv()):s==="hcg"?(O=e.hcg(),I=r.hcg()):s==="hsi"?(O=e.hsi(),I=r.hsi()):(s==="lch"||s==="hcl")&&(s="hcl",O=e.hcl(),I=r.hcl()),s.substr(0,1)==="h"&&(d=O[0],k=O[1],w=O[2],h=I[0],N=I[1],L=I[2]),!isNaN(d)&&!isNaN(h)?(h>d&&h-d>180?l=h-(d+360):h<d&&d-h>180?l=h+360-d:l=h-d,f=d+i*l):isNaN(d)?isNaN(h)?f=Number.NaN:(f=h,(w===1||w===0)&&s!=="hsv"&&(M=N)):(f=d,(L===1||L===0)&&s!=="hsv"&&(M=k)),M==null&&(M=k+i*(N-k)),b=w+i*(L-w),F=g[s](f,M,b)},E=E.concat(function(){var e,r,i,s;for(i=["hsv","hsl","hsi","hcl","lch","hcg"],s=[],r=0,e=i.length;r<e;r++)Jt=i[r],s.push([Jt,De]);return s}()),Fe=function(e,r,i,s){var l,f;return l=e.num(),f=r.num(),g.num(l+(f-l)*i,"num")},E.push(["num",Fe]),de=function(e,r,i,s){var l,f,d;return f=e.lab(),d=r.lab(),l=new t(f[0]+i*(d[0]-f[0]),f[1]+i*(d[1]-f[1]),f[2]+i*(d[2]-f[2]),s)},E.push(["lab",de])}).call(pt)});var Ge=new WeakMap,Zr=navigator.userAgent.toLowerCase().indexOf("firefox")>-1?5e6:1e7;function gr(t,o,n,a,c){var u={};return Object.keys(a).forEach(function(p){u[p]=a[p]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=n.slice().reverse().reduce(function(p,y){return y(t,o,p)||p},u),c&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(c):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(t,o,u),u=null),u}var Ct=0,Ve=0,br=performance.now(),mr=(t,...o)=>t.map((n,a)=>[n,o[a]]).flat().filter(n=>!!n).join("");function vr(t,o,n){let a=n.value,c=Symbol("regular-table throttle lock");return n.value=async function(...u){if(this[c]!==void 0&&(await this[c],this[c]!==void 0))return void await this[c];let p;this[c]=(()=>{let y,_=new Promise(v=>{y=v});return _.resolve=y,_})();try{p=await a.call(this,...u)}finally{let y=this[c];this[c]=void 0,y.resolve()}return p},n.value.flush=async function(){return await new Promise(requestAnimationFrame),await this[c]},n}var Nt,Qr=(gr((Nt=class extends HTMLElement{create_shadow_dom(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=mr` <style> ${":host{bottom:0;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch}:host,div.rt-virtual-panel{position:absolute;top:0;left:0;right:0}div.rt-virtual-panel{pointer-events:none}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%}div.rt-tree-container{display:flex;align-items:center;height:100%}slot{position:absolute;overflow:hidden;overflow-anchor:none}"} </style> <style> ${":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px}"} </style> <div class="rt-virtual-panel"></div> <div class="rt-scroll-table-clip"> ${"<slot></slot>"} </div> `;let[,t,o,n]=this.shadowRoot.children;this._sub_cell_style=t,this._table_clip=n,this._virtual_panel=o,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode==="both"||this._virtual_mode==="vertical"?this._table_clip.style.top="0px":this._table_clip.style.removeProperty("top"),this._virtual_mode==="both"||this._virtual_mode==="horizontal"?this._table_clip.style.left="0px":this._table_clip.style.removeProperty("left"),this._virtual_mode!=="both"?this._table_clip.style.contain="none":this._table_clip.style.removeProperty("contain"))}_calculate_viewport(t,o){let{start_row:n,end_row:a}=this._calculate_row_range(t),{start_col:c,end_col:u}=this._calculate_column_range(o);return this._nrows=t,{start_col:c,end_col:u,start_row:n,end_row:a}}_calculate_row_range(t){let{height:o}=this._container_size,n=this._column_sizes.row_height||19,a=this._view_cache.config.column_pivots.length,c=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),u=Math.max(Math.ceil(this.scrollTop),0)/c,p=o/n-a,y=t||0,_=Math.max(0,Math.ceil(y-p))*u;return{start_row:_,end_row:Math.max(0,Math.min(_+p,t))}}_calc_start_column(){let t=this._view_cache.config.row_pivots.length,o=0,n=0,a=0;for(;n<this.scrollLeft;){let c=this._column_sizes.indices[o+t];a=this.scrollLeft-n,o+=1,n+=c!==void 0?c:60}return o+=a/(this._column_sizes.indices[o+t-1]||60),Math.max(0,o-1)}_calculate_column_range(t){if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let o=this._calc_start_column();return{start_col:o,end_col:o+(this.table_model.num_columns()||Math.min(t,Math.ceil(this._container_size.width/60)))+1}}}_max_scroll_column(t){let o=0;if(this._view_cache.config.row_pivots.length>0)for(let c of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))o+=c;let n=this._view_cache.config.row_pivots.length,a=t;for(;o<this._container_size.width&&a>=0;)a--,o+=this._column_sizes.indices[a+n]||60;return Math.min(t-1,a+1)}_validate_viewport({start_col:t,end_col:o,start_row:n,end_row:a}){n=Math.floor(n),a=Math.ceil(a),t=Math.floor(t),o=Math.ceil(o);let c=this._start_col!==t,u=this._start_row!==n||this._end_row!==a||this._end_col!==o;return this._start_col=t,this._end_col=o,this._start_row=n,this._end_row=a,{invalid_column:c,invalid_row:u}}_calc_scrollable_column_width(t){let o=this._view_cache.config.row_pivots.length,n=this._max_scroll_column(t),a=o,c=0;for(;a<n+o;)c+=this._column_sizes.indices[a]||60,a++;return c}_update_virtual_panel_width(t,o){if(t)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((n,a)=>n+a,0)+"px";else{let n=this._calc_scrollable_column_width(o);if(n!==0){let a=this._container_size.width+n+2;this._virtual_panel.style.width=a+"px"}else this._virtual_panel.style.width="1px"}}_update_virtual_panel_height(t){let{row_height:o=19}=this._column_sizes,n=this._view_cache.config.column_pivots.length*o,a;if(this._virtual_mode==="horizontal"||this._virtual_mode==="none")a=t*o+n;else{let c=this.clientHeight/(this._table_clip.offsetHeight-n);a=Math.min(Zr,t*o*c)}this._virtual_panel.style.height=a+"px"}async draw(t={}){let o=performance.now(),{invalid_viewport:n=!0,preserve_width:a=!1}=t,{num_columns:c,num_rows:u}=await this._view_cache.view(0,0,0,0);this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight},this._update_virtual_panel_height(u),a||this._update_virtual_panel_width(n,c);let p=this._calculate_viewport(u,c),{invalid_row:y,invalid_column:_}=this._validate_viewport(p);if(this._invalid_schema||y||_||n){let x=[],E=!0;for await(let S of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,a,p,c)){S!==void 0&&(x=x.concat(S)),E&&(this.update_sub_cell_offset(p),E=!1),this._is_styling=!0;let D=this._style_callbacks;for(let q of D)await q({detail:this});if(this._is_styling=!1,!this._invalidated&&S!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(x),this.table_model.header.reset_header_cache(),a||this._update_virtual_panel_width(this._invalid_schema||_,c),this._invalid_schema=!1}else this.update_sub_cell_offset(p);var v;v=performance.now()-o,Ct=(Ct*Ve+v)/(Ve+1),Ve+=1}update_sub_cell_offset(t){var o;let n=this._column_sizes.row_height*(t.start_row%1)||0,a=this._column_sizes.indices[(this.table_model._row_headers_length||0)+Math.floor(t.start_col)]*(t.start_col%1)||0,c=(o=this._sub_cell_style.sheet)===null||o===void 0?void 0:o.cssRules[0].style;c&&(c.setProperty("--regular-table--clip-x",a+"px"),c.setProperty("--regular-table--clip-y",n+"px"),c.setProperty("--regular-table--transform-x",`-${a}px`),c.setProperty("--regular-table--transform-y",`-${n}px`))}}).prototype,"draw",[vr],Object.getOwnPropertyDescriptor(Nt.prototype,"draw"),Nt.prototype),Nt),At,ei=(gr((At=class extends Qr{register_listeners(){this.addEventListener("mousedown",this._on_click_or_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!0}),this._register_glitch_scroll_listeners()}_on_scroll(t){t.stopPropagation(),this.draw({invalid_viewport:!1})}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this))}_on_mousewheel(t){if(!window.safari)return;let{clientWidth:o,clientHeight:n,scrollTop:a,scrollLeft:c}=this;t.preventDefault(),t.returnValue=!1;let u=Math.max(1,this._virtual_panel.offsetHeight-n),p=Math.max(1,this._virtual_panel.offsetWidth-o);this.scrollTop=Math.max(0,Math.min(u,a+t.deltaY)),this.scrollLeft=Math.max(0,Math.min(p,c+t.deltaX)),this._on_scroll(t)}_on_touchmove(t){t.stopPropagation(),t.preventDefault(),t.returnValue=!1;let{clientWidth:o,clientHeight:n}=this,a=Math.max(1,this._virtual_panel.offsetHeight-n),c=Math.max(1,this._virtual_panel.offsetWidth-o);this.scrollTop=Math.min(a,this._memo_scroll_top+(this._memo_touch_startY-t.touches[0].pageY)),this.scrollLeft=Math.min(c,this._memo_scroll_left+(this._memo_touch_startX-t.touches[0].pageX)),this._on_scroll(t)}_on_touchstart(t){this._memo_touch_startY=t.touches[0].pageY,this._memo_touch_startX=t.touches[0].pageX,this._memo_scroll_top=this.scrollTop,this._memo_scroll_left=this.scrollLeft}async _on_dblclick(t){let o=t.target;for(;o.tagName!=="TD"&&o.tagName!=="TH";)if(o=o.parentElement,!this.contains(o))return;let n=t.target.classList.contains("rt-column-resize"),a=Ge.get(o);if(n){t.stopImmediatePropagation(),o.style.minWidth="",o.style.maxWidth="",t.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(this._column_sizes.override[a.size_key]=void 0,this._column_sizes.auto[a.size_key]=void 0,this._column_sizes.indices[a.size_key]=void 0);for(let c of t.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let u of t.shiftKey?c:[c[a._virtual_x]])u&&(u.style.minWidth="",u.style.maxWidth="",u.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(t){if(t.button!==0)return;let o=t.target;for(;o.tagName!=="TD"&&o.tagName!=="TH";)if(o=o.parentElement,!this.contains(o))return;let n=t.target.classList.contains("rt-column-resize"),a=Ge.get(o);n&&(this._on_resize_column(t,o,a),t.stopImmediatePropagation())}async _on_click_or_dblclick(t){let o=performance.now();this._last_clicked_time&&o-this._last_clicked_time<500?(this._last_clicked_time=o,await this._on_dblclick(t)):(this._last_clicked_time=o,await this._on_click(t))}_on_resize_column(t,o,n){let{_virtual_x:a,size_key:c}=n,u=t.pageX,p=a+o.colSpan-1,y=this.table_model.header.get_column_header(p),_=this._column_sizes.indices[c],v=E=>this._on_resize_column_move(E,y,u,_,c,p),x=()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",x);let E=this._column_sizes.override[c],S=this._column_sizes.indices[c]!==E;this._column_sizes.indices[c]=E,S&&this.draw()};document.addEventListener("mousemove",v),document.addEventListener("mouseup",x)}async _on_resize_column_move(t,o,n,a,c,u){await new Promise(setTimeout);let p=t.pageX-n,y=Math.max(1,a+p);if(this._column_sizes.override[c]=y,p<0)await this.draw({preserve_width:!0});else{o.style.minWidth=y+"px",o.style.maxWidth=y+"px";let _=this._column_sizes.auto[c];for(let v of this.table_model.body.cells){let x=v[u];x&&(x.style.maxWidth=x.style.minWidth=y+"px",x.classList.toggle("rt-cell-clip",_>y))}}}}).prototype,"_on_resize_column_move",[vr],Object.getOwnPropertyDescriptor(At.prototype,"_on_resize_column_move"),At.prototype),At),yr=class{constructor(o){this._name=o,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let o=this._elements[this._index];return this._index+=1,o}},Gt=class{constructor(o,n,a){this._column_sizes=o,this._container=n,this._span_factory=new yr("span"),this.table=a,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(o,n){Ge.set(o,n)}_get_or_create_metadata(o){if(o===void 0)return{};if(Ge.has(o))return Ge.get(o);{let n={};return Ge.set(o,n),n}}_replace_cell(o,n){let{tr:a,row_container:c}=this._get_row(o),u=c[n];return u&&(a.removeChild(u),c.splice(n,1,void 0)),u}_fetch_cell(o,n){if(o<0||n<0)return;let{row_container:a}=this._get_row(o);return a[n]}_get_cell(o="TD",n,a){let{tr:c,row_container:u}=this._get_row(n),p=u[a];if(p||(a<u.length?(p=u[a]=document.createElement(o),c.insertBefore(p,u.slice(a+1).find(y=>y))):(p=u[a]=document.createElement(o),c.appendChild(p))),p.tagName!==o){let y=document.createElement(o);c.replaceChild(y,p),this.cells[n].splice(a,1,y),p=y}return p}_get_row(o){let n=this.rows[o];n||(n=this.rows[o]=document.createElement("tr"),this.table.appendChild(n));let a=this.cells[o];return a||(a=this.cells[o]=[]),{tr:n,row_container:a}}_clean_columns(o){for(let n=0;n<this.rows.length;n++){let a=this.rows[n],c=this.cells[n];this.cells[n]=c.slice(0,o[n]||o);let u=this.cells[n].filter(p=>p!==void 0).length;for(;a.children[u];)a.removeChild(a.children[u])}}_clean_rows(o){for(;this.table.children[o];)this.table.removeChild(this.table.children[o]);this.rows=this.rows.slice(0,o),this.cells=this.cells.slice(0,o)}},wr=class extends Gt{constructor(...o){super(...o),this._group_header_cache=[],this._offset_cache=[]}_draw_group_th(o,n,a){let c=this._get_cell("TH",n,o[n]||0);if(o[n]+=1,c.removeAttribute("colspan"),c.style.minWidth="0",c.textContent="",a instanceof HTMLElement)c.appendChild(a);else{let p=this._span_factory.get("span");p.textContent=a,c.appendChild(p)}let u=this._span_factory.get("span");return u.className="rt-column-resize",c.appendChild(u),c}_draw_group(o,n,a){let c=this._get_or_create_metadata(a);return c.column_header=o,c.value=n,c.value=n,c}_draw_th(o,n,a,c,u){let p=this._get_or_create_metadata(a);if(p.column_header=o,p.value=n,p.size_key=u.length?u[0]:u,!(u.length>1)){let y=this._column_sizes.override[p.size_key],_=this._column_sizes.auto[p.size_key];y?(a.classList.toggle("rt-cell-clip",_>y),a.style.minWidth=y+"px",a.style.maxWidth=y+"px"):_?(a.classList.remove("rt-cell-clip"),a.style.maxWidth="",a.style.minWidth=_+"px"):(a.style.maxWidth="",a.style.maxWidth="")}return p}get_column_header(o){return this._get_cell("TH",this.num_rows()-1,o)}draw(o,n,a,c,u,p,y){let _=n==null?void 0:n.length;if(_===0)return;let v,x,E;for(let z=0;z<_;z++){if(E=n[z]?n[z]:"",this._offset_cache[z]=this._offset_cache[z]||0,z<_-1){var S,D,q;((S=this._group_header_cache)===null||S===void 0||(D=S[z])===null||D===void 0||(q=D[0])===null||q===void 0?void 0:q.value)===E?(v=this._group_header_cache[z][1],this._group_header_cache[z][2]+=1,a===1&&(this._group_header_cache[z][0].row_header_x=u),v.setAttribute("colspan",this._group_header_cache[z][2])):(v=this._draw_group_th(this._offset_cache,z,E),x=this._draw_group(n,E,v),this._group_header_cache[z]=[x,v,1])}else{v=this._draw_group_th(this._offset_cache,z,E),x=this._draw_th(o||n,E,v,c,u);for(let[C]of this._group_header_cache)C.size_key=x.size_key;v.removeAttribute("colspan")}v.classList.toggle("rt-group-corner",c===void 0),x&&(x.x=c===void 0?c:Math.floor(c),x.column_header_y=z,x.x0=Math.floor(p),x._virtual_x=y,a===1&&(x.row_header_x=u))}return this._clean_rows(this._offset_cache.length),{th:v,metadata:x}}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}},xr=class extends Gt{_draw_td(o,n,a,c,{column_name:u},{ridx_offset:p},y){let _=this._get_cell(o,n,c),v=this._get_or_create_metadata(_);v.y=n+Math.floor(p),v.size_key=y,o==="TD"&&(v.column_header=u);let x=this._column_sizes.override[v.size_key];if(x){let E=this._column_sizes.auto[v.size_key];_.classList.toggle("rt-cell-clip",E>x),_.style.minWidth=x+"px",_.style.maxWidth=x+"px"}else _.classList.remove("rt-cell-clip"),_.style.minWidth="",_.style.maxWidth="";return v.value!==a&&(a instanceof HTMLElement?(_.textContent="",_.appendChild(a)):_.textContent=a),v.value=a,{td:_,metadata:v}}draw(o,n,a,c=!1,u,p,y){let{cidx:_,column_data:v,row_headers:x,column_data_listener_metadata:E}=n,S,{row_height:D}=a,q=[],z=[],C=0,R=[];for(let g=0;g<(c?a.row_headers_length:1);g++){C=0;for(let Y of v){var Q;let se=x==null?void 0:x[C],j;if(c){let W=Y[g],re=this._fetch_cell(C-(q[g]||1),_+g),oe=this._get_or_create_metadata(re),fe=this._fetch_cell(C,_+g-(R[C]||1)),le=this._get_or_create_metadata(fe);!fe||le.value!==W&&W!==void 0||fe.hasAttribute("rowspan")?re&&oe.value===W&&!re.hasAttribute("colspan")?(q[g]=q[g]?q[g]+1:2,re.setAttribute("rowspan",q[g]),this._replace_cell(C,_+g)):(j=this._draw_td("TH",C,W,_+g,n,a,g),j.td.style.display="",j.td.removeAttribute("rowspan"),j.td.removeAttribute("colspan"),j.metadata.row_header=Y,j.metadata.row_header_x=g,j.metadata.y0=Math.floor(a.ridx_offset),j.metadata.y1=Math.ceil(a.y1),j.metadata._virtual_x=g,p!==void 0&&(j.metadata.x0=Math.floor(p)),q[g]=1,R[C]=1,z[g]=j):(R[C]=R[C]?R[C]+1:2,fe.setAttribute("colspan",R[C]),this._replace_cell(C,_+g))}else j=this._draw_td("TD",C,Y,_,n,a,y),E&&(j.metadata.user=E[C]),j.metadata.x=u===void 0?u:Math.floor(u),j.metadata.x1=Math.ceil(a.x1),j.metadata.row_header=se||[],j.metadata.y0=Math.floor(a.ridx_offset),j.metadata.y1=Math.ceil(a.y1),j.metadata.dx=Math.floor(u-p),j.metadata.dy=j.metadata.y-Math.floor(j.metadata.y0),j.metadata._virtual_x=_,p!==void 0&&(j.metadata.x0=Math.floor(p)),z[0]=j;if(C++,S=j?j.metadata:S,D=D||((Q=j)===null||Q===void 0?void 0:Q.td.offsetHeight),C*D>o)break}}return this._clean_rows(C),{tds:z,ridx:C,metadata:S,row_height:D}}clean({ridx:o,cidx:n}){this._clean_rows(o),this._clean_columns(n)}},$t=class{constructor(o,n,a){this.clear(a);let[c]=a.children,[u,p]=c.children;this.table=c,this._column_sizes=n,this.header=new wr(n,o,u),this.body=new xr(n,o,p),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(o){o.innerHTML=mr` <table cellspacing="0"> <thead></thead> <tbody></tbody> </table> `}autosize_cells(o){for(;o.length>0;){let[n,a,c]=o.pop(),u,p=getComputedStyle(n);p.boxSizing!=="border-box"?(u=n.clientWidth,u-=p.paddingLeft?parseFloat(p.paddingLeft):0,u-=p.paddingRight?parseFloat(p.paddingRight):0):u=parseFloat(p.width),this._column_sizes.row_height=this._column_sizes.row_height||c.offsetHeight,this._column_sizes.indices[a.size_key]=u;let y=this._column_sizes.override[a.size_key]!==void 0;u&&!y&&(this._column_sizes.auto[a.size_key]=u),n.style.minWidth==="0px"&&(n.style.minWidth=u+"px")}}async*draw(o,n,a,c,u,p){var y,_,v,x;let{width:E,height:S}=o,{view:D,config:q}=n,{data:z,row_headers:C,column_headers:R,metadata:Q}=await D(Math.floor(u.start_col),Math.floor(u.start_row),Math.ceil(u.end_col),Math.ceil(u.end_row)),{start_row:g=0,start_col:Y=0,end_col:se=0,end_row:j=0}=u;C&&(this._row_headers_length=C.reduce((ie,Ie)=>Math.max(ie,Ie.length),0),C=C.map(ie=>(ie.length=this._row_headers_length,ie))),n.config.column_pivots=Array.from(Array((R==null||(y=R[0])===null||y===void 0?void 0:y.length)||0).keys()),n.config.row_pivots=Array.from(Array(((_=C)===null||_===void 0||(v=_[0])===null||v===void 0?void 0:v.length)||0).keys());let W={viewport_width:0,selected_id:a,ridx_offset:g,sub_cell_offset:this._column_sizes.indices[(this._row_headers_length||0)+Math.floor(u.start_col)]||0,x0:Y,x1:se,y1:j,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},re,oe=0,fe=[],le=!0;if(((x=C)===null||x===void 0?void 0:x.length)>0){let ie=q.row_pivots.join(","),Ie={column_name:ie,cidx:0,column_data:C,row_headers:C,first_col:le},Se=oe+Math.floor(Y);re=this.body.draw(S,Ie,{...W,x0:0},!0,void 0,void 0,Se);let De=[];for(let de=0;de<n.config.row_pivots.length;de++){let be=this.header.draw(ie,Array(n.config.column_pivots.length).fill(""),1,void 0,de,Y,de);be&&De.push(be)}if(le=!1,W.viewport_width+=De.reduce((de,{th:be},Fe)=>de+(this._column_sizes.indices[Fe]||be.offsetWidth),0),W.row_height=W.row_height||re.row_height,oe=C[0].length,!c)for(let de=0;de<n.config.row_pivots.length;de++){let{td:be,metadata:Fe}=re.tds[de]||{},{th:he,metadata:Te}=De[de]||{};(be||he)&&fe.push([he||be,Te||Fe,be||he])}}try{var Le;let ie=0,Ie=p-u.start_col;for(;ie<Ie;){if(!z[ie]){let me=Math.max(u.end_col,0);u.start_col=me;let ye=0,Ce=0;for(;this._column_sizes.indices.length>oe+Y+ye+1&&Ce+W.viewport_width<E;)ye++,Ce+=this._column_sizes.indices[oe+Y+ye];if(Ce+W.viewport_width<E){let _e=Math.min(p,me+5);u.end_col=Math.max(1,Math.min(p,_e))}else u.end_col=Math.max(1,Math.min(p,me+ye));let Je=D(Math.floor(u.start_col),Math.floor(u.start_row),Math.ceil(u.end_col),Math.ceil(u.end_row));yield;let Ne=await Je;if(Ne.data.length===0)return void(yield fe);u.end_col=u.start_col+Ne.data.length;for(let _e=0;_e<Ne.data.length;_e++){var je;z[ie+_e]=Ne.data[_e],Ne.metadata&&(Q[ie+_e]=Ne.metadata[_e]),R&&(R[ie+_e]=(je=Ne.column_headers)===null||je===void 0?void 0:je[_e])}}let Se=(R==null?void 0:R[ie])||"",De=z[ie],de={column_name:Se,cidx:oe,column_data:De,column_data_listener_metadata:Q==null?void 0:Q[ie],row_headers:C,first_col:le},be=ie+Y,Fe=oe+Math.floor(Y),he=this.header.draw(void 0,Se,void 0,be,Fe,Y,oe);if(re=this.body.draw(S,de,W,!1,be,Y,Fe),le=!1,!c)for(let{td:me,metadata:ye}of re.tds)fe.push([(he==null?void 0:he.th)||me,(he==null?void 0:he.metadata)||ye,me||(he==null?void 0:he.th)]);let Te=this._column_sizes.indices[oe+Math.floor(Y)];var Me;if(Te?W.viewport_width+=Te:W.viewport_width+=(he==null||(Me=he.th)===null||Me===void 0?void 0:Me.offsetWidth)||re.tds.reduce((me,ye)=>{var Ce;return me+((Ce=ye.td)===null||Ce===void 0?void 0:Ce.offsetWidth)},0),W.row_height=W.row_height||re.row_height,oe++,ie++,W.viewport_width-W.sub_cell_offset>E){var Re;this.body.clean({ridx:((Re=re)===null||Re===void 0?void 0:Re.ridx)||0,cidx:oe}),this.header.clean(),yield fe,W.viewport_width=0;for(let[me]of fe)W.viewport_width+=me.offsetWidth;if(W.viewport_width-W.sub_cell_offset>E)return}}this.body.clean({ridx:((Le=re)===null||Le===void 0?void 0:Le.ridx)||0,cidx:oe}),this.header.clean(),yield fe}finally{var Oe;this.body.clean({ridx:((Oe=re)===null||Oe===void 0?void 0:Oe.ridx)||0,cidx:oe}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}},ti=["both","horizontal","vertical","none"],kr=class extends ei{constructor(){super(),this._column_sizes={auto:[],override:[],indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new $t(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto=[],this._column_sizes.override=[],this._column_sizes.indices=[];for(let o=0;o<this.table_model.header.num_columns();o++){let n=this.table_model.header.get_column_header(o);n.style.minWidth="",n.style.maxWidth=""}}clear(){this.table_model=new $t(this._table_clip,this._column_sizes,this)}addStyleListener(o){this._style_callbacks=this._style_callbacks.concat(o);let n=!0;return()=>{if(!n)return;n=!1;let a=this._style_callbacks=this._style_callbacks.slice(),c=a.indexOf(o);a.splice(c,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(o){if(o!==void 0){if(o instanceof HTMLElement)return Ge.get(o);if(o.row_header_x>=0){if(o.row_header_x<this._view_cache.config.row_pivots.length){let n=this.table_model.body._fetch_cell(o.y,o.row_header_x);return this.getMeta(n)}}else{if(!(o.column_header_y>=0))return this.getMeta(this.table_model.body._fetch_cell(o.dy,o.dx+this.table_model._row_headers_length));if(o.column_header_y<this._view_cache.config.column_pivots.length){let n=this.table_model.body._fetch_cell(o.column_header_y,o.y);return this.getMeta(n)}}}}getDrawFPS(){return function(){let o=performance.now(),n=o-br,a=Ct,c=1e3*Ve/n,u=Ve;return Ct=0,Ve=0,br=o,{avg:a,real_fps:c,virtual_fps:1e3/a,num_frames:u,elapsed:n}}()}async scrollToCell(o,n){if(!this._view_cache)return void console.warn("data listener not configured");let a=this._column_sizes.row_height||19,c=this._view_cache.config.column_pivots.length*a,u=(this._table_clip.offsetHeight-c)%a,p=(this._virtual_panel.offsetHeight-u)/this._nrows;this.scrollTop=Math.ceil(p*n);let y=0;for(;o>0;)o--,y+=this._column_sizes.indices[o+this._view_cache.config.row_pivots.length]||60;this.scrollLeft=Math.ceil(y),await new Promise(requestAnimationFrame),await this.draw.flush()}setDataListener(o,{virtual_mode:n="both"}={}){console.assert(ti.indexOf(n)>-1,`Unknown virtual_mode ${n};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=n,this._invalid_schema=!0,this._view_cache={view:o,config:{row_pivots:[],column_pivots:[]},schema:{}},this._setup_virtual_scroll()}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",kr);var Cr=qt(Er());var $e=qt(Yt()),ve=Symbol("Plugin Symbol");function bt(t){let[o,n,a]=t.rgb(),[c,u,p]=t.set("hsl.h",(t.get("hsl.h")-15)%360).rgb(),[y,_,v]=t.set("hsl.h",(t.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${c},${u},${p}),rgb(${o},${n},${a}) 50%,rgb(${y},${_},${v}))`}function Xt(t,o,n){let a=typeof n!="undefined",c=document.createElement(`perspective-${a?"number":"string"}-column-style`),u=t.getMeta(o),p=u.column_header[u.column_header.length-1],y=this._schema[p],_;if(a?_={gradient:n,pos_color:this._pos_color[0],neg_color:this._neg_color[0],number_color_mode:"foreground"}:_={color:this._color[0]},y!=="string")if(y==="float")_.fixed=2;else if(y==="integer")_.fixed=0;else{this._open_column_styles_menu.pop(),t.draw({preserve_width:!0});return}let v=()=>c.blur(),x=q=>{let z=q.detail;z.pos_color&&(z.pos_color=[z.pos_color,...(0,$e.default)(z.pos_color).rgb(),bt((0,$e.default)(z.pos_color))],z.neg_color=[z.neg_color,...(0,$e.default)(z.neg_color).rgb(),bt((0,$e.default)(z.neg_color))]),z.color&&(z.color=[z.color,...(0,$e.default)(z.color).rgb(),bt((0,$e.default)(z.color))]),t[ve]=t[ve]||{},t[ve][p]=z,t.draw({preserve_width:!0}),t.parentElement.parentElement.dispatchEvent(new Event("perspective-config-update"))},E=async()=>{t.removeEventListener("regular-table-scroll",v),c.removeEventListener("perspective-column-style-change",x),c.removeEventListener("blur",E),c.destroy(),this._open_column_styles_menu.pop(),await t.draw({preserve_width:!0}),t.parentElement.parentElement.dispatchEvent(new Event("perspective-config-update"))};c.addEventListener("perspective-column-style-change",x),c.addEventListener("blur",E),t.addEventListener("regular-table-scroll",v);let S=t[ve]||{},D=Object.assign({},S[p]=S[p]||{});D.pos_color&&(D.pos_color=D.pos_color[0],D.neg_color=D.neg_color[0]),D.color&&(D.color=D.color[0]),c.open(o,D,_)}function mt([t,o,n,a],c=[255,255,255]){function u(p,y){return((1-a)*(c[p]/255)+a*(y/255))*255}return[u(0,t),u(1,o),u(2,n)]}function vt([t,o,n]){return Math.sqrt(t*t*.299+o*o*.587+n*n*.114)>130?"#161616":"#ffffff"}var yt=qt(Yt());function ri(t){let o=t._view_cache.config.row_pivots.length-1,n=Array.from(t.children[0].children[0].children),a=t[ve]||{};if(n.length>0){let[y]=n.splice(n.length-1,1);for(let _ of y?.children){let v=t.getMeta(_),x=v.column_header?.[v.column_header?.length-1],E=this._config.sort.find(R=>R[0]===x),S=v.row_header_x===o,D=typeof v.x=="undefined";S=S||(v.x+1)%this._config.columns.length==0,_.classList.toggle("psp-header-border",S),_.classList.toggle("psp-header-group",!1),_.classList.toggle("psp-header-leaf",!0),_.classList.toggle("psp-is-top",!1),_.classList.toggle("psp-header-corner",D),_.classList.toggle("psp-header-sort-asc",!!E&&E[1]==="asc"),_.classList.toggle("psp-header-sort-desc",!!E&&E[1]==="desc"),_.classList.toggle("psp-header-sort-col-asc",!!E&&E[1]==="col asc"),_.classList.toggle("psp-header-sort-col-desc",!!E&&E[1]==="col desc");let q=Kt.call(this,v),z=q==="integer"||q==="float",C=q==="string";_.classList.toggle("psp-align-right",z),_.classList.toggle("psp-align-left",!z),_.classList.toggle("psp-menu-open",this._open_column_styles_menu[0]===v._virtual_x),_.classList.toggle("psp-menu-enabled",(C||z)&&!D),_.classList.toggle("psp-is-width-override",t._column_sizes?.override[v.size_key]!==void 0)}}let c=[],u=new Set,p=t.children[0];for(let y=0;y<n.length;y++){let _=p.rows[y],v=new Set;for(let x=0;x<_.cells.length;x++){let E=_.cells[x];E.style.backgroundColor="";let S=t.getMeta(E),D=S.row_header_x===o||S.x>=0;E.classList.toggle("psp-align-right",!1),E.classList.toggle("psp-align-left",!1),E.classList.toggle("psp-header-group",!0),E.classList.toggle("psp-header-leaf",!1),E.classList.toggle("psp-header-border",D),E.classList.toggle("psp-header-group-corner",typeof S.x=="undefined"),E.classList.toggle("psp-color-mode-bar",!1),E.classList.toggle("psp-header-sort-asc",!1),E.classList.toggle("psp-header-sort-desc",!1),E.classList.toggle("psp-header-sort-col-asc",!1),E.classList.toggle("psp-header-sort-col-desc",!1);let q=_.cells[x],z=x,C,R;for(;c[y]&&c[y][z];++z);for(v.add(z),C=z;C<z+q.colSpan;++C)for(R=y;R<y+q.rowSpan;++R)c[R]||(c[R]=[]),c[R][C]=!0;q.classList.toggle("psp-is-top",y===0||!u.has(C))}u=v}for(let y of t.children[0].children[1].children)for(let _ of y.children){let v=t.getMeta(_),x=v.column_header?.[v.column_header?.length-1],E=Kt.call(this,v),S=a[x],D=E==="integer"||E==="float";if(D){let z=v.user>0,C=v.user<0,[R,Q,g,Y,se]=(()=>S?.pos_color!==void 0?z?S.pos_color:C?S.neg_color:["",0,0,0,""]:z?this._pos_color:C?this._neg_color:["",0,0,0,""])();if(_.style.position="",S?.number_color_mode==="background"){let j=this._plugin_background,W=vt(mt([Q,g,Y,1],j));_.style.color=W,_.style.backgroundColor=R}else if(S?.number_color_mode==="gradient"){let j=Math.max(0,Math.min(1,Math.abs(v.user/S.gradient))),W=this._plugin_background,re=vt(mt([Q,g,Y,j],W));_.style.color=re,_.style.backgroundColor=`rgba(${Q},${g},${Y},${j})`}else S?.number_color_mode==="disabled"?(_.style.backgroundColor="",_.style.color=""):S?.number_color_mode==="bar"?(_.style.backgroundColor="",_.style.color="",_.style.position="relative",se!==""&&_.children.length>0&&_.children[0].nodeType===Node.ELEMENT_NODE&&(_.children[0].style.background=se)):(_.style.backgroundColor="",_.style.color=R)}else if(E==="boolean"){let[z]=v.user===!0?this._pos_color:v.user===!1?this._neg_color:["",0,0,0,""];_.style.backgroundColor="",_.style.color=z}else if(E==="string"){let[z,C,R,Q,g]=(()=>S?.color!==void 0?S.color:this._color)();if(S?.string_color_mode==="foreground"&&v.user!==null)_.style.color=z,_.style.backgroundColor="",S?.format==="link"&&(_.children[0].style.color=z);else if(S?.string_color_mode==="background"&&v.user!==null){let Y=this._plugin_background,se=vt(mt([C,R,Q,1],Y));_.style.color=se,_.style.backgroundColor=z}else if(S?.string_color_mode==="series"&&v.user!==null){this._series_color_map.has(x)||(this._series_color_map.set(x,new Map),this._series_color_seed.set(x,0));let Y=this._series_color_map.get(x);if(!Y.has(v.user)){let Oe=this._series_color_seed.get(x);Y.set(v.user,Oe),this._series_color_seed.set(x,Oe+1)}let se=Y.get(v.user),[j,W,re]=(0,yt.default)(z).hsl();j=j+se*150%360;let oe=(0,yt.default)(j,W,re,"hsl"),[fe,le,Le]=oe.rgb(),je=oe.hex(),Me=this._plugin_background,Re=vt(mt([fe,le,Le,1],Me));_.style.color=Re,_.style.backgroundColor=je}else _.style.backgroundColor="",_.style.color=""}else _.style.backgroundColor="",_.style.color="";_.classList.toggle("psp-bool-type",E==="boolean"&&v.user!==null);let q=_.tagName==="TH";if(q){let z=typeof v.value!=null&&typeof v.value!=null&&v.value?.toString()?.trim().length>0,C=v.row_header_x>=this._config.group_by.length,R=t.getMeta({dx:0,dy:v.y-v.y0+1}),Q=R&&R.row_header&&typeof R.row_header[v.row_header_x+1]!="undefined";_.classList.toggle("psp-tree-label",z&&!C),_.classList.toggle("psp-tree-label-expand",z&&!C&&!Q),_.classList.toggle("psp-tree-label-collapse",z&&!C&&Q),_.classList.toggle("psp-tree-leaf",z&&C)}_.classList.toggle("psp-align-right",!q&&D),_.classList.toggle("psp-align-left",q||!D),_.classList.toggle("psp-color-mode-bar",S?.number_color_mode==="bar"&&D)}}async function ii(t,o,n){let a=t.getMeta(n),c=a.column_header[a.column_header.length-1],p=(o.shiftKey?oi:ni).call(this,c);t.dispatchEvent(new CustomEvent("regular-table-psp-sort",{detail:{sort:p}}))}function oi(t){let o=[],n=!1;for(let a of this._config.sort){let[c,u]=a;if(c===t){n=!0;let p=Nr.call(this,t,u);p&&o.push(p)}else o.push(a)}return n||o.push([t,"desc"]),o}function ni(t){for(let[o,n]of this._config.sort)if(o===t){let a=Nr.call(this,t,n);return a?[a]:[]}return[[t,"desc"]]}function Nr(t,o){let a=this._config.split_by.length>0?li:si,c=o?a[o]:"desc";if(c)return[t,c]}var si={desc:"asc",asc:void 0},li={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};async function ai(t,o){let n=t.getMeta(o.target),a=o.target.classList.contains("psp-tree-label-collapse");o.shiftKey&&a?this._view.set_depth(n.row_header.filter(c=>c!==void 0).length-2):o.shiftKey?this._view.set_depth(n.row_header.filter(c=>c!==void 0).length-1):a?this._view.collapse(n.y):this._view.expand(n.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),t.draw()}async function ci(t,o){if(o.which!==1)return;let n=o.target;if(n.tagName==="A")return;for(;n.tagName!=="TD"&&n.tagName!=="TH";)if(n=n.parentElement,!t.contains(n))return;if(n.classList.contains("psp-tree-label")&&o.offsetX<26){ai.call(this,t,o),o.stopImmediatePropagation();return}let a=n.getBoundingClientRect();if(n.classList.contains("psp-menu-enabled")&&o.clientY-a.top>16){let c=t.getMeta(n),u=c.column_header?.[c.column_header?.length-1],p=this._schema[u];if(this._open_column_styles_menu.unshift(c._virtual_x),p==="string")t.draw({preserve_width:!0}),Xt.call(this,t,n);else{let[,y]=await this._view.get_min_max(u);t.draw({preserve_width:!0}),Xt.call(this,t,n,y)}o.preventDefault(),o.stopImmediatePropagation()}else n.classList.contains("psp-header-leaf")&&!n.classList.contains("psp-header-corner")&&(ii.call(this,t,o,n),o.stopImmediatePropagation())}function fi(t,o){if(o.which!==1)return;let n=o.target;for(;n.tagName!=="TD"&&n.tagName!=="TH";)if(n=n.parentElement,!t.contains(n))return;(n.classList.contains("psp-tree-label")&&o.offsetX<26||n.classList.contains("psp-header-leaf")&&!n.classList.contains("psp-header-corner"))&&o.stopImmediatePropagation()}var Be={},Vt={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(t){return t?"check":"close"}}},Ar=Be;function Or(t,o,n={},a=!1){if(o===null)return"-";let c=t[t.length-1],u=a&&this._table_schema[c]||this._schema[c]||"string",p=n[c],y=u==="integer"||u==="float";if(y&&p?.number_color_mode==="bar"){let _=Math.max(0,Math.min(.95,Math.abs(o/p.gradient)*.95)),v=this._div_factory.get(),x=o>=0?"left":"right";return v.setAttribute("style",`width:${(_*100).toFixed(2)}%;position:absolute;${x}:0;height:80%;top:10%;pointer-events:none;`),v}else if(p?.format==="link"&&u==="string"){let _=document.createElement("a");return _.setAttribute("href",o),_.setAttribute("target","_blank"),_.textContent=o,_}else if(p?.format==="bold"&&u==="string"){let _=document.createElement("b");return _.textContent=o,_}else if(p?.format==="italics"&&u==="string"){let _=document.createElement("i");return _.textContent=o,_}else{let _=y&&p&&p.fixed!==void 0,v=_?`${u}${p.fixed}`:u;if(Be[v]===void 0){let x=(0,Cr.get_type_config)(u);if(_){let E={minimumFractionDigits:p.fixed,maximumFractionDigits:p.fixed};Be[v]=new Vt[u]("en-us",E)}else Vt[u]?Be[v]=new Vt[u]("en-us",x.format):Be[v]=!1}return Be[v]?Be[v].format(o):o}}function*di(t=[],o,n){let a=n[ve];for(let c of t){c=["TOTAL",...c];let u=c[c.length-1];c=c.slice(0,c.length-1).fill("");let p=Or.call(this,[o[c.length-1]],u,a,!0);p instanceof HTMLElement?c=c.concat(p):c=c.concat({toString:()=>p}),c.length=o.length+1,yield c}}async function ui(t,o,n,a,c){let u={};a-o>0&&c-n>0?(u=await this._view.to_columns({start_row:n,start_col:o,end_row:c,end_col:a,id:!0}),this._ids=u.__ID__):this._div_factory.clear();let p=[],y=[],_=[];for(let v of this._column_paths.slice(o,a)){let x=v.split("|"),E=u[v]||new Array(c-n).fill(null);p.push(E.map(S=>Or.call(this,x,S,t[ve]))),y.push(E),_.push(x)}return{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(di.call(this,u.__ROW_PATH__,this._config.group_by,t)),column_headers:_,data:p,metadata:y}}function St(t,o,n){let a=window.getComputedStyle(t).getPropertyValue(o).trim();return a.length>0?a:n}var Sr=class{constructor(o){this._name=o,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let o=this._elements[this._index];return this._index+=1,o}};function Ye(t){let o=(0,yt.default)(t),n=bt(o);return[t,...o.rgb(),n]}async function Ut(t,o,n,a={}){let c=await n.get_config(),u=c.expressions.map(j=>j[1]),[p,y,_,v,x,E]=await Promise.all([o.schema(),o.validate_expressions(u),n.num_rows(),n.schema(),n.expression_schema(),n.column_paths()]),S=(0,yt.default)(St(t,"--plugin--background","#FFFFFF")).rgb(),D=Ye(St(t,"--rt-pos-cell--color","#338DCD")),q=Ye(St(t,"--rt-neg-cell--color","#FF5942")),z=Ye(St(t,"--active--color","#ff0000")),C={...v,...x},R={...p,...y.expression_schema},Q=E.filter(j=>j!=="__ROW_PATH__"&&j!=="__ID__"),g=[],Y=[];for(let j of Q){let W=j.split("|"),re=W[W.length-1];Y.push(C[re]),g.push(!!p[re])}let se=Object.assign(a,{_view:n,_table:o,_table_schema:R,_config:c,_num_rows:_,_schema:C,_ids:[],_open_column_styles_menu:[],_plugin_background:S,_color:z,_pos_color:D,_neg_color:q,_column_paths:Q,_column_types:Y,_is_editable:g,_row_header_types:c.group_by.map(j=>R[j]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:Kt});return se._div_factory=se._div_factory||new Sr("div"),t.setDataListener(ui.bind(se,t),{virtual_mode:window.getComputedStyle(t).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),se}function Kt(t){return t.x>=0?this._column_types[t.x]:this._row_header_types[t.row_header_x-1]}async function Fr(t,o){t.addStyleListener(ri.bind(o,t)),t.addEventListener("mousedown",ci.bind(o,t)),t.addEventListener("click",fi.bind(o,t)),await t.draw()}var Pr=`regular-table{padding:0;margin:12px 0 0 12px;scrollbar-color:transparent transparent;scrollbar-width:thin;outline:none}regular-table:hover{scrollbar-color:rgba(0,0,0,.3) transparent}.sub-cell-scroll-enabled regular-table table tbody td,.sub-cell-scroll-enabled regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x, 0px))}.sub-cell-scroll-enabled regular-table table tbody{transform:translateY(var(--regular-table--transform-y, 0px))}.sub-cell-scroll-enabled regular-table table tbody tr:first-child td,.sub-cell-scroll-enabled regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y, 0),0 200%,200% 200%,200% var(--regular-table--clip-y, 0))}.sub-cell-scroll-enabled regular-table table thead th.rt-group-corner{background:var(--plugin--background, white);z-index:1}.sub-cell-scroll-enabled regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x, 0) 0,var(--regular-table--clip-x, 0) 200%,200% 200%,200% 0)}.sub-cell-scroll-enabled regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x, 0) var(--regular-table--clip-y, 0),var(--regular-table--clip-x, 0) 200%,200% 200%,200% var(--regular-table--clip-y, 0))}regular-table{font-family:inherit}regular-table div[tabindex]{outline:none}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden}regular-table th{text-align:center}regular-table thead tr:not(:last-child) th{overflow:hidden;max-width:0px}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right}regular-table tbody th{text-align:left}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left}regular-table thead tr:last-child th{border-bottom:1px solid #eaedef}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important}regular-table th{position:relative}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid #eee;height:100%}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding:0 5px;height:19px}regular-table tr:hover td{background:#eee;opacity:1}regular-table tr:hover{color:#333}regular-table table *{box-sizing:border-box}regular-table table{position:absolute;overflow:hidden;color:#666;outline:none}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family, "Material Icons")}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family, "Material Icons")}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px #1a7da1}regular-table .rt-selected td{background-color:#eee}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%}regular-table th span.rt-group-name{text-align:left}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize}regular-table a{color:var(--rt-pos-cell--color)}regular-table a:visited{color:var(--active--color)}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background-color:#0000;border-radius:5px}regular-table::-webkit-scrollbar-thumb:horizontal{border-bottom:2px solid transparent;border-top:2px solid transparent}regular-table::-webkit-scrollbar-thumb:vertical{border-left:2px solid transparent;border-right:2px solid transparent}regular-table:hover::-webkit-scrollbar-thumb{background-color:#00000026}regular-table::-webkit-scrollbar-thumb:hover{background-color:#0000004d}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0 var(--inactive--color, #eaedef)}.psp-header-group{box-shadow:0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-is-top{box-shadow:5px 4px 0 -4px var(--inactive--color, #eaedef)}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0 -4px var(--inactive--color, #eaedef),0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0 var(--inactive--color, #eaedef),0 10px 0 -9px var(--inactive--color, #eaedef)}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0 -4px var(--inactive--color, #eaedef)}tr:only-child th{box-shadow:none!important}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--rt-hover--border-color, #c5c9d080)!important;background-color:transparent;box-shadow:0 1px 0 var(--rt-hover--border-color, #c5c9d080),0 3px #0000000d,0 5px #00000003}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:1px;border-right-color:transparent}regular-table tbody tr:hover{color:#161616}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color, #c5c9d080)!important}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color, #c5c9d080)!important}perspective-viewer[settings] regular-table .psp-header-leaf{height:36px;vertical-align:top;padding-top:2px}perspective-viewer[settings] regular-table .psp-header-leaf:not(.psp-header-corner):before{font-family:var(--button--font-family, inherit);content:var(--column-style-open-button--content, var(--config-button-icon--content, "\\1f527"));position:absolute;width:calc(100% - 8px);left:5px;bottom:0px;color:var(--inactive--color, #b4b7be)}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:not(.psp-header-corner):before{color:inherit;cursor:pointer}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner){pointer-events:none}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-open:not(.psp-header-corner):before{content:var(--column-style-close-button--content, "X")}perspective-viewer[settings] regular-table .psp-header-leaf.psp-menu-enabled:hover:before{color:#338dcd}perspective-viewer[settings] regular-table .psp-header-leaf .rt-column-resize{height:18px}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:#fff!important;background-color:#ea7319!important;border-color:#ea7319!important}.psp-row-selected.psp-tree-label:not(:hover):before{color:#fff}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,.2)!important}.psp-error{color:red}td:focus{outline:#666;outline-style:dotted;outline-width:1px}perspective-viewer.dragging regular-table{pointer-events:none}.psp-header-border:last-child{border-right-width:0px}.psp-header-sort-desc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-desc--content, "\\2193")}.psp-header-sort-asc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-asc--content, "\\2191")}.psp-header-sort-col-desc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-col-desc--content, "\\2190")}.psp-header-sort-col-asc:after{font-family:var(--button--font-family, inherit);font-size:10px;content:var(--sort-order-col-asc--content, "\\2192")}tbody th:last-of-type{border-right:1px solid #eaedef;overflow:hidden;text-overflow:ellipsis}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,#eee 10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none}.psp-tree-label{max-width:0px;min-width:0px}.psp-tree-label:before{color:#ccc;font-family:var(--button--font-family, inherit);padding-right:11px;vertical-align:-1px}.psp-tree-label-expand:before{content:var(--tree-label-expand--content, "+")}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content, "-")}.psp-tree-label:hover:before{color:#338dcd;text-shadow:0px 0px 5px #338dcd}regular-table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--color, #eaedef)}.psp-tree-leaf{padding-left:24px}.psp-align-right{text-align:right}.psp-align-left{text-align:left}.psp-positive:not(:focus){color:var(--rt-pos-cell--color, #338dcd)}.psp-negative:not(:focus){color:var(--rt-neg-cell--color, #ff5942)}regular-table table tbody td{min-width:52px!important}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed #999;border-bottom-width:0px;border-left-width:0px}.psp-bool-type{font-family:var(--button--font-family, "Material Icons")}.boolean-editable{cursor:pointer}regular-table table{user-select:none;color:#161616;border-collapse:separate}regular-table table th{font-weight:400}regular-table table td,regular-table table th{border-color:#eaedef;height:23px}regular-table table .psp-header-group{text-overflow:ellipsis}regular-table table .psp-header-leaf{border-bottom-width:0px}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px}regular-table table tbody th:empty{background-position:0px -10px}
`;var jr=`:host{position:relative;display:block}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0}:host #toolbar{display:flex;align-items:center;height:36px}:host #slot-container{flex:1;position:relative}#scroll_lock.lock-scroll:before{content:"lock"}#scroll_lock:before{content:"lock_open"}#select_mode:before{content:"highlight_alt"}#edit_mode:before{content:"edit_off"}#edit_mode.editable:before{content:"edit"}:host(.aggregated) #toolbar #edit_mode{display:none}.button:before{color:var(--inactive--color, #ccc);line-height:36px;font-size:14px;font-family:var(--button--font-family, "Material Icons Outlined");vertical-align:bottom;margin:0 11px}.button.editable:before,.button.lock-scroll:before{color:inherit}.button{user-select:none;width:36px;box-sizing:border-box}.button>span{display:none;margin:0;padding:0}.button:hover{opacity:1;color:inherit;cursor:pointer;min-width:105px;background-color:#0000000d}.button:hover:before{margin:0 6px 0 11px}.button:hover>span{display:contents;font-size:12px;font-weight:300;line-height:36px}
`;async function wt({_view:t,_config:o},n,a){let c=o.group_by,u=o.split_by,p=n>=0?n:0,y=p+1,_=await t.to_json({start_row:p,end_row:y}),x=_.map(R=>R.__ROW_PATH__)[0]||[],E=c.map((R,Q)=>{let g=x[Q];return g?[R,"==",g]:void 0}).filter(R=>R),S=c.length>0?a+1:a,D=Object.keys(_[0])[S],q={row:_[0]},z=[];if(D){let R=D.split("|");q.column_names=[R[R.length-1]],z=u.map((Q,g)=>{let Y=R[g];return Y?[Q,"==",Y]:void 0}).filter(Q=>Q).filter(([,,Q])=>Q!=="__ROW_PATH__")}let C=o.filter.concat(E).concat(z);return q.config={filter:C},q}var Ue=new WeakMap;async function pi(t,o,n){let a=t.getMeta(n.target);if(!o.hasAttribute("selectable")||n.handled||n.which!==1||!a)return;let c=this._ids[a.y-a.y0];if(a&&a.y>=0){let u=Ue.get(t),p=!!u&&u.reduce((v,x,E)=>v&&x===c[E],!0),y=!!u&&c.length===u.length&&p,_=[];y?Ue.delete(t):(Ue.set(t,c),_=await wt(this,a.y,a.x),_=_.config.filter),await t.draw({preserve_width:!0}),n.handled=!0,o.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:{selected:!y,config:{filter:_}}}))}}function gi(t,o){if(!o.hasAttribute("selectable"))return;let n=Ue.has(t),a=Ue.get(t);for(let c of t.querySelectorAll("td"))if(!n)c.classList.toggle("psp-row-selected",!1),c.classList.toggle("psp-row-subselected",!1);else{let u=t.getMeta(c),p=this._ids[u.y-u.y0],y=a.reduce((_,v,x)=>_&&v===p[x],!0);c.classList.toggle("psp-row-selected",p.length===a.length&&y),c.classList.toggle("psp-row-subselected",p.length!==a.length&&y)}for(let c of t.querySelectorAll("tbody th")){let u=t.getMeta(c),p=this._ids[u.y-u.y0];if(!n||!!p[u.row_header_x])c.classList.toggle("psp-row-selected",!1),c.classList.toggle("psp-row-subselected",!1);else{let y=a.reduce((_,v,x)=>_&&v===p[x],!0);c.classList.toggle("psp-row-selected",p.length===a.length&&y),c.classList.toggle("psp-row-subselected",p.length!==a.length&&y)}}}function Rr(t,o){t.addStyleListener(gi.bind(this,t,o)),t.addEventListener("mousedown",pi.bind(this,t,o))}async function Ir(t){Ue.delete(t);for(let o of t.querySelectorAll("td,th"))o.classList.toggle("psp-row-selected",!1),o.classList.toggle("psp-row-subselected",!1)}async function bi(t,o,n){let a=t.getMeta(n.target);if(!a)return;let{x:c,y:u}=a,{row:p,column_names:y,config:_}=await wt(this,u,c);o.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:p,column_names:y,config:_}}))}function Dr(t,o){t.addEventListener("click",bi.bind(this,t,o))}var Xe=new WeakMap;function mi(t){let o;return async function(...n){if(!!o&&await o&&!!o)return;let a;o=new Promise(c=>a=c),await t.apply(this,n),o=void 0,a()}}function Wr(){if(this.isContentEditable){let t=document.getSelection().getRangeAt(0),o=t.cloneRange();return o.selectNodeContents(this),o.setEnd(t.endContainer,t.endOffset),o.toString().length}else return this.target.selectionStart}function Hr(t,o,n){let a=t.getMeta(n),c=o._schema[o._column_paths[a.x]];if(a){let u=n.textContent,p=o._ids[a.y-a.y0];if(c==="float"||c==="integer"){if(u=parseFloat(u.replace(/,/g,"")),isNaN(u))return!1}else if(c==="date"||c==="datetime"){if(u=Date.parse(u),isNaN(u))return!1}else c==="boolean"&&(u=u==="check"?!1:u==="close"?!0:null);let y={__INDEX__:p,[o._column_paths[a.x]]:u};return o._table.update([y],{port_id:o._edit_port}),!0}}function Ft(t,o=!1){let n=this._config.group_by.length===0&&this._config.split_by.length===0,a=t.hasAttribute("selectable"),c=o||!!t.children[0]._is_edit_mode;return n&&!a&&c}var Ke=mi(async function(t,o,n,a){let c=t.getMeta(o),u=this._column_paths.length,p=this._num_rows,y=Xe.get(t);if(!y)return;c.x+n<u&&0<=c.x+n&&(y.x=c.x+n),c.y+a<p&&0<=c.y+a&&(y.y=c.y+a);let _=Math.max(c.x0-10,0),v=Math.min(c.x0+10,u),x=Math.max(c.y0-5,0),E=Math.min(c.y0+10,p),S=c.x0+n,D=c.y0+a;for(;!Tr(t)&&S>=_&&S<v&&D>=x&&D<E;)await t.scrollToCell(S,D,u,p),Xe.set(t,y),S+=n,D+=a});function vi(t,o){let n=t[ve]||{},a=Ft.call(this,o);t.parentElement.classList.toggle("edit-mode-allowed",Ft.call(this,o,!0));for(let c of t.querySelectorAll("td")){let u=t.getMeta(c),p=this.get_psp_type(u);if(this._is_editable[u.x]){let y=u.column_header[u.column_header.length-1];p==="string"&&n[y]?.format==="link"?(c.toggleAttribute("contenteditable",!1),c.classList.toggle("boolean-editable",!1)):p==="boolean"?(c.toggleAttribute("contenteditable",!1),c.classList.toggle("boolean-editable",u.user!==null)):(a!==c.hasAttribute("contenteditable")&&c.toggleAttribute("contenteditable",a),c.classList.toggle("boolean-editable",!1))}else c.toggleAttribute("contenteditable",!1),c.classList.toggle("boolean-editable",!1)}}var Tr=t=>{let o=t.querySelectorAll("td"),n=Xe.get(t);if(n){for(let a of o){let c=t.getMeta(a);if(c.x===n.x&&c.y===n.y)return document.activeElement!==a&&a.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&t.contains(document.activeElement)&&document.activeElement.blur()}};function yi(t,o,n){if(!Ft.call(this,o))return;let a=document.activeElement;switch(n.target.classList.remove("psp-error"),n.keyCode){case 13:n.preventDefault(),n.shiftKey?Ke.call(this,t,a,0,-1):Ke.call(this,t,a,0,1);break;case 37:Wr.call(a)==0&&(n.preventDefault(),Ke.call(this,t,a,-1,0));break;case 38:n.preventDefault(),Ke.call(this,t,a,0,-1);break;case 39:Wr.call(a)==a.textContent.length&&(n.preventDefault(),Ke.call(this,t,a,1,0));break;case 40:n.preventDefault(),Ke.call(this,t,a,0,1);break;default:}}function wi(t,o,n){if(Ft.call(this,o)&&Xe.has(t)){n.target.classList.remove("psp-error");let a=Xe.get(t);Xe.delete(t),a.content!==n.target.textContent&&(Hr(t,this,n.target)||(n.target.textContent=a.content,n.target.classList.add("psp-error"),n.target.focus()))}}function xi(t,o,n){let a=t.getMeta(n.target);if(a){let c={x:a.x,y:a.y,content:n.target.textContent};Xe.set(t,c)}}function ki(t,o,n){let a=t.getMeta(n.target);if(typeof a?.x!="undefined"){let c=this._is_editable[a.x],u=this.get_psp_type(a)==="boolean",p=n.target.textContent==="-";c&&u&&!p&&Hr(t,this,n.target)}}async function qr(t,o){this._edit_port=await o.getEditPort(),t.addStyleListener(vi.bind(this,t,o)),t.addStyleListener(Tr.bind(this,t,o)),t.addEventListener("click",ki.bind(this,t,o)),t.addEventListener("focusin",xi.bind(this,t,o)),t.addEventListener("focusout",wi.bind(this,t,o)),t.addEventListener("keydown",yi.bind(this,t,o))}async function Gr(t,o){t.addEventListener("regular-table-psp-sort",n=>{this._preserve_focus_state=!0,o.restore({sort:n.detail.sort})})}customElements.define("perspective-viewer-datagrid",class extends HTMLElement{constructor(){super();this.datagrid=document.createElement("regular-table"),this.datagrid.formatters=Ar,this._is_scroll_lock=!0}connectedCallback(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar"),this._toolbar.setAttribute("slot","plugin-settings"),this._toolbar.attachShadow({mode:"open"}),this._toolbar.shadowRoot.innerHTML=`
                    <style>
                        ${jr}
                    </style>
                    <div id="toolbar">
                        <span id="scroll_lock" class="lock-scroll button"><span>Align Scroll</span></span>
                        <span id="edit_mode" class="button"><span>Read Only</span></span>
                    </div>
                `,this._scroll_lock=this._toolbar.shadowRoot.querySelector("#scroll_lock"),this._scroll_lock.addEventListener("click",()=>this._toggle_scroll_lock()),this._edit_mode=this._toolbar.shadowRoot.querySelector("#edit_mode"),this._edit_mode.addEventListener("click",()=>{this._toggle_edit_mode(),this.datagrid.draw()})),this.parentElement.appendChild(this._toolbar)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}_toggle_edit_mode(t=void 0){typeof t=="undefined"&&(t=!this._is_edit_mode),this._is_edit_mode=t,this.classList.toggle("editable",t),this._edit_mode.classList.toggle("editable",t),t?this._edit_mode.children[0].textContent="Editable":this._edit_mode.children[0].textContent="Read Only"}_toggle_scroll_lock(t=void 0){typeof t=="undefined"&&(t=!this._is_scroll_lock),this._is_scroll_lock=t,this.classList.toggle("sub-cell-scroll-enabled",!t),this._scroll_lock.classList.toggle("lock-scroll",t),t?this._scroll_lock.children[0].textContent="Align Scroll":this._scroll_lock.children[0].textContent="Free Scroll"}async activate(t){let o=this.parentElement,n=await o.getTable(!0);this._initialized?await Ut(this.datagrid,n,t,this.model):(this.innerHTML="",this.appendChild(this.datagrid),this.model=await Ut(this.datagrid,n,t),Fr(this.datagrid,this.model),await Rr.call(this.model,this.datagrid,o),await Dr.call(this.model,this.datagrid,o),await qr.call(this.model,this.datagrid,o),await Gr.call(this.model,this.datagrid,o),this._initialized=!0)}get name(){return"Datagrid"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){}async draw(t){if(!this.isConnected)return;let o=this._save_column_size_overrides();await this.activate(t);let n=this.parentElement,a=this.datagrid.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.datagrid.scrollTop=0,this.datagrid.scrollLeft=0,Ir(this.datagrid,n),this.datagrid._resetAutoSize()),this._restore_column_size_overrides(o),await a,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}async update(t){this.model._num_rows=await t.num_rows(),await this.datagrid.draw()}async resize(){this._initialized&&await this.datagrid.draw()}async clear(){this.datagrid._resetAutoSize(),this.datagrid.clear()}save(){if(this.datagrid){let t=this.datagrid,o={columns:{},scroll_lock:!!this._is_scroll_lock,editable:!!this._is_edit_mode};for(let a of Object.keys(t[ve]||{})){let c=Object.assign({},t[ve][a]);c?.pos_color&&(c.pos_color=c.pos_color[0],c.neg_color=c.neg_color[0]),c?.color&&(c.color=c.color[0]),o.columns[a]=c}let n=this._save_column_size_overrides();for(let a of Object.keys(n||{}))o.columns[a]||(o.columns[a]={}),o.columns[a].column_size_override=n[a];return JSON.parse(JSON.stringify(o))}return{}}restore(t){t=JSON.parse(JSON.stringify(t));let o={};if(t.columns)for(let a of Object.keys(t.columns)){let c=t.columns[a];c.column_size_override!==void 0&&(o[a]=c.column_size_override,delete c.column_size_override),c?.pos_color&&(c.pos_color=Ye(c.pos_color),c.neg_color=Ye(c.neg_color)),c?.color&&(c.color=Ye(c.color)),Object.keys(c).length===0&&delete t.columns[a]}"editable"in t&&this._toggle_edit_mode(t.editable),"scroll_lock"in t&&this._toggle_scroll_lock(t.scroll_lock);let n=this.datagrid;try{n._resetAutoSize()}catch{}this._restore_column_size_overrides(o,!0),n[ve]=t.columns}async restyle(t){this.draw(t)}delete(){this.datagrid.table_model&&this.datagrid._resetAutoSize(),this.datagrid.clear()}_save_column_size_overrides(){if(!this._initialized)return[];if(this._cached_column_sizes){let u=this._cached_column_sizes;return this._cached_column_sizes=void 0,u}let t=this.datagrid._column_sizes.override,{group_by:o,columns:n}=this.model._config,a=o?.length>0?o.length+1:0,c={};for(let u of Object.keys(t))if(t[u]!==void 0){let p=u-a;p>-1&&(c[this.model._column_paths[p]]=t[u])}return c}_restore_column_size_overrides(t,o=!1){if(!this._initialized)return;o&&(this._cached_column_sizes=t);let n={},{group_by:a,columns:c}=this.model._config,u=a?.length>0?a.length+1:0;for(let p of Object.keys(t)){let y=this.model._column_paths.indexOf(p);n[y+u]=t[p]}this.datagrid._column_sizes.override=n}});function Li(){let t=document.createElement("style");t.textContent=Pr,document.head.insertBefore(t,document.head.firstChild)}function Mi(){customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}customElements.whenDefined("perspective-viewer").then(Mi);Li();})();
/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */
/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
//# sourceMappingURL=perspective-viewer-datagrid.js.map
